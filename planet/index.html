<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    
    <meta content="IE=8" http-equiv="X-UA-Compatible"/>
    <title>OCaml :: OCaml Planet</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <meta content="Ashish Agarwal, Esther Baruk, Christophe Troestler and many contributors" name="author"/>
    <meta content="" name="description"/>
    <meta content="" name="keywords"/>
    <meta content="OCaml (Weberizer)" name="generator"/>

    <link href="http://ocaml.org/img/favicon.ico" rel="shortcut icon"/>
    <link rel="stylesheet" href=".././css/bootstrap.css"/>
    <link href=".././css/ocaml.css" media="all" type="text/css" rel="stylesheet"/>
    <link rel="stylesheet" href=".././css/bootstrap-responsive.css"/>

    
    

    <meta content="OCaml Planet" property="og:title"/>
    <meta content="non_profit" property="og:type"/>

    <meta content="all" name="robots"/>
  </head>
  <body>
    <div id="header">
      <div class="top">
      </div>
      <div class="bottom">
      </div>
    </div>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
	  
          <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a href=".././" class="brand">OCaml</a>

          <div class="nav-collapse">
            <ul class="nav">
	      <li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">
    Discover
    <b class="caret"></b>
  </a>
  <ul class="dropdown-menu">
    <li><a href="../description.html">What is OCaml?</a></li>
    <li><a href="http://try.ocamlpro.com/">Try it Online</a></li>
    <li><a href="../taste.html">100 Lines of OCaml</a></li>
    <li><a href="../success.html">Success Stories</a></li>
    <li><a href="../companies.html">Who Is Using It?</a></li>
    <li><a href="http://pleac.sourceforge.net/pleac_ocaml/">Pleac</a></li>
    <li><a href="http://rosettacode.org/wiki/Category:OCaml">Rosetta</a>
        <a href="http://langref.org/ocaml">langref.org</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">
    Learn
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../install.html">Install</a></li>
    <li><a href="../tutorials/">Tutorials</a></li>
    <li><a href="../faq.html">FAQ</a></li>
    <li><a href="../books.html">Books</a></li>
    <li><a href="../videos.html">Videos</a></li>
    <li><a href="../papers.html">Papers</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">Use
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../releases/">Releases</a></li>
    <li><a href="../libraries.html">Libraries</a></li>
    <li><a href="../dev_tools.html">Development Tools</a></li>
    <li><a href="http://caml.inria.fr/pub/docs/manual-ocaml/">User Manual</a></li>
    <li><a href="../cheat_sheets.html">Cheat Sheets</a></li>
    <li><a href="http://search.ocaml.jp/">OCaml API Search</a></li>
    <li><a href="http://forge.ocamlcore.org/">Forge</a></li>
    <li><a href="https://github.com/languages/OCaml">GitHub</a></li>
    <li><a href="https://bitbucket.org/repo/all?name=ocaml">Bitbucket</a></li>
    <li><a href="http://gitorious.org/search?page=1&q=ocaml">Gitorious</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">Community
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../mailing_lists.html">Mailing Lists</a></li>
    <li><a href="../planet/">Blogs</a></li>
    <li><a href="../meetings/">Meetings</a></li>
    <li><a href="irc://irc.freenode.net/ocaml">IRC</a></li>
    <li><a href="http://stackoverflow.com/questions/tagged?tagnames=ocaml">Stack Overflow</a></li>
    <li><a href="http://www.reddit.com/r/ocaml/">Reddit</a></li>
    <li><a href="../support.html">Commercial Support</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">More
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="http://caml.inria.fr/mantis/">Mantis Bug Tracker</a></li>
    <li><a href="../caml-light/">Caml Light</a></li>
    <li><a href="../logos.html">Logos</a></li>
  </ul>
</li>

            </ul>
	    <form action="http://www.google.com/search" method="get" class="navbar-search pull-right">
	      <input placeholder="Search" class="search-query" name="q" type="text"/>
	      <input value="site:http://ocaml.org/" name="q" type="hidden"/>
	    </form>
            
	    
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <span class="navigation-bar">
	<a href="./../">Home</a><span class="separation"><img src=".././img/right_arrow.png" alt="&gt;"/></span>OCaml Planet
	<span id="language">
	  <span class="horizontal-toolbar"><span class="open-bracket">[</span><span class="current-url">En</span><span class="close-bracket">]</span></span>
	</span>
      </span>

      

    <h1>OCaml Planet</h1>

    <p>The OCaml Planet aggregates various blogs from the OCaml
    community.  It is kindly provided
    by <a href="http://www.ocamlcore.com/">OCamlCore</a>.  If you
    would like to be added, read
    the <a href="http://www.ocamlcore.org/planet/">Planet
    subscription HOWTO</a>.</p>

    <br/>
    <div style="float: right; margin-right: 0; margin-top: 0" class="span2 planet-subscriptions"><em>Subscriptions</em>
      <ul><li><a href="http://alexleighton.tumblr.com/tagged/ocaml/rss">Alex Leighton</a></li><li><a href="http://feeds.feedburner.com/amirmc-ocaml">Amir Chaudhry</a></li><li><a href="http://andreiformiga.com/blog/?cat=5&feed=rss2">Andrei Formiga</a></li><li><a href="http://math.andrej.com/feed/">Andrej Bauer</a></li><li><a href="http://anil.recoil.org/feeds/atom.xml">Anil Madhavapeddy</a></li><li><a href="http://ashishagarwal.org/tag/ocaml/feed/">Ashish Agarwal</a></li><li><a href="http://www.blogger.com/feeds/7617521785419311079/posts/default">Cameleon news</a></li><li><a href="http://caml.inria.fr/news.en.rss">Caml INRIA</a></li><li><a href="http://camlspotter.blogspot.com/feeds/posts/default?alt=rss">Caml Spotting</a></li><li><a href="http://alan.petitepomme.net/cwn/cwn.rss">Caml Weekly News</a></li><li><a href="http://coherentpdf.com/blog/?tag=ocaml&feed=rss">Coherent Graphics</a></li><li><a href="http://coq.inria.fr/news/feed">Coq</a></li><li><a href="http://erratique.ch/feeds/news.atom">Daniel Bünzli</a></li><li><a href="http://nleyten.com:82/feed/tag/ocaml/atom">Dario Teixeira</a></li><li><a href="http://www.blogger.com/feeds/17133288/posts/default/-/ocaml">David Baelde</a></li><li><a href="http://blog.bentobako.org/index.php?feed/tag/ocaml/atom">David Mentré</a></li><li><a href="http://dutherenverseauborddelatable.wordpress.com/category/ocaml/feed/">David Teller</a></li><li><a href="http://www.examachine.net/blog/cat/ocaml/feed/">Eray Özkural</a></li><li><a href="http://www.mega-nerd.com/erikd/Blog/index.rss20">Erik de Castro Lopo</a></li><li><a href="http://blog.emillon.org/feeds/ocaml.xml">Etienne Millon</a></li><li><a href="http://frama-c.com/rss.xml">Frama-C</a></li><li><a href="http://functionaljobs.com/jobs/search/?q=ocaml&format=rss">Functional Jobs</a></li><li><a href="http://gallium.inria.fr/blog/index.rss">GaGallium</a></li><li><a href="http://gaiustech.wordpress.com/category/ocaml/feed/">Gaius Hammond</a></li><li><a href="http://blog.camlcity.org/blog/rss">Gerd Stolpmann</a></li><li><a href="http://jobs.github.com/positions.atom?description=ocaml&location=">Github OCaml jobs</a></li><li><a href="http://www.wisdomandwonder.com/tag/OCaml/feed">Grant Rettke</a></li><li><a href="http://hongboz.wordpress.com/feed/">Hong bo Zhang</a></li><li><a href="http://blog.incubaid.com/tag/ocaml/feed/">Incubaid Research</a></li><li><a href="http://ambassadortothecomputers.blogspot.com/feeds/posts/default?alt=rss">Jake Donham</a></li><li><a href="http://scattered-thoughts.net/atom.xml">Jamie Brandon</a></li><li><a href="https://ocaml.janestreet.com/?q=rss.xml">Jane Street</a></li><li><a href="http://lpw25.net/rss.xml">Leo White</a></li><li><a href="http://www.lexifi.com/blogs/ocaml/feed">LexiFi</a></li><li><a href="http://newblog.0branch.com/rss.xml">Marc Simpson</a></li><li><a href="http://syntaxexclamation.wordpress.com/tag/ocaml/feed/">Matthias Puech</a></li><li><a href="http://www.blogger.com/feeds/5888658295182480819/posts/default">Matías Giovannini</a></li><li><a href="">Mihamina Rakotomandimby</a></li><li><a href="http://mcclurmc.wordpress.com/feed/">Mike McClurg</a></li><li><a href="http://nyc-ocaml.posterous.com/rss.xml">NYC OCaml</a></li><li><a href="http://ocaml-book.com/blog?format=rss">OCaml Book</a></li><li><a href="http://forge.ocamlcore.org/export/rss_sfnews.php">OCamlCore Forge News</a></li><li><a href="http://forge.ocamlcore.org/export/rss_sfprojects.php">OCamlCore Forge Projects</a></li><li><a href="http://www.ocamlcore.com/wp/?feed=rss2&amp;language=en&#038;language=en">OCamlCore.com</a></li><li><a href="http://www.ocamlpro.com/feed/atom.xml">OCamlPro</a></li><li><a href="http://odns.tuxfamily.org/feed/">ODNS project</a></li><li><a href="http://ox.tuxfamily.org/feed/">Ocaml XMPP project</a></li><li><a href="http://ocsigen.org/news.atom">Ocsigen project</a></li><li><a href="http://www.blogger.com/feeds/2073503406800427577/posts/default">Opa</a></li><li><a href="http://www.openmirage.org/blog/atom.xml">Open Mirage</a></li><li><a href="http://functional-orbitz.blogspot.com/feeds/posts/default/-/planetocaml?alt=rss">Orbitz</a></li><li><a href="http://www.donadeo.net/facets/programming-languages/objective-caml/feed/">Paolo Donadeo</a></li><li><a href="https://mancoosi.org/~abate/taxonomy/term/5/0/feed">Pietro Abate</a></li><li><a href="http://rwmj.wordpress.com/tag/ocaml/feed/">Richard Jones</a></li><li><a href="http://blog.rastageeks.org/spip.php?page=rss&id_mot=2">Romain Beauxis</a></li><li><a href="http://seb.mondet.org/blog/feed/ocaml.rss">Sebastien Mondet</a></li><li><a href="http://upsilon.cc/~zack/tags/ocaml/index.rss">Stefano Zacchiroli</a></li><li><a href="http://le-gall.net/sylvain+violaine/blog/index.php?feed/tag/ocaml/atom">Sylvain Le Gall</a></li><li><a href="http://caml.inria.fr/hump.rss">The Caml Humps</a></li><li><a href="http://www.blogger.com/feeds/6115529230232389198/posts/default">Till Varoquaux</a></li><li><a href="http://y-node.com/blog/feeds/latest/">y-node</a></li></ul>

      <a href="http://planet.ocaml.org/rss20.xml"><img src=".././img/rss20.png"/></a>
      <a href="http://planet.ocaml.org/opml.xml"><img src=".././img/opml.png"/></a>
    </div>
    <div class="planet"><a name="2895e571d9df92eaff657637a147984b"></a><span class="rss-header"><span class="rss-title"><a href="http://anil.recoil.org/2013/08/06/real-world-ocaml-beta2"> Final Real World OCaml beta; the good, the bad and the ugly</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Anil Madhavapeddy</span>, <span class="rss-date">05 AUg 2013</span></span><span class="rss-description"><div id="post1"><p>The second and final public beta of Real World OCaml is now available: <a href="https://realworldocaml.org">https://realworldocaml.org</a></p> <p>Release notes:</p> <a onclick="switchContent('post1','post2')" class="btn" href="#2895e571d9df92eaff657637a147984b">Read more...</a></div><div id="post2" style="display: none"><p>The second and final public beta of Real World OCaml is now available: <a href="https://realworldocaml.org">https://realworldocaml.org</a></p> <p>Release notes:</p> <ul> <li> <p>Over 2,000 comments from proofreaders have been resolved. We realize that reading early content is hard work, and hugely appreciate the spirited feedback! The book is now a week away from being handed over to the O’Reilly production team for copyediting, so the window for changes are limited after that. Comments reset between milestones and so beta2 is a clean slate; we’re still working through some remaining older issues.</p> </li> <li> <p>The chapters on first-class modules, parsing with Menhir, and objects and classes have been significantly revised from beta1. Our thanks to Leo White for contributing significantly to the latter two chapters.</p> </li> <li> <p>All the code snippets and terminal outputs are now mechanically generated. The source code is as close to public domain as practical, at: <a href="https://github.com/realworldocaml/examples">https://github.com/realworldocaml/examples</a></p> </li> <li> <p>The final version will have the installation chapter moved to be online only, and we intend to publish updates there to elaborate on installation and packaging mechanisms.</p> </li> <li> <p>Exercises will be available after we go into production, and also only be available online. We really like the collaborative spirit of the commenting system, and will likely extend this to collecting exercises from our readers on an ongoing basis.</p> </li> </ul> <p>There’s been quite a bit of feedback and conversation about the book, so this also seemed like a good point to checkpoint the process somewhat.</p> <h2 id="crowd_sourcing_community_feedback">Crowd sourcing community feedback</h2> <a href="http://realworldocaml.org"><img src="http://anil.recoil.org/images/oreilly-cover.gif" align="right" style="padding-left: 15px;"/></a> <p><em>Good</em>: The decision to crowdsource feedback has been exhausting but very worthwhile, with over 2,200 <a href="http://github.com/ocamllabs/rwo-comments">comments</a> posted (and over 2,000 resolved by us too!). O’Reilly has a similar platform called <a href="http://atlas.labs.oreilly.com">Atlas</a> that wasn’t quite ready when we started our book, but I’d highly encourage new authors to go down this route and not stick with a traditional editorial scheme.</p> <p>It’s simply not possible for a small group of technical reviewers to notice as many errors as the wider community has. Having said this, it’s interesting how much more focussed and critical the comments of our editor <a href="http://radar.oreilly.com/andyo">Andy Oram</a> were when compared to most of the wider community feedback, so the commenting system is definitely a complement and not a replacement to the editorial process.</p> <h3 id="the_github_requirement">The GitHub requirement</h3> <p><em>Bad</em>: After the first beta, we got criticized on a <a href="https://news.ycombinator.com/item?id=5893168">Hacker News</a> thread for passing around Github oAuth tokens without SSL. This was entirely my fault, and I corrected the site to be pure-SSL within 24 hours.</p> <p><em>Ugly</em>: In my defence though, I <em>dont want</em> the authority that all the reviewers have granted to me for their Github accounts! We need just two things to enable commenting: an identity service to cut down on spam comments, and the ability to create issues in a <a href="http://github.com/ocamllabs/rwo-comments">public repository</a>. Unfortunately, Github’s <a href="http://developer.github.com/v3/oauth/#scopes">scope</a> API requires you to also grant us access to commit to public code repositories. Add on the fact that around 6,000 people have clicked through the oAuth API to review RWO, and you start to see just how much code we potentially have access to. I did try to reduce the damage by not actually storing the oAuth tokens on the server-side. Instead, we store it in the client using a secure cookie, so you can easily reset your browser to log out.</p> <p>It’s not just about authentication either: another reader <a href="http://www.reddit.com/r/ocaml/comments/1gil84/public_beta_of_real_world_ocaml/cal811r">points out</a> that if they use GitHub during work hours, they have no real way of separating the news streams that result.</p> <p>Much of the frustration here is that there’s nothing I can do to fix this except wait for GitHub to hopefully improve their service. I very much hope that GitHub is listening to this and has internal plans to overhaul their privilege management APIs.</p> <p><em>Good</em> and <em>Bad</em>: One of my goals with the commenting infrastructure was to try and eliminate all server-side code, so that we could simply publish the book onto Github Pages and use JavaScript for the comment creation and listing.</p> <p>This <em>almost</em> worked out. We still need a tiny HTTP proxy for comment creation, as we add contextual information such as a milestone to every new comment to make it easier to index. Setting a milestone requires privileged access to the repository and so our server-side proxy creates the issue using the user-supplied oAuth token (so that it originates from the commenter), and then updates it (via the <a href="http://github.com/bactrian">bactrian</a> account) to add the milestone add insert a little contextual comment pointing back to the book paragraph where the comment originated from.</p> <h3 id="infrastructurefree_hosting">Infrastructure-free hosting</h3> <p><em>Good</em>: The other criticism from the <a href="http://www.reddit.com/r/programming/comments/1gipea/first_public_beta_of_real_world_ocaml_book/cakmeuz">online feedback</a> was the <em>requirement</em> to have a Github login to read the book at all. This is a restriction that we intend to lift for the final release (which will be freely available online under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/us/">CC-BY-NC-ND</a> license), but I think it’s absolutely the right decision to gateway early adopters to get useful feedback. Even if we lost 90% of our potential reviewers through the Github auth wall, I don’t think we could have coped with another 10,000 comments in any case.</p> <p>On the positive side, we didn’t have a single spam comment or other abuses of the commenting system at all.</p> <p>I’ve had quite a few queries been open-sourcing the <a href="http://github.com/realworldocaml/scripts">scripts</a> that drive the server-side commenting, and this on my TODO list for after the final book has gone to production.</p> <h2 id="autogenerating_the_examples">Auto-generating the examples</h2> <p><em>Bad</em>: We tried for far too long during the book writing to stumble through with manual installation instructions and hand-copied code snippets and outputs. Some of our alpha reviewers pointed out <a href="https://github.com/ocamllabs/rwo-comments/issues/236">vociferously</a> that spending time on installation and dealing with code typos was not a good use of their time.</p> <p><em>Good</em>: <a href="http://bolinfest.com">Michael Bolin</a> was entirely correct in his criticism (and incidentally, one of our most superstar reviewers). The latest beta has an entirely mechanically generated toolchain that lets us regenerate the entire book output from a cold start by cloning the <a href="https://github.com/realworldocaml/examples">examples</a> repository. In retrospect, I should have written this infrastructure a year ago, and I’d recommend any new books of this sort focus hard on automation from the early days.</p> <p>Luckily, my automation <a href="https://github.com/realworldocaml/scripts">scripts</a> could crib heavily from existing open-source OCaml projects that had portions of what we needed, such as <a href="https://github.com/diml/utop">uTop</a> and <a href="https://github.com/ocaml/ocaml.org">ocaml.org</a> (and my thanks to <a href="https://github.com/diml">Jeremie Dimino</a> and <a href="https://github.com/Chris00">Christophe Troestler</a> for their help here).</p> <p><em>Awesome</em>: We’re hacking on a little surprise for the final online version of the book, based on this build infrastructure. Stay <a href="http://try.ocamlpro.com">tuned</a>!</p><a onclick="switchContent('post2','post1')" class="btn" href="#2895e571d9df92eaff657637a147984b">Hide</a></div></span>
<a name="141badefecc893bf03e7aae299c52c16"></a><span class="rss-header"><span class="rss-title"><a href="http://www.ocamlpro.com/blog/2013/08/05/monthly-07.html"> News from July</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author"><span id="ocaml_1">OCamlPro &#9001;thomas<abbr title="(at) &rarr; @">(at)</abbr>ocamlpro.com (Thomas Gazagnaire)&#9002;</span><script type="text/javascript"><!--;
local = "thomas";
h = "ocamlpro.com (Thomas Gazagnaire)";
hq = "ocamlpro.com%20(Thomas%20Gazagnaire)";
document.getElementById("ocaml_1").innerHTML = '<a href="mailto:' + local + '@' + hq + "\" >OCamlPro<\/a>";
//--></script></span>, <span class="rss-date">05 AUg 2013</span></span><span class="rss-description"><div id="post3"><p>Once again, here is the summary of our activities for last month. The highlight this month is the release of <a href="http://www.typerex.org/ocaml-top.html">ocaml-top</a>, an interactive editor for education which works well under Windows and that we hope professors all around the world will use to teach OCaml to their students. We are also continuying our work on the improvement of the performance of OCaml, with new inlining heuristics in the compiler and adding multicore support to the runtime.</p><h2>Compiler updates</h2><p>Last month, we started to get very nice results with our compiler performance improvements. First, Pierre Chambart polished the prototype implementation of his new <code>flamba</code> intermediate language and he started to get impressive <a href="http://www.ocamlpro.com/blog/2013/07/11/inlining-progress-report.html">micro-benchmarks results</a>, with around 20% - 30% improvements on code using exceptions or functors. Following a discussion with our industrial users, he is currently focusing on improving the compilation of local recursive functions such as the very typical:</p><pre><code>let f x y = let rec loop v = ... x ... loop z in loop x </code></pre><a onclick="switchContent('post3','post4')" class="btn" href="#141badefecc893bf03e7aae299c52c16">Read more...</a></div><div id="post4" style="display: none"><p>Once again, here is the summary of our activities for last month. The highlight this month is the release of <a href="http://www.typerex.org/ocaml-top.html">ocaml-top</a>, an interactive editor for education which works well under Windows and that we hope professors all around the world will use to teach OCaml to their students. We are also continuying our work on the improvement of the performance of OCaml, with new inlining heuristics in the compiler and adding multicore support to the runtime.</p><h2>Compiler updates</h2><p>Last month, we started to get very nice results with our compiler performance improvements. First, Pierre Chambart polished the prototype implementation of his new <code>flamba</code> intermediate language and he started to get impressive <a href="http://www.ocamlpro.com/blog/2013/07/11/inlining-progress-report.html">micro-benchmarks results</a>, with around 20% - 30% improvements on code using exceptions or functors. Following a discussion with our industrial users, he is currently focusing on improving the compilation of local recursive functions such as the very typical:</p><pre><code>let f x y = let rec loop v = ... x ... loop z in loop x </code></pre><p>A simple and reasonably efficient solutions is to eta-expand the auxiliary function, i.e. add an intermediate function calling the loop with all closure parameters passed as variables. The hard part is to then to add the right arguments to all the call sites: luckily enough the new inlining engine already does that kind of analysis so it can be re-used here. This means that these constructs will be compiled efficiently by the new inlining heuristics.</p><p>Second, Luca Saiu has finished debugging the native thread support on top of his <a href="https://github.com/lucasaiu/ocaml">multi-runtime variant of OCaml</a>, which has become quite usable and is pretty robust now. He has tentatively started adding support for <code>vmthreads</code> as well, concurrently cleaning up context finalization and solving other minor issues, such as configuration scripts for architectures that do not support the multi-runtime features yet. Then, after writing documentation and running a full pass over the sources to remove debugging stubs and prints which pollute the code after months of low-level experimentation, he is going to prepare patches for discussion and submission to the main OCaml compiler.</p><p>Çagdas Bozman continued to improve the implementation of his <a href="https://github.com/cago/ocaml">profiling tools</a> for both native and byte-code programs. A great output of his recent work is that the location information is much more precise: with very different techniques for native and byte code, the program locations are now uniquely identified. The usability was improved as well, as the profiling location tables are now embedded directly into the programs. He also improved the post-mortem profiling tools to re-type dumped heaps, which also leads to much more accurate profiling information. Çagdas is now actively using these tools on <a href="http://why3.lri.fr/">why3</a> and he expects to get feedback results very soon to continue to improve his tools.</p><p>Finally, Thomas Blanc is still working on whole program analysis for his internship, in order to find possibly uncaught exceptions. The project is moving quite well and the month was spent on analyzing the lambda intermediate representation of the compilation step. With the help of Pierre Chambart, he is working on a <a href="https://github.com/thomasblanc/ocaml-data-analysis">0-CFA library</a> that should allow to compute the "possible" values for each variable at each point of the program. The idea is to make a directed hypergraph with each hyperedge representing an instruction and each vertex being a state of the program. Then search a fixpoint in the possible values propagated through the graph. This allows the compiler to know everywhere in the program what possible values may be returned or what possible exceptions may be raised. In order to create a well-designed graph, it is needed to create a new intermediate representation that looks like Lambda except (mainly) that every expression gets an identifier. The next step is to specify a hypergraph construction for each primitive and control-flow.</p><h2>Development Tools</h2><h3>Editors</h3><p>This month, Louis Gesbert has been busy making the first release of <a href="http://www.typerex.org/ocaml-top.html">ocaml-top</a>, the simple graphical top-level for beginners and students. Together with the web-IDE, this project aims at lowering the entry barrier to OCaml. Ocaml-top features a clean and easy to access interface, with nonetheless advanced features like automatic semantic indentation, error marking, and integrated display of standard library types -- using the engines of <a href="https://github.com/OCamlPro/ocp-indent">ocp-indent</a> and <a href="https://github.com/OCamlPro/ocp-index">ocp-index</a> of course. The biggest challenge was probably to make everything work as expected on Microsoft Windows, which was required for most beginners and classrooms. The two main issues were:</p><p></p><p><img src="http://www.typerex.org/ocaml-top-resources/screenshot_1.png" alt="ocaml-top" width="720px"/></p><p></p><ul> <li> <p>Setup the build environment: there are several versions of OCaml for Windows ; we generally want to avoid any dependency on cygwin on the generated program, but it's very hard to avoid any need for it in the build chain. The easiest solution at the moment is to "cross-compile" from cygwin using the mingw32 gcc compiler. The hard part is to get all the needed libraries properly setup: this felt a lot like Linux 15 years ago, you can find some binaries but generally not properly configured, and there is no consistent packaging system (or at least you can't find what you want in it).</p> </li><li> <p>Process management: ocaml-top runs the OCaml toplevel as a sub-process, so as not to be inpaired by any problem in the user program. Interacting with that process in a portable way is close to impossible, Windows having no POSIX signals, and read/write operations being very different in terms of blocking, etc. Some obscure C bindings were required to simulate a SIGINT that could tell the ocaml process to stop the current computation and return to the prompt. But at this cost, ocaml-top can be run with any existing external OCaml toplevel.</p> </li> </ul><p>Not mentioning some gtk/lablgtk bugs that were often OS-specific. After having read <a href="http://gallium.inria.fr/~scherer/gagallium/the-ocaml-installer-for-windows/">horror stories</a> about the most commonly used "Windows installer generator" <a href="http://nsis.sourceforge.net/Main_Page">NSIS</a>, Louis opted for the Microsoft open source solution <a href="http://wixtoolset.org/">WiX</a> which turned out to be quite clean and efficient, although using a lot of XML. The only point that might be in favor of NSIS is that it can generate the installer from Linux, so it's much convenient when you cross-compile, which is not the case here ; also worth mentioning, Xen and LVM are really great tools which do save a lot of time when working and testing between two (or more) different OSes.</p><p>Always on the editor front, David and Pierrick have been working on a web-IDE for OCaml since the beginning of their internship two months ago. For now, the IDE includes <a href="http://ace.c9.io/">Ace</a>, an editor, plugged with some features specific for OCaml, particularly <a href="https://github.com/OCamlPro/ocp-indent">ocp-indent</a>, made possible by using <a href="http://ocsigen.org/js_of_ocaml/">js_of_ocaml</a> which compiles bytecode to Javascript. It also includes a basic project manager that uses a server to store files for each user. Authentication is done by using <a href="http://www.mozilla.org/en-US/persona/">Mozilla's Persona</a>. One particularly nice feature they are working on is <i>client-side</i> bytecode generation: this means users can ask their browser to produce the byte-code of the project they are working on <i>without any connection to the server</i> ! Beware that this is still work-in-progress and the feature is not bug-free for the moment. The project (undocumented for now) is available on <a href="https://github.com/pcouderc/ocp-webedit">Github</a>.</p><h3> Tools</h3><p>Meanwhile, most of my time last month has been spent preparing the next release of OPAM, with the help of Louis Gesbert. This new release will contain a <a href="https://github.com/OCamlPro/opam/issues?milestone=17&amp;page=1&amp;state=closed">lot of bug-fixes</a> and an improved <code>opam update</code> mechanism: it will be much more flexible, faster and more stable than the one present in <code>1.0</code>. Few months ago, I had already pushed a <a href="https://github.com/OCamlPro/opam/pull/597">first batch of patches</a> to the development version, which started to make things look much better. I decided last month to continue improving that feature and make it rock-solid: hence I have started a <a href="https://github.com/samoht/opam-rt">regression testing platform for OPAM</a> which is still young but already damn useful to stabilize my new <a href="https://github.com/OCamlPro/opam/pull/719">set of patches</a>. <code>opam-rt</code> is also written in OCaml: it generates random repositories with random packages, shuffles everything around and checks that OPAM correctly picks-up the changes. In the future this will make it easier to test complex OPAM scenarios and will hopefully lead to a better OPAM.</p><p><a href="https://github.com/OCamlPro/ocp-index">ocp-index</a> has seen some progress, with lots of rough edges rounded, and much better performance on big <code>cmi</code> files (typically module packs, like <code>Core.Std</code>). While more advanced functionality is being planned, it is already very helpful, and problems seen in earlier development versions have been fixed. The upcoming release also greatly improves the experience from emacs, and might become the first "stable". The flow of bugs reported on <a href="https://github.com/OCamlPro/ocp-index">ocp-indent</a> is drying up, which means the tool is gaining some maturity. Not much visible changes for the past month except for a few bug-fixes, but the library interface has been completely rewritten to offer much more flexibility while being more friendly. This has allowed it to be plugged in the Web-IDE (see above), which being executed in JavaScript has much tighter performance constraints -- the indent engine is only re-run where required after changes -- ; and in ocaml-top, where it is also used to detect top-level phrase bounds.</p><h2>Community</h2><p>We are proud to be well represented at the <a href="http://ocaml.org/meetings/ocaml/2013/program.html">OCaml Developer Workshop 2013</a>. This year it happens in Boston, in September, co-located with the <a href="http://cufp.org/conference/schedule/2013">Conference of Users of Functional Programming</a>. Both conferences will contains a lot of OCaml-related talks: I am especially excited to hear about <a href="http://cufp.org/conference/schedule/2013">PHP type-inference efforts</a> at Facebook using OCaml! If you are in the area around the 22/23 and 24 of September and you want to chat about OCamlPro and OCaml, we will be around!</p><a onclick="switchContent('post4','post3')" class="btn" href="#141badefecc893bf03e7aae299c52c16">Hide</a></div></span>
<a name="109c4b459881cf0a41e04f991729da9a"></a><span class="rss-header"><span class="rss-title"><a href="http://gaiustech.wordpress.com/?p=2233"> August</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Gaius Hammond</span>, <span class="rss-date">31 Jul 2013</span></span><span class="rss-description"><p>As of today I am on gardening leave, and I intend to spend the time productively (after taking a long-planned and well-deserved holiday next week!). In no particular order:</p> <ul> <li>Update this blog more regularly, I have some posts that I have been meaning to write but just never have the time. I have been updating my <a href="http://gaiusdive.wordpress.com/">other blog</a> tho’.</li> <li>Some work on my sorely neglected Open Source stuff – finally LOBs in <a href="http://gaiustech.github.io/ociml/">OCI*ML</a>?? :-)</li> <li>Get properly up to speed in a couple of new technologies, mainly <a href="http://gaiustech.wordpress.com/2013/06/27/howto-install-oracle-12c-on-debian-wheezy/">Oracle 12c</a> and <a href="http://www.stroustrup.com/C++11FAQ.html">C++11</a>.</li> <li>Repair the stack of broken <a href="http://www.nesta.org.uk/areas_of_work/creative_economy/assets/features/bbc_micro">BBC Micros</a> in the living room!</li> </ul> <p>I have been offered redundancy before, and take a pretty philosophical view of it. I work for organizations, or groups within larger organizations, that push hard and take risks. When it works, it works very well – this year I got a decent bonus, despite the company struggling (a matter of public record, not betraying any secrets!). And when it doesn’t, then it’s time to go.</p> <br/> <a href="http://feeds.wordpress.com/1.0/gocomments/gaiustech.wordpress.com/2233/" rel="nofollow"><img src="http://feeds.wordpress.com/1.0/comments/gaiustech.wordpress.com/2233/" alt="" border="0"/></a> <img src="http://stats.wordpress.com/b.gif?host=gaiustech.wordpress.com&amp;blog=15595609&amp;post=2233&amp;subd=gaiustech&amp;ref=&amp;feed=1" alt="" height="1" border="0" width="1"/></span>
<a name="810d1d28cf3ffe78864a40f74aa00b09"></a><span class="rss-header"><span class="rss-title"><a href="http://alan.petitepomme.net/cwn/2013.07.30.html"> Caml Weekly News, 30 Jul 2013</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Caml Weekly News</span>, <span class="rss-date">30 Jul 2013</span></span><span class="rss-description">GODI is shutting down / ocaml-lua v1.1: OCaml binding of Lua library / Writing Awk in OCaml / Lecturer/Senior Lecturer / Other Caml News</span>
<a name="ab9d8b4f537b3a688fd51857119dc0b0"></a><span class="rss-header"><span class="rss-title"><a href="https://forge.ocamlcore.org/forum/forum.php?forum_id=881"> New release: v1.1</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">OCamlCore Forge News</span>, <span class="rss-date">28 Jul 2013</span></span><span class="rss-description"><pre class="rss-text">I'm happy to announce a fix release of ocaml-lua, the OCaml binding of the Lua library. With ocaml-lua you can embed a Lua interpreter in an OCaml program in a few lines of code, and use Lua for configuration or customization purposes. Few changes from previous v1.0: * bug fixes; * support for LuaJIT (2.0.0 for Lua 5.1); * compiles on OSX (not much tested, I don't have a Mac at home); * support OPAM (package available soon in the official repository, pull request already sent); * now you can specify a memory limit allocable for the Lua state: http://ocaml-lua.forge.ocamlcore.org/api-lua/Lua_aux_lib.html#VALnewstate Here are some references: The homepage of the project is hosted on OCaml Forge: http://ocaml-lua.forge.ocamlcore.org/ The complete library reference (ocamldoc generated) is here: http://ocaml-lua.forge.ocamlcore.org/api-lua/ Source tarballs are on the download page on OCaml Forge: http://forge.ocamlcore.org/frs/?group_id=167 The official GIT repository is here: http://forge.ocamlcore.org/scm/browser.php?group_id=167 Bug reports and feature requests are on my page on GitHub: https://github.com/pdonadeo/ocaml-lua/issues</pre></span>
<a name="73e7be9c133226b8c769f554bb6d3730"></a><span class="rss-header"><span class="rss-title"><a href="https://forge.ocamlcore.org/projects/ocaml-freebsd/"> OCaml on FreeBSD Maintainer's Toolkit</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">OCamlCore Forge Projects</span>, <span class="rss-date">28 Jul 2013</span></span><span class="rss-description">Scripts and programs to ease maintenership of OCaml ports on FreeBSD.</span>
<a name="89b311685a1c051189a066c5ad1001e6"></a><span class="rss-header"><span class="rss-title"><a href="http://alan.petitepomme.net/cwn/2013.07.23.html"> Caml Weekly News, 23 Jul 2013</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Caml Weekly News</span>, <span class="rss-date">23 Jul 2013</span></span><span class="rss-description">Ubuntu PPAs for OCaml (4.00 and 4.01dev) / Batteries 2.1 / Request for feedback: Procord, a library to delegate tasks to other processes / ocamlnet-3.6.6 / GODI is shutting down / Other Caml News</span>
<a name="95403b87bfc4cab537315257c998c4b0"></a><span class="rss-header"><span class="rss-title"><a href="https://forge.ocamlcore.org/forum/forum.php?forum_id=880"> Batteries 2.1 released</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">OCamlCore Forge News</span>, <span class="rss-date">22 Jul 2013</span></span><span class="rss-description"><pre class="rss-text">Get the new release here: https://forge.ocamlcore.org/frs/download.php/1218/batteries-2.1.tar.gz</pre></span>
<a name="302f357ecd2507af64083a003ea143ee"></a><span class="rss-header"><span class="rss-title"><a href="http://blog.camlcity.org/blog/godi_shutdown.html"> GODI is shutting down</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Gerd Stolpmann</span>, <span class="rss-date">22 Jul 2013</span></span><span class="rss-description"><div id="post5"><div> <b>Sorry!</b><br/>  </div> <div> Unfortunately, it is no longer possible for me to run the GODI distribution. GODI will not upgrade to OCaml 4.01 once it is out, and it will shut down the public service in the course of September 2013. </div> <a onclick="switchContent('post5','post6')" class="btn" href="#302f357ecd2507af64083a003ea143ee">Read more...</a></div><div id="post6" style="display: none"><div> <b>Sorry!</b><br/>  </div> <div> Unfortunately, it is no longer possible for me to run the GODI distribution. GODI will not upgrade to OCaml 4.01 once it is out, and it will shut down the public service in the course of September 2013. </div> <div> <p>This website, camlcity.org, will remain up, but with reduced content. Existing GODI installations can be continued to be used, but upgrades or bugfixes will not be available when GODI is off. </p><p> Although there are still a lot of GODI users, it is unavoidable to shut GODI down due to lack of supporters, especially package developers. I was more or less alone in the past months, and my time contingent will not allow it to do the upgrade to OCaml 4.01 alone (when it is released). </p><p> Also, there was a lot of noise about a competing packaging system for OCaml in the past weeks: OPAM. Apparently, it got a lot of attention both from individuals and from organizations. As I see it, the OCaml community is too small to support two systems, and so in some sense GODI is displaced by OPAM. </p><p> The sad part is that OPAM is only clearly better in one point, namely in interacting with the community (via Github). In times where social networks are worth billions this is probably the striking point. It doesn't matter that OPAM lacks some features GODI has. So there is some loss of functionality for the community (partly difficult to replace, like GODI's support for Windows). </p><p> If somebody wants to take over GODI, please do so. The <a href="https://godirepo.camlcity.org/svn/godi-bootstrap/">source code</a> is still available as well as the <a href="https://godirepo.camlcity.org/svn/godi-build/">package directories</a>. Maybe it is sufficient to move the repository to a public place and to redesign the package release process to give GODI a restart. </p><p> Hoorn (NL), the 22nd July 2013, </p><p> Gerd Stolpmann </p> </div> <div> Gerd Stolpmann works as O'Caml consultant </div> <div> </div><a onclick="switchContent('post6','post5')" class="btn" href="#302f357ecd2507af64083a003ea143ee">Hide</a></div></span>
<a name="7f7cd1796e5a03453125a889f94a24fb"></a><span class="rss-header"><span class="rss-title"><a href="http://www.openmirage.org/blog/xen-block-devices-with-mirage"> Creating Xen block devices with Mirage</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author"><span id="ocaml_2">Open Mirage &#9001;dave<abbr title="(at) &rarr; @">(at)</abbr>recoil.org (Dave Scott)&#9002;</span><script type="text/javascript"><!--;
local = "dave";
h = "recoil.org (Dave Scott)";
hq = "recoil.org%20(Dave%20Scott)";
document.getElementById("ocaml_2").innerHTML = '<a href="mailto:' + local + '@' + hq + "\" >Open Mirage<\/a>";
//--></script></span>, <span class="rss-date">18 Jul 2013</span></span><span class="rss-description"><div id="post7"><p><a href="http://www.openmirage.org/">Mirage</a> is a <a href="http://anil.recoil.org/papers/2013-asplos-mirage.pdf">unikernel</a> or "library operating system" that allows us to build applications which can be compiled to very diverse environments: the same code can be linked to run as a regular Unix app, relinked to run as a <a href="https://github.com/pgj/mirage-kfreebsd">FreeBSD kernel module</a>, and even linked into a self-contained kernel which can run on the <a href="http://www.xenproject.org/">Xen hypervisor</a>.</p><p>Mirage has access to an extensive suite of pure OCaml <a href="https://github.com/mirage">libraries</a>, covering everything from Xen <a href="https://github.com/mirage/ocaml-xen-block-driver">block</a> and <a href="https://github.com/mirage/mirage-platform/blob/master/xen/lib/netif.ml">network</a> virtual device drivers, a <a href="https://github.com/mirage/mirage-net">TCP/IP stack</a>, OpenFlow learning switches and controllers, to SSH and <a href="https://github.com/mirage/ocaml-cohttp">HTTP</a> server implementations.</p><p>I normally use Mirage to deploy applications as kernels on top of a <a href="http://www.xenserver.org/">XenServer</a> hypervisor. I start by first using the Mirage libraries within a normal Unix userspace application -- where I have access to excellent debugging tools -- and then finally link my app as a high-performance Xen kernel for production.</p><a onclick="switchContent('post7','post8')" class="btn" href="#7f7cd1796e5a03453125a889f94a24fb">Read more...</a></div><div id="post8" style="display: none"><p><a href="http://www.openmirage.org/">Mirage</a> is a <a href="http://anil.recoil.org/papers/2013-asplos-mirage.pdf">unikernel</a> or "library operating system" that allows us to build applications which can be compiled to very diverse environments: the same code can be linked to run as a regular Unix app, relinked to run as a <a href="https://github.com/pgj/mirage-kfreebsd">FreeBSD kernel module</a>, and even linked into a self-contained kernel which can run on the <a href="http://www.xenproject.org/">Xen hypervisor</a>.</p><p>Mirage has access to an extensive suite of pure OCaml <a href="https://github.com/mirage">libraries</a>, covering everything from Xen <a href="https://github.com/mirage/ocaml-xen-block-driver">block</a> and <a href="https://github.com/mirage/mirage-platform/blob/master/xen/lib/netif.ml">network</a> virtual device drivers, a <a href="https://github.com/mirage/mirage-net">TCP/IP stack</a>, OpenFlow learning switches and controllers, to SSH and <a href="https://github.com/mirage/ocaml-cohttp">HTTP</a> server implementations.</p><p>I normally use Mirage to deploy applications as kernels on top of a <a href="http://www.xenserver.org/">XenServer</a> hypervisor. I start by first using the Mirage libraries within a normal Unix userspace application -- where I have access to excellent debugging tools -- and then finally link my app as a high-performance Xen kernel for production.</p><p>However Mirage is great for more than simply building Xen kernels. In this post I'll describe how I've been using Mirage to create experimental virtual disk devices for existing Xen VMs (which may themselves be Linux, *BSD, Windows or even Mirage kernels). The Mirage libraries let me easily experiment with different backend file formats and protocols, all while writing only type-safe OCaml code thats runs in userspace in a normal Linux domain 0.</p><p><b>Disk devices under Xen</b></p><p>The protocols used by Xen disk and network devices are designed to permit fast and efficient software implementations, avoiding the inefficiencies inherent in emulating physical hardware in software. The protocols are based on two primitives:</p><ul> <li> <p><b>shared memory pages</b>: used for sharing both data and metadata</p> </li><li> <p><b>event channels</b>: similar to interrupts, these allow one side to signal the other</p> </li> </ul><p>In the disk block protocol, the protocol starts with the client ("frontend" in Xen jargon) sharing a page with the server ("backend"). This single page will contain the request/response metadata, arranged as a circular buffer or "ring". The client ("frontend") can then start sharing pages containing disk blocks with the backend and pushing request structures to the ring, updating shared pointers as it goes. The client will give the server end a kick via an event channel signal and then both ends start running simultaneously. There are no locks in the protocol so updates to the shared metadata must be handled carefully, using write memory barriers to ensure consistency.</p><p><b>Xen disk devices in Mirage</b></p><p>Like everything else in Mirage, Xen disk devices are implemented as libraries. The ocamlfind library called "xenctrl" provides support for manipulating blocks of raw memory pages, "granting" access to them to other domains and signalling event channels. There are two implementations of "xenctrl": <a href="https://github.com/mirage/mirage-platform/tree/master/xen/lib">one that invokes Xen "hypercalls" directly</a> and one which uses the <a href="https://github.com/xapi-project/ocaml-xen-lowlevel-libs">Xen userspace library libxc</a>. Both implementations satisfy a common signature, so it's easy to write code which will work in both userspace and kernelspace.</p><p>The ocamlfind library <a href="https://github.com/mirage/shared-memory-ring">shared-memory-ring</a> provides functions to create and manipulate request/response rings in shared memory as used by the disk and network protocols. This library is a mix of 99.9% OCaml and 0.1% asm, where the asm is only needed to invoke memory barrier operations to ensure that metadata writes issued by one CPU core appear in the same order when viewed from another CPU core.</p><p>Finally the ocamlfind library <a href="https://github.com/mirage/ocaml-xen-block-driver">xenblock</a> provides functions to hotplug and hotunplug disk devices, together with an implementation of the disk block protocol itself.</p><p><b>Making custom virtual disk servers with Mirage</b></p><p>Let's experiment with making our own virtual disk server based on the Mirage example program, <a href="https://github.com/mirage/xen-disk">xen-disk</a>.</p><p>First, install <a href="http://www.xen.org/">Xen</a>, <a href="http://www.ocaml.org/">OCaml</a> and <a href="http://opam.ocamlpro.com/">OPAM</a>. Second initialise your system:</p><div class="ocaml"><pre><code>opam init eval `opam config env` </code></pre></div><p>At the time of writing, not all the libraries were released as upstream OPAM packages, so it was necessary to add some extra repositories. This should not be necessary after the Mirage developer preview at <a href="http://www.oscon.com/oscon2013/public/schedule/detail/28956">OSCON 2013</a>.</p><div class="ocaml"><pre><code>opam remote add mirage-dev git<span class="keyword2">:</span>//github.com/mirage/opam-repo-dev opam remote add xapi-dev git<span class="keyword2">:</span>//github.com/xapi-project/opam-repo-dev </code></pre></div><p>Install the unmodified <code>xen-disk</code> package, this will ensure all the build dependencies are installed:</p><div class="ocaml"><pre><code>opam install xen-disk </code></pre></div><p>When this completes it will have installed a command-line tool called <code>xen-disk</code>. If you start a VM using your Xen toolstack of choice ("xl create ..." or "xe vm-install ..." or "virsh create ...") then you should be able to run:</p><div class="ocaml"><pre><code>xen-disk connect <span class="keyword2">&lt;</span>vmname<span class="keyword2">&gt;</span> </code></pre></div><p>which will hotplug a fresh block device into the VM "&lt;vmname&gt;" using the "discard" backend, which returns "success" to all read and write requests, but actually throws all data away. Obviously this backend should only be used for basic testing!</p><p>Assuming that worked ok, clone and build the source for <code>xen-disk</code> yourself:</p><div class="ocaml"><pre><code>git clone git<span class="keyword2">:</span>//github.com/mirage/xen-disk cd xen-disk make </code></pre></div><p><b>Making a custom virtual disk implementation</b></p><p>The <code>xen-disk</code> program has a set of simple built-in virtual disk implementations. Each one satisifies a simple signature, contained in <a href="https://github.com/mirage/xen-disk/blob/master/src/storage.mli">src/storage.mli</a>:</p><div class="ocaml"><pre><code><span class="keyword4">type</span> configuration <span class="keyword2">=</span> <span class="keyword2">{</span> filename<span class="keyword2">:</span> <span class="keyword3">string</span><span class="keyword2">;</span> <span class="comments">(** path where the data will be stored *)</span> format<span class="keyword2">:</span> <span class="keyword3">string</span> option<span class="keyword2">;</span> <span class="comments">(** format of physical data *)</span> <span class="keyword2">}</span> <span class="comments">(** Information needed to "open" a disk *)</span> <span class="keyword4">module</span> <span class="keyword4">type</span> <span class="keyword6">S </span><span class="keyword2">=</span> <span class="keyword4">sig</span> <span class="comments">(** A concrete mechanism to access and update a virtual disk. *)</span> <span class="keyword4">type</span> t <span class="comments">(** An open virtual disk *)</span> <span class="keyword4">val</span> open_disk<span class="keyword2">:</span> configuration -<span class="keyword2">&gt;</span> t option <span class="keyword5">Lwt.</span>t <span class="comments">(** Given a configuration, attempt to open a virtual disk *)</span> <span class="keyword4">val</span> size<span class="keyword2">:</span> t -<span class="keyword2">&gt;</span> int64 <span class="comments">(** [size t] is the size of the virtual disk in bytes. The actual number of bytes stored on media may be different. *)</span> <span class="keyword4">val</span> read<span class="keyword2">:</span> t -<span class="keyword2">&gt;</span> <span class="keyword5">Cstruct.</span>t -<span class="keyword2">&gt;</span> int64 -<span class="keyword2">&gt;</span> <span class="keyword3">int</span> -<span class="keyword2">&gt;</span> unit <span class="keyword5">Lwt.</span>t <span class="comments">(** [read t buf offset_sectors len_sectors] copies [len_sectors] sectors beginning at sector [offset_sectors] from [t] into [buf] *)</span> <span class="keyword4">val</span> write<span class="keyword2">:</span> t -<span class="keyword2">&gt;</span> <span class="keyword5">Cstruct.</span>t -<span class="keyword2">&gt;</span> int64 -<span class="keyword2">&gt;</span> <span class="keyword3">int</span> -<span class="keyword2">&gt;</span> unit <span class="keyword5">Lwt.</span>t <span class="comments">(** [write t buf offset_sectors len_sectors] copies [len_sectors] sectors from [buf] into [t] beginning at sector [offset_sectors]. *)</span> <span class="keyword4">end</span> </code></pre></div><p>Let's make a virtual disk implementation which uses an existing disk image file as a "gold image", but uses copy-on-write so that no writes persist. This is a common configuration in Virtual Desktop Infrastructure deployments and is generally handy when you want to test a change quickly, and revert it cleanly afterwards.</p><p>A useful Unix technique for file I/O is to "memory map" an existing file: this associates the file contents with a range of virtual memory addresses so that reading and writing within this address range will actually read or write the file contents. The "mmap" C function has a number of flags, which can be used to request "copy on write" behaviour. Reading the <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Bigarray.Genarray.html">OCaml manual Bigarray.map_file</a> it says:</p><blockquote> <p>If shared is true, all modifications performed on the array are reflected in the file. This requires that fd be opened with write permissions. If shared is false, modifications performed on the array are done in memory only, using copy-on-write of the modified pages; the underlying file is not affected.</p> </blockquote><p>So we should be able to make a virtual disk implementation which memory maps the image file and achieves copy-on-write by setting "shared" to false. For extra safety we can also open the file read-only.</p><p>Luckily there is already an <a href="https://github.com/mirage/xen-disk/blob/master/src/backend.ml#L63">"mmap" implementation</a> in <code>xen-disk</code>; all we need to do is tweak it slightly. Note that the <code>xen-disk</code> program uses a co-operative threading library called <a href="http://ocsigen.org/lwt/">lwt</a> which replaces functions from the OCaml standard library which might block with non-blocking variants. In particular <code>lwt</code> uses <code>Lwt_bytes.map_file</code> as a wrapper for the <code>Bigarray.Array1.map_file</code> function. In the "open-disk" function we simply need to set "shared" to "false" to achieve the behaviour we want i.e.</p><div class="ocaml"><pre><code><span class="keyword4">let</span> open_disk configuration <span class="keyword2">=</span> <span class="keyword4">let</span> fd <span class="keyword2">=</span> <span class="keyword5">Unix.</span>openfile configuration.filename <span class="keyword2">[</span> <span class="keyword5">Unix.O_RDONLY </span><span class="keyword2">]</span> <span class="keyword8">0</span>o0 <span class="keyword4">in</span> <span class="keyword4">let</span> stats <span class="keyword2">=</span> <span class="keyword5">Unix.</span><span class="keyword5">LargeFile.</span>fstat fd <span class="keyword4">in</span> <span class="keyword4">let</span> mmap <span class="keyword2">=</span> <span class="keyword5">Lwt_bytes.</span>map_file ~fd ~shared<span class="keyword2">:</span>false <span class="keyword2">(</span><span class="keyword2">)</span> <span class="keyword4">in</span> <span class="keyword5">Unix.</span>close fd<span class="keyword2">;</span> return <span class="keyword2">(</span><span class="keyword6">Some </span><span class="keyword2">(</span>stats.<span class="keyword5">Unix.</span><span class="keyword5">LargeFile.</span>st_size, <span class="keyword5">Cstruct.</span>of_bigarray mmap<span class="keyword2">)</span><span class="keyword2">)</span> </code></pre></div><p>The read and write functions can be left as they are:</p><div class="ocaml"><pre><code><span class="keyword4">let</span> read <span class="keyword2">(</span>_, mmap<span class="keyword2">)</span> buf offset_sectors len_sectors <span class="keyword2">=</span> <span class="keyword4">let</span> offset_sectors <span class="keyword2">=</span> <span class="keyword5">Int64.</span>to_int offset_sectors <span class="keyword4">in</span> <span class="keyword4">let</span> len_bytes <span class="keyword2">=</span> len_sectors <span class="keyword2">*</span> sector_size <span class="keyword4">in</span> <span class="keyword4">let</span> offset_bytes <span class="keyword2">=</span> offset_sectors <span class="keyword2">*</span> sector_size <span class="keyword4">in</span> <span class="keyword5">Cstruct.</span>blit mmap offset_bytes buf <span class="keyword8">0</span> len_bytes<span class="keyword2">;</span> return <span class="keyword2">(</span><span class="keyword2">)</span> <span class="keyword4">let</span> write <span class="keyword2">(</span>_, mmap<span class="keyword2">)</span> buf offset_sectors len_sectors <span class="keyword2">=</span> <span class="keyword4">let</span> offset_sectors <span class="keyword2">=</span> <span class="keyword5">Int64.</span>to_int offset_sectors <span class="keyword4">in</span> <span class="keyword4">let</span> offset_bytes <span class="keyword2">=</span> offset_sectors <span class="keyword2">*</span> sector_size <span class="keyword4">in</span> <span class="keyword4">let</span> len_bytes <span class="keyword2">=</span> len_sectors <span class="keyword2">*</span> sector_size <span class="keyword4">in</span> <span class="keyword5">Cstruct.</span>blit buf <span class="keyword8">0</span> mmap offset_bytes len_bytes<span class="keyword2">;</span> return <span class="keyword2">(</span><span class="keyword2">)</span> </code></pre></div><p>Now if we rebuild and run something like:</p><div class="ocaml"><pre><code>dd <span class="keyword1">if</span><span class="keyword2">=</span>/dev/zero <span class="keyword2">of</span><span class="keyword2">=</span>disk.raw bs<span class="keyword2">=</span><span class="keyword8">1</span><span class="keyword6">M </span>seek<span class="keyword2">=</span><span class="keyword8">1024</span> count<span class="keyword2">=</span><span class="keyword8">1</span> losetup /dev/loop0 disk.raw mkfs.ext3 /dev/loop0 losetup -d /dev/loop0 dist/build/xen-disk/xen-disk connect <span class="keyword2">&lt;</span>myvm<span class="keyword2">&gt;</span> --path disk.raw </code></pre></div><p>Inside the VM we should be able to do some basic speed testing:</p><div class="ocaml"><pre><code># dd <span class="keyword1">if</span><span class="keyword2">=</span>/dev/xvdb <span class="keyword2">of</span><span class="keyword2">=</span>/dev/null bs<span class="keyword2">=</span><span class="keyword8">1</span><span class="keyword6">M </span>iflag<span class="keyword2">=</span>direct count<span class="keyword2">=</span><span class="keyword8">100</span> <span class="keyword8">100</span><span class="keyword2">+</span><span class="keyword8">0</span> records <span class="keyword4">in</span> <span class="keyword8">100</span><span class="keyword2">+</span><span class="keyword8">0</span> records out <span class="keyword8">104857600</span> bytes <span class="keyword2">(</span><span class="keyword8">105</span> MB<span class="keyword2">)</span> copied, <span class="keyword8">0</span>.<span class="keyword8">125296</span> s, <span class="keyword8">837</span> MB/s </code></pre></div><p>Plus we should be able to mount the filesystem inside the VM, make changes and then disconnect (send SIGINT to xen-disk by hitting Control+C on your terminal) without disturbing the underlying disk contents.</p><p><b>So what else can we do?</b></p><p>Thanks to Mirage it's now really easy to experiment with custom storage types for your existing VMs. If you have a cunning scheme where you want to hash block contents, and use the hashes as keys in some distributed datastructure -- go ahead, it's all easy to do. If you have ideas for improving the low-level block access protocol then Mirage makes those experiments very easy too.</p><p>If you come up with a cool example with Mirage, then send us a <a href="https://github.com/mirage">pull request</a> or send us an email to the <a href="http://www.openmirage.org/about/">Mirage mailing list</a> -- we'd love to hear about it!</p><a onclick="switchContent('post8','post7')" class="btn" href="#7f7cd1796e5a03453125a889f94a24fb">Hide</a></div></span>
<script type="text/javascript">function switchContent(id1,id2) {
     // Get the DOM reference
     var contentId1 = document.getElementById(id1);
     var contentId2 = document.getElementById(id2);
     // Toggle
     contentId1.style.display = "none";
     contentId2.style.display = "block";
     }</script></div>

  
    </div>

    
    <br/>
    <hr/>
    <div id="footer">
      Contribute to this project!
      Find us on <a href="https://github.com/ocaml/ocaml.org">Github</a>.
    </div>
    <span title=".././img/ = image directory from the base of the site"></span>


    
    
    

    <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
    <script src=".././js/jquery-1.8.0.min.js"></script>
    
    <script src=".././js/bootstrap.js"></script>

    <script type="text/javascript">
      var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-22552764-2']); _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-37808023-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

    </script>

</body></html>
