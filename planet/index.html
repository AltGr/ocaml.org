<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    
    <meta content="IE=8" http-equiv="X-UA-Compatible"/>
    <title>OCaml :: OCaml Planet</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <meta content="Ashish Agarwal, Esther Baruk, Christophe Troestler and many contributors" name="author"/>
    <meta content="" name="description"/>
    <meta content="" name="keywords"/>
    <meta content="OCaml (Weberizer)" name="generator"/>

    <link href="https://static.ocamlcore.org/official/images/favicon.ico" rel="shortcut icon"/>
    <link rel="stylesheet" href=".././css/bootstrap.css"/>
    <link href=".././css/ocaml.css" media="all" type="text/css" rel="stylesheet"/>
    <link rel="stylesheet" href=".././css/bootstrap-responsive.css"/>

    
    

    <meta content="OCaml Planet" property="og:title"/>
    <meta content="non_profit" property="og:type"/>

    <meta content="all" name="robots"/>
  </head>
  <body>
    <div id="header">
      <div class="top">
      </div>
      <div class="bottom">
      </div>
    </div>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
	  
          <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a href=".././" class="brand">OCaml</a>

          <div class="nav-collapse">
            <ul class="nav">
	      <li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">
    Discover
    <b class="caret"></b>
  </a>
  <ul class="dropdown-menu">
    <li><a href="../description.html">What is OCaml?</a></li>
    <li><a href="http://try.ocamlpro.com/">Try it Online</a></li>
    <li><a href="../taste.html">100 Lines of OCaml</a></li>
    <li><a href="../success.html">Success Stories</a></li>
    <li><a href="../companies.html">Who Is Using It?</a></li>
    <li><a href="http://pleac.sourceforge.net/pleac_ocaml/">Pleac</a></li>
    <li><a href="http://rosettacode.org/wiki/Category:OCaml">Rosetta</a>
        <a href="http://langref.org/ocaml">langref.org</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">
    Learn
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../install.html">Install</a></li>
    <li><a href="../tutorials/">Tutorials</a></li>
    <li><a href="../faq.html">FAQ</a></li>
    <li><a href="../books.html">Books</a></li>
    <li><a href="../videos.html">Videos</a></li>
    <li><a href="../papers.html">Papers</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">Use
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../releases/">Releases</a></li>
    <li><a href="../libraries.html">Libraries</a></li>
    <li><a href="../dev_tools.html">Development Tools</a></li>
    <li><a href="../books.html#manual">User Manual</a></li>
    <li><a href="../cheat_sheets.html">Cheat Sheets</a></li>
    <li><a href="http://search.ocaml.jp/">OCaml API Search</a></li>
    <li><a href="http://forge.ocamlcore.org/">Forge</a></li>
    <li><a href="https://github.com/languages/OCaml">GitHub</a></li>
    <li><a href="https://bitbucket.org/repo/all?name=ocaml">Bitbucket</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">Community
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../mailing_lists.html">Mailing Lists</a></li>
    <li><a href="../planet/">Blogs</a></li>
    <li><a href="../meetings.html">Meetings</a></li>
    <li><a href="irc://irc.freenode.net/ocaml">IRC</a></li>
    <li><a href="http://stackoverflow.com/questions/tagged?tagnames=ocaml">Stack Overflow</a></li>
    <li><a href="http://www.reddit.com/r/ocaml/">Reddit</a></li>
    <li><a href="../support.html">Commercial Support</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">More
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="http://caml.inria.fr/mantis/">Mantis Bug Tracker</a></li>
    <li><a href="../caml-light/">Caml Light</a></li>
    <li><a href="../logos.html">Logos</a></li>
  </ul>
</li>

            </ul>
	    <form action="http://www.google.com/search" method="get" class="navbar-search pull-right">
	      <input placeholder="Search" class="search-query" name="q" type="text"/>
	      <input value="site:http://www.ocaml.org/" name="q" type="hidden"/>
	    </form>
            
	    
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <span class="navigation-bar">
	<a href="./../">Home</a><span class="separation"><img src=".././img/right_arrow.png" alt="&gt;"/></span>OCaml Planet
	<span id="language">
	  <span class="horizontal-toolbar"><span class="open-bracket">[</span><span class="current-url">En</span><span class="close-bracket">]</span></span>
	</span>
      </span>

      

    <h1>OCaml Planet</h1>

    <p>The OCaml Planet aggregates various blogs from the OCaml
    community.  It is kindly provided
    by <a href="http://www.ocamlcore.com/">OCamlCore</a>.  If you
    would like to be added, read
    the <a href="http://www.ocamlcore.org/planet/">Planet
    subscription HOWTO</a>.</p>

    <br/>
    <div style="float: right; margin-right: 0; margin-top: 0" class="span2 planet-subscriptions"><em>Subscriptions</em>
      <ul><li><a href="http://alexleighton.tumblr.com/tagged/ocaml/rss">Alex Leighton</a></li><li><a href="http://andreiformiga.com/blog/?cat=5&feed=rss2">Andrei Formiga</a></li><li><a href="http://math.andrej.com/feed/">Andrej Bauer</a></li><li><a href="http://anil.recoil.org/feeds/atom.xml">Anil Madhavapeddy</a></li><li><a href="http://ashishagarwal.org/tag/ocaml/feed/">Ashish Agarwal</a></li><li><a href="http://www.blogger.com/feeds/7617521785419311079/posts/default">Cameleon news</a></li><li><a href="http://caml.inria.fr/news.en.rss">Caml INRIA</a></li><li><a href="http://camlspotter.blogspot.com/feeds/posts/default?alt=rss">Caml Spotting</a></li><li><a href="http://alan.petitepomme.net/cwn/cwn.rss">Caml Weekly News</a></li><li><a href="http://coherentpdf.com/blog/?tag=ocaml&feed=rss">Coherent Graphics</a></li><li><a href="http://coq.inria.fr/news/feed">Coq</a></li><li><a href="http://erratique.ch/feeds/news.atom">Daniel Bünzli</a></li><li><a href="http://nleyten.com:82/feed/tag/ocaml/atom">Dario Teixeira</a></li><li><a href="http://www.blogger.com/feeds/17133288/posts/default/-/ocaml">David Baelde</a></li><li><a href="http://bentobako.org/david/blog/index.php?feed/tag/ocaml/atom">David Mentré</a></li><li><a href="http://dutherenverseauborddelatable.wordpress.com/category/ocaml/feed/">David Teller</a></li><li><a href="http://www.examachine.net/blog/cat/ocaml/feed/">Eray Özkural</a></li><li><a href="http://www.mega-nerd.com/erikd/Blog/index.rss20">Erik de Castro Lopo</a></li><li><a href="http://blog.emillon.org/feeds/ocaml.xml">Etienne Millon</a></li><li><a href="http://www.blogger.com/feeds/8964007124326996693/posts/default/-/ocaml">Fayssal Martani</a></li><li><a href="http://frama-c.com/rss.xml">Frama-C</a></li><li><a href="http://functionaljobs.com/jobs/search/?q=ocaml&format=rss">Functional Jobs</a></li><li><a href="http://gallium.inria.fr/blog/index.rss">GaGallium</a></li><li><a href="http://gaiustech.wordpress.com/category/ocaml/feed/">Gaius Hammond</a></li><li><a href="http://blog.camlcity.org/blog/rss">Gerd Stolpmann</a></li><li><a href="http://www.wisdomandwonder.com/tag/OCaml/feed">Grant Rettke</a></li><li><a href="http://hongboz.wordpress.com/feed/">Hong bo Zhang</a></li><li><a href="http://blog.incubaid.com/tag/ocaml/feed/">Incubaid Research</a></li><li><a href="http://ambassadortothecomputers.blogspot.com/feeds/posts/default?alt=rss">Jake Donham</a></li><li><a href="http://scattered-thoughts.net/atom.xml">Jamie Brandon</a></li><li><a href="https://ocaml.janestreet.com/?q=rss.xml">Jane Street</a></li><li><a href="http://lpw25.net/rss.xml">Leo White</a></li><li><a href="http://www.lexifi.com/blogs/ocaml/feed">LexiFi</a></li><li><a href="http://newblog.0branch.com/rss.xml">Marc Simpson</a></li><li><a href="http://syntaxexclamation.wordpress.com/tag/ocaml/feed/">Matthias Puech</a></li><li><a href="http://www.blogger.com/feeds/5888658295182480819/posts/default">Matías Giovannini</a></li><li><a href="http://www.elehack.net/michael/blog/tags/ocaml?format=rss">Michael Ekstrand</a></li><li><a href="">Mihamina Rakotomandimby</a></li><li><a href="http://mcclurmc.wordpress.com/feed/">Mike McClurg</a></li><li><a href="http://nyc-ocaml.posterous.com/rss.xml">NYC OCaml</a></li><li><a href="http://forge.ocamlcore.org/export/rss_sfnews.php">OCamlCore Forge News</a></li><li><a href="http://forge.ocamlcore.org/export/rss_sfprojects.php">OCamlCore Forge Projects</a></li><li><a href="http://www.ocamlcore.com/wp/?feed=rss2&amp;language=en&#038;language=en">OCamlCore.com</a></li><li><a href="http://www.ocamlpro.com/feed/atom.xml">OCamlPro</a></li><li><a href="http://odns.tuxfamily.org/feed/">ODNS project</a></li><li><a href="http://ox.tuxfamily.org/feed/">Ocaml XMPP project</a></li><li><a href="http://ocsigen.org/news.atom">Ocsigen project</a></li><li><a href="http://www.blogger.com/feeds/2073503406800427577/posts/default">Opa</a></li><li><a href="http://www.openmirage.org/blog/atom.xml">Open Mirage</a></li><li><a href="http://functional-orbitz.blogspot.com/feeds/posts/default/-/planetocaml?alt=rss">Orbitz</a></li><li><a href="http://www.donadeo.net/facets/programming-languages/objective-caml/feed/">Paolo Donadeo</a></li><li><a href="https://mancoosi.org/~abate/taxonomy/term/5/0/feed">Pietro Abate</a></li><li><a href="http://rwmj.wordpress.com/tag/ocaml/feed/">Richard Jones</a></li><li><a href="http://blog.rastageeks.org/spip.php?page=rss&id_mot=2">Romain Beauxis</a></li><li><a href="http://seb.mondet.org/blog/feed/ocaml.rss">Sebastien Mondet</a></li><li><a href="http://upsilon.cc/~zack/tags/ocaml/index.rss">Stefano Zacchiroli</a></li><li><a href="http://le-gall.net/sylvain+violaine/blog/index.php?feed/tag/ocaml/atom">Sylvain Le Gall</a></li><li><a href="http://caml.inria.fr/hump.rss">The Caml Humps</a></li><li><a href="http://www.blogger.com/feeds/6115529230232389198/posts/default">Till Varoquaux</a></li><li><a href="http://y-node.com/blog/feeds/latest/">y-node</a></li></ul>

      <a href="http://planet.ocaml.org/rss20.xml"><img src=".././img/rss20.png"/></a>
      <a href="http://planet.ocaml.org/opml.xml"><img src=".././img/opml.png"/></a>
    </div>
    <div class="planet"><a name="4500c6dfee297759b237d6b0101e99f5"></a><span class="rss-header"><span class="rss-title"><a href="http://bentobako.org/david/blog/index.php?post/2013/01/28/The-failures-of-Debian-%28and-its-derivatives%29"> The failures of Debian (and its derivatives)</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">David Mentré</span>, <span class="rss-date">22 Mar 2013</span></span><span class="rss-description"><div id="post1"><p>I am a long term Debian user. I have used Debian since probably the mid 90' up to now. I use latest Debian stable on my personal server or at work, and Ubuntu on my desktop and laptop machines at home. Using it does not mean I am entirely satisfied with it to say the least. I think the distribution is not making enough efforts for its users and I'll try to explain why. Of course, YYMV. ;-)</p>

<a onclick="switchContent('post1','post2')" class="btn" href="#4500c6dfee297759b237d6b0101e99f5">Read more...</a></div><div id="post2" style="display: none"><p>I am a long term Debian user. I have used Debian since probably the mid 90' up to now. I use latest Debian stable on my personal server or at work, and Ubuntu on my desktop and laptop machines at home. Using it does not mean I am entirely satisfied with it to say the least. I think the distribution is not making enough efforts for its users and I'll try to explain why. Of course, YYMV. ;-)</p>

<ul>
<li><strong>Debian packaging is made for developers, not users</strong>. Debian has too many packages. To take just one example, the OCaml compiler is packaged into the main compiler, its libraries, the native compiler and the byte code one, etc. Why so many packages? If I am an OCaml developer, I want all of them so why do I need to manually find (the naming is far from being obvious, at least for beginners) and install so many packages? I have heard of several reasons: it allows to factorise common parts between the different binary architectures, it allows to install the command line only parts without the graphics parts, it allows to install only what the user wants, etc. For me, those reasons are just plain wrong. We have more and more disk capacity on our machines so disk usage is no longer a limitation. The package should be able to dynamically activate the graphic parts automatically if the X server is available. And the factorisation of shared parts between Debian architectures should be done on the servers storing the packages, not trough the packaging system.</li>
</ul>
<ul>
<li><strong>Debian has out-dated software</strong>. Debian Wheezy is about to be released and it will have GNOME 3.4. But GNOME 3.6 is already out and GNOME 3.8 is on its way. And I am taking GNOME as an example, it is the same issue for lot of software within Debian. I have heard this is for stability issues. But software packaged in Debian is already stable! It should take 10 or 15 days to integrate a new software into Debian stable, not months or even years (the time between successive stable releases). I acknowledge that some packages have complex interdependencies between each others. For example, when a new release of the OCaml compiler is out, one needs to recompile all OCaml packages. But this constraint is only for OCaml packages. Why should I wait for a new stable version of Debian to get the newly released OCaml compiler? For me this sounds just plain wrong.</li>
</ul>
<ul>
<li><strong>Nobody uses plain Debian stable</strong>. Debian developers are using unstable. Debian users are using Debian stable, but enriched with backports because of out-dated software. Or derivatives like Ubuntu. The fact the Debian developers are not using what they recommend to users is bogus. I know they do that for technical reasons, but that should not be a good reason. Debian developers should use what they are providing to their users, except maybe for a few packages they are working on.</li>
</ul>
<ul>
<li><strong>There are too many dependencies between packages</strong>. The dependency system of Debian is a nice piece of work, it was ahead of its time when it was created. But the use of dependencies has been perverted. The dependencies are manually computed (thus source of errors and bugs) and at the same time any software can write to about any part of the file system. Due to too many dependencies and lack of clean interfaces between sub-systems, the installation of a recent user software can trigger a ton of packages down to a new kernel or libc. Why is it so? I think the sub-systems of Debian (e.g. the X graphical infrastructure, the kernel and base C libraries, the OCaml system, ...) should be isolated the one from the others. It would allow them to be updated without waiting for the others. Having dependencies between 29,000 packages is just not scalable. It is even more true if those dependencies are manually computed.</li>
</ul>
<ul>
<li><strong>Debian packaging is lacking automation</strong>. I am a developer. Debian packagers are developers. It always astonished me how much manual work should be done to make and maintain a Debian package. All developers know that if they want to be efficient, they need to automate their work as much as possible, so as to be able to focus their manpower on the complex parts. Everything should be automated in Debian packages, starting from a minimal description file. Automation should be the default (package creation, test, static analysis, ...), not the exception.</li>
</ul>
<ul>
<li><strong>One cannot install simultaneously several versions of the same software</strong>. As a user or developer, I want to use the stable version of a piece of software and maybe the latest stable version that just have been released in order to do a few tests or check that my software still compiles with the new shiny compiler. Debian does not allow me to do that. And if I install a newer package, downgrading to the previous version is complex and error prone.</li>
</ul>
<ul>
<li><strong>Debian is undocumented</strong>. I am not talking about the installation guide which is nice, I am talking about the modifications made to software by Debian developers. Doing modification on the "standard" (for the software) way of configuring or using it has always seemed suspect to me, even if I agree that having harmonized configuration is a real advantage (all configuration files in /etc for example). But all of those modifications should be documented in README.Debian file. To take an example, the last time I tried to install the dokuwiki Debian package, I was unable to configure it! The way to add new users had been changed compared to a regular dokuwiki (the web interface was disabled), and those changes were undocumented. It should be a release critical bug! Without proper documentation, the user cannot use the software. And, of course, the reason behind those changes should be questioned, even for security reasons (a very secure but unusable software is superfluous. Security is a trade-off).</li>
</ul>

<p>So, why I am complaining? Why I do not become a Debian Developer, so I can fix it? Because a single developer is not going to change the root causes of those issues. They need a massive development effort, or at least a massive acknowledgement by the Debian Developers. And I don't have ready-made answers to those issues (even if I have some ideas to solve them).</p>


<p>Is the grass greener in the other fields? I don't think so, or at least I am not aware of it. I like Debian for is community approach, its focus on Free Software (even if it is sometimes imperfect) and the wide range of software packaged in it (the OCaml packages are numerous for example). I just hope that the whole Debian community will focus on more user related issues in the future.</p><a onclick="switchContent('post2','post1')" class="btn" href="#4500c6dfee297759b237d6b0101e99f5">Hide</a></div></span>
<a name="6f1d80d96686f1248d18776ac85fb4cf"></a><span class="rss-header"><span class="rss-title"><a href="http://caml.inria.fr/cgi-bin/hump.cgi?contrib=818"> Stog 0.8.0</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">The Caml Humps</span>, <span class="rss-date">20 Mar 2013</span></span><span class="rss-description">Stog is a kind of Jekyll in OCaml: It is a static web site generator, able to handle blog posts as well as regular pages.</span>
<a name="c8d1b76670230be9d19c1105da03f9fa"></a><span class="rss-header"><span class="rss-title"><a href="http://caml.inria.fr/cgi-bin/hump.cgi?contrib=850"> OCamlRSS 2.1.0</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">The Caml Humps</span>, <span class="rss-date">20 Mar 2013</span></span><span class="rss-description">OCaml-RSS is an OCaml library providing functions to parse and print RSS 2.0 files.</span>
<a name="32fc33bb0bab6e1d1fefc542855d772e"></a><span class="rss-header"><span class="rss-title"><a href="http://alan.petitepomme.net/cwn/2013.03.19.html"> Caml Weekly News, 19 Mar 2013</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Caml Weekly News</span>, <span class="rss-date">19 Mar 2013</span></span><span class="rss-description">Case study in optimization: porting a compiler from OCaml to F# / OPAM 1.0.0 released ! / Use of OCaml in universities and engineering schools / Riakc 0.0.0 / Core Suite 109.14.00 released + custom_printf / Other Caml News</span>
<a name="5d1decd418b678381c3b4cbe1970cabb"></a><span class="rss-header"><span class="rss-title"><a href="http://www.ocamlpro.com/blog/2013/03/18/monthly-03.html"> An Indentation Engine for OCaml</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author"><span id="ocaml_1">OCamlPro &#9001;louis.gesbert<abbr title="(at) &rarr; @">(at)</abbr>ocamlpro.com (Louis Gesbert)&#9002;</span><script type="text/javascript"><!--;
local = "louis.gesbert";
h = "ocamlpro.com (Louis Gesbert)";
hq = "ocamlpro.com%20(Louis%20Gesbert)";
document.getElementById("ocaml_1").innerHTML = '<a href="mailto:' + local + '@' + hq + "\" >OCamlPro<\/a>";
//--></script></span>, <span class="rss-date">18 Mar 2013</span></span><span class="rss-description"><div id="post3"><p>Since our last <a href="http://www.ocamlpro.com/blog/2013/02/18/monthly-01-02.html">activity report</a> we have released the first stable versions of two projects: <a href="http://opam.ocamlpro.com">OPAM</a>, an installation manager for OCaml source packages, and <a href="https://github.com/OCamlPro/ocp-indent">ocp-indent</a>, an indentation tool.</p><p>We have already described the basics of OPAM in two precedent <a href="http://www.ocamlpro.com/blog/2013/01/17/opam-beta.html">blog</a> <a href="http://www.ocamlpro.com/blog/2013/01/17/opam-1.0.0.html">posts</a>, so today we will focus on the release of <code>ocp-indent</code>.</p><h2>Indentation should be consistent across editors</h2><a onclick="switchContent('post3','post4')" class="btn" href="#5d1decd418b678381c3b4cbe1970cabb">Read more...</a></div><div id="post4" style="display: none"><p>Since our last <a href="http://www.ocamlpro.com/blog/2013/02/18/monthly-01-02.html">activity report</a> we have released the first stable versions of two projects: <a href="http://opam.ocamlpro.com">OPAM</a>, an installation manager for OCaml source packages, and <a href="https://github.com/OCamlPro/ocp-indent">ocp-indent</a>, an indentation tool.</p><p>We have already described the basics of OPAM in two precedent <a href="http://www.ocamlpro.com/blog/2013/01/17/opam-beta.html">blog</a> <a href="http://www.ocamlpro.com/blog/2013/01/17/opam-1.0.0.html">posts</a>, so today we will focus on the release of <code>ocp-indent</code>.</p><h2>Indentation should be consistent across editors</h2><p>When you work on a very large code-base, it is crucial to keep a consistent indentation scheme. This is not only good for code review purposes (when the indentation carries semantic properties) but also when your code is starting to evolve and when the one who makes the change is not the one who wrote the initial piece of code. In the latter case, the variety of editors and local configurations usually leads to lot of small changes carrying no semantic value at all (such as changing tabs to spaces, adding few spaces at the beginning or end of lines, and so on). This semantic noise considerably decreases the efficiency of any code-review and change process and is usually very good at hiding hard-to-track bugs in your code-base.</p><p>A few months ago, the solutions for OCaml to this indentation problem were limited. For instance, you could write coding guidelines and hope that all the developers in your project would follow them. If you wanted to be more systematic, you could create and share a common configuration file for some popular editors (most OCaml developers use the emacs' <code>tuareg-mode</code> or vim) but it is very hard to get consistent indentation result across multiple tools. Moreover, having to rely on a specific editor mode means that it is harder to fully automatize the indentation process, for instance when setting-up a VCS hook.</p><p>In order to overcome these pitfalls, <a href="http://www.janestreet.com/">Jane Street</a> asked us to design a new external tool with the following high-level specification:</p><ul> <li> <p>it should be easy to use inside and outside any editor;</p> </li><li> <p>it should understand the OCaml semantics and reflect it in the indentation;</p> </li><li> <p>it should be easy to maintain and to extend;</p> </li> </ul><p>So we started to look at the OCaml tools' ecosystem and we found an early prototype of Jun Furuse's <a href="https://bitbucket.org/camlspotter">ocaml-indent</a>. The foundation looked great but the result on real-world code sources was not as nice as it could be, so we decided to start from this base to build our new tool, that we called <code>ocp-indent</code>. Today, <code>ocp-indent</code> and <code>ocaml-indent</code> do not have much code in common anymore, but the global architecture of the system remains the same.</p><h2>Writing an indentation engine for OCaml</h2><p>An indentation engine may seem like a rather simple problem: given any line in the program, we want to compute its indentation level, based on the code structure.</p><p>It turns out to be much more difficult than that, mainly because indentation is only marginally semantic, and, worse, is a matter of taste and "proper layout". In short, it's not a problem that can be expressed concisely, because one really does want lots of specific cases handled "nicely", depending on the on-screen layout -- position of line breaks -- rather than the semantic structure. <code>Ocp-indent</code> does contain lots of ad-hoc logic for such cases. To make things harder, the OCaml syntax is known to be difficult to handle, with a few ambiguities.</p><h3>Indent process</h3><p><code>Ocp-indent</code> processes code in a simple and efficient way:</p><ul> <li> <p>We lex the input with a <a href="https://github.com/OCamlPro/ocp-indent/blob/master/src/approx_lexer.mll">modified version of the OCaml lexer</a>, to guarantee complete consistency with OCaml itself. The parser had to be modified to be more robust (ocaml fails on errors, the indentation tool should not) and to keep tokens like comments, quotations, and, in the latest version, some ocamldoc block delimiters.</p> </li><li> <p>Taking the token stream as input, we maintain a <a href="https://github.com/OCamlPro/ocp-indent/blob/master/src/indentBlock.ml">"block" stack</a> that keeps informations like the kinds of blocks we have been through to get to the cursor position, the column and the indentation parameters. For instance, the "block" stack  <code>[KBody KFfun; KLet; KBody KModule]</code> corresponds to the position of <code>X</code> in the following piece of (pseudo-) code:</p> </li> </ul><pre><code>...
module Foo = struct
  ...
  let f = fun a -&gt; X
</code></pre><ul> <li> <p>Each token may look up the stack to find its starting counterpart (<code>in</code> will look for <code>KLet</code>, etc.), or disambiguate (<code>=</code> will look for <code>KLet</code>, stopping on opening tokens like <code>KBracket</code>, and will be inserted as an operator if none is found). This is flexible enough to allow for "breaking" the stack when incorrect grammar is found. For example, the unclosed paren in <code>module let x = ( end</code> should not break indent after the <code>end</code>. Great care was taken in deciding what tokens should be able to remove from the stack in which conditions.</p> </li><li> <p>The stack can also be used to find a token that we want to align on, typically bars <code>|</code> in a pattern-matching.</p> </li><li> <p>On every line break, the stack can be used to compute the indentation of the next line.</p> </li><li> <p>In the case of partial file indentation (typically, reindenting one line or a single block), on lines that shouldn't be reindented the stack is reversely updated to adapt to the current indentation.</p> </li> </ul><h3>Priorities</h3><p>The part where some abstraction can be put into the engine is the knowledge of the semantics, and more precisely of the scope of the operations. It's also in that case that the indenter can help you write, and not only read, your code. On that matter, <code>ocp-indent</code> has a knowledge of the precedence of operators and constructs that is used to know how far to unwind the stack, and what to align on. For example, a <code>;</code> will flush function applications and most operators.</p><p>It is that part that gives it the most edge over <code>tuareg</code>, and avoids semantically incorrect indents. All infix operators are defined with a priority, a kind of indentation (indentation increment or alignment over the above concerned expression), and an indentation value (number of spaces to add). So for example most operators have a priority lower than function application, but not <code>.</code>, which yields correct results for:</p><pre><code>let f =
  somefun
    record.
      field
    y
  + z
</code></pre><p>Boolean operators like <code>&amp;&amp;</code> and <code>||</code> are setup for alignment instead of indentation:</p><pre><code>let r = a
        || b
           &amp;&amp; c
        || d
</code></pre><p>Additionally, some special operators are wanted with a <i>negative</i> alignment in some cases. This is also handled in a generic way by the engine. In particular, this is the case for <code>;</code> or <code>|</code>:</p><pre><code>type t = A
       | B

let r = { f1 = x
        ; f2 = y
        }
</code></pre><h3>A note on the integration in editors</h3><p><code>ocp-indent</code> can be used on the command-line to reindent whole files (or part of them with <code>--lines</code>), but the most common use of an indenter is from an editor. If you are lucky enough to be able to call OCaml code from your editor, you can use it directly as a library, but otherwise, the preferred way is to use the option <code>--numeric</code>: instead of reprinting the file reindented, it will only output indentation levels, which you can then process from your editor (for instance, using <code>indent-line-to</code> with emacs). That should be cheaper and will help preserve cursor position, etc.</p><p>Currently, a simple emacs binding working on either the ocaml or the tuareg mode is provided, together with a vim mode contributed by Raphaël Proust and David Powers.</p><h2>Results</h2><p>We've built <code>ocp-indent</code> based on a growing collection of <a href="https://github.com/OCamlPro/ocp-indent/tree/master/tests/passing">unit-tests</a>. If you find an indentation bug, feel free to <a href="https://github.com/OCamlPro/ocp-indent/issues">send us</a> a code snippet that we will incorporate into our test suite.</p><p>Our tests clearly show that the deep understanding that <code>ocp-indent</code> has of the OCaml syntax makes it shines on specific cases. We are still discussing and evaluating the implementation of few corner-cases related, see for instance the <a href="http://htmlpreview.github.com/?https://github.com/OCamlPro/ocp-indent/blob/master/tests/failing.html">currently failing tests</a>.</p><p>We have also run some <a href="http://htmlpreview.github.com/?https://github.com/AltGr/ocp-indent-tests/blob/master/status.html">benchmarks</a> on real code-bases and the result is quite conclusive: <code>ocp-indent</code> is always better than tuareg! This is a very nice result as most of the existing source files are either indented manually or are following tuareg standards. But <code>ocp-indent</code> is also orders of magnitude faster, which means you can integrate it seamlessly into any automatic process.</p><a onclick="switchContent('post4','post3')" class="btn" href="#5d1decd418b678381c3b4cbe1970cabb">Hide</a></div></span>
<a name="4dc81c1e1a3ae1c0cc9d8c57fae067dc"></a><span class="rss-header"><span class="rss-title"><a href="http://functional-orbitz.blogspot.com/2013/03/ann-riakc-000.html"> [ANN] Riakc 0.0.0</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author"><span id="ocaml_2">Orbitz &#9001;noreply<abbr title="(at) &rarr; @">(at)</abbr>blogger.com (orbitz)&#9002;</span><script type="text/javascript"><!--;
local = "noreply";
h = "blogger.com (orbitz)";
hq = "blogger.com%20(orbitz)";
document.getElementById("ocaml_2").innerHTML = '<a href="mailto:' + local + '@' + hq + "\" >Orbitz<\/a>";
//--></script></span>, <span class="rss-date">17 Mar 2013</span></span><span class="rss-description"><div id="post5"><p><i>Note, since writing this post, Riakc 1.0.0 has already been released and merged into opam.  It fixes the below issue of Links (there is a typo in the release notes, 'not' should be 'now'.  The source code can be found <a href="https://github.com/orbitz/ocaml-riakc/tree/1.0.0">here</a>.  The 1.0.0 version number does not imply any stability or completeness of the library, just that it is not backwards compatible with 0.0.0. </i></p> <p>Riakc is a Riak Protobuf client for Ocaml.  Riakc uses Jane St Core/Async for concurrency.  Riakc is in early development and so far supports a subset of the Riak API.  The supported methods are: </p> <p></p><ul><li>ping</li><li>client_id</li><li>server_info</li><li>list_buckets</li><li>list_keys</li><li>bucket_props</li><li>get</li><li>put</li><li>delete</li></ul><p></p> <h2>A note on GET</h2><p>Links are currently dropped all together in the implementation, so if you read a value with links and write it back, you will have lost them.  This will be fixed in the very near future. </p> <p>As with anything, please feel free to submit issues and pull requests. </p> <a onclick="switchContent('post5','post6')" class="btn" href="#4dc81c1e1a3ae1c0cc9d8c57fae067dc">Read more...</a></div><div id="post6" style="display: none"><p><i>Note, since writing this post, Riakc 1.0.0 has already been released and merged into opam.  It fixes the below issue of Links (there is a typo in the release notes, 'not' should be 'now'.  The source code can be found <a href="https://github.com/orbitz/ocaml-riakc/tree/1.0.0">here</a>.  The 1.0.0 version number does not imply any stability or completeness of the library, just that it is not backwards compatible with 0.0.0. </i></p> <p>Riakc is a Riak Protobuf client for Ocaml.  Riakc uses Jane St Core/Async for concurrency.  Riakc is in early development and so far supports a subset of the Riak API.  The supported methods are: </p> <p></p><ul><li>ping</li><li>client_id</li><li>server_info</li><li>list_buckets</li><li>list_keys</li><li>bucket_props</li><li>get</li><li>put</li><li>delete</li></ul><p></p> <h2>A note on GET</h2><p>Links are currently dropped all together in the implementation, so if you read a value with links and write it back, you will have lost them.  This will be fixed in the very near future. </p> <p>As with anything, please feel free to submit issues and pull requests. </p> <p>The source code can be found <a href="https://github.com/orbitz/ocaml-riakc/tree/0.0.0">here</a>.  Riakc is in opam and you can install it by doing <code>opam install riakc</code>. </p> <h1>Usage</h1><p>There are two API modules in Riakc.  Examples of all existing API functions can be found <a href="https://github.com/orbitz/ocaml-riakc/tree/0.0.0/examples">here</a>. </p> <h2>Riakc.Conn</h2><p><code>Riakc.Conn</code> provides the API for performing actions on the database.  The module interface can be read <a href="https://github.com/orbitz/ocaml-riakc/blob/0.0.0/lib/riakc/conn.mli">here</a>.   </p> <h2>Riakc.Robj</h2><p><code>Riakc.Robj</code> provides the API for objects stored in Riak.  The module interface can be read <a href="https://github.com/orbitz/ocaml-riakc/blob/0.0.0/lib/riakc/robj.mli">here</a>.  <code>Riakc.Conn.get</code> returns a <code>Riakc.Robj.t</code> and <code>Riakc.Conn.put</code> takes one.  <code>Robj.t</code> supports representing siblings, however <code>Riakc.Conn.put</code> cannot PUT objects with siblings, this is enforced using phantom types.  A value of <code>Riakc.Robj.t</code> that might have siblings is converted to one that doesn't using <code>Riakc.Robj.set_content</code>. </p><a onclick="switchContent('post6','post5')" class="btn" href="#4dc81c1e1a3ae1c0cc9d8c57fae067dc">Hide</a></div></span>
<a name="10d12e77b837ececa6666cfdb0c9aa91"></a><span class="rss-header"><span class="rss-title"><a href="http://functional-orbitz.blogspot.com/2013/03/ann-protobuf-002.html"> [ANN] Protobuf 0.0.2</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author"><span id="ocaml_3">Orbitz &#9001;noreply<abbr title="(at) &rarr; @">(at)</abbr>blogger.com (orbitz)&#9002;</span><script type="text/javascript"><!--;
local = "noreply";
h = "blogger.com (orbitz)";
hq = "blogger.com%20(orbitz)";
document.getElementById("ocaml_3").innerHTML = '<a href="mailto:' + local + '@' + hq + "\" >Orbitz<\/a>";
//--></script></span>, <span class="rss-date">17 Mar 2013</span></span><span class="rss-description"><div id="post7"><p>Protobuf is an Ocaml library for communicating with Google's protobuf format.  It provides a method for writing parsers and builders.  There is no protoc support, yet and writing it is not a top goal right now.  Protobuf is meant to be fairly lightweight and straight forward to use.  The only other Protobuf support for Ocaml I am aware of is through <a href="http://piqi.org/">piqi</a>, however that was too heavy for my needs. </p> <p>Protobuf is meant to be very low level, mostly dealing with representation of values and not semantics.  For example, the <code>fixed32</code> and <code>sfixed32</code> values are both parsed as <code>Int32.t</code>'s.  Dealing with being signed or not is left up to the user. </p> <p>The source code can be viewed <a href="https://github.com/orbitz/ocaml-protobuf/tree/0.0.2">here</a>.  Protobuf is in opam, to install it <code>opam install protobuf</code>. </p> <a onclick="switchContent('post7','post8')" class="btn" href="#10d12e77b837ececa6666cfdb0c9aa91">Read more...</a></div><div id="post8" style="display: none"><p>Protobuf is an Ocaml library for communicating with Google's protobuf format.  It provides a method for writing parsers and builders.  There is no protoc support, yet and writing it is not a top goal right now.  Protobuf is meant to be fairly lightweight and straight forward to use.  The only other Protobuf support for Ocaml I am aware of is through <a href="http://piqi.org/">piqi</a>, however that was too heavy for my needs. </p> <p>Protobuf is meant to be very low level, mostly dealing with representation of values and not semantics.  For example, the <code>fixed32</code> and <code>sfixed32</code> values are both parsed as <code>Int32.t</code>'s.  Dealing with being signed or not is left up to the user. </p> <p>The source code can be viewed <a href="https://github.com/orbitz/ocaml-protobuf/tree/0.0.2">here</a>.  Protobuf is in opam, to install it <code>opam install protobuf</code>. </p> <p>The hope is that parsers and builders look reasonably close to the <code>.proto</code> files such that translation is straight forward, at least until protoc support is added.  This is an early release and, without a doubt, has bugs in it please submit pull requests and issues. </p> <p><a href="https://github.com/orbitz/ocaml-protobuf/tree/0.0.2/">https://github.com/orbitz/ocaml-protobuf/tree/0.0.2/</a></p> <h1>Examples</h1><p>The best collection of examples right now is the <a href="https://github.com/orbitz/ocaml-protobuf/blob/0.0.2/lib/protobuf/protobuf_test.ml">tests</a>.  An example from the file: </p> <p></p><pre><code><b></b></code></pre><font color="#0000FF">let</font> simple <font color="#990000">=</font><br/>  <b><font color="#000080">P</font></b><font color="#990000">.</font><font color="#009900">int32</font> <font color="#993399">1</font> <font color="#990000">&gt;&gt;=</font> <b><font color="#000080">P</font></b><font color="#990000">.</font>return<br/><br/><b><font color="#0000FF">let</font></b> complex <font color="#990000">=</font><br/>  <b><font color="#000080">P</font></b><font color="#990000">.</font><font color="#009900">int32</font> <font color="#993399">1</font>           <font color="#990000">&gt;&gt;=</font> <b><font color="#0000FF">fun</font></b> num <font color="#990000">-&gt;</font><br/>  <b><font color="#000080">P</font></b><font color="#990000">.</font><font color="#009900">string</font> <font color="#993399">2</font>          <font color="#990000">&gt;&gt;=</font> <b><font color="#0000FF">fun</font></b> s <font color="#990000">-&gt;</font><br/>  <b><font color="#000080">P</font></b><font color="#990000">.</font>embd_msg <font color="#993399">3</font> simple <font color="#990000">&gt;&gt;=</font> <b><font color="#0000FF">fun</font></b> emsg <font color="#990000">-&gt;</font><br/>  <b><font color="#000080">P</font></b><font color="#990000">.</font>return <font color="#990000">(</font>num<font color="#990000">,</font> s<font color="#990000">,</font> emsg<font color="#990000">)</font><br/><br/><b><font color="#0000FF">let</font></b> run_complex str <font color="#990000">=</font><br/>  <b><font color="#0000FF">let</font></b> <b><font color="#000080">open</font></b> <b><font color="#000080">Result</font></b><font color="#990000">.</font><font color="#009900">Monad_infix</font> <b><font color="#0000FF">in</font></b><br/>  <b><font color="#000080">P</font></b><font color="#990000">.</font><b><font color="#000080">State</font></b><font color="#990000">.</font>create <font color="#990000">(</font><b><font color="#000080">Bitstring</font></b><font color="#990000">.</font>bitstring_of_string str<font color="#990000">)</font><br/>  <font color="#990000">&gt;&gt;=</font> <b><font color="#0000FF">fun</font></b> s <font color="#990000">-&gt;</font><br/>  <b><font color="#000080">P</font></b><font color="#990000">.</font>run complex s<br/><p></p> <p>The builder for this message looks like: </p> <p></p><pre><code><b></b></code></pre><font color="#0000FF">let</font> build_simple i <font color="#990000">=</font><br/>  <b><font color="#0000FF">let</font></b> <b><font color="#000080">open</font></b> <b><font color="#000080">Result</font></b><font color="#990000">.</font><font color="#009900">Monad_infix</font> <b><font color="#0000FF">in</font></b><br/>  <b><font color="#0000FF">let</font></b> b <font color="#990000">=</font> <b><font color="#000080">B</font></b><font color="#990000">.</font>create <font color="#990000">()</font> <b><font color="#0000FF">in</font></b><br/>  <b><font color="#000080">B</font></b><font color="#990000">.</font><font color="#009900">int32</font> b <font color="#993399">1</font> i <font color="#990000">&gt;&gt;=</font> <b><font color="#0000FF">fun</font></b> <font color="#990000">()</font> <font color="#990000">-&gt;</font><br/>  <font color="#009900">Ok</font> <font color="#990000">(</font><b><font color="#000080">B</font></b><font color="#990000">.</font>to_string b<font color="#990000">)</font><br/><br/><b><font color="#0000FF">let</font></b> build_complex <font color="#990000">(</font>i1<font color="#990000">,</font> s<font color="#990000">,</font> i2<font color="#990000">)</font> <font color="#990000">=</font><br/>  <b><font color="#0000FF">let</font></b> <b><font color="#000080">open</font></b> <b><font color="#000080">Result</font></b><font color="#990000">.</font><font color="#009900">Monad_infix</font> <b><font color="#0000FF">in</font></b><br/>  <b><font color="#0000FF">let</font></b> b <font color="#990000">=</font> <b><font color="#000080">B</font></b><font color="#990000">.</font>create <font color="#990000">()</font> <b><font color="#0000FF">in</font></b><br/>  <b><font color="#000080">B</font></b><font color="#990000">.</font><font color="#009900">int32</font> b <font color="#993399">1</font> i1                 <font color="#990000">&gt;&gt;=</font> <b><font color="#0000FF">fun</font></b> <font color="#990000">()</font> <font color="#990000">-&gt;</font><br/>  <b><font color="#000080">B</font></b><font color="#990000">.</font><font color="#009900">string</font> b <font color="#993399">2</font> s                 <font color="#990000">&gt;&gt;=</font> <b><font color="#0000FF">fun</font></b> <font color="#990000">()</font> <font color="#990000">-&gt;</font><br/>  <b><font color="#000080">B</font></b><font color="#990000">.</font>embd_msg b <font color="#993399">3</font> i2 build_simple <font color="#990000">&gt;&gt;=</font> <b><font color="#0000FF">fun</font></b> <font color="#990000">()</font> <font color="#990000">-&gt;</font><br/>  <font color="#009900">Ok</font> <font color="#990000">(</font><b><font color="#000080">B</font></b><font color="#990000">.</font>to_string b<font color="#990000">)</font><br/><p></p><a onclick="switchContent('post8','post7')" class="btn" href="#10d12e77b837ececa6666cfdb0c9aa91">Hide</a></div></span>
<a name="175d5661f0dbe68962e4cbd84fded38c"></a><span class="rss-header"><span class="rss-title"><a href="http://www.ocamlpro.com/blog/2013/03/14/opam-1.0.0.html"> OPAM 1.0.0 Released</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author"><span id="ocaml_4">OCamlPro &#9001;thomas<abbr title="(at) &rarr; @">(at)</abbr>ocamlpro.com (Thomas Gazagnaire)&#9002;</span><script type="text/javascript"><!--;
local = "thomas";
h = "ocamlpro.com (Thomas Gazagnaire)";
hq = "ocamlpro.com%20(Thomas%20Gazagnaire)";
document.getElementById("ocaml_4").innerHTML = '<a href="mailto:' + local + '@' + hq + "\" >OCamlPro<\/a>";
//--></script></span>, <span class="rss-date">14 Mar 2013</span></span><span class="rss-description"><div id="post9"><p>We have previously <a href="http://www.ocamlpro.com/blog/2013/01/17/opam-beta.html">announced</a> the beta-release of <a href="http://opam.ocamlpro.com/">OPAM</a>. After two intense months of work, we are now very proud to announce the <b>first official</b> release of OPAM!</p><p>This release fixes many bugs and adds few new features to the previously announced beta-release.</p><p>The most visible new feature, which should be useful for beginners with OCaml and OPAM, is an auto-configuration tool. This tool easily enables all the features of OPAM (auto-completion, fix the loading of scripts for the toplevel, opam-switch-eval alias, etc). This tool runs interactively on each <code>opam init</code> invocation. If you don't like OPAM to change your configuration files, use <code>opam init --no-setup</code>. If you trust the tool blindly, use <code>opam init --auto-setup</code>.</p><pre><code>opam init                 # Interactive setup
opam init --no-setup      # No configuration change
opam init --auto-setup    # Automatic setup
</code></pre><p>You can later change the setup by doing:</p><a onclick="switchContent('post9','post10')" class="btn" href="#175d5661f0dbe68962e4cbd84fded38c">Read more...</a></div><div id="post10" style="display: none"><p>We have previously <a href="http://www.ocamlpro.com/blog/2013/01/17/opam-beta.html">announced</a> the beta-release of <a href="http://opam.ocamlpro.com/">OPAM</a>. After two intense months of work, we are now very proud to announce the <b>first official</b> release of OPAM!</p><p>This release fixes many bugs and adds few new features to the previously announced beta-release.</p><p>The most visible new feature, which should be useful for beginners with OCaml and OPAM, is an auto-configuration tool. This tool easily enables all the features of OPAM (auto-completion, fix the loading of scripts for the toplevel, opam-switch-eval alias, etc). This tool runs interactively on each <code>opam init</code> invocation. If you don't like OPAM to change your configuration files, use <code>opam init --no-setup</code>. If you trust the tool blindly, use <code>opam init --auto-setup</code>.</p><pre><code>opam init                 # Interactive setup
opam init --no-setup      # No configuration change
opam init --auto-setup    # Automatic setup
</code></pre><p>You can later change the setup by doing:</p><pre><code>opam config setup --list  # show your current setup
opam config setup --all   # Enable all the features of OPAM
</code></pre><p>You can of course manually review and modifye the changes made b by editing your <code>~/.profile</code> (or <code>~/.zshrc</code> for zsh users), <code>~/.ocamlinit</code> and the <code>~/.opam/opam-init/*</code> init scripts.</p><h2>Contribute</h2><p>Please report:</p><ul> <li> <p>Bug reports and feature requests for the OPAM tool <a href="http://github.com/OCamlPro/opam/issues">here</a>.</p> </li><li> <p>Packaging issues or requests for a new package <a href="http://github.com/OCamlPro/opam-repository/issues">here</a>.</p> </li><li> <p>General queries to the <a href="http://lists.ocaml.org/listinfo/platform">platform list</a>.</p> </li><li> <p>More specific queries about the internals of OPAM to the <a href="http://lists.ocaml.org/listinfo/opam-devel">OPAM devel list</a>.</p> </li> </ul><h2>Install</h2><p>Packages for Debian and OSX (at least homebrew) should follow shortly and I'm looking for volunteers to create and maintain rpm packages. The binary installer is up-to-date for Linux and Darwin 64-bit architectures, the 32-bit version for Linux should arrive shortly.</p><p>If you want to build from sources, the full archive (including dependencies) is available at:</p><p><a href="http://www.ocamlpro.com/pub/opam-full-latest.tar.gz">http://www.ocamlpro.com/pub/opam-full-latest.tar.gz</a></p><h2>Upgrade</h2><p>If you are upgrading from 0.9.* (eg. if you have at least installed the beta release announced in January) you won't have anything special to do apart installing the new binary. You can then update your package metadata by running <code>opam update</code>. If you want to use the auto-setup feature, remove the "eval <code>opam config env</code> line you have previously added in your <code>~/.profile</code> and run <code>opam config setup --all</code>.</p><p>So everything should be fine. But you never know ... so if something goes horribly wrong in the upgrade process (of if your are upgrading from an old version of OPAM) you can still trash your <code>~/.opam</code>, manually remove what OPAM added in your <code>~/.profile</code> (<code>~/.zshrc</code> for zsh users) and <code>~/.ocamlinit</code>, and start again from scratch.</p><h2>Random Statistics</h2><p>The OPAM project on Github is very pleasantly active. We have got lot of contribution from a lot of different people, and I am very pleased to regularly discover new and interesting OCaml projects pushed to the OPAM repository. So thanks everybody for the great contributions!</p><p>We have worked hard to deliver OPAM and we are very delighted to get a warm welcome from the community. This give us a lot of motivation to continue improving OPAM!</p><h3>Repositories</h3><ul> <li> <p><a href="https://github.com/OCamlPro/opam">https://github.com/OCamlPro/opam</a>: +2000 commits, 26 contributors</p> </li><li> <p><a href="https://github.com/OCamlPro/opam-repository">https://github.com/OCamlPro/opam-repository</a>: +1700 commits, 75 contributors, 370+ packages</p> </li> </ul><h3>Usage</h3><p>On <a href="http://opam.ocamlpro.com/">http://opam.ocamlpro.com/</a></p><ul> <li> <p>+400 unique visitor per week, 15k <code>opam update</code> per week</p> </li><li> <p>+1300 unique visitor per month, 55k <code>opam update</code> per month</p> </li><li> <p>3815 unique visitor since the alpha release</p> </li> </ul><h2>Changelog</h2><p>The full change-log is available <a href="https://github.com/OCamlPro/opam/blob/master/CHANGES">here</a></p><a onclick="switchContent('post10','post9')" class="btn" href="#175d5661f0dbe68962e4cbd84fded38c">Hide</a></div></span>
<a name="0115a8e5838e2168af30a5dedfe7ee44"></a><span class="rss-header"><span class="rss-title"><a href="http://alan.petitepomme.net/cwn/2013.03.12.html"> Caml Weekly News, 12 Mar 2013</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Caml Weekly News</span>, <span class="rss-date">12 Mar 2013</span></span><span class="rss-description">Commercial Users of Functional Programming 2013 / OPAM mailing-lists ERRATUM / Barista 2.0-beta release / A brief guide to a bit of the OCaml type checker / llpp v15 / [ocamlgraph] Johnson's algo, C-bindings, GraphML reader, edge dominators / If you distribute oasis' setup.ml with your software, please use a recent (&gt;= 0.3.0) version of Oasis / OpenGL Ocaml mailing-list / Other Caml News</span>
<a name="c3f4de345dacff845f985e402cced3c6"></a><span class="rss-header"><span class="rss-title"><a href="http://lpw25.net/2013/03/10/ocaml-namespaces.html"> Adding namespaces to OCaml</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author"><span id="ocaml_5">Leo White &#9001;leo<abbr title="(at) &rarr; @">(at)</abbr>lpw25.net (Leo White)&#9002;</span><script type="text/javascript"><!--;
local = "leo";
h = "lpw25.net (Leo White)";
hq = "lpw25.net%20(Leo%20White)";
document.getElementById("ocaml_5").innerHTML = '<a href="mailto:' + local + '@' + hq + "\" >Leo White<\/a>";
//--></script></span>, <span class="rss-date">10 Mar 2013</span></span><span class="rss-description"><div id="post11"><a onclick="switchContent('post11','post12')" class="btn" href="#c3f4de345dacff845f985e402cced3c6">Read more...</a></div><div id="post12" style="display: none"><div class="well well-small">
<h4>Contents</h4>
<div class="toc">
   <ul>

   </ul><ul>

   </ul><ul>
   <li><a href="http://www.lpw25.net/rss.xml#Problems+with+pack">Problems with pack</a>   </li>
   <li><a href="http://www.lpw25.net/rss.xml#Formal+semantics">Formal semantics</a>   </li>
   <li><a href="http://www.lpw25.net/rss.xml#Design+goals">Design goals</a>   </li>
   <li><a href="http://www.lpw25.net/rss.xml#Design+choices">Design choices</a>
    <ul>
    <li><a href="http://www.lpw25.net/rss.xml#Flat+or+hierarchical?">Flat or hierarchical?</a>    </li>
    <li><a href="http://www.lpw25.net/rss.xml#Should+namespaces+be+opened+explicitly+in+source+code?">Should namespaces be opened explicitly in source code?</a>    </li>
    <li><a href="http://www.lpw25.net/rss.xml#How+should+the+compiler+find+modules+in+the+presence+of+namespaces?">How should the compiler find modules in the presence of namespaces?</a>
     <ul>
     <li><a href="http://www.lpw25.net/rss.xml#Using+filenames">Using filenames</a>     </li>
     <li><a href="http://www.lpw25.net/rss.xml#Checking+multiple++.cmi++files">Checking multiple “.cmi” files</a>     </li>
     <li><a href="http://www.lpw25.net/rss.xml#Using+namespace+description+files">Using namespace description files</a>     </li>
     <li><a href="http://www.lpw25.net/rss.xml#Using+environment+description+files">Using environment description files</a>     </li>
    </ul>
    </li><li><a href="http://www.lpw25.net/rss.xml#How+should+namespaces+specified?">How should namespaces specified?</a>
     <ul>
     <li><a href="http://www.lpw25.net/rss.xml#Explicitly+in+the+source+files">Explicitly in the source files</a>     </li>
     <li><a href="http://www.lpw25.net/rss.xml#Through+command-line+arguments">Through command-line arguments</a>     </li>
     <li><a href="http://www.lpw25.net/rss.xml#Through+filenames">Through filenames</a>     </li>
     <li><a href="http://www.lpw25.net/rss.xml#Through+namespace+description+files">Through namespace description files</a>     </li>
     <li><a href="http://www.lpw25.net/rss.xml#Through+environment+description+files">Through environment description files</a>     </li>
    </ul>
    </li><li><a href="http://www.lpw25.net/rss.xml#How+rich+should+a+description+language+be?">How rich should a description language be?</a>    </li>
    <li><a href="http://www.lpw25.net/rss.xml#Should+namespaces+support+automatically+opened+members?">Should namespaces support automatically opened members?</a>    </li>
   </ul>
   </li><li><a href="http://www.lpw25.net/rss.xml#Proposal">Proposal</a>
    <ul>
    <li><a href="http://www.lpw25.net/rss.xml#Simple+namespaces+through+filenames">Simple namespaces through filenames</a>    </li>
    <li><a href="http://www.lpw25.net/rss.xml#An+alternative+to+search+paths">An alternative to search paths</a>    </li>
    <li><a href="http://www.lpw25.net/rss.xml#The++-name++argument">The “-name” argument</a>    </li>
    <li><a href="http://www.lpw25.net/rss.xml#The++-open++argument">The “-open” argument</a>    </li>
    </ul>
   </li>
   </ul>
  
  
 
 

</div>
</div>


<p>Recently there has been a lot of discussion on
<a href="http://lists.ocaml.org/listinfo/platform">platform@lists.ocaml.org</a> about
proposals for adding namespaces to OCaml. I’ve written this post to summarise
the design decisions for such a proposal and to make my own proposal.</p>

<p>Before discussing what namespaces are and the issues surrounding their
implementation, it is important to explain why they are needed in the first
place.</p>

<p>The most important reason for adding namespaces is to provide some means for
grouping the components of a library together. Up to now this has been
achieved using the OCaml module system. Since the components of an OCaml
library are modules, a module can be created that contains all the components
of the library as sub-modules. The “-pack” option for the compiler was created
to allow this module to be created while still keeping each component of the
library in its own file.</p>

<h3 id="Problems+with+pack">Problems with pack</h3>

<p>There are some critical problems with using “-pack” to create a single module
containing the whole library:</p>

<ul>
<li><p>The packed module is a single unit that has to be linked or not as a
unit. This means that any program using part of the library must include the
entire library.</p></li>
<li><p>The packed module is a choke-point in the dependency graph.  If a file
depends on one thing in the packed module then it needs to be recompiled if
anything in the packed module changes.</p></li>
<li><p>Opening a large packed module is very slow and can seriously affect build
performance.</p></li>
</ul>


<p>These problems are all caused by the fact that pack creates an OCaml
module. To understand this consider the run-time semantics of the module
system.</p>

<p>At run-time a module is a record. Initialising a module involves initialising
every component of the module and placing them in this record.  Initialising
these components can involve executing arbitrary code; in fact the execution
of an OCaml program is simply the initialisation of all its modules.</p>

<p>The problems with pack are related to these dynamic semantics. In order to
be a module pack must create a record to represent this module. This means
that it must initialise all of its components. It is this (rather than any
detail of pack’s implementation) that causes the problems identified above.</p>

<p>Access to the components of a top-level module could proceed without the
existence of this record. However, the record is required in order to “alias”
the module, use the module as a first-class value or use it as the argument to
a functor.</p>

<p>Any attempt to overcome the problems with pack, whilst still maintaining
the illusion that the “pack” is a normal module, would result (at the very
least) in one of the following unhealthy situations:</p>

<ul>
<li><p>The module type of the “packed module” would depend on which of its
components were accessed by the program.</p></li>
<li><p>Any use of the “packed module” other than as a simple container
(e.g.
<span class="highlight"><code><span class="k">module</span>
<span class="nc">CS</span>
<span class="o">=</span>
<span class="nn">Core</span><span class="p">.</span><span class="nc">Std</span></code></span>
) could have a dramatic effect on what was
linked into the program and potentially on the semantics of the program.</p></li>
</ul>


<p>Namespaces are basically modules that can only be used as a simple
container. This means that they do not need a corresponding record at
run-time (or any other run-time representation). This avoids the problems
with pack as well as enabling other useful features.</p>

<h3 id="Formal+semantics">Formal semantics</h3>

<p>Following the semantics and description language for namespaces described by
<a href="http://gallium.inria.fr/~scherer/namespaces/spec.pdf">Gabriel Scherer et al</a>,
I will consider namespaces to be name-labelled trees whose leaves are
compilation units. I will use
<span class="highlight"><code><span class="o">#</span></code></span>
to represent projection on namespaces, so the
<span class="highlight"><code><span class="nc">Bar</span></code></span>
member of the
<span class="highlight"><code><span class="nc">Foo</span></code></span>
namespace will be referred to as
<span class="highlight"><code><span class="nc">Foo</span><span class="o">#</span><span class="nc">Bar</span></code></span>.</p>

<h3 id="Design+goals">Design goals</h3>

<p>Some design goals that we might want from a proposal for adding namespaces to
OCaml include:</p>

<ul>
<li><p><strong>Allow library components to be grouped together without creating a module
containing them.</strong></p></li>
<li><p><strong>Allow users to group together modules from different libraries as they see
fit.</strong> This means letting people change which namespace a library module is
in.</p></li>
<li><p><strong>Allow library components to be given multiple names.</strong> For example
<span class="highlight"><code><span class="nc">Lib</span><span class="o">#</span><span class="nc">Foo</span></code></span>
and
<span class="highlight"><code><span class="nc">Lib</span><span class="o">#</span><span class="nc">Stable</span><span class="o">#</span><span class="nc">Foo</span></code></span>
, where
<span class="highlight"><code><span class="nc">Lib</span><span class="o">#</span><span class="nc">Stable</span></code></span>
is a namespace containing only those components whose interfaces are stable.</p></li>
<li><p><strong>Be simple and easy to explain to beginners.</strong></p></li>
<li><p><strong>Allow multiple source files to share the same filename.</strong> Each module that
is linked into an OCaml program must have a unique name. Currently, a
module’s name is completely determined by its filename. This forces library
developers to either use pack (which gives its components new long names) or
give their source files long names like “libName_Foo.ml”. A namespaces
proposal may be able to alleviate this problem.</p></li>
<li><p><strong>Allow libraries to control which modules are open by default.</strong> By default
OCaml opens the standard library’s
<span class="highlight"><code><span class="nc">Pervasives</span></code></span>
module. Libraries that wish to replace the standard library may also wish to
provide their own
<span class="highlight"><code><span class="nc">Pervasives</span></code></span>
module and have it opened by default.</p></li>
<li><p><strong>Support libraries that wish to remain compatible with versions of OCaml
without namespaces.</strong></p></li>
<li><p><strong>Require minimal changes to existing build systems.</strong> Since a namespace
proposal changes how a library’s components are named, it may require
changes to some build systems. If these changes are too invasive then users
of some build systems will probably be unable to use namespaces in the near
future.</p></li>
</ul>


<h3 id="Design+choices">Design choices</h3>

<h4 id="Flat+or+hierarchical?">Flat or hierarchical?</h4>

<p>In order to replace pack, namespaces must be able to contain modules. It is
not clear, however, whether they need to be able to contain other
namespaces. We call namespaces that can contain other namespaces
<em>hierarchical</em>, as opposed to <em>flat</em>.</p>

<p>In favour of flat namespaces:</p>

<ul>
<li><p>Hierarchical namespaces might lead to arbitrary categorising of components
(e.g.<br/>
<span class="highlight"><code><span class="nc">Data</span><span class="o">#</span><span class="nc">Array</span></code></span>
). These add syntactic clutter and do not bring any real benefit.</p></li>
<li><p>Hierarchical namespaces might lead to deep java-style hierarchies
(e.g.<br/>
<span class="highlight"><code><span class="nc">Com</span><span class="o">#</span><span class="nc">Janestreet</span><span class="o">#</span><span class="nc">Core</span><span class="o">#</span><span class="nc">Std</span></code></span>
). These add syntactic clutter without adding any actual information.</p></li>
</ul>


<p>In favour of hierarchical namespaces:</p>

<ul>
<li>
A library may wish to provide multiple versions of some of its components. For
example:

<ul>
<li>    
<span class="highlight"><code><span class="nc">Http</span><span class="o">#</span><span class="nc">Async</span><span class="o">#</span><span class="nc">IO</span></code></span>
 and 
<span class="highlight"><code><span class="nc">Http</span><span class="o">#</span><span class="nc">Lwt</span><span class="o">#</span><span class="nc">IO</span></code></span>
</li>
<li>
<span class="highlight"><code><span class="nc">File</span><span class="o">#</span><span class="nc">Windows</span><span class="o">#</span><span class="nc">Directories</span></code></span>
and 
<span class="highlight"><code><span class="nc">File</span><span class="o">#</span><span class="nc">Unix</span><span class="o">#</span><span class="nc">Directories</span></code></span>
</li>
<li>
<span class="highlight"><code><span class="nc">Core</span><span class="o">#</span><span class="nc">Mutex</span></code></span>
and 
<span class="highlight"><code><span class="nc">Core</span><span class="o">#</span><span class="nc">Testing</span><span class="o">#</span><span class="nc">Mutex</span></code></span>
</li>
</ul>

In such situations it is useful to be able to write both


<div class="highlight"><pre><code class="ocaml"><span class="k">open</span> <span class="nc">Core</span>
<span class="o">[...]</span>
<span class="nc">Testing</span><span class="o">#</span><span class="nn">Mutex</span><span class="p">.</span><span class="n">lock</span> <span class="n">x</span>
</code></pre></div>


and


<div class="highlight"><pre><code class="ocaml"><span class="k">open</span> <span class="nc">Core</span><span class="o">#</span><span class="nc">Testing</span>
<span class="o">[...]</span>
<span class="nn">Mutex</span><span class="p">.</span><span class="n">lock</span> <span class="n">x</span>
</code></pre></div>

</li>
<li>
None of the systems of namespaces that have been proposed have any
additional cost for supporting hierarchical namespaces.
</li>
</ul>


<h4 id="Should+namespaces+be+opened+explicitly+in+source+code?">Should namespaces be opened explicitly in source code?</h4>

<p>There was some debate on the platform mailing list about whether to support
opening namespaces explicitly in source code. This means allowing a syntax
like:</p>

<div class="highlight">
<pre><code class="ocaml"><span class="k">open</span> <span class="k">namespace</span> <span class="nc">Foo</span></code></pre>
</div>


<p>that allows the members of namespace
<span class="highlight"><code><span class="nc">Foo</span></code></span>
to be referenced directly (i.e.
<span class="highlight"><code><span class="nc">Foo</span><span class="o">#</span><span class="nc">Bar</span></code></span>
can be referred to as
<span class="highlight"><code><span class="nc">Bar</span></code></span>).</p>

<p>The alternative would be to only support opening namespaces through a
command-line argument.</p>

<p>In favour of supporting explicit opens:</p>

<ul>
<li><p>If you open two namespaces with commonly named sub-components then the order
of those opens matters. If the opens are command-line arguments then the
order of those command-line arguments (often determined by build systems and
other tools) matters. This is potentially very fragile.</p></li>
<li><p>Explicit opens in a source file give valuable information about which
libraries are being used by that source file. If a file contains “open
namespace Core” then you know it uses the Core library.</p></li>
<li><p>Local namespace opens provide users more precise control over their naming
environment.</p></li>
</ul>


<p>Against supporting explicit opens:</p>

<ul>
<li>They require a new syntactic construct.</li>
</ul>


<h4 id="How+should+the+compiler+find+modules+in+the+presence+of+namespaces?">How should the compiler find modules in the presence of namespaces?</h4>

<p>Currently, when looking for a module
<span class="highlight"><code><span class="nc">Bar</span></code></span>
that is not in the current environment, the OCaml compiler will search the
directories in its search path for a file called “bar.cmi”.</p>

<p>In the presence of namespaces this becomes more complicated: how does the
compiler find the module
<span class="highlight"><code><span class="nc">Foo</span><span class="o">#</span><span class="nc">Bar</span></code></span>
?</p>

<p>The suggested possible methods for finding modules in the presence of
namespaces fall into four categories.</p>

<h5 id="Using+filenames">Using filenames</h5>

<p>By storing the interface for
<span class="highlight"><code><span class="nc">Foo</span><span class="o">#</span><span class="nc">Bar</span></code></span>
in a file named “foo-bar.cmi” the compiler can continue to simply look-up
modules in its search path.</p>

<p>Note that “–” is an illegal character in module names so there is no risk of
<span class="highlight"><code><span class="nc">Foo</span><span class="o">#</span><span class="nc">Bar</span></code></span>
being confused with a module called
<span class="highlight"><code><span class="nc">Foo-bar</span></code></span>.</p>

<p>This simple scheme does not support placing a module within multiple
namespaces or allowing users to put existing modules in a new namespace.</p>

<h5 id="Checking+multiple++.cmi++files">Checking multiple “.cmi” files</h5>

<p>The name of the namespace containing a compilation unit could be included in
the “.cmi” file of that unit. Then, when looking for a module
<span class="highlight"><code><span class="nc">Foo</span><span class="o">#</span><span class="nc">Bar</span></code></span>
, the compiler would try every “bar.cmi” file in its search path until it
found one that was part of the “Foo” namespace. This may require the compiler
to open all the “bar.cmi” files on its search path, which could be expensive
on certain operating systems.</p>

<p>This scheme does not support allowing users to put existing modules in a new
namespace, but can support placing a module in multiple namespaces.</p>

<p>It is difficult to detect typos in namespace open statements using this
scheme. For example, detecting that
<span class="highlight"><code><span class="k">open</span>
<span class="k">namespace</span>
<span class="nc">Core</span><span class="o">#</span><span class="nc">Sdt</span></code></span>
should have been
<span class="highlight"><code><span class="k">open</span>
<span class="k">namespace</span>
<span class="nc">Core</span><span class="o">#</span><span class="nc">Std</span></code></span>
would require the compiler to check every file in its search path for one that
was part of namespace
<span class="highlight"><code><span class="nc">Core</span><span class="o">#</span><span class="nc">Sdt</span></code></span>.</p>

<h5 id="Using+namespace+description+files">Using namespace description files</h5>

<p>The compiler could find a member of a namespace by consulting a file that
describes the members of that namespace.</p>

<p>For example, if namespace
<span class="highlight"><code><span class="nc">Foo</span></code></span>
was described by a file “foo.ns” that was on the compiler’s search path then
the compiler could find
<span class="highlight"><code><span class="nc">Foo</span><span class="o">#</span><span class="nc">Bar</span></code></span>
by locating “foo.ns” and using it to look-up the location of the “.cmi” file
for
<span class="highlight"><code><span class="nc">Bar</span></code></span>.</p>

<p>These namespace description files could be created automatically by some
tool. However, they must be produced before detecting dependencies with
OCamlDep, which could complicate the build process.</p>

<h5 id="Using+environment+description+files">Using environment description files</h5>

<p>The compiler could find a member of a namespace by consulting a file that
describes a mapping between module names and “.cmi” files.</p>

<p>For example, if a file “foo.mlpath” included the mapping “Foo#Bar:
foo/bar.cmi” then that file could be passed as a command-line argument to the
compiler and used to look up the “bar.cmi” file directly.</p>

<p>Looking up modules using this scheme may speed up compilation by avoiding the
need to scan directories for files.</p>

<h4 id="How+should+namespaces+specified?">How should namespaces specified?</h4>

<p>Perhaps the most important question for any namespaces proposal is how
namespaces are specified. It is closely related to the above question of how
the compiler finds modules in the presence of namespaces.</p>

<p>The suggested possible methods for specifying namespaces fall into five
categories.</p>

<h5 id="Explicitly+in+the+source+files">Explicitly in the source files</h5>

<p>Namespaces could be specified by adding a line like:</p>

<div class="highlight">
<pre><code class="ocaml"><span class="k">namespace</span> <span class="nc">Foo</span></code></pre>
</div>


<p>to the beginning of each compilation unit that is part of the
<span class="highlight"><code><span class="nc">Foo</span></code></span>
namespace.</p>

<p>This has the benefit of making namespaces explicitly part of the language
itself, however it does mean that the full name of a module is specified in
two locations: partly in the filename and partly within the file itself.</p>

<h5 id="Through+command-line+arguments">Through command-line arguments</h5>

<p>Namespaces could be specified by passing a command-line argument to the
compiler. For example,
<span class="highlight"><code><span class="nc">Foo</span><span class="o">#</span><span class="nc">Bar</span></code></span>
could be compiled with the command-line:</p>

<div class="highlight"><pre><code class="sh">ocamlc -c -namespace Foo bar.ml 
</code></pre></div>


<p>This scheme also means that the full name of a module is specified in two
locations: partly in the build system and partly in the filename.</p>

<h5 id="Through+filenames">Through filenames</h5>

<p>Namespaces could be specified using the filenames of source files. For
example,
<span class="highlight"><code><span class="nc">Foo</span><span class="o">#</span><span class="nc">Bar</span></code></span>
would be created by compiling a file “foo-bar.ml”</p>

<p>This scheme is simple and very similar to how modules are currently named, but
it would require all source files to have long unique names.</p>

<h5 id="Through+namespace+description+files">Through namespace description files</h5>

<p>Namespaces could be specified using namespace description files. The
<span class="highlight"><code><span class="nc">Foo</span></code></span>
namespace would be specified by a file “foo.ns” that described the members of
<span class="highlight"><code><span class="nc">Foo</span></code></span>:</p>

<pre><code>module Bar = "foo_bar.cmi"
namespace Testing = "testing.ns"
</code></pre>

<h5 id="Through+environment+description+files">Through environment description files</h5>

<p>Namespaces could be specified using environment description files. A namespace
<span class="highlight"><code><span class="nc">Foo</span></code></span>
would be defined by passing an environment description file to the compiler
that included mappings for each of the members of
<span class="highlight"><code><span class="nc">Foo</span></code></span>. For example:</p>

<pre><code>Foo#Bar: "foo_bar.cmi"
Foo#Testing#Bar: "foo_testing_bar.cmi"
Baz: "baz.cmi"
</code></pre>

<p>In addition to specifying namespaces, this system allows users (or a tool like
OCamlFind) to have complete control the naming environment of a program.</p>

<h4 id="How+rich+should+a+description+language+be?">How rich should a description language be?</h4>

<p>For namespace proposals that use namespace or environment description files,
they must decide how rich their description language should be.</p>

<p>For example, <a href="http://gallium.inria.fr/~scherer/namespaces/spec.pdf">Gabriel Scherer et
al</a> describe a very rich
environment description language including many different operations that can
be performed on namespaces.</p>

<p>A rich description language can produce shorter descriptions. However, the
more operations a language supports the more syntax that users must understand
in order to read description files. The majority of description files are
unlikely to require complex operations.</p>

<h4 id="Should+namespaces+support+automatically+opened+members?">Should namespaces support automatically opened members?</h4>

<p>A feature of namespaces that has been proposed on the mailing list is to allow
some modules within a namespace to be automatically opened when the namespace
is also opened. This makes it seem that the namespace has values and types as
members.</p>

<p>This feature is based on the current design of Jane Street’s Core
library. Users of the Core library are expected to open the
<span class="highlight"><code><span class="nc">Core<span class="p">.</span>Std</span></code></span>
 module before using the library. Opening this module provides access to all
the other modules of the library (much like opening a namespace), but it also
provides types and values similar to those provided by the standard library’s
<span class="highlight"><code><span class="nc">Pervasives</span></code></span> module.</p>

<p>Supporting auto-opened modules would allow
<span class="highlight"><code><span class="nc">Core<span class="p">.</span>Std</span></code></span>
to be directly replaced by a namespace. However, the semantics of this feature
could be awkward due to potential conflicts between members of the namespace
and sub-modules of the auto-opened modules. It also increases the overlap
between namespaces and modules.</p>

<h3 id="Proposal">Proposal</h3>

<p>In the last section of this post I will outline a namespaces proposal that I
think satisfies the design goals set out earlier.</p>

<p>I think that satisfying these design goals requires a combination of
extensions to OCaml. My proposal is made up of four such extensions. To keep
things simple for users to understand, I have tried to keep each of these
extensions completely independent of the others and with a clearly defined
goal.</p>

<h4 id="Simple+namespaces+through+filenames">Simple namespaces through filenames</h4>

<p>Currently, the name of a module is completely defined by its filename, and
modules are looked up using a simple search path. While it has some problems,
this simple paradigm has served OCaml well and I think that it is important to
provide some support for namespaces within this paradigm.</p>

<p>This means allowing simple namespaces to be specified using source file
names. For example, to create a module
<span class="highlight"><code><span class="nc">Bar</span></code></span>
within the namespace
<span class="highlight"><code><span class="nc">Foo</span></code></span>
developers can simply create an implementation file “foo-bar.ml” and an
interface file “foo-bar.mli”. This interface file would be compiled to a
“foo-bar.cmi” file. Hierarchical namespaces would be created by files with
names like “foo-bar-baz.ml”.</p>

<p>These namespaced modules can be referred to using the syntax
<span class="highlight"><code><span class="nc">Foo</span><span class="o">#</span><span class="nc">Bar</span></code></span>.
This syntax simply causes the compiler to look in its search path for a
“foo-bar.cmi” file.</p>

<p>I also propose supporting a namespace opening syntax like:</p>

<div class="highlight">
<pre><code class="ocaml"><span class="k">open</span> <span class="k">namespace</span> <span class="nc">Foo</span>
[...]
<span class="nc">Bar</span></code></pre>
</div>


<h4 id="An+alternative+to+search+paths">An alternative to search paths</h4>

<p>Forcing the name of a module to be completely defined by its (compiled)
filename makes it easy to look-up modules in a search path. However, it
prevents modules from being given multiple names or being renamed by users. So
I propose supporting an alternative look-up mechanism.</p>

<p>I propose supporting environment description files called <em>search path
files</em>. These files would have a syntax like:</p>

<pre><code>Foo#Bar : "other_bar.cmi"
Foo#Baz : Foo#Bar
</code></pre>

<p>This file can be given to the “-I” command-line argument instead of a
directory and used to look-up the locations of “.cmi” files for given module
names.</p>

<p>These search path files can be used to alias modules and to create new
namespaces. They also allow a module to be available under multiple namespaces.</p>

<p>I envisage two particular modes of use:</p>

<ul>
<li><p>Library authors can write “.mlpath” files and tell OCamlFind to use that
file as its search path instead of a list of directories.</p></li>
<li><p>A user (or potentially OCamlFind) can create search path files to define
their entire naming environment as they see fit.</p></li>
</ul>


<h4 id="The++-name++argument">The “-name” argument</h4>

<p>While the hard link between a module’s name and the name of its source file
makes life easier for build systems (“list.cmi” can only be produced by
compiling “list.ml”), it forces library authors to give their source files long
unique names.</p>

<p>I propose adding a “-name” command-line argument to the OCaml compiler. This
would be used as follows:</p>

<div class="highlight"><pre><code class="sh">ocamlc -c -name Foo#Bar other.ml
</code></pre></div>


<p>This command would produce a “foo-bar.cmi” file defining a module named
<span class="highlight"><code><span class="nc">Foo</span><span class="o">#</span><span class="nc">Bar</span></code></span>
. This means that “.cmi” files would still be expected to be unique, but
source files could be named however the developer wants.</p>

<p>Obviously, any tools that assume that a module
<span class="highlight"><code><span class="nc">Bar</span></code></span>
must be compiled from a file called “bar.ml” will not work in this
situation. However, the only OCaml tool that absolutely relies on this
assumption is “OCamlDep” when it is producing makefile formatted output.</p>

<p>Build systems would not be required to support the “-name” argument, however
it would make it easy for them to provide features such as:</p>

<ul>
<li><p>Creating namespaces to reflect a directory structure (e.g. “foo/bar.mli” becomes “foo-bar.cmi”).</p></li>
<li><p>Placing all the modules of a library under a common namespace (e.g. “bar.mli” becomes “foo-bar.cmi”)</p></li>
</ul>


<p>This would mean that the names of source files could be kept conveniently
short.</p>

<h4 id="The++-open++argument">The “-open” argument</h4>

<p>My proposals do not include support for automatically opened modules within
namespaces. I feel that this feature conflates two separate issues and it
would be better to solve the problem of automatically opened modules elsewhere.</p>

<p>Auto-opened modules are meant to allow libraries to provide their own
equivalent of the standard library’s
<span class="highlight"><code><span class="nc">Pervasives</span></code></span>
module. I think that it would be more appropriate to have these “pervasive”
modules opened by default in any program compiled using one of these
libraries.</p>

<p>I propose adding a command-line argument “-open” that could be used to open a
module by default:</p>

<div class="highlight"><pre><code class="sh">ocamlc -c -open core-pervasives.cmi foo.ml
</code></pre></div>


<p>By adding support for this feature to OCamlFind, libraries could add this
argument to every program compiled using them. This amounts to having
automatically opened modules as part of the package system rather than part of
the namespace system.</p><a onclick="switchContent('post12','post11')" class="btn" href="#c3f4de345dacff845f985e402cced3c6">Hide</a></div></span>
<script type="text/javascript">function switchContent(id1,id2) {
     // Get the DOM reference
     var contentId1 = document.getElementById(id1);
     var contentId2 = document.getElementById(id2);
     // Toggle
     contentId1.style.display = "none";
     contentId2.style.display = "block";
     }</script></div>

  
    </div>

    
    <br/>
    <hr/>
    <div id="footer">
      Contribute to this project!
      Find us on <a href="https://github.com/ocaml/ocaml.org">Github</a>.
    </div>
    <span title=".././img/ = image directory from the base of the site"></span>


    
    
    

    <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
    <script src=".././js/jquery-1.8.0.min.js"></script>
    
    <script src=".././js/bootstrap.js"></script>

    <script type="text/javascript">
      var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-22552764-2']); _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-37808023-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

    </script>

</body></html>
