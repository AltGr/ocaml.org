<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    
    <meta content="IE=8" http-equiv="X-UA-Compatible"/>
    <title>OCaml :: OCaml Planet</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <meta content="Ashish Agarwal, Esther Baruk, Christophe Troestler and many contributors" name="author"/>
    <meta content="" name="description"/>
    <meta content="" name="keywords"/>
    <meta content="OCaml (Weberizer)" name="generator"/>

    <link href="https://static.ocamlcore.org/official/images/favicon.ico" rel="shortcut icon"/>
    <link rel="stylesheet" href=".././css/bootstrap.css"/>
    <link href=".././css/ocaml.css" media="all" type="text/css" rel="stylesheet"/>
    <link rel="stylesheet" href=".././css/bootstrap-responsive.css"/>

    
    

    <meta content="OCaml Planet" property="og:title"/>
    <meta content="non_profit" property="og:type"/>

    <meta content="all" name="robots"/>
  </head>
  <body>
    <div id="header">
      <div class="top">
      </div>
      <div class="bottom">
      </div>
    </div>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
	  
          <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a href=".././" class="brand">OCaml</a>

          <div class="nav-collapse">
            <ul class="nav">
	      <li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">
    Discover
    <b class="caret"></b>
  </a>
  <ul class="dropdown-menu">
    <li><a href="../description.html">What is OCaml?</a></li>
    <li><a href="http://try.ocamlpro.com/">Try it Online</a></li>
    <li><a href="../taste.html">100 Lines of OCaml</a></li>
    <li><a href="../success.html">Success Stories</a></li>
    <li><a href="../companies.html">Who Is Using It?</a></li>
    <li><a href="http://pleac.sourceforge.net/pleac_ocaml/">Pleac</a></li>
    <li><a href="http://rosettacode.org/wiki/Category:OCaml">Rosetta</a>
        <a href="http://langref.org/ocaml">langref.org</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">
    Learn
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../install.html">Install</a></li>
    <li><a href="../tutorials/">Tutorials</a></li>
    <li><a href="../faq.html">FAQ</a></li>
    <li><a href="../books.html">Books</a></li>
    <li><a href="../videos.html">Videos</a></li>
    <li><a href="../papers.html">Papers</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">Use
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../releases/">Releases</a></li>
    <li><a href="../libraries.html">Libraries</a></li>
    <li><a href="../dev_tools.html">Development Tools</a></li>
    <li><a href="../books.html#manual">User Manual</a></li>
    <li><a href="../cheat_sheets.html">Cheat Sheets</a></li>
    <li><a href="http://search.ocaml.jp/">OCaml API Search</a></li>
    <li><a href="http://forge.ocamlcore.org/">Forge</a></li>
    <li><a href="https://github.com/languages/OCaml">GitHub</a></li>
    <li><a href="https://bitbucket.org/repo/all?name=ocaml">Bitbucket</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">Community
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../mailing_lists.html">Mailing Lists</a></li>
    <li><a href="../planet/">Blogs</a></li>
    <li><a href="../meetings.html">Meetings</a></li>
    <li><a href="irc://irc.freenode.net/ocaml">IRC</a></li>
    <li><a href="http://stackoverflow.com/questions/tagged?tagnames=ocaml">Stack Overflow</a></li>
    <li><a href="http://www.reddit.com/r/ocaml/">Reddit</a></li>
    <li><a href="../support.html">Commercial Support</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">More
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="http://caml.inria.fr/mantis/">Mantis Bug Tracker</a></li>
    <li><a href="../caml-light/">Caml Light</a></li>
    <li><a href="../logos.html">Logos</a></li>
  </ul>
</li>

            </ul>
	    <form action="http://www.google.com/search" method="get" class="navbar-search pull-right">
	      <input placeholder="Search" class="search-query" name="q" type="text"/>
	      <input value="site:http://www.ocaml.org/" name="q" type="hidden"/>
	    </form>
            
	    
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <span class="navigation-bar">
	<a href="./../">Home</a><span class="separation"><img src=".././img/right_arrow.png" alt="&gt;"/></span>OCaml Planet
	<span id="language">
	  <span class="horizontal-toolbar"><span class="open-bracket">[</span><span class="current-url">En</span><span class="close-bracket">]</span></span>
	</span>
      </span>

      

    <h1>OCaml Planet</h1>

    <p>The OCaml Planet aggregates various blogs from the OCaml
    community.  It is kindly provided
    by <a href="http://www.ocamlcore.com/">OCamlCore</a>.  If you
    would like to be added, read
    the <a href="http://www.ocamlcore.org/planet/">Planet
    subscription HOWTO</a>.</p>

    <br/>
    <div style="float: right; margin-right: 0; margin-top: 0" class="span2 planet-subscriptions"><em>Subscriptions</em>
      <ul><li><a href="http://alexleighton.tumblr.com/tagged/ocaml/rss">Alex Leighton</a></li><li><a href="http://blog.mestan.fr/feed/?cat=16">Alp Mestan</a></li><li><a href="http://andreiformiga.com/blog/?cat=5&feed=rss2">Andrei Formiga</a></li><li><a href="http://math.andrej.com/feed/">Andrej Bauer</a></li><li><a href="http://anil.recoil.org/feeds/atom.xml">Anil Madhavapeddy</a></li><li><a href="http://unnali.com/tag/ocaml/feed/">Arlen Cuss</a></li><li><a href="http://ashishagarwal.org/tag/ocaml/feed/">Ashish Agarwal</a></li><li><a href="http://www.blogger.com/feeds/7617521785419311079/posts/default">Cameleon news</a></li><li><a href="http://caml.inria.fr/news.en.rss">Caml INRIA</a></li><li><a href="http://camlspotter.blogspot.com/feeds/posts/default?alt=rss">Caml Spotting</a></li><li><a href="http://alan.petitepomme.net/cwn/cwn.rss">Caml Weekly News</a></li><li><a href="http://procrastiblog.com/category/ocaml/feed/">Christopher Conway</a></li><li><a href="http://coherentpdf.com/blog/?tag=ocaml&feed=rss">Coherent Graphics</a></li><li><a href="http://coq.inria.fr/news/feed">Coq</a></li><li><a href="http://erratique.ch/feeds/news.atom">Daniel Bünzli</a></li><li><a href="http://blog.dbpatterson.com/rss">Daniel Patterson</a></li><li><a href="http://nleyten.com/atom.aspx">Dario Teixeira</a></li><li><a href="http://www.blogger.com/feeds/17133288/posts/default/-/ocaml">David Baelde</a></li><li><a href="http://bentobako.org/david/blog/index.php?feed/tag/ocaml/atom">David Mentré</a></li><li><a href="http://dutherenverseauborddelatable.wordpress.com/category/ocaml/feed/">David Teller</a></li><li><a href="http://www.examachine.net/blog/cat/ocaml/feed/">Eray Özkural</a></li><li><a href="http://www.mega-nerd.com/erikd/Blog/CodeHacking/Ocaml/index.rss20">Erik de Castro Lopo</a></li><li><a href="http://blog.emillon.org/feeds/ocaml.xml">Etienne Millon</a></li><li><a href="http://www.mega-nerd.com/erikd/Blog/FP-Syd/index.rss20">FP-Sydney</a></li><li><a href="http://www.blogger.com/feeds/8964007124326996693/posts/default/-/ocaml">Fayssal Martani</a></li><li><a href="http://frama-c.com/rss.xml">Frama-C</a></li><li><a href="http://functionaljobs.com/jobs/search/?q=ocaml&format=rss">Functional Jobs</a></li><li><a href="http://gallium.inria.fr/blog/index.rss">GaGallium</a></li><li><a href="http://gaiustech.wordpress.com/category/ocaml/feed/">Gaius Hammond</a></li><li><a href="http://blog.camlcity.org/blog/rss">Gerd Stolpmann</a></li><li><a href="http://www.wisdomandwonder.com/tag/OCaml/feed">Grant Rettke</a></li><li><a href="http://hongboz.wordpress.com/feed/">Hong bo Zhang</a></li><li><a href="http://blog.incubaid.com/tag/ocaml/feed/">Incubaid Research</a></li><li><a href="http://ambassadortothecomputers.blogspot.com/feeds/posts/default?alt=rss">Jake Donham</a></li><li><a href="http://scattered-thoughts.net/rss?tag=ocaml">Jamie Brandon</a></li><li><a href="http://ocaml.janestcapital.com/?q=rss.xml">Jane Street</a></li><li><a href="http://lpw25.net/rss.xml">Leo White</a></li><li><a href="http://www.lexifi.com/blogs/ocaml/feed">LexiFi</a></li><li><a href="http://savonet.sourceforge.net/liquidsoap.rss">Liquidsoap</a></li><li><a href="http://syntaxexclamation.wordpress.com/tag/ocaml/feed/">Matthias Puech</a></li><li><a href="http://www.blogger.com/feeds/5888658295182480819/posts/default">Matías Giovannini</a></li><li><a href="http://eigenclass.org/R2/feeds/rss2/all">Mauricio Fernandez</a></li><li><a href="http://www.elehack.net/michael/blog/tags/ocaml?format=rss">Michael Ekstrand</a></li><li><a href="http://www.rktmb.org:82/feed/category/work/ocaml/atom">Mihamina Rakotomandimby</a></li><li><a href="http://mcclurmc.wordpress.com/feed/">Mike McClurg</a></li><li><a href="http://nyc-ocaml.posterous.com/rss.xml">NYC OCaml</a></li><li><a href="http://ocamlhackers.ning.com/profiles/blog/feed?tag=ocaml&xn_auth=no">OCaml Hackers</a></li><li><a href="http://forge.ocamlcore.org/export/rss_sfnews.php">OCamlCore Forge News</a></li><li><a href="http://forge.ocamlcore.org/export/rss_sfprojects.php">OCamlCore Forge Projects</a></li><li><a href="http://www.ocamlcore.com/wp/?feed=rss2&amp;language=en&#038;language=en">OCamlCore.com</a></li><li><a href="http://www.ocamlpro.com/feed/atom.xml">OCamlPro</a></li><li><a href="http://odns.tuxfamily.org/feed/">ODNS project</a></li><li><a href="http://ox.tuxfamily.org/feed/">Ocaml XMPP project</a></li><li><a href="http://ocsigen.org/news.atom">Ocsigen project</a></li><li><a href="http://www.blogger.com/feeds/2073503406800427577/posts/default">Opa</a></li><li><a href="http://www.openmirage.org/blog/atom.xml">Open Mirage</a></li><li><a href="http://functional-orbitz.blogspot.com/feeds/posts/default/-/planetocaml?alt=rss">Orbitz</a></li><li><a href="http://www.donadeo.net/facets/programming-languages/objective-caml/feed/">Paolo Donadeo</a></li><li><a href="https://mancoosi.org/~abate/taxonomy/term/5/0/feed">Pietro Abate</a></li><li><a href="http://redlizards.com/blog/feed/?tag=ocaml">Red Lizard Software</a></li><li><a href="http://rwmj.wordpress.com/tag/ocaml/feed/">Richard Jones</a></li><li><a href="http://blog.rastageeks.org/spip.php?page=rss&id_mot=2">Romain Beauxis</a></li><li><a href="http://seb.mondet.org/blog/feed/ocaml.rss">Sebastien Mondet</a></li><li><a href="http://upsilon.cc/~zack/tags/ocaml/index.rss">Stefano Zacchiroli</a></li><li><a href="http://le-gall.net/sylvain+violaine/blog/index.php?feed/tag/ocaml/atom">Sylvain Le Gall</a></li><li><a href="http://caml.inria.fr/hump.rss">The Caml Humps</a></li><li><a href="http://www.blogger.com/feeds/6115529230232389198/posts/default">Till Varoquaux</a></li><li><a href="http://www.nicollet.net/toroidal/ocaml/feed/">Victor Nicollet</a></li><li><a href="http://y-node.com/blog/feeds/tag/ocaml/">y-node</a></li></ul>

      <a href="http://planet.ocaml.org/rss20.xml"><img src=".././img/rss20.png"/></a>
      <a href="http://planet.ocaml.org/opml.xml"><img src=".././img/opml.png"/></a>
    </div>
    <div class="planet"><a name="95c68fb5b27ea5ca29bbb054741328e7"></a><span class="rss-header"><span class="rss-title"><a href="http://erratique.ch/software/four"> Four</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Daniel Bünzli</span>, <span class="rss-date">14 Feb 2013</span></span><span class="rss-description"><a href="http://gaspardbuma.org/en">Gaspard Buma</a>'s show <em>Boats to nowhere</em> is now playing at the <a href="http://www.arsenic.ch">Arsenic</a>. I helped with the show's visuals and along the way prototyped <a href="http://erratique.ch/software/four">Four</a> a lightweight modern OpenGL rendering engine for Lua.</span>
<a name="e56033b085d70d0747d47e6fe495078d"></a><span class="rss-header"><span class="rss-title"><a href="http://blog.opalang.org/2013/02/some-great-news-on-opa.html"> Some great news on Opa</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author"><span id="ocaml_1">Opa &#9001;noreply<abbr title="(at) &rarr; @">(at)</abbr>blogger.com (HB)&#9002;</span><script type="text/javascript"><!--;
local = "noreply";
h = "blogger.com (HB)";
document.getElementById("ocaml_1").innerHTML = '<a href="mailto:' + local + '@' + h + "\" >Opa<\/a>";
//--></script></span>, <span class="rss-date">12 Feb 2013</span></span><span class="rss-description"><div id="post1"><p>It's been a while since our last post. Like many others, we mainly rely on Twitter to spread the news on Opa.</p><p>This very short post is just an exciting summary on new things that happened in the last couple of months.</p><h1 id="release-of-opa-1.1.0">Release of Opa 1.1.0</h1><p>We released Opa 1.1.0 which as always brings bugfixes, performance enhancement and new feature.</p><p>With Opa 1.1.0, you now can include JavaScript code and Node.js packages easier than ever! We will write about it soon.</p><p>Sadly, we were hit by GitHub decision to halt its download feature. We relied on this and even built a service (in Opa!) that automatically pushed packages. We are still looking at nice hosting alternatives, as the GitHub files should disappear soon.</p><p>From this release, we also support a 32-bit Windows package.</p><h1 id="ongoing-support-of-postgres">Ongoing support of Postgres</h1><p>For a important project that is being built with Opa, we are adding Postgres support.</p><p>Switching your Opa code from MongoDB to Postgres requires almost no code change, and again we will write about it soon.</p><a onclick="switchContent('post1','post2')" class="btn" href="#e56033b085d70d0747d47e6fe495078d">Read more...</a></div><div id="post2" style="display: none"><p>It's been a while since our last post. Like many others, we mainly rely on Twitter to spread the news on Opa.</p><p>This very short post is just an exciting summary on new things that happened in the last couple of months.</p><h1 id="release-of-opa-1.1.0">Release of Opa 1.1.0</h1><p>We released Opa 1.1.0 which as always brings bugfixes, performance enhancement and new feature.</p><p>With Opa 1.1.0, you now can include JavaScript code and Node.js packages easier than ever! We will write about it soon.</p><p>Sadly, we were hit by GitHub decision to halt its download feature. We relied on this and even built a service (in Opa!) that automatically pushed packages. We are still looking at nice hosting alternatives, as the GitHub files should disappear soon.</p><p>From this release, we also support a 32-bit Windows package.</p><h1 id="ongoing-support-of-postgres">Ongoing support of Postgres</h1><p>For a important project that is being built with Opa, we are adding Postgres support.</p><p>Switching your Opa code from MongoDB to Postgres requires almost no code change, and again we will write about it soon.</p><h1 id="big-project-in-opa">Big project in Opa</h1><p>As mentioned earlier, we are working on a pretty big project implemented with Opa. Stay tuned!</p><a onclick="switchContent('post2','post1')" class="btn" href="#e56033b085d70d0747d47e6fe495078d">Hide</a></div></span>
<a name="4b7db653fbf5071a25953fe10c60f802"></a><span class="rss-header"><span class="rss-title"><a href="http://caml.inria.fr/cgi-bin/hump.cgi?contrib=846"> Reactive ML 1.08.04</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">The Caml Humps</span>, <span class="rss-date">12 Feb 2013</span></span><span class="rss-description">ReactiveML is a programming language dedicated to the implementation of interactive systems as found in graphical user interfaces, video games or simulation problems. ReactiveML is based on the synchronous reactive model of Boussinot embedded in an ML language (here OCaml).
The synchronous reactive model provides synchronous parallel composition and dynamic features like the dynamic creation of processes. In ReactiveML, the reactive model is integrated at the language level (not as a library) which leads to safer and more natural programming.</span>
<a name="da82f0e63b34e3440f7373de319ca75f"></a><span class="rss-header"><span class="rss-title"><a href="http://alan.petitepomme.net/cwn/2013.02.12.html"> Caml Weekly News, 12 Feb 2013</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Caml Weekly News</span>, <span class="rss-date">12 Feb 2013</span></span><span class="rss-description">OCaml Platform - Mailing List / Memoize GADT / ocp-indent beta release / Core Suite 109.08.00 released / OCaml Labs Monthly Update / OMonad 0.2 / OCaml tests on Travis CI / geany as an ocaml ide / ReactiveML 1.08.04 / Other Caml News</span>
<a name="9bfd41186a5d09dbb247bf59b25a3541"></a><span class="rss-header"><span class="rss-title"><a href="http://caml.inria.fr/cgi-bin/hump.cgi?contrib=845"> Pprint</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">The Caml Humps</span>, <span class="rss-date">11 Feb 2013</span></span><span class="rss-description">This is an adaptation of Daan Leijen's "PPrint" library,
  which itself is based on the ideas developed by Philip
  Wadler in "A Prettier Printer".</span>
<a name="f7bed3401cb8fa5fe0de4eaa50b3c8fb"></a><span class="rss-header"><span class="rss-title"><a href="http://gallium.inria.fr/blog/first-release-of-pprint"> First release of PPrint</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">GaGallium</span>, <span class="rss-date">08 Feb 2013</span></span><span class="rss-description"><div id="post3"><p>I am pleased to announce the first official release of <em><strong>PPrint</strong></em>, an OCaml library for pretty-printing textual documents.</p>




<h4 id="a-taste-of-the-layout-language">A taste of the layout language</h4>
<p>At the heart of <em><strong>PPrint</strong></em> is a little domain-specific language of documents. This language has a well-defined semantics, which the printing engine implements. This language rests upon a small number of fundamental concepts.</p>
<p>There are combinators for creating atomic documents. For instance,</p>
<pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="dt">string</span> <span class="st">"hello"</span></code></pre>
<p>is a simple, unbreakable document.</p>
<p>There is also a concatenation operator, which joins two documents. For instance,</p>
<pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="dt">string</span> <span class="st">"hello"</span> ^^ <span class="dt">string</span> <span class="st">"world"</span></code></pre>
<p>is a composite document. It is in fact equivalent to <code>string "helloworld"</code>.</p>
<p>So far, nothing very exciting. The next two combinators are more original and interesting.</p>
<p>The first of these combinators, <code>break 1</code>, is a breakable space. If printed in flat mode, it produces an ordinary space character; if printed in normal mode, it produces a newline character.</p>
<a onclick="switchContent('post3','post4')" class="btn" href="#f7bed3401cb8fa5fe0de4eaa50b3c8fb">Read more...</a></div><div id="post4" style="display: none"><p>I am pleased to announce the first official release of <em><strong>PPrint</strong></em>, an OCaml library for pretty-printing textual documents.</p>




<h4 id="a-taste-of-the-layout-language">A taste of the layout language</h4>
<p>At the heart of <em><strong>PPrint</strong></em> is a little domain-specific language of documents. This language has a well-defined semantics, which the printing engine implements. This language rests upon a small number of fundamental concepts.</p>
<p>There are combinators for creating atomic documents. For instance,</p>
<pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="dt">string</span> <span class="st">"hello"</span></code></pre>
<p>is a simple, unbreakable document.</p>
<p>There is also a concatenation operator, which joins two documents. For instance,</p>
<pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="dt">string</span> <span class="st">"hello"</span> ^^ <span class="dt">string</span> <span class="st">"world"</span></code></pre>
<p>is a composite document. It is in fact equivalent to <code>string "helloworld"</code>.</p>
<p>So far, nothing very exciting. The next two combinators are more original and interesting.</p>
<p>The first of these combinators, <code>break 1</code>, is a breakable space. If printed in flat mode, it produces an ordinary space character; if printed in normal mode, it produces a newline character.</p>
<p>Yes, there are two printing modes, namely flat mode and normal mode. The printing engine goes back and forth between these two modes. Exactly where and how the engine switches from one mode to the other is controlled by the next combinator.</p>
<p>The second of these combinators, <code>group</code>, introduces a choice between flat mode and normal mode. It is a document transformer: if <code>d</code> is a document, then <code>group d</code> is a document. When the printing engine encounters <code>group d</code>, two possibilities arise. The first possibility is to print all of <code>d</code> on a single line. This is known as flat mode. The engine tries this first (ignoring any <code>group</code> combinators inside <code>d</code>). If it succeeds, great. If it fails, by lack of space on the current line, then the engine backtracks and reverts to the second possibility, which is to simply ignore the <code>group</code> combinator, and just print <code>d</code>. This has subtle consequences: there might be further groups inside <code>d</code>, and each of these groups will give rise to further choices.</p>
<p>This gives rise to an interesting language, where <code>group</code> is used to indicate a choice point, and the appearance of <code>break</code> is dependent upon the choice point(s) that appear higher up in the hierarchical structure of the document. For instance, the document:</p>
<pre class="sourceCode ocaml"><code class="sourceCode ocaml">group (<span class="dt">string</span> <span class="st">"This"</span> ^^ break 1 ^^ <span class="dt">string</span> <span class="st">"is"</span> ^^ break 1 ^^ <span class="dt">string</span> <span class="st">"pretty."</span>)</code></pre>
<p>will be printed either on a single line, if it fits, or on three lines. It will not be printed on two lines: there is just one choice point, so either the two breakable spaces will be broken, or none of them will. By the way, this document can be abbreviated as follows:</p>
<pre class="sourceCode ocaml"><code class="sourceCode ocaml">group (<span class="dt">string</span> <span class="st">"This"</span> ^/^ <span class="dt">string</span> <span class="st">"is"</span> ^/^ <span class="dt">string</span> <span class="st">"pretty."</span>)</code></pre>
<p>On the other hand, the document:</p>
<pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="dt">string</span> <span class="st">"This"</span> ^^
group (break 1 ^^ <span class="dt">string</span> <span class="st">"is"</span>) ^^
group (break 1 ^^ <span class="dt">string</span> <span class="st">"pretty."</span>)</code></pre>
<p>could be printed on one, two, or three lines. There are two choice points, each of which influences one of the two breakable spaces. The two choices are independent of one another. Each of the words in the sentence <code>This is pretty.</code> will be printed on the current line if it fits, and on a new line otherwise. By the way, this document can be abbreviated as follows:</p>
<pre class="sourceCode ocaml"><code class="sourceCode ocaml">flow 1 [
  <span class="dt">string</span> <span class="st">"This"</span> ;
  <span class="dt">string</span> <span class="st">"is"</span> ;
  <span class="dt">string</span> <span class="st">"pretty."</span>
]</code></pre>
<p>There are more combinators, such as <code>nest</code>, which controls indentation, and it is relatively easy to roll your own combinators on top of those that are provided.</p>
<p>One limitation of the library is that the document must be entirely built in memory before it is printed. So far, we have used the library in small- to medium-scale applications, and this has not been a problem. In principle, one could work around this limitation by adding a new document constructor whose argument is a suspended document computation.</p>
<h4 id="acknowledgements">Acknowledgements</h4>
<p>The document language and the printing engine are inspired by Daan Leijen's <a href="http://www.cs.uu.nl/~daan/pprint.html">PPrint</a> library, which itself is based on the ideas developed by Philip Wadler in the paper <a href="http://homepages.inf.ed.ac.uk/wadler/papers/prettier/prettier.pdf">A Prettier Printer</a>.</p>
<p><em><strong>PPrint</strong></em> was written by François Pottier and Nicolas Pouillard, with contributions by Yann Régis-Gianas, Gabriel Scherer, and Jonathan Protzenko.</p>
<h4 id="installation">Installation</h4>
<p>The library is available online (<a href="http://gallium.inria.fr/~fpottier/pprint/pprint.tar.gz">source code</a>, <a href="http://gallium.inria.fr/~fpottier/pprint/doc/">documentation</a>), and can also be installed via OPAM: just type <code>opam install pprint</code> if you already have a working OPAM installation.</p>
<p>Have fun! Feel free to make comments, suggestions, and to let me know if and how you are using this library.</p>
<h4 id="a-final-example">A Final Example</h4>
<p>For a larger example, here is the code of the file <code>PPrintTest.ml</code> included in the distribution (with the maximum line width adapted for this blog post):</p>
<pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="ot">open</span> PPrint

<span class="kw">let</span> document =
  prefix 2 1
    (<span class="dt">string</span> <span class="st">"TITLE:"</span>)
    (<span class="dt">string</span> <span class="st">"PPrint"</span>)
  ^^
  hardline
  ^^
  prefix 2 1
    (<span class="dt">string</span> <span class="st">"AUTHORS:"</span>)
    (utf8string <span class="st">"François Pottier and Nicolas Pouillard"</span>)
  ^^
  hardline
  ^^
  prefix 2 1
    (<span class="dt">string</span> <span class="st">"ABSTRACT:"</span>)
    (
      flow 1 (words
        <span class="st">"This is an adaptation of Daan Leijen's </span><span class="ch">\"</span><span class="st">PPrint</span><span class="ch">\"</span>
<span class="st">        library, which itself is based on the ideas developed</span>
<span class="st">        by Philip Wadler in </span><span class="ch">\"</span><span class="st">A Prettier Printer</span><span class="ch">\"</span><span class="st">. For more</span>
<span class="st">        information about Wadler's and Leijen's work,</span>
<span class="st">        please consult the following references:"</span>)
      ^^
      nest 2 (
        twice (break 1)
        ^^
        separate_map (break 1) (<span class="kw">fun</span> s -&gt; nest 2 (url s)) [
          <span class="st">"http://www.cs.uu.nl/~daan/pprint.html"</span>;
          <span class="st">"http://homepages.inf.ed.ac.uk/wadler/papers/prettier/prettier.pdf"</span>;
        ]
      )
      ^^
      twice (break 1)
      ^^
      flow 1 (words
        <span class="st">"To install PPrint, type </span><span class="ch">\"</span><span class="st">make -C src install</span><span class="ch">\"</span><span class="st">.</span>
<span class="st">         ocamlfind is required."</span>)
      ^^
      twice (break 1)
      ^^
      flow 1 (words
        <span class="st">"The documentation for PPrint is built by </span><span class="ch">\"</span><span class="st">make doc</span><span class="ch">\"</span>
<span class="st">         and is found in the file doc/index.html."</span>)
    )
  ^^
  hardline

<span class="kw">let</span> () =
  ToChannel<span class="kw">.</span>pretty 1. 60 stdout document;
  flush stdout</code></pre>
<p>It produces the following output:</p>
<pre><code>TITLE: PPrint
AUTHORS: François Pottier and Nicolas Pouillard
ABSTRACT:
  This is an adaptation of Daan Leijen's "PPrint" library,
  which itself is based on the ideas developed by Philip
  Wadler in "A Prettier Printer". For more information about
  Wadler's and Leijen's work, please consult the following
  references:
    
    http://www.cs.uu.nl/~daan/pprint.html
    http://homepages.inf.ed.ac.uk/wadler/papers/prettier/
      prettier.pdf
  
  To install PPrint, type "make -C src install". ocamlfind
  is required.
  
  The documentation for PPrint is built by "make doc" and is
  found in the file doc/index.html.</code></pre><a onclick="switchContent('post4','post3')" class="btn" href="#f7bed3401cb8fa5fe0de4eaa50b3c8fb">Hide</a></div></span>
<a name="6cdb7a70631b8b103948bf9782f47600"></a><span class="rss-header"><span class="rss-title"><a href="http://functional-orbitz.blogspot.com/2013/02/ann-ocaml-vclock-000.html"> [ANN] ocaml-vclock - 0.0.0</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author"><span id="ocaml_2">Orbitz &#9001;noreply<abbr title="(at) &rarr; @">(at)</abbr>blogger.com (orbitz)&#9002;</span><script type="text/javascript"><!--;
local = "noreply";
h = "blogger.com (orbitz)";
document.getElementById("ocaml_2").innerHTML = '<a href="mailto:' + local + '@' + h + "\" >Orbitz<\/a>";
//--></script></span>, <span class="rss-date">07 Feb 2013</span></span><span class="rss-description"><p>I ported some Erlang vector clock code to Ocaml for fun and learning.  It's not well tested and it hasn't any performance optimizations.  I'm not ready yet but I have some projects in mind to use it so it will likely get fleshed out more. </p> <p>Vector clocks are a system for determining the partial ordering of events in a distributed environment.  You can determine if one value is the ancestor of another, equal, or was concurrently updated.  It is one mechanism that distributed databases, such as Riak, use to automatically resolve some conflicts in data while maintaining availability. </p> <p>The vector clock implementation allows for user defined site id type.  It also allows metadata to be encoded in the site id, which is useful if you want your vector clock to be prunable by encoding timestamps in it. </p> <p>The repo can be found <a href="https://github.com/orbitz/ocaml-vclock/tree/0.0.0">here</a>.  If you'd like to learn more about vector clocks read the wikipedia page <a href="http://en.wikipedia.org/wiki/Vector_clock">here</a>.  The Riak website also has some content on vector clocks <a href="http://docs.basho.com/riak/latest/references/appendices/concepts/Vector-Clocks/">here</a>. </p></span>
<a name="e019222843fac682c9f57ee0f6d1fe6a"></a><span class="rss-header"><span class="rss-title"><a href="http://rwmj.wordpress.com/2013/02/07/more-static-analysis-with-cil/"> More static analysis with CIL</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Richard Jones</span>, <span class="rss-date">07 Feb 2013</span></span><span class="rss-description"><div id="post5"><p>Years ago I <a href="http://people.redhat.com/~rjones/cil-analysis-of-libvirt/">played around</a> with <a href="http://www.cs.berkeley.edu/~necula/cil/">CIL</a> to analyze <a href="http://libvirt.org">libvirt</a>.  More recently <a href="https://rwmj.wordpress.com/2009/05/15/dan-uses-ocaml-cil-to-analyze-libvirts-locking-patterns/">Dan used CIL to analyze libvirt’s locking code</a>.</p>
<p>We didn’t get so far either time, but I’ve been taking a deeper look at CIL in an attempt to verify error handling in <a href="http://libguestfs.org/">libguestfs</a>.</p>
<p>Here is my partly working code so far.</p>
<pre><tt><i></i></tt></pre><font color="#9A1900">(*</font>
<i><font color="#9A1900"> * Analyse libguestfs APIs to find error overwriting.</font></i>
<i><font color="#9A1900"> * Copyright (C) 2008-2013 Red Hat, Inc.</font></i>
<i><font color="#9A1900"> *</font></i>
<i><font color="#9A1900"> * This library is free software; you can redistribute it and/or</font></i>
<i><font color="#9A1900"> * modify it under the terms of the GNU Lesser General Public</font></i>
<i><font color="#9A1900"> * License as published by the Free Software Foundation; either</font></i>
<i><font color="#9A1900"> * version 2.1 of the License, or (at your option) any later version.</font></i>
<i><font color="#9A1900"> *</font></i>
<i><font color="#9A1900"> * This library is distributed in the hope that it will be useful,</font></i>
<i><font color="#9A1900"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</font></i>
<i><font color="#9A1900"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font></i>
<i><font color="#9A1900"> * Lesser General Public License for more details.</font></i>
<i><font color="#9A1900"> *</font></i>
<i><font color="#9A1900"> * You should have received a copy of the GNU Lesser General Public</font></i>
<a onclick="switchContent('post5','post6')" class="btn" href="#e019222843fac682c9f57ee0f6d1fe6a">Read more...</a></div><div id="post6" style="display: none"><p>Years ago I <a href="http://people.redhat.com/~rjones/cil-analysis-of-libvirt/">played around</a> with <a href="http://www.cs.berkeley.edu/~necula/cil/">CIL</a> to analyze <a href="http://libvirt.org">libvirt</a>.  More recently <a href="https://rwmj.wordpress.com/2009/05/15/dan-uses-ocaml-cil-to-analyze-libvirts-locking-patterns/">Dan used CIL to analyze libvirt’s locking code</a>.</p>
<p>We didn’t get so far either time, but I’ve been taking a deeper look at CIL in an attempt to verify error handling in <a href="http://libguestfs.org/">libguestfs</a>.</p>
<p>Here is my partly working code so far.</p>
<pre><tt><i></i></tt></pre><font color="#9A1900">(*</font>
<i><font color="#9A1900"> * Analyse libguestfs APIs to find error overwriting.</font></i>
<i><font color="#9A1900"> * Copyright (C) 2008-2013 Red Hat, Inc.</font></i>
<i><font color="#9A1900"> *</font></i>
<i><font color="#9A1900"> * This library is free software; you can redistribute it and/or</font></i>
<i><font color="#9A1900"> * modify it under the terms of the GNU Lesser General Public</font></i>
<i><font color="#9A1900"> * License as published by the Free Software Foundation; either</font></i>
<i><font color="#9A1900"> * version 2.1 of the License, or (at your option) any later version.</font></i>
<i><font color="#9A1900"> *</font></i>
<i><font color="#9A1900"> * This library is distributed in the hope that it will be useful,</font></i>
<i><font color="#9A1900"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</font></i>
<i><font color="#9A1900"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font></i>
<i><font color="#9A1900"> * Lesser General Public License for more details.</font></i>
<i><font color="#9A1900"> *</font></i>
<i><font color="#9A1900"> * You should have received a copy of the GNU Lesser General Public</font></i>
<i><font color="#9A1900"> * License along with this library.  If not, see</font></i>
<i><font color="#9A1900"> * &lt;http://www.gnu.org/licenses/&gt;.</font></i>
<i><font color="#9A1900"> *</font></i>
<i><font color="#9A1900"> * Author: Daniel P. Berrange &lt;berrange@redhat.com&gt;</font></i>
<i><font color="#9A1900"> * Author: Richard W.M. Jones &lt;rjones@redhat.com&gt;</font></i>
<i><font color="#9A1900"> *)</font></i>

<b><font color="#000080">open</font></b> <font color="#009900">Unix</font>
<b><font color="#000080">open</font></b> <font color="#009900">Printf</font>

<b><font color="#000080">open</font></b> <font color="#009900">Cil</font>

<b><font color="#0000FF">let</font></b> debug <font color="#990000">=</font> <font color="#009900">ref</font> <b><font color="#0000FF">false</font></b>

<i><font color="#9A1900">(* Set of ints. *)</font></i>
<b><font color="#0000FF">module</font></b> <font color="#009900">IntSet</font> <font color="#990000">=</font> <b><font color="#000080">Set</font></b><font color="#990000">.</font><font color="#009900">Make</font> <font color="#990000">(</font><b><font color="#0000FF">struct</font></b> <b><font color="#0000FF">type</font></b> t <font color="#990000">=</font> <font color="#009900">int</font> <b><font color="#0000FF">let</font></b> compare <font color="#990000">=</font> compare <b><font color="#0000FF">end</font></b><font color="#990000">)</font>

<i><font color="#9A1900">(* A module for storing any set (unordered list) of functions. *)</font></i>
<b><font color="#0000FF">module</font></b> <font color="#009900">FunctionSet</font> <font color="#990000">=</font> <b><font color="#000080">Set</font></b><font color="#990000">.</font><font color="#009900">Make</font> <font color="#990000">(</font>
  <b><font color="#0000FF">struct</font></b>
    <b><font color="#0000FF">type</font></b> t <font color="#990000">=</font> varinfo
    <b><font color="#0000FF">let</font></b> compare v1 v2 <font color="#990000">=</font> compare v1<font color="#990000">.</font>vid v2<font color="#990000">.</font>vid
  <b><font color="#0000FF">end</font></b>
<font color="#990000">)</font>

<i><font color="#9A1900">(* Directed graph of functions.</font></i>
<i><font color="#9A1900"> *</font></i>
<i><font color="#9A1900"> * Function = a node in the graph</font></i>
<i><font color="#9A1900"> * FunctionDigraph = the directed graph</font></i>
<i><font color="#9A1900"> * FunctionPathChecker = path checker module using Dijkstra's algorithm</font></i>
<i><font color="#9A1900"> *)</font></i>
<b><font color="#0000FF">module</font></b> <font color="#009900">Function</font> <font color="#990000">=</font>
<b><font color="#0000FF">struct</font></b>
  <b><font color="#0000FF">type</font></b> t <font color="#990000">=</font> varinfo
  <b><font color="#0000FF">let</font></b> compare f1 f2 <font color="#990000">=</font> compare f1<font color="#990000">.</font>vid f2<font color="#990000">.</font>vid
  <b><font color="#0000FF">let</font></b> hash f <font color="#990000">=</font> <b><font color="#000080">Hashtbl</font></b><font color="#990000">.</font>hash f<font color="#990000">.</font>vid
  <b><font color="#0000FF">let</font></b> equal f1 f2 <font color="#990000">=</font> f1<font color="#990000">.</font>vid <font color="#990000">=</font> f2<font color="#990000">.</font>vid
<b><font color="#0000FF">end</font></b>
<b><font color="#0000FF">module</font></b> <font color="#009900">FunctionDigraph</font> <font color="#990000">=</font> <b><font color="#000080">Graph</font></b><font color="#990000">.</font><b><font color="#000080">Imperative</font></b><font color="#990000">.</font><b><font color="#000080">Digraph</font></b><font color="#990000">.</font><font color="#009900">Concrete</font> <font color="#990000">(</font><font color="#009900">Function</font><font color="#990000">)</font>
<b><font color="#0000FF">module</font></b> <font color="#009900">FunctionPathChecker</font> <font color="#990000">=</font> <b><font color="#000080">Graph</font></b><font color="#990000">.</font><b><font color="#000080">Path</font></b><font color="#990000">.</font><font color="#009900">Check</font> <font color="#990000">(</font><font color="#009900">FunctionDigraph</font><font color="#990000">)</font>

<i><font color="#9A1900">(* Module used to analyze the paths through each function. *)</font></i>
<b><font color="#0000FF">module</font></b> <font color="#009900">ErrorCounter</font> <font color="#990000">=</font>
<b><font color="#0000FF">struct</font></b>
  <b><font color="#0000FF">let</font></b> name <font color="#990000">=</font> <font color="#FF0000">"ErrorCounter"</font>
  <b><font color="#0000FF">let</font></b> debug <font color="#990000">=</font> debug

  <i><font color="#9A1900">(* Our current state is very simple, just the number of error</font></i>
<i><font color="#9A1900">   * function calls did encountered up to this statement.</font></i>
<i><font color="#9A1900">   *)</font></i>
  <b><font color="#0000FF">type</font></b> t <font color="#990000">=</font> <font color="#009900">int</font>

  <b><font color="#0000FF">let</font></b> copy errcalls <font color="#990000">=</font> errcalls

  <i><font color="#9A1900">(* Start data for each statement. *)</font></i>
  <b><font color="#0000FF">let</font></b> stmtStartData <font color="#990000">=</font> <b><font color="#000080">Inthash</font></b><font color="#990000">.</font>create <font color="#993399">97</font>

  <b><font color="#0000FF">let</font></b> printable errcalls <font color="#990000">=</font> sprintf <font color="#FF0000">"(errcalls=%d)"</font> errcalls

  <b><font color="#0000FF">let</font></b> pretty <font color="#990000">()</font> t <font color="#990000">=</font> <b><font color="#000080">Pretty</font></b><font color="#990000">.</font>text <font color="#990000">(</font>printable t<font color="#990000">)</font>

  <b><font color="#0000FF">let</font></b> computeFirstPredecessor stmt x <font color="#990000">=</font> x <i><font color="#9A1900">(* XXX??? *)</font></i>

  <b><font color="#0000FF">let</font></b> combinePredecessors stmt <font color="#990000">~</font>old<font color="#990000">:</font>old_t new_t <font color="#990000">=</font>
    <b><font color="#0000FF">if</font></b> old_t <font color="#990000">=</font> new_t <b><font color="#0000FF">then</font></b> <font color="#009900">None</font>
    <b><font color="#0000FF">else</font></b> <font color="#009900">Some</font> new_t

  <i><font color="#9A1900">(* This will be initialized after we have calculated the set of all</font></i>
<i><font color="#9A1900">   * functions which can call an error function, in main() below.</font></i>
<i><font color="#9A1900">   *)</font></i>
  <b><font color="#0000FF">let</font></b> error_functions_set <font color="#990000">=</font> <font color="#009900">ref</font> <b><font color="#000080">FunctionSet</font></b><font color="#990000">.</font>empty

  <i><font color="#9A1900">(* Handle a Cil.Instr. *)</font></i>
  <b><font color="#0000FF">let</font></b> doInstr instr _ <font color="#990000">=</font>
    <b><font color="#0000FF">match</font></b> instr <b><font color="#0000FF">with</font></b>
    <i><font color="#9A1900">(* A call to an error function. *)</font></i>
    <font color="#990000">|</font> <font color="#009900">Call</font> <font color="#990000">(</font>_<font color="#990000">,</font> <font color="#009900">Lval</font> <font color="#990000">(</font><font color="#009900">Var</font> callee<font color="#990000">,</font> _<font color="#990000">),</font> _<font color="#990000">,</font> _<font color="#990000">)</font>
        <b><font color="#0000FF">when</font></b> <b><font color="#000080">FunctionSet</font></b><font color="#990000">.</font>mem callee <font color="#990000">!</font>error_functions_set <font color="#990000">-&gt;</font>
      <b><font color="#000080">Dataflow</font></b><font color="#990000">.</font><font color="#009900">Post</font> <font color="#990000">(</font><b><font color="#0000FF">fun</font></b> errcalls <font color="#990000">-&gt;</font> errcalls<font color="#990000">+</font><font color="#993399">1</font><font color="#990000">)</font>

    <font color="#990000">|</font> _ <font color="#990000">-&gt;</font> <b><font color="#000080">Dataflow</font></b><font color="#990000">.</font><font color="#009900">Default</font>

  <i><font color="#9A1900">(* Handle a Cil.Stmt. *)</font></i>
  <b><font color="#0000FF">let</font></b> doStmt _ _ <font color="#990000">=</font> <b><font color="#000080">Dataflow</font></b><font color="#990000">.</font><font color="#009900">SDefault</font>

  <i><font color="#9A1900">(* Handle a Cil.Guard. *)</font></i>
  <b><font color="#0000FF">let</font></b> doGuard _ _ <font color="#990000">=</font> <b><font color="#000080">Dataflow</font></b><font color="#990000">.</font><font color="#009900">GDefault</font>

  <i><font color="#9A1900">(* Filter statements we've seen already to prevent loops. *)</font></i>
  <b><font color="#0000FF">let</font></b> filter_set <font color="#990000">=</font> <font color="#009900">ref</font> <b><font color="#000080">IntSet</font></b><font color="#990000">.</font>empty
  <b><font color="#0000FF">let</font></b> filterStmt <font color="#FF0000">{</font> sid <font color="#990000">=</font> sid <font color="#FF0000">}</font> <font color="#990000">=</font>
    <b><font color="#0000FF">if</font></b> <b><font color="#000080">IntSet</font></b><font color="#990000">.</font>mem sid <font color="#990000">!</font>filter_set <b><font color="#0000FF">then</font></b> <b><font color="#0000FF">false</font></b>
    <b><font color="#0000FF">else</font></b> <font color="#990000">(</font>
      filter_set <font color="#990000">:=</font> <b><font color="#000080">IntSet</font></b><font color="#990000">.</font>add sid <font color="#990000">!</font>filter_set<font color="#990000">;</font>
      <b><font color="#0000FF">true</font></b>
    <font color="#990000">)</font>

  <i><font color="#9A1900">(* Initialize the module before each function that we examine. *)</font></i>
  <b><font color="#0000FF">let</font></b> init stmts <font color="#990000">=</font>
    filter_set <font color="#990000">:=</font> <b><font color="#000080">IntSet</font></b><font color="#990000">.</font>empty<font color="#990000">;</font>
    <b><font color="#000080">Inthash</font></b><font color="#990000">.</font>clear stmtStartData<font color="#990000">;</font>
    <i><font color="#9A1900">(* Add the initial statement(s) to the hash. *)</font></i>
    <b><font color="#000080">List</font></b><font color="#990000">.</font>iter <font color="#990000">(</font><b><font color="#0000FF">fun</font></b> stmt <font color="#990000">-&gt;</font> <b><font color="#000080">Inthash</font></b><font color="#990000">.</font>add stmtStartData stmt<font color="#990000">.</font>sid <font color="#993399">0</font><font color="#990000">)</font> stmts
<b><font color="#0000FF">end</font></b>

<b><font color="#0000FF">module</font></b> <font color="#009900">ForwardsErrorCounter</font> <font color="#990000">=</font> <b><font color="#000080">Dataflow</font></b><font color="#990000">.</font><font color="#009900">ForwardsDataFlow</font> <font color="#990000">(</font><font color="#009900">ErrorCounter</font><font color="#990000">)</font>

<i><font color="#9A1900">(* The always useful filter + map function. *)</font></i>
<b><font color="#0000FF">let</font></b> <b><font color="#0000FF">rec</font></b> filter_map f <font color="#990000">=</font> <b><font color="#0000FF">function</font></b>
  <font color="#990000">|</font> <font color="#990000">[]</font> <font color="#990000">-&gt;</font> <font color="#990000">[]</font>
  <font color="#990000">|</font> x <font color="#990000">::</font> xs <font color="#990000">-&gt;</font>
      <b><font color="#0000FF">match</font></b> f x <b><font color="#0000FF">with</font></b>
      <font color="#990000">|</font> <font color="#009900">Some</font> y <font color="#990000">-&gt;</font> y <font color="#990000">::</font> filter_map f xs
      <font color="#990000">|</font> <font color="#009900">None</font> <font color="#990000">-&gt;</font> filter_map f xs

<b><font color="#0000FF">let</font></b> <b><font color="#0000FF">rec</font></b> main <font color="#990000">()</font> <font color="#990000">=</font>
  <i><font color="#9A1900">(* Read the list of input C files. *)</font></i>
  <b><font color="#0000FF">let</font></b> files <font color="#990000">=</font>
    <b><font color="#0000FF">let</font></b> chan <font color="#990000">=</font> open_process_in <font color="#FF0000">"find src -name '*.i' | sort"</font> <b><font color="#0000FF">in</font></b>
    <b><font color="#0000FF">let</font></b> files <font color="#990000">=</font> input_chan chan <b><font color="#0000FF">in</font></b>
    <b><font color="#0000FF">if</font></b> close_process_in chan <font color="#990000">&lt;&gt;</font> <font color="#009900">WEXITED</font> <font color="#993399">0</font> <b><font color="#0000FF">then</font></b>
      failwith <font color="#FF0000">"failed to read input list of files"</font><font color="#990000">;</font>
    <b><font color="#0000FF">if</font></b> files <font color="#990000">=</font> <font color="#990000">[]</font> <b><font color="#0000FF">then</font></b>
      failwith <font color="#FF0000">"no input files; is the program running from the top directory? did you compile with make -C src CFLAGS=\"-save-temps\"?"</font><font color="#990000">;</font>
    files <b><font color="#0000FF">in</font></b>

  <i><font color="#9A1900">(* Load and parse each input file. *)</font></i>
  <b><font color="#0000FF">let</font></b> files <font color="#990000">=</font>
    <b><font color="#000080">List</font></b><font color="#990000">.</font>map <font color="#990000">(</font>
      <b><font color="#0000FF">fun</font></b> filename <font color="#990000">-&gt;</font>
        printf <font color="#FF0000">"loading %s\n%!"</font> filename<font color="#990000">;</font>
        <b><font color="#000080">Frontc</font></b><font color="#990000">.</font>parse filename <font color="#990000">()</font>
    <font color="#990000">)</font> files <b><font color="#0000FF">in</font></b>

  <i><font color="#9A1900">(* Merge the files. *)</font></i>
  printf <font color="#FF0000">"merging files\n%!"</font><font color="#990000">;</font>
  <b><font color="#0000FF">let</font></b> sourcecode <font color="#990000">=</font> <b><font color="#000080">Mergecil</font></b><font color="#990000">.</font>merge files <font color="#FF0000">"libguestfs"</font> <b><font color="#0000FF">in</font></b>

  <i><font color="#9A1900">(* CFG analysis. *)</font></i>
  printf <font color="#FF0000">"computing control flow\n%!"</font><font color="#990000">;</font>
  <b><font color="#000080">Cfg</font></b><font color="#990000">.</font>computeFileCFG sourcecode<font color="#990000">;</font>

  <b><font color="#0000FF">let</font></b> functions <font color="#990000">=</font>
    filter_map <font color="#990000">(</font><b><font color="#0000FF">function</font></b> <font color="#009900">GFun</font> <font color="#990000">(</font>f<font color="#990000">,</font> loc<font color="#990000">)</font> <font color="#990000">-&gt;</font> <font color="#009900">Some</font> <font color="#990000">(</font>f<font color="#990000">,</font> loc<font color="#990000">)</font> <font color="#990000">|</font> _ <font color="#990000">-&gt;</font> <font color="#009900">None</font><font color="#990000">)</font>
      sourcecode<font color="#990000">.</font>globals <b><font color="#0000FF">in</font></b>

  <i><font color="#9A1900">(* Examine which functions directly call which other functions. *)</font></i>
  printf <font color="#FF0000">"computing call graph\n%!"</font><font color="#990000">;</font>
  <b><font color="#0000FF">let</font></b> call_graph <font color="#990000">=</font> make_call_graph functions <b><font color="#0000FF">in</font></b>
  <i><font color="#9A1900">(*</font></i>
<i><font color="#9A1900">  FunctionDigraph.iter_edges (</font></i>
<i><font color="#9A1900">    fun caller callee -&gt;</font></i>
<i><font color="#9A1900">      printf "%s calls %s\n" caller.vname callee.vname</font></i>
<i><font color="#9A1900">  ) call_graph;</font></i>
<i><font color="#9A1900">  *)</font></i>

  <i><font color="#9A1900">(* The libguestfs error functions.  These are global function names,</font></i>
<i><font color="#9A1900">   * but to be any use to us we have to look these up in the list of</font></i>
<i><font color="#9A1900">   * all global functions (ie. 'functions') and turn them into the</font></i>
<i><font color="#9A1900">   * corresponding varinfo structures.</font></i>
<i><font color="#9A1900">   *)</font></i>
  <b><font color="#0000FF">let</font></b> error_function_names <font color="#990000">=</font> <font color="#990000">[</font> <font color="#FF0000">"guestfs_error_errno"</font><font color="#990000">;</font>
                               <font color="#FF0000">"guestfs_perrorf"</font> <font color="#990000">]</font> <b><font color="#0000FF">in</font></b>

  <b><font color="#0000FF">let</font></b> find_function name <font color="#990000">=</font>
    <b><font color="#0000FF">try</font></b> <b><font color="#000080">List</font></b><font color="#990000">.</font>find <font color="#990000">(</font><b><font color="#0000FF">fun</font></b> <font color="#990000">(</font><font color="#FF0000">{</font> svar <font color="#990000">=</font> <font color="#FF0000">{</font> vname <font color="#990000">=</font> n <font color="#FF0000">}}</font><font color="#990000">,</font> _<font color="#990000">)</font> <font color="#990000">-&gt;</font> n <font color="#990000">=</font> name<font color="#990000">)</font> functions
    <b><font color="#0000FF">with</font></b> <font color="#009900">Not_found</font> <font color="#990000">-&gt;</font> failwith <font color="#990000">(</font><font color="#FF0000">"function '"</font> <font color="#990000">^</font> name <font color="#990000">^</font> <font color="#FF0000">"' does not exist"</font><font color="#990000">)</font>
  <b><font color="#0000FF">in</font></b>
  <b><font color="#0000FF">let</font></b> error_function_names <font color="#990000">=</font> <b><font color="#000080">List</font></b><font color="#990000">.</font>map <font color="#990000">(</font>
    <b><font color="#0000FF">fun</font></b> f <font color="#990000">-&gt;</font> <font color="#990000">(</font>fst <font color="#990000">(</font>find_function f<font color="#990000">)).</font>svar
  <font color="#990000">)</font> error_function_names <b><font color="#0000FF">in</font></b>

  <i><font color="#9A1900">(* Get a list of functions that might (directly or indirectly) call</font></i>
<i><font color="#9A1900">   * one of the error functions.</font></i>
<i><font color="#9A1900">   *)</font></i>
  <b><font color="#0000FF">let</font></b> error_functions<font color="#990000">,</font> non_error_functions <font color="#990000">=</font>
    functions_which_call call_graph error_function_names functions <b><font color="#0000FF">in</font></b>

  <i><font color="#9A1900">(*</font></i>
<i><font color="#9A1900">  List.iter (</font></i>
<i><font color="#9A1900">    fun f -&gt; printf "%s can call an error function\n" f.vname</font></i>
<i><font color="#9A1900">  ) error_functions;</font></i>

<i><font color="#9A1900">  List.iter (</font></i>
<i><font color="#9A1900">    fun f -&gt; printf "%s can NOT call an error function\n" f.vname</font></i>
<i><font color="#9A1900">  ) non_error_functions;</font></i>
<i><font color="#9A1900">  *)</font></i>

  <i><font color="#9A1900">(* Save the list of error functions in a global set for fast lookups. *)</font></i>
  <b><font color="#0000FF">let</font></b> set <font color="#990000">=</font>
    <b><font color="#000080">List</font></b><font color="#990000">.</font>fold_left <font color="#990000">(</font>
      <b><font color="#0000FF">fun</font></b> set elt <font color="#990000">-&gt;</font> <b><font color="#000080">FunctionSet</font></b><font color="#990000">.</font>add elt set
    <font color="#990000">)</font> <b><font color="#000080">FunctionSet</font></b><font color="#990000">.</font>empty error_functions <b><font color="#0000FF">in</font></b>
  <b><font color="#000080">ErrorCounter</font></b><font color="#990000">.</font>error_functions_set <font color="#990000">:=</font> set<font color="#990000">;</font>

  <i><font color="#9A1900">(* Analyze each top-level function to ensure it calls an error</font></i>
<i><font color="#9A1900">   * function exactly once on error paths, and never on normal return</font></i>
<i><font color="#9A1900">   * paths.</font></i>
<i><font color="#9A1900">   *)</font></i>
  printf <font color="#FF0000">"analyzing correctness of error paths\n%!"</font><font color="#990000">;</font>
  <b><font color="#000080">List</font></b><font color="#990000">.</font>iter compute_error_paths functions<font color="#990000">;</font>

  <font color="#990000">()</font>

<i><font color="#9A1900">(* Make a directed graph of which functions directly call which other</font></i>
<i><font color="#9A1900"> * functions.</font></i>
<i><font color="#9A1900"> *)</font></i>
<b><font color="#0000FF">and</font></b> make_call_graph functions <font color="#990000">=</font>
  <b><font color="#0000FF">let</font></b> graph <font color="#990000">=</font> <b><font color="#000080">FunctionDigraph</font></b><font color="#990000">.</font>create <font color="#990000">()</font> <b><font color="#0000FF">in</font></b>

  <b><font color="#000080">List</font></b><font color="#990000">.</font>iter <font color="#990000">(</font>
    <b><font color="#0000FF">fun</font></b> <font color="#990000">(</font><font color="#FF0000">{</font> svar <font color="#990000">=</font> caller<font color="#990000">;</font> sallstmts <font color="#990000">=</font> sallstmts <font color="#FF0000">}</font><font color="#990000">,</font> _<font color="#990000">)</font> <font color="#990000">-&gt;</font>
      <i><font color="#9A1900">(* Evaluate which other functions 'caller' calls.  First pull</font></i>
<i><font color="#9A1900">       * out every 'Call' instruction anywhere in the function.</font></i>
<i><font color="#9A1900">       *)</font></i>
      <b><font color="#0000FF">let</font></b> insns <font color="#990000">=</font>  <b><font color="#000080">List</font></b><font color="#990000">.</font>concat <font color="#990000">(</font>
        filter_map <font color="#990000">(</font>
          <b><font color="#0000FF">function</font></b>
          <font color="#990000">|</font> <font color="#FF0000">{</font> skind <font color="#990000">=</font> <font color="#009900">Instr</font> insns <font color="#FF0000">}</font> <font color="#990000">-&gt;</font> <font color="#009900">Some</font> insns
          <font color="#990000">|</font> _ <font color="#990000">-&gt;</font> <font color="#009900">None</font>
        <font color="#990000">)</font> sallstmts
      <font color="#990000">)</font> <b><font color="#0000FF">in</font></b>
      <b><font color="#0000FF">let</font></b> calls <font color="#990000">=</font> <b><font color="#000080">List</font></b><font color="#990000">.</font>filter <font color="#990000">(</font><b><font color="#0000FF">function</font></b> <font color="#009900">Call</font> _ <font color="#990000">-&gt;</font> <b><font color="#0000FF">true</font></b> <font color="#990000">|</font> _ <font color="#990000">-&gt;</font> <b><font color="#0000FF">false</font></b><font color="#990000">)</font> insns <b><font color="#0000FF">in</font></b>
      <i><font color="#9A1900">(* Then examine what function is being called at each place. *)</font></i>
      <b><font color="#0000FF">let</font></b> callees <font color="#990000">=</font> filter_map <font color="#990000">(</font>
        <b><font color="#0000FF">function</font></b>
        <font color="#990000">|</font> <font color="#009900">Call</font> <font color="#990000">(</font>_<font color="#990000">,</font> <font color="#009900">Lval</font> <font color="#990000">(</font><font color="#009900">Var</font> callee<font color="#990000">,</font> _<font color="#990000">),</font> _<font color="#990000">,</font> _<font color="#990000">)</font> <font color="#990000">-&gt;</font> <font color="#009900">Some</font> callee
        <font color="#990000">|</font> _ <font color="#990000">-&gt;</font> <font color="#009900">None</font>
      <font color="#990000">)</font> calls <b><font color="#0000FF">in</font></b>

      <b><font color="#000080">List</font></b><font color="#990000">.</font>iter <font color="#990000">(</font>
        <b><font color="#0000FF">fun</font></b> callee <font color="#990000">-&gt;</font>
          <b><font color="#000080">FunctionDigraph</font></b><font color="#990000">.</font>add_edge graph caller callee
      <font color="#990000">)</font> callees
  <font color="#990000">)</font> functions<font color="#990000">;</font>

  graph

<i><font color="#9A1900">(* [functions_which_call g endpoints functions] partitions the</font></i>
<i><font color="#9A1900"> * [functions] list, returning those functions that call directly or</font></i>
<i><font color="#9A1900"> * indirectly one of the functions in [endpoints], and a separate list</font></i>
<i><font color="#9A1900"> * of functions which do not.  [g] is the direct call graph.</font></i>
<i><font color="#9A1900"> *)</font></i>
<b><font color="#0000FF">and</font></b> functions_which_call g endpoints functions <font color="#990000">=</font>
  <b><font color="#0000FF">let</font></b> functions <font color="#990000">=</font> <b><font color="#000080">List</font></b><font color="#990000">.</font>map <font color="#990000">(</font><b><font color="#0000FF">fun</font></b> <font color="#990000">(</font><font color="#FF0000">{</font> svar <font color="#990000">=</font> svar <font color="#FF0000">}</font><font color="#990000">,</font> _<font color="#990000">)</font> <font color="#990000">-&gt;</font> svar<font color="#990000">)</font> functions <b><font color="#0000FF">in</font></b>

  <b><font color="#0000FF">let</font></b> checker <font color="#990000">=</font> <b><font color="#000080">FunctionPathChecker</font></b><font color="#990000">.</font>create g <b><font color="#0000FF">in</font></b>
  <b><font color="#000080">List</font></b><font color="#990000">.</font>partition <font color="#990000">(</font>
    <b><font color="#0000FF">fun</font></b> f <font color="#990000">-&gt;</font>
      <i><font color="#9A1900">(* Does a path exist from f to any of the endpoints? *)</font></i>
      <b><font color="#000080">List</font></b><font color="#990000">.</font>exists <font color="#990000">(</font>
        <b><font color="#0000FF">fun</font></b> endpoint <font color="#990000">-&gt;</font>
          <b><font color="#0000FF">try</font></b> <b><font color="#000080">FunctionPathChecker</font></b><font color="#990000">.</font>check_path checker f endpoint
          <b><font color="#0000FF">with</font></b>
          <i><font color="#9A1900">(* It appears safe to ignore this exception.  It seems to</font></i>
<i><font color="#9A1900">           * mean that this function is in a part of the graph which</font></i>
<i><font color="#9A1900">           * is completely disconnected from the other part of the graph</font></i>
<i><font color="#9A1900">           * that contains the endpoint.</font></i>
<i><font color="#9A1900">           *)</font></i>
          <font color="#990000">|</font> <font color="#009900">Invalid_argument</font> <font color="#FF0000">"[ocamlgraph] iter_succ"</font> <font color="#990000">-&gt;</font> <b><font color="#0000FF">false</font></b>
      <font color="#990000">)</font> endpoints
  <font color="#990000">)</font> functions

<b><font color="#0000FF">and</font></b> compute_error_paths <font color="#990000">(</font><font color="#FF0000">{</font> svar <font color="#990000">=</font> svar <font color="#FF0000">}</font> <b><font color="#0000FF">as</font></b> f<font color="#990000">,</font> loc<font color="#990000">)</font> <font color="#990000">=</font>
  <i><font color="#9A1900">(*ErrorCounter.debug := true;*)</font></i>

  <i><font color="#9A1900">(* Find the initial statement in this function (assumes that the</font></i>
<i><font color="#9A1900">   * function can only be entered in one place, which is normal for C</font></i>
<i><font color="#9A1900">   * functions).</font></i>
<i><font color="#9A1900">   *)</font></i>
  <b><font color="#0000FF">let</font></b> initial_stmts <font color="#990000">=</font>
    <b><font color="#0000FF">match</font></b> f<font color="#990000">.</font>sbody<font color="#990000">.</font>bstmts <b><font color="#0000FF">with</font></b>
    <font color="#990000">|</font> <font color="#990000">[]</font> <font color="#990000">-&gt;</font> <font color="#990000">[]</font>
    <font color="#990000">|</font> first<font color="#990000">::</font>_ <font color="#990000">-&gt;</font> <font color="#990000">[</font>first<font color="#990000">]</font> <b><font color="#0000FF">in</font></b>

  <i><font color="#9A1900">(* Initialize ErrorCounter. *)</font></i>
  <b><font color="#000080">ErrorCounter</font></b><font color="#990000">.</font>init initial_stmts<font color="#990000">;</font>

  <i><font color="#9A1900">(* Compute the error counters along paths through the function. *)</font></i>
  <b><font color="#000080">ForwardsErrorCounter</font></b><font color="#990000">.</font>compute initial_stmts<font color="#990000">;</font>

  <i><font color="#9A1900">(* Process all Return statements in this function. *)</font></i>
  <b><font color="#000080">List</font></b><font color="#990000">.</font>iter <font color="#990000">(</font>
    <b><font color="#0000FF">fun</font></b> stmt <font color="#990000">-&gt;</font>
      <b><font color="#0000FF">try</font></b>
        <b><font color="#0000FF">let</font></b> errcalls <font color="#990000">=</font> <b><font color="#000080">Inthash</font></b><font color="#990000">.</font>find <b><font color="#000080">ErrorCounter</font></b><font color="#990000">.</font>stmtStartData stmt<font color="#990000">.</font>sid <b><font color="#0000FF">in</font></b>

        <b><font color="#0000FF">match</font></b> stmt <b><font color="#0000FF">with</font></b>
        <i><font color="#9A1900">(* return -1; *)</font></i>
        <font color="#990000">|</font> <font color="#FF0000">{</font> skind <font color="#990000">=</font> <font color="#009900">Return</font> <font color="#990000">(</font><font color="#009900">Some</font> i<font color="#990000">,</font> loc<font color="#990000">)</font> <font color="#FF0000">}</font> <b><font color="#0000FF">when</font></b> is_literal_minus_one i <font color="#990000">-&gt;</font>
          <b><font color="#0000FF">if</font></b> errcalls <font color="#990000">=</font> <font color="#993399">0</font> <b><font color="#0000FF">then</font></b>
            printf <font color="#FF0000">"%s:%d: %s: may return an error code without calling error/perrorf\n"</font>
              loc<font color="#990000">.</font>file loc<font color="#990000">.</font>line svar<font color="#990000">.</font>vname
          <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b> errcalls <font color="#990000">&gt;</font> <font color="#993399">1</font> <b><font color="#0000FF">then</font></b>
            printf <font color="#FF0000">"%s:%d: %s: may call error/perrorf %d times (more than once) along an error path\n"</font>
          loc<font color="#990000">.</font>file loc<font color="#990000">.</font>line svar<font color="#990000">.</font>vname errcalls

        <i><font color="#9A1900">(* return 0; *)</font></i>
        <font color="#990000">|</font> <font color="#FF0000">{</font> skind <font color="#990000">=</font> <font color="#009900">Return</font> <font color="#990000">(</font><font color="#009900">Some</font> i<font color="#990000">,</font> loc<font color="#990000">)</font> <font color="#FF0000">}</font> <b><font color="#0000FF">when</font></b> is_literal_zero i <font color="#990000">-&gt;</font>
          <b><font color="#0000FF">if</font></b> errcalls <font color="#990000">&gt;=</font> <font color="#993399">1</font> <b><font color="#0000FF">then</font></b>
            printf <font color="#FF0000">"%s:%d: %s: may call error/perrorf along a non-error return path\n"</font>
              loc<font color="#990000">.</font>file loc<font color="#990000">.</font>line svar<font color="#990000">.</font>vname

        <i><font color="#9A1900">(* return; (void return) *)</font></i>
        <font color="#990000">|</font> <font color="#FF0000">{</font> skind <font color="#990000">=</font> <font color="#009900">Return</font> <font color="#990000">(</font><font color="#009900">None</font><font color="#990000">,</font> loc<font color="#990000">)</font> <font color="#FF0000">}</font> <font color="#990000">-&gt;</font>
          <b><font color="#0000FF">if</font></b> errcalls <font color="#990000">&gt;=</font> <font color="#993399">1</font> <b><font color="#0000FF">then</font></b>
            printf <font color="#FF0000">"%s:%d: %s: may call error/perrorf and return void\n"</font>
              loc<font color="#990000">.</font>file loc<font color="#990000">.</font>line svar<font color="#990000">.</font>vname

        <font color="#990000">|</font> _ <font color="#990000">-&gt;</font> <font color="#990000">()</font>

      <b><font color="#0000FF">with</font></b>
        <font color="#009900">Not_found</font> <font color="#990000">-&gt;</font>
          printf <font color="#FF0000">"%s:%d: %s: may contain unreachable code\n"</font>
            loc<font color="#990000">.</font>file loc<font color="#990000">.</font>line svar<font color="#990000">.</font>vname
  <font color="#990000">)</font> f<font color="#990000">.</font>sallstmts

<i><font color="#9A1900">(* Some convenience CIL matching functions. *)</font></i>
<b><font color="#0000FF">and</font></b> is_literal_minus_one <font color="#990000">=</font> <b><font color="#0000FF">function</font></b>
  <font color="#990000">|</font> <font color="#009900">Const</font> <font color="#990000">(</font><font color="#009900">CInt64</font> <font color="#990000">(-</font><font color="#993399">1L</font><font color="#990000">,</font> _<font color="#990000">,</font> _<font color="#990000">))</font> <font color="#990000">-&gt;</font> <b><font color="#0000FF">true</font></b>
  <font color="#990000">|</font> _ <font color="#990000">-&gt;</font> <b><font color="#0000FF">false</font></b>

<b><font color="#0000FF">and</font></b> is_literal_zero <font color="#990000">=</font> <b><font color="#0000FF">function</font></b>
  <font color="#990000">|</font> <font color="#009900">Const</font> <font color="#990000">(</font><font color="#009900">CInt64</font> <font color="#990000">(</font><font color="#993399">0L</font><font color="#990000">,</font> _<font color="#990000">,</font> _<font color="#990000">))</font> <font color="#990000">-&gt;</font> <b><font color="#0000FF">true</font></b>
  <font color="#990000">|</font> _ <font color="#990000">-&gt;</font> <b><font color="#0000FF">false</font></b>

<i><font color="#9A1900">(* Convenient routine to load the contents of a channel into a list of</font></i>
<i><font color="#9A1900"> * strings.</font></i>
<i><font color="#9A1900"> *)</font></i>
<b><font color="#0000FF">and</font></b> input_chan chan <font color="#990000">=</font>
  <b><font color="#0000FF">let</font></b> lines <font color="#990000">=</font> <font color="#009900">ref</font> <font color="#990000">[]</font> <b><font color="#0000FF">in</font></b>
  <b><font color="#0000FF">try</font></b> <b><font color="#0000FF">while</font></b> <b><font color="#0000FF">true</font></b><font color="#990000">;</font> <b><font color="#0000FF">do</font></b> lines <font color="#990000">:=</font> input_line chan <font color="#990000">::</font> <font color="#990000">!</font>lines <b><font color="#0000FF">done</font></b><font color="#990000">;</font> <font color="#990000">[]</font>
  <b><font color="#0000FF">with</font></b> <font color="#009900">End_of_file</font> <font color="#990000">-&gt;</font> <b><font color="#000080">List</font></b><font color="#990000">.</font>rev <font color="#990000">!</font>lines

<b><font color="#0000FF">and</font></b> input_file filename <font color="#990000">=</font>
  <b><font color="#0000FF">let</font></b> chan <font color="#990000">=</font> open_in filename <b><font color="#0000FF">in</font></b>
  <b><font color="#0000FF">let</font></b> r <font color="#990000">=</font> input_chan chan <b><font color="#0000FF">in</font></b>
  close_in chan<font color="#990000">;</font>
  r

<b><font color="#0000FF">let</font></b> <font color="#990000">()</font> <font color="#990000">=</font>
  <b><font color="#0000FF">try</font></b> main <font color="#990000">()</font>
  <b><font color="#0000FF">with</font></b> 
    <font color="#009900">exn</font> <font color="#990000">-&gt;</font>
      prerr_endline <font color="#990000">(</font><b><font color="#000080">Printexc</font></b><font color="#990000">.</font>to_string <font color="#009900">exn</font><font color="#990000">);</font>
      <b><font color="#000080">Printexc</font></b><font color="#990000">.</font>print_backtrace <b><font color="#000080">Pervasives</font></b><font color="#990000">.</font>stderr<font color="#990000">;</font>
      exit <font color="#993399">1</font>


<br/>  <a href="http://feeds.wordpress.com/1.0/gocomments/rwmj.wordpress.com/4163/" rel="nofollow"><img src="http://feeds.wordpress.com/1.0/comments/rwmj.wordpress.com/4163/" alt="" border="0"/></a> <img src="http://stats.wordpress.com/b.gif?host=rwmj.wordpress.com&amp;blog=6840703&amp;post=4163&amp;subd=rwmj&amp;ref=&amp;feed=1" alt="" height="1" border="0" width="1"/><a onclick="switchContent('post6','post5')" class="btn" href="#e019222843fac682c9f57ee0f6d1fe6a">Hide</a></div></span>
<a name="00ec978ade6c4d3f5b6ce89570ef0ff1"></a><span class="rss-header"><span class="rss-title"><a href="http://hongboz.wordpress.com/2013/02/05/syntactic-meta-programming-in-ocaml-ii-5/"> Syntactic Meta-Programming in OCaml (II)</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Hong bo Zhang</span>, <span class="rss-date">05 Feb 2013</span></span><span class="rss-description"><div id="post7"><p>In this post, we continue discussing syntactic meta-programming<br/>
following <a href="http://hongboz.wordpress.com/2013/01/28/random-thoughts-about-syntactic-meta-programming-i/">last post</a>.
</p>
<p>
My years of experience in different meta-program system(Common Lisp,<br/>
Template Haskell, Camlp4) tell me that quosi-quotation is the most<br/>
essential part in syntactic meta programming. Though all three claims<br/>
they have quosi-quotation support. But Template Haskell’s<br/>
quosi-quotation falls far behind either Camlp4 or Common Lisp. For a<br/>
decent quosi-quotation system, first, nested quotation and<br/>
anti-quotation is necessary, second, like Lisp, every part should be<br/>
able to be quoted and antiquoted except keywords position, that’s to<br/>
say, each part of the code fragment can be parametrized.
</p>
<p>
For the notation, we denote <code>Ast^0</code> as the normal Ast, <code>Ast^1</code> as Ast<br/>
encoding <code>Ast^0</code>, the same as <code>Ast^n</code>.
</p>
<p>
So in this post, we discuss the quosi-quotation first.
</p>
<a onclick="switchContent('post7','post8')" class="btn" href="#00ec978ade6c4d3f5b6ce89570ef0ff1">Read more...</a></div><div id="post8" style="display: none"><p>In this post, we continue discussing syntactic meta-programming<br/>
following <a href="http://hongboz.wordpress.com/2013/01/28/random-thoughts-about-syntactic-meta-programming-i/">last post</a>.
</p>
<p>
My years of experience in different meta-program system(Common Lisp,<br/>
Template Haskell, Camlp4) tell me that quosi-quotation is the most<br/>
essential part in syntactic meta programming. Though all three claims<br/>
they have quosi-quotation support. But Template Haskell’s<br/>
quosi-quotation falls far behind either Camlp4 or Common Lisp. For a<br/>
decent quosi-quotation system, first, nested quotation and<br/>
anti-quotation is necessary, second, like Lisp, every part should be<br/>
able to be quoted and antiquoted except keywords position, that’s to<br/>
say, each part of the code fragment can be parametrized.
</p>
<p>
For the notation, we denote <code>Ast^0</code> as the normal Ast, <code>Ast^1</code> as Ast<br/>
encoding <code>Ast^0</code>, the same as <code>Ast^n</code>.
</p>
<p>
So in this post, we discuss the quosi-quotation first.
</p>
<p>
The implementation of quosi-quotation heavily relies on the<br/>
implementation of the compiler, so let’s limit the scope of how to get<br/>
quosi-quotation done to OCaml.
</p>
<p>
Let’s ignore the antiquote part, and focus the quote part first, the<br/>
essential of quosi-quotation is to encode the Ast using Ast itself in<br/>
the meta level: there are different technologies to implement<br/>
quosi-quotations, to my knowledge, I summarized three here:
</p>
<div id="outline-container-1" class="outline-3">
<h3 id="sec-1">Raw String manipulation</h3>
<div id="text-1" class="outline-text-3">
<p>   This is the most intuitive way, given a string input, the normal<br/>
   way of parsing is transform it into a parsetree,
</p>
<pre class="src src-ocaml"><span style="color: #ffa500; font-weight: bold;">val</span> <span style="color: #dfaf8f;">parse</span><span style="color: #f0e68c;">:</span> <span style="color: #8cd0d3;">string </span><span style="color: #f0e68c;">-&gt;</span><span style="color: #8cd0d3;"> ast</span>
</pre>
<p>
   To encode the meta-level ast, we can do the unparsing again,<br/>
   assume we have an unparsing function which unparse the ast
</p>
<pre class="src src-ocaml"><span style="color: #ffa500; font-weight: bold;">val</span> <span style="color: #dfaf8f;">unparse</span><span style="color: #f0e68c;">:</span> <span style="color: #8cd0d3;">ast </span><span style="color: #f0e68c;">-&gt;</span><span style="color: #8cd0d3;"> string</span>
</pre>
<p>
   so after the composition of parse and unparse, you transformed a<br/>
   string into the meta-level
</p>
<pre class="src src-ocaml"><span style="color: #f0e68c;">(</span>parse <span style="color: #cc9393;">"3"</span><span style="color: #f0e68c;">)</span>
<span style="color: #f0e68c;">-</span> `Int <span style="color: #cc9393;">"3"</span>
unparse<span style="color: #f0e68c;">(</span>parse <span style="color: #cc9393;">"3"</span><span style="color: #f0e68c;">)</span>
<span style="color: #f0e68c;">-</span> <span style="color: #cc9393;">"`Int \"3\""</span>

</pre>
<p>
   Then you can do <code>parse</code> again, after <code>parse(unparse (parse "3"))</code>,<br/>
   we managed to lift the Ast in the meta level. There are serious<br/>
   defects with this way, First, it’s very brittle, since we are doing<br/>
   string manipulation in different levels, second, after <b>unparsing</b>,<br/>
   the location is totally lost, location is one of the most tedious<br/>
   but necessary part for a practical meta programming system, third,<br/>
   there is no easy way to integrate with antiquot. This technique is<br/>
   quite intuitive and easy to understand, but I don’t know any<br/>
   meta-system do it this way, so feel free to tell me if you know<br/>
   anyone does similar work <img src="http://s1.wp.com/wp-includes/images/smilies/icon_wink.gif" alt=";-)" class="wp-smiley"/>
</p>
</div>
</div>
<div id="outline-container-2" class="outline-3">
<h3 id="sec-2">Maintaining different parsers</h3>
<div id="text-2" class="outline-text-3">
<p>
   Unlike the string manipulation, it write different parsers for<br/>
   different actions. Suppose we are in OCaml, if we want to support<br/>
   quosi-quotations in such syntax categories
</p>
<pre class="example">sig_item, str_item, patt, expr, module_type, module_expr, class_type
class_expr, class_sig_item, class_str_item, with_constr, binding, rec_binding,
match_case,
</pre>
<p>
   And you want the quosi-quotaion appears in both <code>expr</code> and <code>patt</code><br/>
   positions, then you have to write <code>14 x (2+1)</code> parsers, the parser can<br/>
   not be re-usable, if you want to support <code>overloaded quotations</code> (I<br/>
   will talk about it later), then you have to roll your own parser<br/>
   again. Writing parser is not hard, but it’s not fun either, and<br/>
   keeping sync up different parsers is a nightmare.
</p>
<p>
   To make things worse, once anti-quotation is considered, for each<br/>
   category, there are three parsers to write, but anti-quot makes<br/>
   them slightly different. To be honest, this way is impractical.
</p>
</div>
</div>
<div id="outline-container-3" class="outline-3">
<h3 id="sec-3">Ast Lifting</h3>
<div id="text-3" class="outline-text-3">
<p>   Another mechanism to do quosi-quotation is that imaging we have a<br/>
   powerful function:
</p>
<pre class="src src-ocaml"><span style="color: #ffa500; font-weight: bold;">val</span> <span style="color: #dfaf8f;">meta</span><span style="color: #f0e68c;">:</span> <span style="color: #8cd0d3;">ast</span><span style="color: #f0e68c;">^</span>0 <span style="color: #f0e68c;">-&gt;</span> ast<span style="color: #f0e68c;">^</span>1
</pre>
<p>
   This seems magic, but it’s possible even though in OCaml we don’t<br/>
   have generic programming support, since we have the definition<br/>
   of ast.
</p>
<p>
   The problem with this technique is that it requires an explicit<br/>
   <code>Ant</code> tag in the ast representation, since at <code>ast^0</code> level, you<br/>
   have to store <code>Ant</code> as intermediate node which will be removed when<br/>
   applied <code>meta</code> function.
</p>
<p>
   Let’s walk through each phase in Fan
</p>
<p>
   Think about how such piece of code would be parsed in Fan:
</p>
<pre class="src src-ocaml"><span style="color: #f0e68c;">{:</span><span style="color: #8cd0d3;">expr</span><span style="color: #f0e68c;">|</span> <span style="color: #f0e68c;">$</span>x <span style="color: #f0e68c;">+</span> y<span style="color: #f0e68c;">|}</span>
</pre>
<p>
   For the first phase (I removed the location for simplicity)
</p>
<pre class="src src-ocaml">`App<span style="color: #f0e68c;">(</span>`App
      <span style="color: #f0e68c;">(</span> `Id <span style="color: #f0e68c;">(</span> `Lid <span style="color: #f0e68c;">(</span> <span style="color: #cc9393;">"+"</span><span style="color: #f0e68c;">)),</span>
        `Ant <span style="color: #f0e68c;">(</span> <span style="color: #f0e68c;">{</span>cxt <span style="color: #f0e68c;">=</span> <span style="color: #cc9393;">"expr"</span><span style="color: #f0e68c;">;</span> sep <span style="color: #f0e68c;">=</span> None<span style="color: #f0e68c;">;</span> decorations <span style="color: #f0e68c;">=</span> <span style="color: #cc9393;">""</span><span style="color: #f0e68c;">;</span> content <span style="color: #f0e68c;">=</span> <span style="color: #cc9393;">"x"</span><span style="color: #f0e68c;">})),</span>
     `Id <span style="color: #f0e68c;">(</span> `Lid <span style="color: #f0e68c;">(</span> <span style="color: #cc9393;">"y"</span><span style="color: #f0e68c;">)))</span>
</pre>
<p>
   Here <code>Ant</code> exists only as intermediate node, it will be eliminated<br/>
   in the meta-step
</p>
<p>
   after applied with <code>meta</code> function
</p>
<pre class="src src-ocaml"><span style="color: #f0e68c;">(</span><span style="color: #8cd0d3;">Filters</span>.<span style="color: #8cd0d3;">ME</span>.meta_expr _loc <span style="color: #f0e68c;">(</span>t expr <span style="color: #cc9393;">"$x + y"</span><span style="color: #f0e68c;">));</span>
<span style="color: #f0e68c;">-</span> <span style="color: #f0e68c;">:</span> <span style="color: #8cd0d3;">FanAst.expr </span><span style="color: #f0e68c;">=</span>
`App
  <span style="color: #f0e68c;">(,</span>
   `App
     <span style="color: #f0e68c;">(,</span> `App <span style="color: #f0e68c;">(,</span> `Vrn <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"App"</span><span style="color: #f0e68c;">),</span> `Id <span style="color: #f0e68c;">(,</span> `Lid <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"_loc"</span><span style="color: #f0e68c;">))),</span>
      `App
        <span style="color: #f0e68c;">(,</span>
         `App
           <span style="color: #f0e68c;">(,</span> `App <span style="color: #f0e68c;">(,</span> `Vrn <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"App"</span><span style="color: #f0e68c;">),</span> `Id <span style="color: #f0e68c;">(,</span> `Lid <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"_loc"</span><span style="color: #f0e68c;">))),</span>
            `App
              <span style="color: #f0e68c;">(,</span> `App <span style="color: #f0e68c;">(,</span> `Vrn <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"Id"</span><span style="color: #f0e68c;">),</span> `Id <span style="color: #f0e68c;">(,</span> `Lid <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"_loc"</span><span style="color: #f0e68c;">))),</span>
               `App
                 <span style="color: #f0e68c;">(,</span> `App <span style="color: #f0e68c;">(,</span> `Vrn <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"Lid"</span><span style="color: #f0e68c;">),</span> `Id <span style="color: #f0e68c;">(,</span> `Lid <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"_loc"</span><span style="color: #f0e68c;">))),</span>
                  `Str <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"+"</span><span style="color: #f0e68c;">)))),</span>
         `Ant <span style="color: #f0e68c;">(,</span> <span style="color: #f0e68c;">{</span>cxt <span style="color: #f0e68c;">=</span> <span style="color: #cc9393;">"expr"</span><span style="color: #f0e68c;">;</span> sep <span style="color: #f0e68c;">=</span> None<span style="color: #f0e68c;">;</span> decorations <span style="color: #f0e68c;">=</span> <span style="color: #cc9393;">""</span><span style="color: #f0e68c;">;</span> content <span style="color: #f0e68c;">=</span> <span style="color: #cc9393;">"x"</span><span style="color: #f0e68c;">}))),</span>
   `App
     <span style="color: #f0e68c;">(,</span> `App <span style="color: #f0e68c;">(,</span> `Vrn <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"Id"</span><span style="color: #f0e68c;">),</span> `Id <span style="color: #f0e68c;">(,</span> `Lid <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"_loc"</span><span style="color: #f0e68c;">))),</span>
      `App <span style="color: #f0e68c;">(,</span> `App <span style="color: #f0e68c;">(,</span> `Vrn <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"Lid"</span><span style="color: #f0e68c;">),</span> `Id <span style="color: #f0e68c;">(,</span> `Lid <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"_loc"</span><span style="color: #f0e68c;">))),</span> `Str <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"y"</span><span style="color: #f0e68c;">))))</span>   
</pre>
<p>
   (t is a parsing function)<br/>
   Here we see that <code>Ant</code> node is still kept and it will be<br/>
   filtering, now we can filter the <code>Ant</code> node into a normal Ast,
</p>
<pre class="src src-ocaml"><span style="color: #f0e68c;">(</span><span style="color: #8cd0d3;">Ant</span>.antiquot_expander <span style="color: #f0e68c;">~</span>parse_patt <span style="color: #f0e68c;">~</span>parse_expr<span style="color: #f0e68c;">)#</span>expr <span style="color: #f0e68c;">(</span><span style="color: #8cd0d3;">Filters</span>.<span style="color: #8cd0d3;">ME</span>.meta_expr _loc <span style="color: #f0e68c;">(</span>t expr <span style="color: #cc9393;">" $x + y"</span><span style="color: #f0e68c;">));</span>
<span style="color: #f0e68c;">-</span> <span style="color: #f0e68c;">:</span> <span style="color: #8cd0d3;">FanAst.expr </span><span style="color: #f0e68c;">=</span>
`App
  <span style="color: #f0e68c;">(,</span>
   `App
     <span style="color: #f0e68c;">(,</span> `App <span style="color: #f0e68c;">(,</span> `Vrn <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"App"</span><span style="color: #f0e68c;">),</span> `Id <span style="color: #f0e68c;">(,</span> `Lid <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"_loc"</span><span style="color: #f0e68c;">))),</span>
      `App
        <span style="color: #f0e68c;">(,</span>
         `App
           <span style="color: #f0e68c;">(,</span> `App <span style="color: #f0e68c;">(,</span> `Vrn <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"App"</span><span style="color: #f0e68c;">),</span> `Id <span style="color: #f0e68c;">(,</span> `Lid <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"_loc"</span><span style="color: #f0e68c;">))),</span>
            `App
              <span style="color: #f0e68c;">(,</span> `App <span style="color: #f0e68c;">(,</span> `Vrn <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"Id"</span><span style="color: #f0e68c;">),</span> `Id <span style="color: #f0e68c;">(,</span> `Lid <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"_loc"</span><span style="color: #f0e68c;">))),</span>
               `App
                 <span style="color: #f0e68c;">(,</span> `App <span style="color: #f0e68c;">(,</span> `Vrn <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"Lid"</span><span style="color: #f0e68c;">),</span> `Id <span style="color: #f0e68c;">(,</span> `Lid <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"_loc"</span><span style="color: #f0e68c;">))),</span>
                  `Str <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"+"</span><span style="color: #f0e68c;">)))),</span>
         `Id <span style="color: #f0e68c;">(,</span> `Lid <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"x"</span><span style="color: #f0e68c;">)))),</span>
   `App
     <span style="color: #f0e68c;">(,</span> `App <span style="color: #f0e68c;">(,</span> `Vrn <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"Id"</span><span style="color: #f0e68c;">),</span> `Id <span style="color: #f0e68c;">(,</span> `Lid <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"_loc"</span><span style="color: #f0e68c;">))),</span>
      `App <span style="color: #f0e68c;">(,</span> `App <span style="color: #f0e68c;">(,</span> `Vrn <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"Lid"</span><span style="color: #f0e68c;">),</span> `Id <span style="color: #f0e68c;">(,</span> `Lid <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"_loc"</span><span style="color: #f0e68c;">))),</span> `Str <span style="color: #f0e68c;">(,</span> <span style="color: #cc9393;">"y"</span><span style="color: #f0e68c;">))))</span>   
</pre>
<p>
   (location in the meta-level is ignored)<br/>
   If we want to share the same grammar between the <code>Ast^n(n=0,1,2,...)</code>,<br/>
   Ast lifting (a function of type <code>Ast^0 -&gt; Ast^1</code>) is necessary.
</p>
</div>
</div>
<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">Summary</h2>
<div id="text-1" class="outline-text-2">
<p>
  We see the three techniques introduced here to do the<br/>
  quosi-quotation, Fan adopts the third one, suppose we pick the<br/>
  third one, let’s discuss what kind of Ast representation we need to<br/>
  make life easier.
</p>
<p>
  As we discussed previously, introducing records in the Abstract Syntax<br/>
  brings in un-necessary complexity when you want to encode the Ast<br/>
  using the Ast itself since you have to express the record in the<br/>
  meta-level as well.
</p>
<p>
  Another defect with current Parsetree is that it was designed without<br/>
  meta-programming in mind, so it does not provide an <code>Ant</code> tag in all<br/>
  syntax categories, so in the zero stage <code>Ast^0</code>, you can not have an<br/>
  Ast node <code>$x</code> in the outermost, since it’s semantically incorrect in<br/>
  <code>Ast^0</code>, but syntactically correct in <code>Ast^n(n=0,1,2,...)</code>
</p>
<p>
  The third defect with the <code>Parsetree</code> is that it’s quite irregular,<br/>
  so you can not do any meta-programming with the parsetree itself, for<br/>
  example, stripping all the location from the Ast node to derive a new<br/>
  type without locations, deriving a new type without anti-quot tags (we<br/>
  will see that such ability is quite important in <a href="https://github.com/bobzhang/Fan">Fan</a>)
</p>
<p>
  The fourth defect is more serious from the point of view of<br/>
  semantics, since in OCaml, there is no way to express absolute path,<br/>
  when you do the Ast lifting, the time you define Ast lifting is<br/>
  different from the time you use the quotations
</p>
<p>
  Camlp4′s Ast is slightly better than Parsetree, since it does not<br/>
  introduce records to increase the complexity.
</p>
<p>
  However, Camlp4′s Ast can not express the absolute path which<br/>
  results in a semantics imprecise, another serious implementation<br/>
  defect is that it tries to encode the anti-quote using both two<br/>
  techniques: either explicit <code>Ant</code> tag or via string mangling, prefix<br/>
  the string with <code>\\$:</code>, and Camlp4′s tag name is totally not<br/>
  meaningful.
</p>
<p>
  Think a bit further , about syntactic meta-programming, what we<br/>
  really care about is purely syntax, <code>Int "3"= should not be   different whether it is of type =expr</code> or <code>patt</code>, if we take a<br/>
  location of ast node, we should not care about whether its type is<br/>
  <code>expr</code> or <code>patt</code> or <code>str_item</code>, right?
</p>
<p>
  If we compose two ast node using semi syntax <code>;</code>, we really don’t<br/>
  care about whether it’s expr node or patt node
</p>
<pre class="src src-ocaml"><span style="color: #ffa500; font-weight: bold;">let</span> <span style="color: #8cd0d3;">sem</span><span style="color: #dfaf8f;"> a b </span><span style="color: #f0e68c;">=</span> <span style="color: #f0e68c;">{|</span> <span style="color: #f0e68c;">$</span>a<span style="color: #f0e68c;">;</span> <span style="color: #f0e68c;">$</span>b <span style="color: #f0e68c;">|}</span>
</pre>
<p>
  The code above should work well under already syntax categories as<br/>
  long as it support <code>`Sem</code> tag.
</p>
<p>
  Changing the underlying representation of Ast means all existing<br/>
  code in Camlp4 engine can not be reused, since the quotation-kit no<br/>
  longer apply in Fan, but the tough old days are already gone, Fan<br/>
  already managed to provide the whole quotation kit from scratch.  In<br/>
  the next post we will talk about the underly Ast using polymorphic<br/>
  variants in Fan, and argue why it’s the right direction.
</p>
<p>
  Thanks for your reading!(btw, there’s a bug in Emacs org/blog, sorry for posting several times)
</p>
</div>
</div>

<br/>  <a href="http://feeds.wordpress.com/1.0/gocomments/hongboz.wordpress.com/155/" rel="nofollow"><img src="http://feeds.wordpress.com/1.0/comments/hongboz.wordpress.com/155/" alt="" border="0"/></a> <img src="http://stats.wordpress.com/b.gif?host=hongboz.wordpress.com&amp;blog=40164267&amp;post=155&amp;subd=hongboz&amp;ref=&amp;feed=1" alt="" height="1" border="0" width="1"/><a onclick="switchContent('post8','post7')" class="btn" href="#00ec978ade6c4d3f5b6ce89570ef0ff1">Hide</a></div></span>
<a name="0eed7dbfb15f8c7e7c88f25ac195e914"></a><span class="rss-header"><span class="rss-title"><a href="https://forge.ocamlcore.org/projects/ocaml-efl/"> OCaml EFL</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">OCamlCore Forge Projects</span>, <span class="rss-date">05 Feb 2013</span></span><span class="rss-description">An OCaml interface to the Enlightenment Foundation Libraries (EFL)</span>
<script type="text/javascript">function switchContent(id1,id2) {
     // Get the DOM reference
     var contentId1 = document.getElementById(id1);
     var contentId2 = document.getElementById(id2);
     // Toggle
     contentId1.style.display = "none";
     contentId2.style.display = "block";
     }</script></div>

  
    </div>

    
    <br/>
    <hr/>
    <div id="footer">
      Contribute to this project!
      Find us on <a href="https://github.com/ocaml/ocaml.org">Github</a>.
    </div>
    <span title=".././img/ = image directory from the base of the site"></span>


    
    
    

    <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
    <script src=".././js/jquery-1.8.0.min.js"></script>
    
    <script src=".././js/bootstrap.js"></script>

    <script type="text/javascript">
      var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-22552764-2']); _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-37808023-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

    </script>

</body></html>
