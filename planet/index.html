<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    
    <meta content="IE=8" http-equiv="X-UA-Compatible"/>
    <title>OCaml :: OCaml Planet</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <meta content="Ashish Agarwal, Esther Baruk, Christophe Troestler and many contributors" name="author"/>
    <meta content="" name="description"/>
    <meta content="" name="keywords"/>
    <meta content="OCaml (Weberizer)" name="generator"/>

    <link href="https://static.ocamlcore.org/official/images/favicon.ico" rel="shortcut icon"/>
    <link rel="stylesheet" href=".././css/bootstrap.css"/>
    <link href=".././css/ocaml.css" media="all" type="text/css" rel="stylesheet"/>
    <link rel="stylesheet" href=".././css/bootstrap-responsive.css"/>

    
    

    <meta content="OCaml Planet" property="og:title"/>
    <meta content="non_profit" property="og:type"/>

    <meta content="all" name="robots"/>
  </head>
  <body>
    <div id="header">
      <div class="top">
      </div>
      <div class="bottom">
      </div>
    </div>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
	  
          <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a href=".././" class="brand">OCaml</a>

          <div class="nav-collapse">
            <ul class="nav">
	      <li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">
    Discover
    <b class="caret"></b>
  </a>
  <ul class="dropdown-menu">
    <li><a href="../description.html">What is OCaml?</a></li>
    <li><a href="http://try.ocamlpro.com/">Try it Online</a></li>
    <li><a href="../taste.html">100 Lines of OCaml</a></li>
    <li><a href="../success.html">Success Stories</a></li>
    <li><a href="../companies.html">Who Is Using It?</a></li>
    <li><a href="http://pleac.sourceforge.net/pleac_ocaml/">Pleac</a></li>
    <li><a href="http://rosettacode.org/wiki/Category:OCaml">Rosetta</a>
        <a href="http://langref.org/ocaml">langref.org</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">
    Learn
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../install.html">Install</a></li>
    <li><a href="../tutorials/">Tutorials</a></li>
    <li><a href="../faq.html">FAQ</a></li>
    <li><a href="../books.html">Books</a></li>
    <li><a href="../videos.html">Videos</a></li>
    <li><a href="../papers.html">Papers</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">Use
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../releases/">Releases</a></li>
    <li><a href="../libraries.html">Libraries</a></li>
    <li><a href="../dev_tools.html">Development Tools</a></li>
    <li><a href="../books.html#manual">User Manual</a></li>
    <li><a href="../cheat_sheets.html">Cheat Sheets</a></li>
    <li><a href="http://search.ocaml.jp/">OCaml API Search</a></li>
    <li><a href="http://forge.ocamlcore.org/">Forge</a></li>
    <li><a href="https://github.com/languages/OCaml">GitHub</a></li>
    <li><a href="https://bitbucket.org/repo/all?name=ocaml">Bitbucket</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">Community
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../mailing_lists.html">Mailing Lists</a></li>
    <li><a href="../planet/">Blogs</a></li>
    <li><a href="../meetings.html">Meetings</a></li>
    <li><a href="irc://irc.freenode.net/ocaml">IRC</a></li>
    <li><a href="http://stackoverflow.com/questions/tagged?tagnames=ocaml">Stack Overflow</a></li>
    <li><a href="http://www.reddit.com/r/ocaml/">Reddit</a></li>
    <li><a href="../support.html">Commercial Support</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">More
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="http://caml.inria.fr/mantis/">Mantis Bug Tracker</a></li>
    <li><a href="../caml-light/">Caml Light</a></li>
    <li><a href="../logos.html">Logos</a></li>
  </ul>
</li>

            </ul>
	    <form action="http://www.google.com/search" method="get" class="navbar-search pull-right">
	      <input placeholder="Search" class="search-query" name="q" type="text"/>
	      <input value="site:http://www.ocaml.org/" name="q" type="hidden"/>
	    </form>
            
	    
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <span class="navigation-bar">
	<a href="./../">Home</a><span class="separation"><img src=".././img/right_arrow.png" alt="&gt;"/></span>OCaml Planet
	<span id="language">
	  <span class="horizontal-toolbar"><span class="open-bracket">[</span><span class="current-url">En</span><span class="close-bracket">]</span></span>
	</span>
      </span>

      

    <h1>OCaml Planet</h1>

    <p>The OCaml Planet aggregates various blogs from the OCaml
    community.  It is kindly provided
    by <a href="http://www.ocamlcore.com/">OCamlCore</a>.  If you
    would like to be added, read
    the <a href="http://www.ocamlcore.org/planet/">Planet
    subscription HOWTO</a>.</p>

    <br/>
    <div style="float: right; margin-right: 0; margin-top: 0" class="span2 planet-subscriptions"><em>Subscriptions</em>
      <ul><li><a href="http://alexleighton.tumblr.com/tagged/ocaml/rss">Alex Leighton</a></li><li><a href="http://blog.mestan.fr/feed/?cat=16">Alp Mestan</a></li><li><a href="http://andreiformiga.com/blog/?cat=5&feed=rss2">Andrei Formiga</a></li><li><a href="http://math.andrej.com/feed/">Andrej Bauer</a></li><li><a href="http://anil.recoil.org/feeds/atom.xml">Anil Madhavapeddy</a></li><li><a href="http://unnali.com/tag/ocaml/feed/">Arlen Cuss</a></li><li><a href="http://ashishagarwal.org/tag/ocaml/feed/">Ashish Agarwal</a></li><li><a href="http://www.blogger.com/feeds/7617521785419311079/posts/default">Cameleon news</a></li><li><a href="http://caml.inria.fr/news.en.rss">Caml INRIA</a></li><li><a href="http://camlspotter.blogspot.com/feeds/posts/default?alt=rss">Caml Spotting</a></li><li><a href="http://alan.petitepomme.net/cwn/cwn.rss">Caml Weekly News</a></li><li><a href="http://procrastiblog.com/category/ocaml/feed/">Christopher Conway</a></li><li><a href="http://coherentpdf.com/blog/?tag=ocaml&feed=rss">Coherent Graphics</a></li><li><a href="http://coq.inria.fr/news/feed">Coq</a></li><li><a href="http://erratique.ch/feeds/news.atom">Daniel Bünzli</a></li><li><a href="http://blog.dbpatterson.com/rss">Daniel Patterson</a></li><li><a href="http://nleyten.com/atom.aspx">Dario Teixeira</a></li><li><a href="http://www.blogger.com/feeds/17133288/posts/default/-/ocaml">David Baelde</a></li><li><a href="http://bentobako.org/david/blog/index.php?feed/tag/ocaml/atom">David Mentré</a></li><li><a href="http://dutherenverseauborddelatable.wordpress.com/category/ocaml/feed/">David Teller</a></li><li><a href="http://www.examachine.net/blog/cat/ocaml/feed/">Eray Özkural</a></li><li><a href="http://www.mega-nerd.com/erikd/Blog/CodeHacking/Ocaml/index.rss20">Erik de Castro Lopo</a></li><li><a href="http://blog.emillon.org/feeds/ocaml.xml">Etienne Millon</a></li><li><a href="http://www.mega-nerd.com/erikd/Blog/FP-Syd/index.rss20">FP-Sydney</a></li><li><a href="http://www.blogger.com/feeds/8964007124326996693/posts/default/-/ocaml">Fayssal Martani</a></li><li><a href="http://frama-c.com/rss.xml">Frama-C</a></li><li><a href="http://functionaljobs.com/jobs/search/?q=ocaml&format=rss">Functional Jobs</a></li><li><a href="http://gallium.inria.fr/blog/index.rss">GaGallium</a></li><li><a href="http://gaiustech.wordpress.com/category/ocaml/feed/">Gaius Hammond</a></li><li><a href="http://blog.camlcity.org/blog/rss">Gerd Stolpmann</a></li><li><a href="http://www.wisdomandwonder.com/tag/OCaml/feed">Grant Rettke</a></li><li><a href="http://hongboz.wordpress.com/feed/">Hong bo Zhang</a></li><li><a href="http://blog.incubaid.com/tag/ocaml/feed/">Incubaid Research</a></li><li><a href="http://ambassadortothecomputers.blogspot.com/feeds/posts/default?alt=rss">Jake Donham</a></li><li><a href="http://scattered-thoughts.net/rss?tag=ocaml">Jamie Brandon</a></li><li><a href="http://ocaml.janestcapital.com/?q=rss.xml">Jane Street</a></li><li><a href="http://lpw25.net/rss.xml">Leo White</a></li><li><a href="http://www.lexifi.com/blogs/ocaml/feed">LexiFi</a></li><li><a href="http://savonet.sourceforge.net/liquidsoap.rss">Liquidsoap</a></li><li><a href="http://syntaxexclamation.wordpress.com/tag/ocaml/feed/">Matthias Puech</a></li><li><a href="http://www.blogger.com/feeds/5888658295182480819/posts/default">Matías Giovannini</a></li><li><a href="http://eigenclass.org/R2/feeds/rss2/all">Mauricio Fernandez</a></li><li><a href="http://www.elehack.net/michael/blog/tags/ocaml?format=rss">Michael Ekstrand</a></li><li><a href="http://www.rktmb.org:82/feed/category/work/ocaml/atom">Mihamina Rakotomandimby</a></li><li><a href="http://mcclurmc.wordpress.com/feed/">Mike McClurg</a></li><li><a href="http://nyc-ocaml.posterous.com/rss.xml">NYC OCaml</a></li><li><a href="http://ocamlhackers.ning.com/profiles/blog/feed?tag=ocaml&xn_auth=no">OCaml Hackers</a></li><li><a href="http://forge.ocamlcore.org/export/rss_sfnews.php">OCamlCore Forge News</a></li><li><a href="http://forge.ocamlcore.org/export/rss_sfprojects.php">OCamlCore Forge Projects</a></li><li><a href="http://www.ocamlcore.com/wp/?feed=rss2&amp;language=en&#038;language=en">OCamlCore.com</a></li><li><a href="http://www.ocamlpro.com/feed/atom.xml">OCamlPro</a></li><li><a href="http://odns.tuxfamily.org/feed/">ODNS project</a></li><li><a href="http://ox.tuxfamily.org/feed/">Ocaml XMPP project</a></li><li><a href="http://ocsigen.org/news.atom">Ocsigen project</a></li><li><a href="http://www.blogger.com/feeds/2073503406800427577/posts/default">Opa</a></li><li><a href="http://www.openmirage.org/blog/atom.xml">Open Mirage</a></li><li><a href="http://functional-orbitz.blogspot.com/feeds/posts/default/-/planetocaml?alt=rss">Orbitz</a></li><li><a href="http://www.donadeo.net/facets/programming-languages/objective-caml/feed/">Paolo Donadeo</a></li><li><a href="https://mancoosi.org/~abate/taxonomy/term/5/0/feed">Pietro Abate</a></li><li><a href="http://redlizards.com/blog/feed/?tag=ocaml">Red Lizard Software</a></li><li><a href="http://rwmj.wordpress.com/tag/ocaml/feed/">Richard Jones</a></li><li><a href="http://blog.rastageeks.org/spip.php?page=rss&id_mot=2">Romain Beauxis</a></li><li><a href="http://seb.mondet.org/blog/feed/ocaml.rss">Sebastien Mondet</a></li><li><a href="http://upsilon.cc/~zack/tags/ocaml/index.rss">Stefano Zacchiroli</a></li><li><a href="http://le-gall.net/sylvain+violaine/blog/index.php?feed/tag/ocaml/atom">Sylvain Le Gall</a></li><li><a href="http://caml.inria.fr/hump.rss">The Caml Humps</a></li><li><a href="http://www.blogger.com/feeds/6115529230232389198/posts/default">Till Varoquaux</a></li><li><a href="http://www.nicollet.net/toroidal/ocaml/feed/">Victor Nicollet</a></li><li><a href="http://y-node.com/blog/feeds/tag/ocaml/">y-node</a></li></ul>

      <a href="http://planet.ocaml.org/rss20.xml"><img src=".././img/rss20.png"/></a>
      <a href="http://planet.ocaml.org/opml.xml"><img src=".././img/opml.png"/></a>
    </div>
    <div class="planet"><a name="13687fd2f726142a177153db4ec36e32"></a><span class="rss-header"><span class="rss-title"><a href="http://alan.petitepomme.net/cwn/2013.02.19.html"> Caml Weekly News, 19 Feb 2013</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Caml Weekly News</span>, <span class="rss-date">19 Feb 2013</span></span><span class="rss-description">ocp-indent 1.0.0 release / Old and new OCaml installed on same machine? / Sequence 0.3.1 / Other Caml News</span>
<a name="557480a976edc0ddba3ac135b12b965d"></a><span class="rss-header"><span class="rss-title"><a href="http://www.ocamlpro.com/blog/2013/02/18/monthly-01-02.html"> An Overview of our Current Activities</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author"><span id="ocaml_1">OCamlPro &#9001;thomas<abbr title="(at) &rarr; @">(at)</abbr>ocamlpro.com (Thomas Gazagnaire)&#9002;</span><script type="text/javascript"><!--;
local = "thomas";
h = "ocamlpro.com (Thomas Gazagnaire)";
document.getElementById("ocaml_1").innerHTML = '<a href="mailto:' + local + '@' + h + "\" >OCamlPro<\/a>";
//--></script></span>, <span class="rss-date">18 Feb 2013</span></span><span class="rss-description"><div id="post1"><p>From the early days of OCamlPro, people have been curious about our plans; they were asking how we worked at OCamlPro and what we were doing exactly. Now that we have started releasing projects more regularly, these questions come again. They are very reasonable questions, and have resolved to be more public and communicate more regularly. This post covers our activities from the beginning of 2013 and updates are scheduled on a monthly basis.</p><h2>OCamlPro ?</h2><p>OCamlPro has been created to promote the use of OCaml in the industry. In order to do so, we provide a wide range of services targeted at all stages of typical software projects: we train engineers and we improve the efficiency and usability of the OCaml compiler and tools, we help design new projects, advise on which open-source software components to use and how, we help deliver OCaml software projects and we do custom software development. One extra focus is the increase of the accessibility of OCaml for beginners and students.</p><a onclick="switchContent('post1','post2')" class="btn" href="#557480a976edc0ddba3ac135b12b965d">Read more...</a></div><div id="post2" style="display: none"><p>From the early days of OCamlPro, people have been curious about our plans; they were asking how we worked at OCamlPro and what we were doing exactly. Now that we have started releasing projects more regularly, these questions come again. They are very reasonable questions, and have resolved to be more public and communicate more regularly. This post covers our activities from the beginning of 2013 and updates are scheduled on a monthly basis.</p><h2>OCamlPro ?</h2><p>OCamlPro has been created to promote the use of OCaml in the industry. In order to do so, we provide a wide range of services targeted at all stages of typical software projects: we train engineers and we improve the efficiency and usability of the OCaml compiler and tools, we help design new projects, advise on which open-source software components to use and how, we help deliver OCaml software projects and we do custom software development. One extra focus is the increase of the accessibility of OCaml for beginners and students.</p><p>Our customers are well-known industrial users such as <a href="http://www.janestreet.com/">Jane-Street</a>, <a href="http://www.citrix.com/">Citrix</a> and <a href="http://www.lexifi.com/">Lexifi</a> but we also help individual developers lost in the wild of non-OCaml environments inter-operate OCaml with other components. We also believe that collaborative R&amp;D projects are a great opportunity to make existing companies discover OCaml and its benefits to their products and we are involved in several of them (see below).</p><p>Our engineering team is steadily growing (currently 9 full-time engineers in a joint lab between OCamlPro and INRIA) located in Paris and Nice. We gather a wide range of technical skills and industrial world expertise as we are all coming from major academic and industrial actors such as <a href="http://www.inria.fr/">INRIA</a>, <a href="http://www.3ds.com/">Dassaut Systèmes</a>, <a href="http://www.mlstate.com/">MLstate</a> and <a href="http://www.citrix.com/">Citrix</a>. We also love the OCaml open-source ecosystem: we have been participating to the development of <a href="http://ocsigen.org/">ocsigen</a>, <a href="http://www.openmirage.org/">mirage</a>, <a href="http://www.xen.org/products/cloudxen.html">XCP</a>, <a href="http://mldonkey.sourceforge.net/">mldonkey</a>, <a href="http://www.marionnet.org/EN/">marionet</a> and so on. By the way, OCamlPro has some open <a href="http://www.ocamlpro.com/company/jobs.html">positions</a> and we are still looking to hire excellent software engineers!</p><h2>OCaml Distribution</h2><p>The first of our technical activities is related to work on the OCaml distribution itself. We are part of the OCaml compiler development team -- our INRIA members are part of the <a href="http://gallium.inria.fr/">Gallium</a> project which develops OCaml at INRIA -- and we regularly contribute patches to improve the usability and performance of the compiler itself.</p><p>We have recently proposed <a href="http://caml.inria.fr/mantis/view.php?id=5894">a series of patches</a> to improve the performance of functions with float arguments and we have started developing a <a href="https://github.com/chambart/ocp-bench">framework</a> to benchmark the efficiency of compiler optimizations.</p><p>We are also actively exploring the design-space for concurrency and distribution in OCaml, with an implementation of (i) a reentrant runtime; (ii) a way to instantiate different runtimes in separate system threads in the same process, and (iii) an efficient multi-scale communication library, between threads and between processes. We call this <b>multi-runtime OCaml</b> and a prototype is available on <a href="https://github.com/lucasaiu/ocaml/tree/master">github</a>.</p><p>Last, we are also making progress with the memory profiling tools. We work on a modified OCaml runtime which can store the location of each allocated block in the heap, with hooks to dump that heap on demand. External tools can then use that dump to produce useful statistics about memory usage of the program. The good news is that we now have a working and usable bytecode runtime and an external tool that produces basic memory information. We are preparing an alpha release in the next month, so stay tuned!</p><h2>Development Tools</h2><p>Our efforts to make OCaml more usable go further than looking at the compiler. We are improving the development tools already existing in the community, such as the recently released <a href="https://github.com/OCamlPro/ocp-indent">indentation tool</a> which was initially coming from an experiment from <a href="https://bitbucket.org/camlspotter/ocaml-indent">Jun Furuse</a>, and creating new ones when the lack is blatant.</p><p>Most recent news on that front concern <a href="http://opam.ocamlpro.com/">OPAM</a>, the package manager for OCaml that we are developing since mid-2012. For people not familiar with it yet, OPAM is a source-based package manager for OCaml. It supports resolution of complex dependency constraints between packages, multiple simultaneous compiler installations, flexible package constraints, and a Git-friendly development workflow. The beta release was announced in January, and we expect the first official release to happen in the next weeks. The OCaml community has gratefully welcomed OPAM, and the <a href="https://github.com/OCamlPro/opam-repository">repository of its package metadata</a> has already become the most forked OCaml project on github! Interestingly, two meetups have gathered more than fifty OPAM users in <a href="http://meetup.ocaml-lang.fr/">Paris</a> and Cambridge in January. We really hope this kind of meetup can be generalized: if you want to help us organize one in your area, feel free to contact us!</p><p>The other major part of our work around development tools for OCaml is TypeRex. TypeRex is a collection of tools which focus on improving developer efficiency, and lowering the entry barrier for experienced developers who are used to shiny IDEs in other languages. The first version of <a href="http://www.typerex.org/">TypeRex</a>, that was released last year, was a first step in this direction: it provided an enhanced emacs mode for OCaml code, with colorization, indentation, refactoring facilities, completion, code-navigation, documentation tooltips, etc. The next version of TypeRex (simply dubbed <b>typerex2</b>) is underway, with more independent tools (like ocp-indent), less tightly coupled to Emacs, and focused on better integration with various IDEs. If you are interested in following the progress of these tools, you can check the <b>typerex2</b> OPAM packages with 1.99.X+beta version numbers, which we release on a regular basis.</p><h2>R&amp;D projects</h2><p>The idea that OCaml is the right choice to create new innovative products is at the core of OCamlPro. We are very involved in the research community, especially on Functional Languages, with participation into the Program Committees of various conferences such as <a href="http://oud.ocaml.org/">the OCaml User and Developer (OUD)</a> workshop and <a href="http://cufp.org/">the Commercial User of Functional Programming (CUFP)</a> conference. We also joined two collaborative R&amp;D projects in 2012, the <a href="http://www.richelieu.pro/">Richelieu FUI</a> and <a href="http://bware.lri.fr/index.php/BWare_project">BWare ANR</a>. As part of the Richelieu project, we are developing a JIT compiler for the <a href="http://www.scilab.org/">Scilab language</a>. As part of the Bware project, we improve the efficiency of automatic theorem provers, with a specific focus on <a href="http://alt-ergo.lri.fr/">Alt-Ergo</a>, an SMT solver particularly suited to program verification. We are always interested in bringing our expertise in compiler technologies and knowledge of complex and distributed systems to new R&amp;D projects: contact us if you are interested!</p><p>In the Richelieu project, our combined technical and theoretical expertise proved particularly effective. The research consortium is led by <a href="http://www.scilab-enterprises.com/">Scilab Entreprises</a> which needed a safer and more efficient execution engine for Scilab in order to compete with Matlab. We joined the consortium to implement the early analysis required by the JIT compiler. The project started last December, and we have since specified the semantics of the language and implemented a working prototype of an interpreter that is already as fast as the current C++ engine of Scilab 6.</p><h2>Growing the Community</h2><p>Our last important domain of activity is geared towards the OCaml community. It is important to us that the community grows bigger, and to achieve this goal there are some basic blocks that we need to help build, together with the other main actors of the community.</p><p>The first missing block is a good reference documentation. This year will end with (at least) one new important book for the language: <a href="http://www.realworldocaml.org/">Real-World OCaml</a> which targets experienced software engineers who do not know OCaml yet. We collaborate with <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/">OCamlLabs</a> to make the technical experience of this book a success. We also work to improve the general experience of using OCaml for complete beginners by creating a stable <a href="https://github.com/OCamlPro/ocp-edit-simple">replacement</a> to the broken <b>ocamlwin</b>, the simple editor distributed with OCaml on Windows.</p><p>It is also important to us that OCaml uses the web as a platform to attract new users, as is becoming the norm for modern programming languages. We are members of the <a href="http://www.ocaml.org/">ocaml.org</a> building effort and have created <a href="http://try.ocamlpro.com/">tryocaml</a> to let newcomers easily discover the language directly from their browser. TryOcaml has been welcomed as a great tool, already adopted and adapted: see for instance <a href="http://rtt.forge.ocamlcore.org/tryrtt.html">tryrtt</a> or <a href="http://rml.lri.fr/tryrml/">try ReactiveML</a>. We are in the process of simplifying the integration with other compiler variants.</p><p>Last, but not least, we collaborate very closely with OCamlLabs to create the OCaml Plateform: a consistent set of libraries, thoroughly tested and integrated, with a rolling release schedule of 6 months. The platform will be based on <a href="http://opam.ocamlpro.com/">OPAM</a> and we are currently designing and prototyping a testing infrastructure to improve and guarantee the quality of packages.</p><a onclick="switchContent('post2','post1')" class="btn" href="#557480a976edc0ddba3ac135b12b965d">Hide</a></div></span>
<a name="95c68fb5b27ea5ca29bbb054741328e7"></a><span class="rss-header"><span class="rss-title"><a href="http://erratique.ch/software/four"> Four</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Daniel Bünzli</span>, <span class="rss-date">14 Feb 2013</span></span><span class="rss-description"><a href="http://gaspardbuma.org/en">Gaspard Buma</a>'s show <em>Boats to nowhere</em> is now playing at the <a href="http://www.arsenic.ch">Arsenic</a>. I helped with the show's visuals and along the way prototyped <a href="http://erratique.ch/software/four">Four</a> a lightweight modern OpenGL rendering engine for Lua.</span>
<a name="e56033b085d70d0747d47e6fe495078d"></a><span class="rss-header"><span class="rss-title"><a href="http://blog.opalang.org/2013/02/some-great-news-on-opa.html"> Some great news on Opa</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author"><span id="ocaml_2">Opa &#9001;noreply<abbr title="(at) &rarr; @">(at)</abbr>blogger.com (HB)&#9002;</span><script type="text/javascript"><!--;
local = "noreply";
h = "blogger.com (HB)";
document.getElementById("ocaml_2").innerHTML = '<a href="mailto:' + local + '@' + h + "\" >Opa<\/a>";
//--></script></span>, <span class="rss-date">12 Feb 2013</span></span><span class="rss-description"><div id="post3"><p>It's been a while since our last post. Like many others, we mainly rely on Twitter to spread the news on Opa.</p><p>This very short post is just an exciting summary on new things that happened in the last couple of months.</p><h1 id="release-of-opa-1.1.0">Release of Opa 1.1.0</h1><p>We released Opa 1.1.0 which as always brings bugfixes, performance enhancement and new feature.</p><p>With Opa 1.1.0, you now can include JavaScript code and Node.js packages easier than ever! We will write about it soon.</p><p>Sadly, we were hit by GitHub decision to halt its download feature. We relied on this and even built a service (in Opa!) that automatically pushed packages. We are still looking at nice hosting alternatives, as the GitHub files should disappear soon.</p><p>From this release, we also support a 32-bit Windows package.</p><h1 id="ongoing-support-of-postgres">Ongoing support of Postgres</h1><p>For a important project that is being built with Opa, we are adding Postgres support.</p><p>Switching your Opa code from MongoDB to Postgres requires almost no code change, and again we will write about it soon.</p><a onclick="switchContent('post3','post4')" class="btn" href="#e56033b085d70d0747d47e6fe495078d">Read more...</a></div><div id="post4" style="display: none"><p>It's been a while since our last post. Like many others, we mainly rely on Twitter to spread the news on Opa.</p><p>This very short post is just an exciting summary on new things that happened in the last couple of months.</p><h1 id="release-of-opa-1.1.0">Release of Opa 1.1.0</h1><p>We released Opa 1.1.0 which as always brings bugfixes, performance enhancement and new feature.</p><p>With Opa 1.1.0, you now can include JavaScript code and Node.js packages easier than ever! We will write about it soon.</p><p>Sadly, we were hit by GitHub decision to halt its download feature. We relied on this and even built a service (in Opa!) that automatically pushed packages. We are still looking at nice hosting alternatives, as the GitHub files should disappear soon.</p><p>From this release, we also support a 32-bit Windows package.</p><h1 id="ongoing-support-of-postgres">Ongoing support of Postgres</h1><p>For a important project that is being built with Opa, we are adding Postgres support.</p><p>Switching your Opa code from MongoDB to Postgres requires almost no code change, and again we will write about it soon.</p><h1 id="big-project-in-opa">Big project in Opa</h1><p>As mentioned earlier, we are working on a pretty big project implemented with Opa. Stay tuned!</p><a onclick="switchContent('post4','post3')" class="btn" href="#e56033b085d70d0747d47e6fe495078d">Hide</a></div></span>
<a name="4b7db653fbf5071a25953fe10c60f802"></a><span class="rss-header"><span class="rss-title"><a href="http://caml.inria.fr/cgi-bin/hump.cgi?contrib=846"> Reactive ML 1.08.04</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">The Caml Humps</span>, <span class="rss-date">12 Feb 2013</span></span><span class="rss-description">ReactiveML is a programming language dedicated to the implementation of interactive systems as found in graphical user interfaces, video games or simulation problems. ReactiveML is based on the synchronous reactive model of Boussinot embedded in an ML language (here OCaml).
The synchronous reactive model provides synchronous parallel composition and dynamic features like the dynamic creation of processes. In ReactiveML, the reactive model is integrated at the language level (not as a library) which leads to safer and more natural programming.</span>
<a name="da82f0e63b34e3440f7373de319ca75f"></a><span class="rss-header"><span class="rss-title"><a href="http://alan.petitepomme.net/cwn/2013.02.12.html"> Caml Weekly News, 12 Feb 2013</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Caml Weekly News</span>, <span class="rss-date">12 Feb 2013</span></span><span class="rss-description">OCaml Platform - Mailing List / Memoize GADT / ocp-indent beta release / Core Suite 109.08.00 released / OCaml Labs Monthly Update / OMonad 0.2 / OCaml tests on Travis CI / geany as an ocaml ide / ReactiveML 1.08.04 / Other Caml News</span>
<a name="9bfd41186a5d09dbb247bf59b25a3541"></a><span class="rss-header"><span class="rss-title"><a href="http://caml.inria.fr/cgi-bin/hump.cgi?contrib=845"> Pprint</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">The Caml Humps</span>, <span class="rss-date">11 Feb 2013</span></span><span class="rss-description">This is an adaptation of Daan Leijen's "PPrint" library,
  which itself is based on the ideas developed by Philip
  Wadler in "A Prettier Printer".</span>
<a name="f7bed3401cb8fa5fe0de4eaa50b3c8fb"></a><span class="rss-header"><span class="rss-title"><a href="http://gallium.inria.fr/blog/first-release-of-pprint"> First release of PPrint</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">GaGallium</span>, <span class="rss-date">08 Feb 2013</span></span><span class="rss-description"><div id="post5"><p>I am pleased to announce the first official release of <em><strong>PPrint</strong></em>, an OCaml library for pretty-printing textual documents.</p>




<h4 id="a-taste-of-the-layout-language">A taste of the layout language</h4>
<p>At the heart of <em><strong>PPrint</strong></em> is a little domain-specific language of documents. This language has a well-defined semantics, which the printing engine implements. This language rests upon a small number of fundamental concepts.</p>
<p>There are combinators for creating atomic documents. For instance,</p>
<pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="dt">string</span> <span class="st">"hello"</span></code></pre>
<p>is a simple, unbreakable document.</p>
<p>There is also a concatenation operator, which joins two documents. For instance,</p>
<pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="dt">string</span> <span class="st">"hello"</span> ^^ <span class="dt">string</span> <span class="st">"world"</span></code></pre>
<p>is a composite document. It is in fact equivalent to <code>string "helloworld"</code>.</p>
<p>So far, nothing very exciting. The next two combinators are more original and interesting.</p>
<p>The first of these combinators, <code>break 1</code>, is a breakable space. If printed in flat mode, it produces an ordinary space character; if printed in normal mode, it produces a newline character.</p>
<a onclick="switchContent('post5','post6')" class="btn" href="#f7bed3401cb8fa5fe0de4eaa50b3c8fb">Read more...</a></div><div id="post6" style="display: none"><p>I am pleased to announce the first official release of <em><strong>PPrint</strong></em>, an OCaml library for pretty-printing textual documents.</p>




<h4 id="a-taste-of-the-layout-language">A taste of the layout language</h4>
<p>At the heart of <em><strong>PPrint</strong></em> is a little domain-specific language of documents. This language has a well-defined semantics, which the printing engine implements. This language rests upon a small number of fundamental concepts.</p>
<p>There are combinators for creating atomic documents. For instance,</p>
<pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="dt">string</span> <span class="st">"hello"</span></code></pre>
<p>is a simple, unbreakable document.</p>
<p>There is also a concatenation operator, which joins two documents. For instance,</p>
<pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="dt">string</span> <span class="st">"hello"</span> ^^ <span class="dt">string</span> <span class="st">"world"</span></code></pre>
<p>is a composite document. It is in fact equivalent to <code>string "helloworld"</code>.</p>
<p>So far, nothing very exciting. The next two combinators are more original and interesting.</p>
<p>The first of these combinators, <code>break 1</code>, is a breakable space. If printed in flat mode, it produces an ordinary space character; if printed in normal mode, it produces a newline character.</p>
<p>Yes, there are two printing modes, namely flat mode and normal mode. The printing engine goes back and forth between these two modes. Exactly where and how the engine switches from one mode to the other is controlled by the next combinator.</p>
<p>The second of these combinators, <code>group</code>, introduces a choice between flat mode and normal mode. It is a document transformer: if <code>d</code> is a document, then <code>group d</code> is a document. When the printing engine encounters <code>group d</code>, two possibilities arise. The first possibility is to print all of <code>d</code> on a single line. This is known as flat mode. The engine tries this first (ignoring any <code>group</code> combinators inside <code>d</code>). If it succeeds, great. If it fails, by lack of space on the current line, then the engine backtracks and reverts to the second possibility, which is to simply ignore the <code>group</code> combinator, and just print <code>d</code>. This has subtle consequences: there might be further groups inside <code>d</code>, and each of these groups will give rise to further choices.</p>
<p>This gives rise to an interesting language, where <code>group</code> is used to indicate a choice point, and the appearance of <code>break</code> is dependent upon the choice point(s) that appear higher up in the hierarchical structure of the document. For instance, the document:</p>
<pre class="sourceCode ocaml"><code class="sourceCode ocaml">group (<span class="dt">string</span> <span class="st">"This"</span> ^^ break 1 ^^ <span class="dt">string</span> <span class="st">"is"</span> ^^ break 1 ^^ <span class="dt">string</span> <span class="st">"pretty."</span>)</code></pre>
<p>will be printed either on a single line, if it fits, or on three lines. It will not be printed on two lines: there is just one choice point, so either the two breakable spaces will be broken, or none of them will. By the way, this document can be abbreviated as follows:</p>
<pre class="sourceCode ocaml"><code class="sourceCode ocaml">group (<span class="dt">string</span> <span class="st">"This"</span> ^/^ <span class="dt">string</span> <span class="st">"is"</span> ^/^ <span class="dt">string</span> <span class="st">"pretty."</span>)</code></pre>
<p>On the other hand, the document:</p>
<pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="dt">string</span> <span class="st">"This"</span> ^^
group (break 1 ^^ <span class="dt">string</span> <span class="st">"is"</span>) ^^
group (break 1 ^^ <span class="dt">string</span> <span class="st">"pretty."</span>)</code></pre>
<p>could be printed on one, two, or three lines. There are two choice points, each of which influences one of the two breakable spaces. The two choices are independent of one another. Each of the words in the sentence <code>This is pretty.</code> will be printed on the current line if it fits, and on a new line otherwise. By the way, this document can be abbreviated as follows:</p>
<pre class="sourceCode ocaml"><code class="sourceCode ocaml">flow 1 [
  <span class="dt">string</span> <span class="st">"This"</span> ;
  <span class="dt">string</span> <span class="st">"is"</span> ;
  <span class="dt">string</span> <span class="st">"pretty."</span>
]</code></pre>
<p>There are more combinators, such as <code>nest</code>, which controls indentation, and it is relatively easy to roll your own combinators on top of those that are provided.</p>
<p>One limitation of the library is that the document must be entirely built in memory before it is printed. So far, we have used the library in small- to medium-scale applications, and this has not been a problem. In principle, one could work around this limitation by adding a new document constructor whose argument is a suspended document computation.</p>
<h4 id="acknowledgements">Acknowledgements</h4>
<p>The document language and the printing engine are inspired by Daan Leijen's <a href="http://www.cs.uu.nl/~daan/pprint.html">PPrint</a> library, which itself is based on the ideas developed by Philip Wadler in the paper <a href="http://homepages.inf.ed.ac.uk/wadler/papers/prettier/prettier.pdf">A Prettier Printer</a>.</p>
<p><em><strong>PPrint</strong></em> was written by François Pottier and Nicolas Pouillard, with contributions by Yann Régis-Gianas, Gabriel Scherer, and Jonathan Protzenko.</p>
<h4 id="installation">Installation</h4>
<p>The library is available online (<a href="http://gallium.inria.fr/~fpottier/pprint/pprint.tar.gz">source code</a>, <a href="http://gallium.inria.fr/~fpottier/pprint/doc/">documentation</a>), and can also be installed via OPAM: just type <code>opam install pprint</code> if you already have a working OPAM installation.</p>
<p>Have fun! Feel free to make comments, suggestions, and to let me know if and how you are using this library.</p>
<h4 id="a-final-example">A Final Example</h4>
<p>For a larger example, here is the code of the file <code>PPrintTest.ml</code> included in the distribution (with the maximum line width adapted for this blog post):</p>
<pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="ot">open</span> PPrint

<span class="kw">let</span> document =
  prefix 2 1
    (<span class="dt">string</span> <span class="st">"TITLE:"</span>)
    (<span class="dt">string</span> <span class="st">"PPrint"</span>)
  ^^
  hardline
  ^^
  prefix 2 1
    (<span class="dt">string</span> <span class="st">"AUTHORS:"</span>)
    (utf8string <span class="st">"François Pottier and Nicolas Pouillard"</span>)
  ^^
  hardline
  ^^
  prefix 2 1
    (<span class="dt">string</span> <span class="st">"ABSTRACT:"</span>)
    (
      flow 1 (words
        <span class="st">"This is an adaptation of Daan Leijen's </span><span class="ch">\"</span><span class="st">PPrint</span><span class="ch">\"</span>
<span class="st">        library, which itself is based on the ideas developed</span>
<span class="st">        by Philip Wadler in </span><span class="ch">\"</span><span class="st">A Prettier Printer</span><span class="ch">\"</span><span class="st">. For more</span>
<span class="st">        information about Wadler's and Leijen's work,</span>
<span class="st">        please consult the following references:"</span>)
      ^^
      nest 2 (
        twice (break 1)
        ^^
        separate_map (break 1) (<span class="kw">fun</span> s -&gt; nest 2 (url s)) [
          <span class="st">"http://www.cs.uu.nl/~daan/pprint.html"</span>;
          <span class="st">"http://homepages.inf.ed.ac.uk/wadler/papers/prettier/prettier.pdf"</span>;
        ]
      )
      ^^
      twice (break 1)
      ^^
      flow 1 (words
        <span class="st">"To install PPrint, type </span><span class="ch">\"</span><span class="st">make -C src install</span><span class="ch">\"</span><span class="st">.</span>
<span class="st">         ocamlfind is required."</span>)
      ^^
      twice (break 1)
      ^^
      flow 1 (words
        <span class="st">"The documentation for PPrint is built by </span><span class="ch">\"</span><span class="st">make doc</span><span class="ch">\"</span>
<span class="st">         and is found in the file doc/index.html."</span>)
    )
  ^^
  hardline

<span class="kw">let</span> () =
  ToChannel<span class="kw">.</span>pretty 1. 60 stdout document;
  flush stdout</code></pre>
<p>It produces the following output:</p>
<pre><code>TITLE: PPrint
AUTHORS: François Pottier and Nicolas Pouillard
ABSTRACT:
  This is an adaptation of Daan Leijen's "PPrint" library,
  which itself is based on the ideas developed by Philip
  Wadler in "A Prettier Printer". For more information about
  Wadler's and Leijen's work, please consult the following
  references:
    
    http://www.cs.uu.nl/~daan/pprint.html
    http://homepages.inf.ed.ac.uk/wadler/papers/prettier/
      prettier.pdf
  
  To install PPrint, type "make -C src install". ocamlfind
  is required.
  
  The documentation for PPrint is built by "make doc" and is
  found in the file doc/index.html.</code></pre><a onclick="switchContent('post6','post5')" class="btn" href="#f7bed3401cb8fa5fe0de4eaa50b3c8fb">Hide</a></div></span>
<a name="6cdb7a70631b8b103948bf9782f47600"></a><span class="rss-header"><span class="rss-title"><a href="http://functional-orbitz.blogspot.com/2013/02/ann-ocaml-vclock-000.html"> [ANN] ocaml-vclock - 0.0.0</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author"><span id="ocaml_3">Orbitz &#9001;noreply<abbr title="(at) &rarr; @">(at)</abbr>blogger.com (orbitz)&#9002;</span><script type="text/javascript"><!--;
local = "noreply";
h = "blogger.com (orbitz)";
document.getElementById("ocaml_3").innerHTML = '<a href="mailto:' + local + '@' + h + "\" >Orbitz<\/a>";
//--></script></span>, <span class="rss-date">07 Feb 2013</span></span><span class="rss-description"><p>I ported some Erlang vector clock code to Ocaml for fun and learning.  It's not well tested and it hasn't any performance optimizations.  I'm not ready yet but I have some projects in mind to use it so it will likely get fleshed out more. </p> <p>Vector clocks are a system for determining the partial ordering of events in a distributed environment.  You can determine if one value is the ancestor of another, equal, or was concurrently updated.  It is one mechanism that distributed databases, such as Riak, use to automatically resolve some conflicts in data while maintaining availability. </p> <p>The vector clock implementation allows for user defined site id type.  It also allows metadata to be encoded in the site id, which is useful if you want your vector clock to be prunable by encoding timestamps in it. </p> <p>The repo can be found <a href="https://github.com/orbitz/ocaml-vclock/tree/0.0.0">here</a>.  If you'd like to learn more about vector clocks read the wikipedia page <a href="http://en.wikipedia.org/wiki/Vector_clock">here</a>.  The Riak website also has some content on vector clocks <a href="http://docs.basho.com/riak/latest/references/appendices/concepts/Vector-Clocks/">here</a>. </p></span>
<a name="e019222843fac682c9f57ee0f6d1fe6a"></a><span class="rss-header"><span class="rss-title"><a href="http://rwmj.wordpress.com/2013/02/07/more-static-analysis-with-cil/"> More static analysis with CIL</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Richard Jones</span>, <span class="rss-date">07 Feb 2013</span></span><span class="rss-description"><div id="post7"><p>Years ago I <a href="http://people.redhat.com/~rjones/cil-analysis-of-libvirt/">played around</a> with <a href="http://www.cs.berkeley.edu/~necula/cil/">CIL</a> to analyze <a href="http://libvirt.org">libvirt</a>.  More recently <a href="https://rwmj.wordpress.com/2009/05/15/dan-uses-ocaml-cil-to-analyze-libvirts-locking-patterns/">Dan used CIL to analyze libvirt’s locking code</a>.</p>
<p>We didn’t get so far either time, but I’ve been taking a deeper look at CIL in an attempt to verify error handling in <a href="http://libguestfs.org/">libguestfs</a>.</p>
<p>Here is my partly working code so far.</p>
<pre><tt><i></i></tt></pre><font color="#9A1900">(*</font>
<i><font color="#9A1900"> * Analyse libguestfs APIs to find error overwriting.</font></i>
<i><font color="#9A1900"> * Copyright (C) 2008-2013 Red Hat, Inc.</font></i>
<i><font color="#9A1900"> *</font></i>
<i><font color="#9A1900"> * This library is free software; you can redistribute it and/or</font></i>
<i><font color="#9A1900"> * modify it under the terms of the GNU Lesser General Public</font></i>
<i><font color="#9A1900"> * License as published by the Free Software Foundation; either</font></i>
<i><font color="#9A1900"> * version 2.1 of the License, or (at your option) any later version.</font></i>
<i><font color="#9A1900"> *</font></i>
<i><font color="#9A1900"> * This library is distributed in the hope that it will be useful,</font></i>
<i><font color="#9A1900"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</font></i>
<i><font color="#9A1900"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font></i>
<i><font color="#9A1900"> * Lesser General Public License for more details.</font></i>
<i><font color="#9A1900"> *</font></i>
<i><font color="#9A1900"> * You should have received a copy of the GNU Lesser General Public</font></i>
<a onclick="switchContent('post7','post8')" class="btn" href="#e019222843fac682c9f57ee0f6d1fe6a">Read more...</a></div><div id="post8" style="display: none"><p>Years ago I <a href="http://people.redhat.com/~rjones/cil-analysis-of-libvirt/">played around</a> with <a href="http://www.cs.berkeley.edu/~necula/cil/">CIL</a> to analyze <a href="http://libvirt.org">libvirt</a>.  More recently <a href="https://rwmj.wordpress.com/2009/05/15/dan-uses-ocaml-cil-to-analyze-libvirts-locking-patterns/">Dan used CIL to analyze libvirt’s locking code</a>.</p>
<p>We didn’t get so far either time, but I’ve been taking a deeper look at CIL in an attempt to verify error handling in <a href="http://libguestfs.org/">libguestfs</a>.</p>
<p>Here is my partly working code so far.</p>
<pre><tt><i></i></tt></pre><font color="#9A1900">(*</font>
<i><font color="#9A1900"> * Analyse libguestfs APIs to find error overwriting.</font></i>
<i><font color="#9A1900"> * Copyright (C) 2008-2013 Red Hat, Inc.</font></i>
<i><font color="#9A1900"> *</font></i>
<i><font color="#9A1900"> * This library is free software; you can redistribute it and/or</font></i>
<i><font color="#9A1900"> * modify it under the terms of the GNU Lesser General Public</font></i>
<i><font color="#9A1900"> * License as published by the Free Software Foundation; either</font></i>
<i><font color="#9A1900"> * version 2.1 of the License, or (at your option) any later version.</font></i>
<i><font color="#9A1900"> *</font></i>
<i><font color="#9A1900"> * This library is distributed in the hope that it will be useful,</font></i>
<i><font color="#9A1900"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</font></i>
<i><font color="#9A1900"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font></i>
<i><font color="#9A1900"> * Lesser General Public License for more details.</font></i>
<i><font color="#9A1900"> *</font></i>
<i><font color="#9A1900"> * You should have received a copy of the GNU Lesser General Public</font></i>
<i><font color="#9A1900"> * License along with this library.  If not, see</font></i>
<i><font color="#9A1900"> * &lt;http://www.gnu.org/licenses/&gt;.</font></i>
<i><font color="#9A1900"> *</font></i>
<i><font color="#9A1900"> * Author: Daniel P. Berrange &lt;berrange@redhat.com&gt;</font></i>
<i><font color="#9A1900"> * Author: Richard W.M. Jones &lt;rjones@redhat.com&gt;</font></i>
<i><font color="#9A1900"> *)</font></i>

<b><font color="#000080">open</font></b> <font color="#009900">Unix</font>
<b><font color="#000080">open</font></b> <font color="#009900">Printf</font>

<b><font color="#000080">open</font></b> <font color="#009900">Cil</font>

<b><font color="#0000FF">let</font></b> debug <font color="#990000">=</font> <font color="#009900">ref</font> <b><font color="#0000FF">false</font></b>

<i><font color="#9A1900">(* Set of ints. *)</font></i>
<b><font color="#0000FF">module</font></b> <font color="#009900">IntSet</font> <font color="#990000">=</font> <b><font color="#000080">Set</font></b><font color="#990000">.</font><font color="#009900">Make</font> <font color="#990000">(</font><b><font color="#0000FF">struct</font></b> <b><font color="#0000FF">type</font></b> t <font color="#990000">=</font> <font color="#009900">int</font> <b><font color="#0000FF">let</font></b> compare <font color="#990000">=</font> compare <b><font color="#0000FF">end</font></b><font color="#990000">)</font>

<i><font color="#9A1900">(* A module for storing any set (unordered list) of functions. *)</font></i>
<b><font color="#0000FF">module</font></b> <font color="#009900">FunctionSet</font> <font color="#990000">=</font> <b><font color="#000080">Set</font></b><font color="#990000">.</font><font color="#009900">Make</font> <font color="#990000">(</font>
  <b><font color="#0000FF">struct</font></b>
    <b><font color="#0000FF">type</font></b> t <font color="#990000">=</font> varinfo
    <b><font color="#0000FF">let</font></b> compare v1 v2 <font color="#990000">=</font> compare v1<font color="#990000">.</font>vid v2<font color="#990000">.</font>vid
  <b><font color="#0000FF">end</font></b>
<font color="#990000">)</font>

<i><font color="#9A1900">(* Directed graph of functions.</font></i>
<i><font color="#9A1900"> *</font></i>
<i><font color="#9A1900"> * Function = a node in the graph</font></i>
<i><font color="#9A1900"> * FunctionDigraph = the directed graph</font></i>
<i><font color="#9A1900"> * FunctionPathChecker = path checker module using Dijkstra's algorithm</font></i>
<i><font color="#9A1900"> *)</font></i>
<b><font color="#0000FF">module</font></b> <font color="#009900">Function</font> <font color="#990000">=</font>
<b><font color="#0000FF">struct</font></b>
  <b><font color="#0000FF">type</font></b> t <font color="#990000">=</font> varinfo
  <b><font color="#0000FF">let</font></b> compare f1 f2 <font color="#990000">=</font> compare f1<font color="#990000">.</font>vid f2<font color="#990000">.</font>vid
  <b><font color="#0000FF">let</font></b> hash f <font color="#990000">=</font> <b><font color="#000080">Hashtbl</font></b><font color="#990000">.</font>hash f<font color="#990000">.</font>vid
  <b><font color="#0000FF">let</font></b> equal f1 f2 <font color="#990000">=</font> f1<font color="#990000">.</font>vid <font color="#990000">=</font> f2<font color="#990000">.</font>vid
<b><font color="#0000FF">end</font></b>
<b><font color="#0000FF">module</font></b> <font color="#009900">FunctionDigraph</font> <font color="#990000">=</font> <b><font color="#000080">Graph</font></b><font color="#990000">.</font><b><font color="#000080">Imperative</font></b><font color="#990000">.</font><b><font color="#000080">Digraph</font></b><font color="#990000">.</font><font color="#009900">Concrete</font> <font color="#990000">(</font><font color="#009900">Function</font><font color="#990000">)</font>
<b><font color="#0000FF">module</font></b> <font color="#009900">FunctionPathChecker</font> <font color="#990000">=</font> <b><font color="#000080">Graph</font></b><font color="#990000">.</font><b><font color="#000080">Path</font></b><font color="#990000">.</font><font color="#009900">Check</font> <font color="#990000">(</font><font color="#009900">FunctionDigraph</font><font color="#990000">)</font>

<i><font color="#9A1900">(* Module used to analyze the paths through each function. *)</font></i>
<b><font color="#0000FF">module</font></b> <font color="#009900">ErrorCounter</font> <font color="#990000">=</font>
<b><font color="#0000FF">struct</font></b>
  <b><font color="#0000FF">let</font></b> name <font color="#990000">=</font> <font color="#FF0000">"ErrorCounter"</font>
  <b><font color="#0000FF">let</font></b> debug <font color="#990000">=</font> debug

  <i><font color="#9A1900">(* Our current state is very simple, just the number of error</font></i>
<i><font color="#9A1900">   * function calls did encountered up to this statement.</font></i>
<i><font color="#9A1900">   *)</font></i>
  <b><font color="#0000FF">type</font></b> t <font color="#990000">=</font> <font color="#009900">int</font>

  <b><font color="#0000FF">let</font></b> copy errcalls <font color="#990000">=</font> errcalls

  <i><font color="#9A1900">(* Start data for each statement. *)</font></i>
  <b><font color="#0000FF">let</font></b> stmtStartData <font color="#990000">=</font> <b><font color="#000080">Inthash</font></b><font color="#990000">.</font>create <font color="#993399">97</font>

  <b><font color="#0000FF">let</font></b> printable errcalls <font color="#990000">=</font> sprintf <font color="#FF0000">"(errcalls=%d)"</font> errcalls

  <b><font color="#0000FF">let</font></b> pretty <font color="#990000">()</font> t <font color="#990000">=</font> <b><font color="#000080">Pretty</font></b><font color="#990000">.</font>text <font color="#990000">(</font>printable t<font color="#990000">)</font>

  <b><font color="#0000FF">let</font></b> computeFirstPredecessor stmt x <font color="#990000">=</font> x <i><font color="#9A1900">(* XXX??? *)</font></i>

  <b><font color="#0000FF">let</font></b> combinePredecessors stmt <font color="#990000">~</font>old<font color="#990000">:</font>old_t new_t <font color="#990000">=</font>
    <b><font color="#0000FF">if</font></b> old_t <font color="#990000">=</font> new_t <b><font color="#0000FF">then</font></b> <font color="#009900">None</font>
    <b><font color="#0000FF">else</font></b> <font color="#009900">Some</font> new_t

  <i><font color="#9A1900">(* This will be initialized after we have calculated the set of all</font></i>
<i><font color="#9A1900">   * functions which can call an error function, in main() below.</font></i>
<i><font color="#9A1900">   *)</font></i>
  <b><font color="#0000FF">let</font></b> error_functions_set <font color="#990000">=</font> <font color="#009900">ref</font> <b><font color="#000080">FunctionSet</font></b><font color="#990000">.</font>empty

  <i><font color="#9A1900">(* Handle a Cil.Instr. *)</font></i>
  <b><font color="#0000FF">let</font></b> doInstr instr _ <font color="#990000">=</font>
    <b><font color="#0000FF">match</font></b> instr <b><font color="#0000FF">with</font></b>
    <i><font color="#9A1900">(* A call to an error function. *)</font></i>
    <font color="#990000">|</font> <font color="#009900">Call</font> <font color="#990000">(</font>_<font color="#990000">,</font> <font color="#009900">Lval</font> <font color="#990000">(</font><font color="#009900">Var</font> callee<font color="#990000">,</font> _<font color="#990000">),</font> _<font color="#990000">,</font> _<font color="#990000">)</font>
        <b><font color="#0000FF">when</font></b> <b><font color="#000080">FunctionSet</font></b><font color="#990000">.</font>mem callee <font color="#990000">!</font>error_functions_set <font color="#990000">-&gt;</font>
      <b><font color="#000080">Dataflow</font></b><font color="#990000">.</font><font color="#009900">Post</font> <font color="#990000">(</font><b><font color="#0000FF">fun</font></b> errcalls <font color="#990000">-&gt;</font> errcalls<font color="#990000">+</font><font color="#993399">1</font><font color="#990000">)</font>

    <font color="#990000">|</font> _ <font color="#990000">-&gt;</font> <b><font color="#000080">Dataflow</font></b><font color="#990000">.</font><font color="#009900">Default</font>

  <i><font color="#9A1900">(* Handle a Cil.Stmt. *)</font></i>
  <b><font color="#0000FF">let</font></b> doStmt _ _ <font color="#990000">=</font> <b><font color="#000080">Dataflow</font></b><font color="#990000">.</font><font color="#009900">SDefault</font>

  <i><font color="#9A1900">(* Handle a Cil.Guard. *)</font></i>
  <b><font color="#0000FF">let</font></b> doGuard _ _ <font color="#990000">=</font> <b><font color="#000080">Dataflow</font></b><font color="#990000">.</font><font color="#009900">GDefault</font>

  <i><font color="#9A1900">(* Filter statements we've seen already to prevent loops. *)</font></i>
  <b><font color="#0000FF">let</font></b> filter_set <font color="#990000">=</font> <font color="#009900">ref</font> <b><font color="#000080">IntSet</font></b><font color="#990000">.</font>empty
  <b><font color="#0000FF">let</font></b> filterStmt <font color="#FF0000">{</font> sid <font color="#990000">=</font> sid <font color="#FF0000">}</font> <font color="#990000">=</font>
    <b><font color="#0000FF">if</font></b> <b><font color="#000080">IntSet</font></b><font color="#990000">.</font>mem sid <font color="#990000">!</font>filter_set <b><font color="#0000FF">then</font></b> <b><font color="#0000FF">false</font></b>
    <b><font color="#0000FF">else</font></b> <font color="#990000">(</font>
      filter_set <font color="#990000">:=</font> <b><font color="#000080">IntSet</font></b><font color="#990000">.</font>add sid <font color="#990000">!</font>filter_set<font color="#990000">;</font>
      <b><font color="#0000FF">true</font></b>
    <font color="#990000">)</font>

  <i><font color="#9A1900">(* Initialize the module before each function that we examine. *)</font></i>
  <b><font color="#0000FF">let</font></b> init stmts <font color="#990000">=</font>
    filter_set <font color="#990000">:=</font> <b><font color="#000080">IntSet</font></b><font color="#990000">.</font>empty<font color="#990000">;</font>
    <b><font color="#000080">Inthash</font></b><font color="#990000">.</font>clear stmtStartData<font color="#990000">;</font>
    <i><font color="#9A1900">(* Add the initial statement(s) to the hash. *)</font></i>
    <b><font color="#000080">List</font></b><font color="#990000">.</font>iter <font color="#990000">(</font><b><font color="#0000FF">fun</font></b> stmt <font color="#990000">-&gt;</font> <b><font color="#000080">Inthash</font></b><font color="#990000">.</font>add stmtStartData stmt<font color="#990000">.</font>sid <font color="#993399">0</font><font color="#990000">)</font> stmts
<b><font color="#0000FF">end</font></b>

<b><font color="#0000FF">module</font></b> <font color="#009900">ForwardsErrorCounter</font> <font color="#990000">=</font> <b><font color="#000080">Dataflow</font></b><font color="#990000">.</font><font color="#009900">ForwardsDataFlow</font> <font color="#990000">(</font><font color="#009900">ErrorCounter</font><font color="#990000">)</font>

<i><font color="#9A1900">(* The always useful filter + map function. *)</font></i>
<b><font color="#0000FF">let</font></b> <b><font color="#0000FF">rec</font></b> filter_map f <font color="#990000">=</font> <b><font color="#0000FF">function</font></b>
  <font color="#990000">|</font> <font color="#990000">[]</font> <font color="#990000">-&gt;</font> <font color="#990000">[]</font>
  <font color="#990000">|</font> x <font color="#990000">::</font> xs <font color="#990000">-&gt;</font>
      <b><font color="#0000FF">match</font></b> f x <b><font color="#0000FF">with</font></b>
      <font color="#990000">|</font> <font color="#009900">Some</font> y <font color="#990000">-&gt;</font> y <font color="#990000">::</font> filter_map f xs
      <font color="#990000">|</font> <font color="#009900">None</font> <font color="#990000">-&gt;</font> filter_map f xs

<b><font color="#0000FF">let</font></b> <b><font color="#0000FF">rec</font></b> main <font color="#990000">()</font> <font color="#990000">=</font>
  <i><font color="#9A1900">(* Read the list of input C files. *)</font></i>
  <b><font color="#0000FF">let</font></b> files <font color="#990000">=</font>
    <b><font color="#0000FF">let</font></b> chan <font color="#990000">=</font> open_process_in <font color="#FF0000">"find src -name '*.i' | sort"</font> <b><font color="#0000FF">in</font></b>
    <b><font color="#0000FF">let</font></b> files <font color="#990000">=</font> input_chan chan <b><font color="#0000FF">in</font></b>
    <b><font color="#0000FF">if</font></b> close_process_in chan <font color="#990000">&lt;&gt;</font> <font color="#009900">WEXITED</font> <font color="#993399">0</font> <b><font color="#0000FF">then</font></b>
      failwith <font color="#FF0000">"failed to read input list of files"</font><font color="#990000">;</font>
    <b><font color="#0000FF">if</font></b> files <font color="#990000">=</font> <font color="#990000">[]</font> <b><font color="#0000FF">then</font></b>
      failwith <font color="#FF0000">"no input files; is the program running from the top directory? did you compile with make -C src CFLAGS=\"-save-temps\"?"</font><font color="#990000">;</font>
    files <b><font color="#0000FF">in</font></b>

  <i><font color="#9A1900">(* Load and parse each input file. *)</font></i>
  <b><font color="#0000FF">let</font></b> files <font color="#990000">=</font>
    <b><font color="#000080">List</font></b><font color="#990000">.</font>map <font color="#990000">(</font>
      <b><font color="#0000FF">fun</font></b> filename <font color="#990000">-&gt;</font>
        printf <font color="#FF0000">"loading %s\n%!"</font> filename<font color="#990000">;</font>
        <b><font color="#000080">Frontc</font></b><font color="#990000">.</font>parse filename <font color="#990000">()</font>
    <font color="#990000">)</font> files <b><font color="#0000FF">in</font></b>

  <i><font color="#9A1900">(* Merge the files. *)</font></i>
  printf <font color="#FF0000">"merging files\n%!"</font><font color="#990000">;</font>
  <b><font color="#0000FF">let</font></b> sourcecode <font color="#990000">=</font> <b><font color="#000080">Mergecil</font></b><font color="#990000">.</font>merge files <font color="#FF0000">"libguestfs"</font> <b><font color="#0000FF">in</font></b>

  <i><font color="#9A1900">(* CFG analysis. *)</font></i>
  printf <font color="#FF0000">"computing control flow\n%!"</font><font color="#990000">;</font>
  <b><font color="#000080">Cfg</font></b><font color="#990000">.</font>computeFileCFG sourcecode<font color="#990000">;</font>

  <b><font color="#0000FF">let</font></b> functions <font color="#990000">=</font>
    filter_map <font color="#990000">(</font><b><font color="#0000FF">function</font></b> <font color="#009900">GFun</font> <font color="#990000">(</font>f<font color="#990000">,</font> loc<font color="#990000">)</font> <font color="#990000">-&gt;</font> <font color="#009900">Some</font> <font color="#990000">(</font>f<font color="#990000">,</font> loc<font color="#990000">)</font> <font color="#990000">|</font> _ <font color="#990000">-&gt;</font> <font color="#009900">None</font><font color="#990000">)</font>
      sourcecode<font color="#990000">.</font>globals <b><font color="#0000FF">in</font></b>

  <i><font color="#9A1900">(* Examine which functions directly call which other functions. *)</font></i>
  printf <font color="#FF0000">"computing call graph\n%!"</font><font color="#990000">;</font>
  <b><font color="#0000FF">let</font></b> call_graph <font color="#990000">=</font> make_call_graph functions <b><font color="#0000FF">in</font></b>
  <i><font color="#9A1900">(*</font></i>
<i><font color="#9A1900">  FunctionDigraph.iter_edges (</font></i>
<i><font color="#9A1900">    fun caller callee -&gt;</font></i>
<i><font color="#9A1900">      printf "%s calls %s\n" caller.vname callee.vname</font></i>
<i><font color="#9A1900">  ) call_graph;</font></i>
<i><font color="#9A1900">  *)</font></i>

  <i><font color="#9A1900">(* The libguestfs error functions.  These are global function names,</font></i>
<i><font color="#9A1900">   * but to be any use to us we have to look these up in the list of</font></i>
<i><font color="#9A1900">   * all global functions (ie. 'functions') and turn them into the</font></i>
<i><font color="#9A1900">   * corresponding varinfo structures.</font></i>
<i><font color="#9A1900">   *)</font></i>
  <b><font color="#0000FF">let</font></b> error_function_names <font color="#990000">=</font> <font color="#990000">[</font> <font color="#FF0000">"guestfs_error_errno"</font><font color="#990000">;</font>
                               <font color="#FF0000">"guestfs_perrorf"</font> <font color="#990000">]</font> <b><font color="#0000FF">in</font></b>

  <b><font color="#0000FF">let</font></b> find_function name <font color="#990000">=</font>
    <b><font color="#0000FF">try</font></b> <b><font color="#000080">List</font></b><font color="#990000">.</font>find <font color="#990000">(</font><b><font color="#0000FF">fun</font></b> <font color="#990000">(</font><font color="#FF0000">{</font> svar <font color="#990000">=</font> <font color="#FF0000">{</font> vname <font color="#990000">=</font> n <font color="#FF0000">}}</font><font color="#990000">,</font> _<font color="#990000">)</font> <font color="#990000">-&gt;</font> n <font color="#990000">=</font> name<font color="#990000">)</font> functions
    <b><font color="#0000FF">with</font></b> <font color="#009900">Not_found</font> <font color="#990000">-&gt;</font> failwith <font color="#990000">(</font><font color="#FF0000">"function '"</font> <font color="#990000">^</font> name <font color="#990000">^</font> <font color="#FF0000">"' does not exist"</font><font color="#990000">)</font>
  <b><font color="#0000FF">in</font></b>
  <b><font color="#0000FF">let</font></b> error_function_names <font color="#990000">=</font> <b><font color="#000080">List</font></b><font color="#990000">.</font>map <font color="#990000">(</font>
    <b><font color="#0000FF">fun</font></b> f <font color="#990000">-&gt;</font> <font color="#990000">(</font>fst <font color="#990000">(</font>find_function f<font color="#990000">)).</font>svar
  <font color="#990000">)</font> error_function_names <b><font color="#0000FF">in</font></b>

  <i><font color="#9A1900">(* Get a list of functions that might (directly or indirectly) call</font></i>
<i><font color="#9A1900">   * one of the error functions.</font></i>
<i><font color="#9A1900">   *)</font></i>
  <b><font color="#0000FF">let</font></b> error_functions<font color="#990000">,</font> non_error_functions <font color="#990000">=</font>
    functions_which_call call_graph error_function_names functions <b><font color="#0000FF">in</font></b>

  <i><font color="#9A1900">(*</font></i>
<i><font color="#9A1900">  List.iter (</font></i>
<i><font color="#9A1900">    fun f -&gt; printf "%s can call an error function\n" f.vname</font></i>
<i><font color="#9A1900">  ) error_functions;</font></i>

<i><font color="#9A1900">  List.iter (</font></i>
<i><font color="#9A1900">    fun f -&gt; printf "%s can NOT call an error function\n" f.vname</font></i>
<i><font color="#9A1900">  ) non_error_functions;</font></i>
<i><font color="#9A1900">  *)</font></i>

  <i><font color="#9A1900">(* Save the list of error functions in a global set for fast lookups. *)</font></i>
  <b><font color="#0000FF">let</font></b> set <font color="#990000">=</font>
    <b><font color="#000080">List</font></b><font color="#990000">.</font>fold_left <font color="#990000">(</font>
      <b><font color="#0000FF">fun</font></b> set elt <font color="#990000">-&gt;</font> <b><font color="#000080">FunctionSet</font></b><font color="#990000">.</font>add elt set
    <font color="#990000">)</font> <b><font color="#000080">FunctionSet</font></b><font color="#990000">.</font>empty error_functions <b><font color="#0000FF">in</font></b>
  <b><font color="#000080">ErrorCounter</font></b><font color="#990000">.</font>error_functions_set <font color="#990000">:=</font> set<font color="#990000">;</font>

  <i><font color="#9A1900">(* Analyze each top-level function to ensure it calls an error</font></i>
<i><font color="#9A1900">   * function exactly once on error paths, and never on normal return</font></i>
<i><font color="#9A1900">   * paths.</font></i>
<i><font color="#9A1900">   *)</font></i>
  printf <font color="#FF0000">"analyzing correctness of error paths\n%!"</font><font color="#990000">;</font>
  <b><font color="#000080">List</font></b><font color="#990000">.</font>iter compute_error_paths functions<font color="#990000">;</font>

  <font color="#990000">()</font>

<i><font color="#9A1900">(* Make a directed graph of which functions directly call which other</font></i>
<i><font color="#9A1900"> * functions.</font></i>
<i><font color="#9A1900"> *)</font></i>
<b><font color="#0000FF">and</font></b> make_call_graph functions <font color="#990000">=</font>
  <b><font color="#0000FF">let</font></b> graph <font color="#990000">=</font> <b><font color="#000080">FunctionDigraph</font></b><font color="#990000">.</font>create <font color="#990000">()</font> <b><font color="#0000FF">in</font></b>

  <b><font color="#000080">List</font></b><font color="#990000">.</font>iter <font color="#990000">(</font>
    <b><font color="#0000FF">fun</font></b> <font color="#990000">(</font><font color="#FF0000">{</font> svar <font color="#990000">=</font> caller<font color="#990000">;</font> sallstmts <font color="#990000">=</font> sallstmts <font color="#FF0000">}</font><font color="#990000">,</font> _<font color="#990000">)</font> <font color="#990000">-&gt;</font>
      <i><font color="#9A1900">(* Evaluate which other functions 'caller' calls.  First pull</font></i>
<i><font color="#9A1900">       * out every 'Call' instruction anywhere in the function.</font></i>
<i><font color="#9A1900">       *)</font></i>
      <b><font color="#0000FF">let</font></b> insns <font color="#990000">=</font>  <b><font color="#000080">List</font></b><font color="#990000">.</font>concat <font color="#990000">(</font>
        filter_map <font color="#990000">(</font>
          <b><font color="#0000FF">function</font></b>
          <font color="#990000">|</font> <font color="#FF0000">{</font> skind <font color="#990000">=</font> <font color="#009900">Instr</font> insns <font color="#FF0000">}</font> <font color="#990000">-&gt;</font> <font color="#009900">Some</font> insns
          <font color="#990000">|</font> _ <font color="#990000">-&gt;</font> <font color="#009900">None</font>
        <font color="#990000">)</font> sallstmts
      <font color="#990000">)</font> <b><font color="#0000FF">in</font></b>
      <b><font color="#0000FF">let</font></b> calls <font color="#990000">=</font> <b><font color="#000080">List</font></b><font color="#990000">.</font>filter <font color="#990000">(</font><b><font color="#0000FF">function</font></b> <font color="#009900">Call</font> _ <font color="#990000">-&gt;</font> <b><font color="#0000FF">true</font></b> <font color="#990000">|</font> _ <font color="#990000">-&gt;</font> <b><font color="#0000FF">false</font></b><font color="#990000">)</font> insns <b><font color="#0000FF">in</font></b>
      <i><font color="#9A1900">(* Then examine what function is being called at each place. *)</font></i>
      <b><font color="#0000FF">let</font></b> callees <font color="#990000">=</font> filter_map <font color="#990000">(</font>
        <b><font color="#0000FF">function</font></b>
        <font color="#990000">|</font> <font color="#009900">Call</font> <font color="#990000">(</font>_<font color="#990000">,</font> <font color="#009900">Lval</font> <font color="#990000">(</font><font color="#009900">Var</font> callee<font color="#990000">,</font> _<font color="#990000">),</font> _<font color="#990000">,</font> _<font color="#990000">)</font> <font color="#990000">-&gt;</font> <font color="#009900">Some</font> callee
        <font color="#990000">|</font> _ <font color="#990000">-&gt;</font> <font color="#009900">None</font>
      <font color="#990000">)</font> calls <b><font color="#0000FF">in</font></b>

      <b><font color="#000080">List</font></b><font color="#990000">.</font>iter <font color="#990000">(</font>
        <b><font color="#0000FF">fun</font></b> callee <font color="#990000">-&gt;</font>
          <b><font color="#000080">FunctionDigraph</font></b><font color="#990000">.</font>add_edge graph caller callee
      <font color="#990000">)</font> callees
  <font color="#990000">)</font> functions<font color="#990000">;</font>

  graph

<i><font color="#9A1900">(* [functions_which_call g endpoints functions] partitions the</font></i>
<i><font color="#9A1900"> * [functions] list, returning those functions that call directly or</font></i>
<i><font color="#9A1900"> * indirectly one of the functions in [endpoints], and a separate list</font></i>
<i><font color="#9A1900"> * of functions which do not.  [g] is the direct call graph.</font></i>
<i><font color="#9A1900"> *)</font></i>
<b><font color="#0000FF">and</font></b> functions_which_call g endpoints functions <font color="#990000">=</font>
  <b><font color="#0000FF">let</font></b> functions <font color="#990000">=</font> <b><font color="#000080">List</font></b><font color="#990000">.</font>map <font color="#990000">(</font><b><font color="#0000FF">fun</font></b> <font color="#990000">(</font><font color="#FF0000">{</font> svar <font color="#990000">=</font> svar <font color="#FF0000">}</font><font color="#990000">,</font> _<font color="#990000">)</font> <font color="#990000">-&gt;</font> svar<font color="#990000">)</font> functions <b><font color="#0000FF">in</font></b>

  <b><font color="#0000FF">let</font></b> checker <font color="#990000">=</font> <b><font color="#000080">FunctionPathChecker</font></b><font color="#990000">.</font>create g <b><font color="#0000FF">in</font></b>
  <b><font color="#000080">List</font></b><font color="#990000">.</font>partition <font color="#990000">(</font>
    <b><font color="#0000FF">fun</font></b> f <font color="#990000">-&gt;</font>
      <i><font color="#9A1900">(* Does a path exist from f to any of the endpoints? *)</font></i>
      <b><font color="#000080">List</font></b><font color="#990000">.</font>exists <font color="#990000">(</font>
        <b><font color="#0000FF">fun</font></b> endpoint <font color="#990000">-&gt;</font>
          <b><font color="#0000FF">try</font></b> <b><font color="#000080">FunctionPathChecker</font></b><font color="#990000">.</font>check_path checker f endpoint
          <b><font color="#0000FF">with</font></b>
          <i><font color="#9A1900">(* It appears safe to ignore this exception.  It seems to</font></i>
<i><font color="#9A1900">           * mean that this function is in a part of the graph which</font></i>
<i><font color="#9A1900">           * is completely disconnected from the other part of the graph</font></i>
<i><font color="#9A1900">           * that contains the endpoint.</font></i>
<i><font color="#9A1900">           *)</font></i>
          <font color="#990000">|</font> <font color="#009900">Invalid_argument</font> <font color="#FF0000">"[ocamlgraph] iter_succ"</font> <font color="#990000">-&gt;</font> <b><font color="#0000FF">false</font></b>
      <font color="#990000">)</font> endpoints
  <font color="#990000">)</font> functions

<b><font color="#0000FF">and</font></b> compute_error_paths <font color="#990000">(</font><font color="#FF0000">{</font> svar <font color="#990000">=</font> svar <font color="#FF0000">}</font> <b><font color="#0000FF">as</font></b> f<font color="#990000">,</font> loc<font color="#990000">)</font> <font color="#990000">=</font>
  <i><font color="#9A1900">(*ErrorCounter.debug := true;*)</font></i>

  <i><font color="#9A1900">(* Find the initial statement in this function (assumes that the</font></i>
<i><font color="#9A1900">   * function can only be entered in one place, which is normal for C</font></i>
<i><font color="#9A1900">   * functions).</font></i>
<i><font color="#9A1900">   *)</font></i>
  <b><font color="#0000FF">let</font></b> initial_stmts <font color="#990000">=</font>
    <b><font color="#0000FF">match</font></b> f<font color="#990000">.</font>sbody<font color="#990000">.</font>bstmts <b><font color="#0000FF">with</font></b>
    <font color="#990000">|</font> <font color="#990000">[]</font> <font color="#990000">-&gt;</font> <font color="#990000">[]</font>
    <font color="#990000">|</font> first<font color="#990000">::</font>_ <font color="#990000">-&gt;</font> <font color="#990000">[</font>first<font color="#990000">]</font> <b><font color="#0000FF">in</font></b>

  <i><font color="#9A1900">(* Initialize ErrorCounter. *)</font></i>
  <b><font color="#000080">ErrorCounter</font></b><font color="#990000">.</font>init initial_stmts<font color="#990000">;</font>

  <i><font color="#9A1900">(* Compute the error counters along paths through the function. *)</font></i>
  <b><font color="#000080">ForwardsErrorCounter</font></b><font color="#990000">.</font>compute initial_stmts<font color="#990000">;</font>

  <i><font color="#9A1900">(* Process all Return statements in this function. *)</font></i>
  <b><font color="#000080">List</font></b><font color="#990000">.</font>iter <font color="#990000">(</font>
    <b><font color="#0000FF">fun</font></b> stmt <font color="#990000">-&gt;</font>
      <b><font color="#0000FF">try</font></b>
        <b><font color="#0000FF">let</font></b> errcalls <font color="#990000">=</font> <b><font color="#000080">Inthash</font></b><font color="#990000">.</font>find <b><font color="#000080">ErrorCounter</font></b><font color="#990000">.</font>stmtStartData stmt<font color="#990000">.</font>sid <b><font color="#0000FF">in</font></b>

        <b><font color="#0000FF">match</font></b> stmt <b><font color="#0000FF">with</font></b>
        <i><font color="#9A1900">(* return -1; *)</font></i>
        <font color="#990000">|</font> <font color="#FF0000">{</font> skind <font color="#990000">=</font> <font color="#009900">Return</font> <font color="#990000">(</font><font color="#009900">Some</font> i<font color="#990000">,</font> loc<font color="#990000">)</font> <font color="#FF0000">}</font> <b><font color="#0000FF">when</font></b> is_literal_minus_one i <font color="#990000">-&gt;</font>
          <b><font color="#0000FF">if</font></b> errcalls <font color="#990000">=</font> <font color="#993399">0</font> <b><font color="#0000FF">then</font></b>
            printf <font color="#FF0000">"%s:%d: %s: may return an error code without calling error/perrorf\n"</font>
              loc<font color="#990000">.</font>file loc<font color="#990000">.</font>line svar<font color="#990000">.</font>vname
          <b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b> errcalls <font color="#990000">&gt;</font> <font color="#993399">1</font> <b><font color="#0000FF">then</font></b>
            printf <font color="#FF0000">"%s:%d: %s: may call error/perrorf %d times (more than once) along an error path\n"</font>
          loc<font color="#990000">.</font>file loc<font color="#990000">.</font>line svar<font color="#990000">.</font>vname errcalls

        <i><font color="#9A1900">(* return 0; *)</font></i>
        <font color="#990000">|</font> <font color="#FF0000">{</font> skind <font color="#990000">=</font> <font color="#009900">Return</font> <font color="#990000">(</font><font color="#009900">Some</font> i<font color="#990000">,</font> loc<font color="#990000">)</font> <font color="#FF0000">}</font> <b><font color="#0000FF">when</font></b> is_literal_zero i <font color="#990000">-&gt;</font>
          <b><font color="#0000FF">if</font></b> errcalls <font color="#990000">&gt;=</font> <font color="#993399">1</font> <b><font color="#0000FF">then</font></b>
            printf <font color="#FF0000">"%s:%d: %s: may call error/perrorf along a non-error return path\n"</font>
              loc<font color="#990000">.</font>file loc<font color="#990000">.</font>line svar<font color="#990000">.</font>vname

        <i><font color="#9A1900">(* return; (void return) *)</font></i>
        <font color="#990000">|</font> <font color="#FF0000">{</font> skind <font color="#990000">=</font> <font color="#009900">Return</font> <font color="#990000">(</font><font color="#009900">None</font><font color="#990000">,</font> loc<font color="#990000">)</font> <font color="#FF0000">}</font> <font color="#990000">-&gt;</font>
          <b><font color="#0000FF">if</font></b> errcalls <font color="#990000">&gt;=</font> <font color="#993399">1</font> <b><font color="#0000FF">then</font></b>
            printf <font color="#FF0000">"%s:%d: %s: may call error/perrorf and return void\n"</font>
              loc<font color="#990000">.</font>file loc<font color="#990000">.</font>line svar<font color="#990000">.</font>vname

        <font color="#990000">|</font> _ <font color="#990000">-&gt;</font> <font color="#990000">()</font>

      <b><font color="#0000FF">with</font></b>
        <font color="#009900">Not_found</font> <font color="#990000">-&gt;</font>
          printf <font color="#FF0000">"%s:%d: %s: may contain unreachable code\n"</font>
            loc<font color="#990000">.</font>file loc<font color="#990000">.</font>line svar<font color="#990000">.</font>vname
  <font color="#990000">)</font> f<font color="#990000">.</font>sallstmts

<i><font color="#9A1900">(* Some convenience CIL matching functions. *)</font></i>
<b><font color="#0000FF">and</font></b> is_literal_minus_one <font color="#990000">=</font> <b><font color="#0000FF">function</font></b>
  <font color="#990000">|</font> <font color="#009900">Const</font> <font color="#990000">(</font><font color="#009900">CInt64</font> <font color="#990000">(-</font><font color="#993399">1L</font><font color="#990000">,</font> _<font color="#990000">,</font> _<font color="#990000">))</font> <font color="#990000">-&gt;</font> <b><font color="#0000FF">true</font></b>
  <font color="#990000">|</font> _ <font color="#990000">-&gt;</font> <b><font color="#0000FF">false</font></b>

<b><font color="#0000FF">and</font></b> is_literal_zero <font color="#990000">=</font> <b><font color="#0000FF">function</font></b>
  <font color="#990000">|</font> <font color="#009900">Const</font> <font color="#990000">(</font><font color="#009900">CInt64</font> <font color="#990000">(</font><font color="#993399">0L</font><font color="#990000">,</font> _<font color="#990000">,</font> _<font color="#990000">))</font> <font color="#990000">-&gt;</font> <b><font color="#0000FF">true</font></b>
  <font color="#990000">|</font> _ <font color="#990000">-&gt;</font> <b><font color="#0000FF">false</font></b>

<i><font color="#9A1900">(* Convenient routine to load the contents of a channel into a list of</font></i>
<i><font color="#9A1900"> * strings.</font></i>
<i><font color="#9A1900"> *)</font></i>
<b><font color="#0000FF">and</font></b> input_chan chan <font color="#990000">=</font>
  <b><font color="#0000FF">let</font></b> lines <font color="#990000">=</font> <font color="#009900">ref</font> <font color="#990000">[]</font> <b><font color="#0000FF">in</font></b>
  <b><font color="#0000FF">try</font></b> <b><font color="#0000FF">while</font></b> <b><font color="#0000FF">true</font></b><font color="#990000">;</font> <b><font color="#0000FF">do</font></b> lines <font color="#990000">:=</font> input_line chan <font color="#990000">::</font> <font color="#990000">!</font>lines <b><font color="#0000FF">done</font></b><font color="#990000">;</font> <font color="#990000">[]</font>
  <b><font color="#0000FF">with</font></b> <font color="#009900">End_of_file</font> <font color="#990000">-&gt;</font> <b><font color="#000080">List</font></b><font color="#990000">.</font>rev <font color="#990000">!</font>lines

<b><font color="#0000FF">and</font></b> input_file filename <font color="#990000">=</font>
  <b><font color="#0000FF">let</font></b> chan <font color="#990000">=</font> open_in filename <b><font color="#0000FF">in</font></b>
  <b><font color="#0000FF">let</font></b> r <font color="#990000">=</font> input_chan chan <b><font color="#0000FF">in</font></b>
  close_in chan<font color="#990000">;</font>
  r

<b><font color="#0000FF">let</font></b> <font color="#990000">()</font> <font color="#990000">=</font>
  <b><font color="#0000FF">try</font></b> main <font color="#990000">()</font>
  <b><font color="#0000FF">with</font></b> 
    <font color="#009900">exn</font> <font color="#990000">-&gt;</font>
      prerr_endline <font color="#990000">(</font><b><font color="#000080">Printexc</font></b><font color="#990000">.</font>to_string <font color="#009900">exn</font><font color="#990000">);</font>
      <b><font color="#000080">Printexc</font></b><font color="#990000">.</font>print_backtrace <b><font color="#000080">Pervasives</font></b><font color="#990000">.</font>stderr<font color="#990000">;</font>
      exit <font color="#993399">1</font>


<br/>  <a href="http://feeds.wordpress.com/1.0/gocomments/rwmj.wordpress.com/4163/" rel="nofollow"><img src="http://feeds.wordpress.com/1.0/comments/rwmj.wordpress.com/4163/" alt="" border="0"/></a> <img src="http://stats.wordpress.com/b.gif?host=rwmj.wordpress.com&amp;blog=6840703&amp;post=4163&amp;subd=rwmj&amp;ref=&amp;feed=1" alt="" height="1" border="0" width="1"/><a onclick="switchContent('post8','post7')" class="btn" href="#e019222843fac682c9f57ee0f6d1fe6a">Hide</a></div></span>
<script type="text/javascript">function switchContent(id1,id2) {
     // Get the DOM reference
     var contentId1 = document.getElementById(id1);
     var contentId2 = document.getElementById(id2);
     // Toggle
     contentId1.style.display = "none";
     contentId2.style.display = "block";
     }</script></div>

  
    </div>

    
    <br/>
    <hr/>
    <div id="footer">
      Contribute to this project!
      Find us on <a href="https://github.com/ocaml/ocaml.org">Github</a>.
    </div>
    <span title=".././img/ = image directory from the base of the site"></span>


    
    
    

    <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
    <script src=".././js/jquery-1.8.0.min.js"></script>
    
    <script src=".././js/bootstrap.js"></script>

    <script type="text/javascript">
      var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-22552764-2']); _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-37808023-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

    </script>

</body></html>
