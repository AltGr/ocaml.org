<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    
    <meta content="IE=8" http-equiv="X-UA-Compatible"/>
    <title>OCaml :: OCaml Planet</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <meta content="Ashish Agarwal, Esther Baruk, Christophe Troestler and many contributors" name="author"/>
    <meta content="" name="description"/>
    <meta content="" name="keywords"/>
    <meta content="OCaml (Weberizer)" name="generator"/>

    <link href="https://static.ocamlcore.org/official/images/favicon.ico" rel="shortcut icon"/>
    <link rel="stylesheet" href=".././css/bootstrap.css"/>
    <link href=".././css/ocaml.css" media="all" type="text/css" rel="stylesheet"/>
    <link rel="stylesheet" href=".././css/bootstrap-responsive.css"/>

    
    

    <meta content="OCaml Planet" property="og:title"/>
    <meta content="non_profit" property="og:type"/>

    <meta content="all" name="robots"/>
  </head>
  <body>
    <div id="header">
      <div class="top">
      </div>
      <div class="bottom">
      </div>
    </div>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
	  
          <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a href=".././" class="brand">OCaml</a>

          <div class="nav-collapse">
            <ul class="nav">
	      <li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">
    Discover
    <b class="caret"></b>
  </a>
  <ul class="dropdown-menu">
    <li><a href="../description.html">What is OCaml?</a></li>
    <li><a href="http://try.ocamlpro.com/">Try it Online</a></li>
    <li><a href="../taste.html">100 Lines of OCaml</a></li>
    <li><a href="../success.html">Success Stories</a></li>
    <li><a href="../companies.html">Who Is Using It?</a></li>
    <li><a href="http://pleac.sourceforge.net/pleac_ocaml/">Pleac</a></li>
    <li><a href="http://rosettacode.org/wiki/Category:OCaml">Rosetta</a>
        <a href="http://langref.org/ocaml">langref.org</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">
    Learn
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../install.html">Install</a></li>
    <li><a href="../tutorials/">Tutorials</a></li>
    <li><a href="../faq.html">FAQ</a></li>
    <li><a href="../books.html">Books</a></li>
    <li><a href="../videos.html">Videos</a></li>
    <li><a href="../papers.html">Papers</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">Use
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../releases/">Releases</a></li>
    <li><a href="../libraries.html">Libraries</a></li>
    <li><a href="../dev_tools.html">Development Tools</a></li>
    <li><a href="http://caml.inria.fr/pub/docs/manual-ocaml/">User Manual</a></li>
    <li><a href="../cheat_sheets.html">Cheat Sheets</a></li>
    <li><a href="http://search.ocaml.jp/">OCaml API Search</a></li>
    <li><a href="http://forge.ocamlcore.org/">Forge</a></li>
    <li><a href="https://github.com/languages/OCaml">GitHub</a></li>
    <li><a href="https://bitbucket.org/repo/all?name=ocaml">Bitbucket</a></li>
    <li><a href="http://gitorious.org/search?page=1&q=ocaml">Gitorious</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">Community
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../mailing_lists.html">Mailing Lists</a></li>
    <li><a href="../planet/">Blogs</a></li>
    <li><a href="../meetings/">Meetings</a></li>
    <li><a href="irc://irc.freenode.net/ocaml">IRC</a></li>
    <li><a href="http://stackoverflow.com/questions/tagged?tagnames=ocaml">Stack Overflow</a></li>
    <li><a href="http://www.reddit.com/r/ocaml/">Reddit</a></li>
    <li><a href="../support.html">Commercial Support</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">More
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="http://caml.inria.fr/mantis/">Mantis Bug Tracker</a></li>
    <li><a href="../caml-light/">Caml Light</a></li>
    <li><a href="../logos.html">Logos</a></li>
  </ul>
</li>

            </ul>
	    <form action="http://www.google.com/search" method="get" class="navbar-search pull-right">
	      <input placeholder="Search" class="search-query" name="q" type="text"/>
	      <input value="site:http://www.ocaml.org/" name="q" type="hidden"/>
	    </form>
            
	    
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <span class="navigation-bar">
	<a href="./../">Home</a><span class="separation"><img src=".././img/right_arrow.png" alt="&gt;"/></span>OCaml Planet
	<span id="language">
	  <span class="horizontal-toolbar"><span class="open-bracket">[</span><span class="current-url">En</span><span class="close-bracket">]</span></span>
	</span>
      </span>

      

    <h1>OCaml Planet</h1>

    <p>The OCaml Planet aggregates various blogs from the OCaml
    community.  It is kindly provided
    by <a href="http://www.ocamlcore.com/">OCamlCore</a>.  If you
    would like to be added, read
    the <a href="http://www.ocamlcore.org/planet/">Planet
    subscription HOWTO</a>.</p>

    <br/>
    <div style="float: right; margin-right: 0; margin-top: 0" class="span2 planet-subscriptions"><em>Subscriptions</em>
      <ul><li><a href="http://alexleighton.tumblr.com/tagged/ocaml/rss">Alex Leighton</a></li><li><a href="http://feeds.feedburner.com/amirmc-ocaml">Amir Chaudhry</a></li><li><a href="http://andreiformiga.com/blog/?cat=5&feed=rss2">Andrei Formiga</a></li><li><a href="http://math.andrej.com/feed/">Andrej Bauer</a></li><li><a href="http://anil.recoil.org/feeds/atom.xml">Anil Madhavapeddy</a></li><li><a href="http://ashishagarwal.org/tag/ocaml/feed/">Ashish Agarwal</a></li><li><a href="http://www.blogger.com/feeds/7617521785419311079/posts/default">Cameleon news</a></li><li><a href="http://caml.inria.fr/news.en.rss">Caml INRIA</a></li><li><a href="http://camlspotter.blogspot.com/feeds/posts/default?alt=rss">Caml Spotting</a></li><li><a href="http://alan.petitepomme.net/cwn/cwn.rss">Caml Weekly News</a></li><li><a href="http://coherentpdf.com/blog/?tag=ocaml&feed=rss">Coherent Graphics</a></li><li><a href="http://coq.inria.fr/news/feed">Coq</a></li><li><a href="http://erratique.ch/feeds/news.atom">Daniel Bünzli</a></li><li><a href="http://nleyten.com:82/feed/tag/ocaml/atom">Dario Teixeira</a></li><li><a href="http://www.blogger.com/feeds/17133288/posts/default/-/ocaml">David Baelde</a></li><li><a href="http://blog.bentobako.org/index.php?feed/tag/ocaml/atom">David Mentré</a></li><li><a href="http://dutherenverseauborddelatable.wordpress.com/category/ocaml/feed/">David Teller</a></li><li><a href="http://www.examachine.net/blog/cat/ocaml/feed/">Eray Özkural</a></li><li><a href="http://www.mega-nerd.com/erikd/Blog/index.rss20">Erik de Castro Lopo</a></li><li><a href="http://blog.emillon.org/feeds/ocaml.xml">Etienne Millon</a></li><li><a href="http://frama-c.com/rss.xml">Frama-C</a></li><li><a href="http://functionaljobs.com/jobs/search/?q=ocaml&format=rss">Functional Jobs</a></li><li><a href="http://gallium.inria.fr/blog/index.rss">GaGallium</a></li><li><a href="http://gaiustech.wordpress.com/category/ocaml/feed/">Gaius Hammond</a></li><li><a href="http://blog.camlcity.org/blog/rss">Gerd Stolpmann</a></li><li><a href="http://jobs.github.com/positions.atom?description=ocaml&location=">Github OCaml jobs</a></li><li><a href="http://www.wisdomandwonder.com/tag/OCaml/feed">Grant Rettke</a></li><li><a href="http://hongboz.wordpress.com/feed/">Hong bo Zhang</a></li><li><a href="http://blog.incubaid.com/tag/ocaml/feed/">Incubaid Research</a></li><li><a href="http://ambassadortothecomputers.blogspot.com/feeds/posts/default?alt=rss">Jake Donham</a></li><li><a href="http://scattered-thoughts.net/atom.xml">Jamie Brandon</a></li><li><a href="https://ocaml.janestreet.com/?q=rss.xml">Jane Street</a></li><li><a href="http://lpw25.net/rss.xml">Leo White</a></li><li><a href="http://www.lexifi.com/blogs/ocaml/feed">LexiFi</a></li><li><a href="http://newblog.0branch.com/rss.xml">Marc Simpson</a></li><li><a href="http://syntaxexclamation.wordpress.com/tag/ocaml/feed/">Matthias Puech</a></li><li><a href="http://www.blogger.com/feeds/5888658295182480819/posts/default">Matías Giovannini</a></li><li><a href="">Mihamina Rakotomandimby</a></li><li><a href="http://mcclurmc.wordpress.com/feed/">Mike McClurg</a></li><li><a href="http://nyc-ocaml.posterous.com/rss.xml">NYC OCaml</a></li><li><a href="http://ocaml-book.com/blog?format=rss">OCaml Book</a></li><li><a href="http://forge.ocamlcore.org/export/rss_sfnews.php">OCamlCore Forge News</a></li><li><a href="http://forge.ocamlcore.org/export/rss_sfprojects.php">OCamlCore Forge Projects</a></li><li><a href="http://www.ocamlcore.com/wp/?feed=rss2&amp;language=en&#038;language=en">OCamlCore.com</a></li><li><a href="http://www.ocamlpro.com/feed/atom.xml">OCamlPro</a></li><li><a href="http://odns.tuxfamily.org/feed/">ODNS project</a></li><li><a href="http://ox.tuxfamily.org/feed/">Ocaml XMPP project</a></li><li><a href="http://ocsigen.org/news.atom">Ocsigen project</a></li><li><a href="http://www.blogger.com/feeds/2073503406800427577/posts/default">Opa</a></li><li><a href="http://www.openmirage.org/blog/atom.xml">Open Mirage</a></li><li><a href="http://functional-orbitz.blogspot.com/feeds/posts/default/-/planetocaml?alt=rss">Orbitz</a></li><li><a href="http://www.donadeo.net/facets/programming-languages/objective-caml/feed/">Paolo Donadeo</a></li><li><a href="https://mancoosi.org/~abate/taxonomy/term/5/0/feed">Pietro Abate</a></li><li><a href="http://rwmj.wordpress.com/tag/ocaml/feed/">Richard Jones</a></li><li><a href="http://blog.rastageeks.org/spip.php?page=rss&id_mot=2">Romain Beauxis</a></li><li><a href="http://seb.mondet.org/blog/feed/ocaml.rss">Sebastien Mondet</a></li><li><a href="http://upsilon.cc/~zack/tags/ocaml/index.rss">Stefano Zacchiroli</a></li><li><a href="http://le-gall.net/sylvain+violaine/blog/index.php?feed/tag/ocaml/atom">Sylvain Le Gall</a></li><li><a href="http://caml.inria.fr/hump.rss">The Caml Humps</a></li><li><a href="http://www.blogger.com/feeds/6115529230232389198/posts/default">Till Varoquaux</a></li><li><a href="http://y-node.com/blog/feeds/latest/">y-node</a></li></ul>

      <a href="http://planet.ocaml.org/rss20.xml"><img src=".././img/rss20.png"/></a>
      <a href="http://planet.ocaml.org/opml.xml"><img src=".././img/opml.png"/></a>
    </div>
    <div class="planet"><a name="566209459dc30a823e044844039f9177"></a><span class="rss-header"><span class="rss-title"><a href="http://alan.petitepomme.net/cwn/2013.07.16.html"> Caml Weekly News, 16 Jul 2013</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Caml Weekly News</span>, <span class="rss-date">16 Jul 2013</span></span><span class="rss-description">OCaml-Top release 1.0.0 / GADTs and associative container / Engineering position at Vector Fabrics / OCaml 2013 (24/09, Boston): Preliminary program is available / enhancements for "perf" on OCaml code / Other Caml News</span>
<a name="95e24529fbb0f6445d9ce28f00b17d68"></a><span class="rss-header"><span class="rss-title"><a href="http://jobs.github.com/positions/0a9333c4-71da-11e0-9ac7-692793c00b45"> Full Time: Software Developer (Functional Programming) at Jane Street in New York, NY; London, UK; Hong Kong</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Github OCaml jobs</span>, <span class="rss-date">15 Jul 2013</span></span><span class="rss-description"><div id="post1"><p>Software Developer (Functional Programming)</p> <p>Jane Street is looking to hire great software developers with an interest in functional programming. OCaml, a statically typed functional programming with similarities to Haskell, Scheme, Erlang, F# and SML, is our language of choice. We’ve got the largest team of OCaml developers in any industrial setting, and probably the world’s largest OCaml codebase. We use OCaml for running our entire business, supporting everything from research to systems administration to trading systems. If you’re interested in seeing how functional programming plays out in the real world, there’s no better place.</p> <p>The atmosphere is informal and intellectual. There is a focus on education, and people learn about software and trading, both through formal classes and on the job. The work is challenging, and you get to see the practical impact of your efforts in quick and dramatic terms. Jane Street is also small enough that people have the freedom to get involved in many different areas of the business. Compensation is highly competitive, and there’s a lot of room for growth.</p> <a onclick="switchContent('post1','post2')" class="btn" href="#95e24529fbb0f6445d9ce28f00b17d68">Read more...</a></div><div id="post2" style="display: none"><p>Software Developer (Functional Programming)</p> <p>Jane Street is looking to hire great software developers with an interest in functional programming. OCaml, a statically typed functional programming with similarities to Haskell, Scheme, Erlang, F# and SML, is our language of choice. We’ve got the largest team of OCaml developers in any industrial setting, and probably the world’s largest OCaml codebase. We use OCaml for running our entire business, supporting everything from research to systems administration to trading systems. If you’re interested in seeing how functional programming plays out in the real world, there’s no better place.</p> <p>The atmosphere is informal and intellectual. There is a focus on education, and people learn about software and trading, both through formal classes and on the job. The work is challenging, and you get to see the practical impact of your efforts in quick and dramatic terms. Jane Street is also small enough that people have the freedom to get involved in many different areas of the business. Compensation is highly competitive, and there’s a lot of room for growth.</p> <p>You can learn more about Jane Street and our technology from our main site, janestreet.com. You can also look at a a talk given at CMU about why Jane Street uses functional programming (<a href="http://ocaml.janestreet.com/?q=node/61">http://ocaml.janestreet.com/?q=node/61</a>), our programming blog (<a href="http://ocaml.janestreet.com">http://ocaml.janestreet.com</a>), and some papers we’ve written about our experience using functional programming in the real world (<a href="http://janestreet.com/technology/articles.php">http://janestreet.com/technology/articles.php</a>).</p> <p>We also have extensive benefits, including:</p> <ul> <li>90% book reimbursement for work-related books</li> <li>90% tuition reimbursement for continuing education</li> <li>Excellent, zero-premium medical and dental insurance</li> <li>Free lunch delivered daily from a selection of restaurants</li> <li>Catered breakfasts and fresh brewed Peet’s coffee</li> <li>An on-site, private gym in New York with towel service</li> <li>Kitchens fully stocked with a variety of snack choices</li> <li>Full company 401(k) match up to 6% of salary, vests immediately</li> <li>Three weeks of paid vacation for new hires in the US</li> <li>16 weeks fully paid maternity/paternity leave for primary caregivers, plus additional unpaid leave</li> </ul> <p>More information at <a href="http://janestreet.com/workplace/benefits.php">http://janestreet.com/workplace/benefits.php</a></p><a onclick="switchContent('post2','post1')" class="btn" href="#95e24529fbb0f6445d9ce28f00b17d68">Hide</a></div></span>
<a name="e70b78d2f071d064b2754bbde1303c23"></a><span class="rss-header"><span class="rss-title"><a href="http://www.ocamlpro.com/blog/2013/07/11/inlining-progress-report.html"> Better Inlining: Progress Report</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author"><span id="ocaml_1">OCamlPro &#9001;pierre.chambart<abbr title="(at) &rarr; @">(at)</abbr>ocamlpro.com (Pierre Chambart)&#9002;</span><script type="text/javascript"><!--;
local = "pierre.chambart";
h = "ocamlpro.com (Pierre Chambart)";
hq = "ocamlpro.com%20(Pierre%20Chambart)";
document.getElementById("ocaml_1").innerHTML = '<a href="mailto:' + local + '@' + hq + "\" >OCamlPro<\/a>";
//--></script></span>, <span class="rss-date">11 Jul 2013</span></span><span class="rss-description"><div id="post3"><p>As announced <a href="http://www.ocamlpro.com/blog/2013/05/24/optimisations-you-shouldn-t-do.html">some time ago</a>, I am working on a new intermediate language within the OCaml compiler to improve its inlining strategy. After some time of bug squashing, I prepared a testable version of the patchset, available either on <a href="https://github.com/chambart/ocaml.git">Github</a> (branch <code>flambda_experiments</code>), or through OPAM, in the following repository:</p><pre><code>opam repo add inlining https://github.com/OCamlPro/opam-compilers-repository.git opam switch flambda opam install inlining-benchs </code></pre><p>The series of patches is not ready for benchmarking against real applications, as no cross module information is propagated yet (this is more practical for development because it simplifies debugging a lot), but it already works quite well on single-file code. Some very simple benchmark examples are available in the <code>inlining-benchs</code> package.</p><p>The series of patches implements a set of 'reasonable' compilation passes, that do not try anything too complicated, but combined, generates quite efficient code.</p><h2>Current Status</h2><a onclick="switchContent('post3','post4')" class="btn" href="#e70b78d2f071d064b2754bbde1303c23">Read more...</a></div><div id="post4" style="display: none"><p>As announced <a href="http://www.ocamlpro.com/blog/2013/05/24/optimisations-you-shouldn-t-do.html">some time ago</a>, I am working on a new intermediate language within the OCaml compiler to improve its inlining strategy. After some time of bug squashing, I prepared a testable version of the patchset, available either on <a href="https://github.com/chambart/ocaml.git">Github</a> (branch <code>flambda_experiments</code>), or through OPAM, in the following repository:</p><pre><code>opam repo add inlining https://github.com/OCamlPro/opam-compilers-repository.git opam switch flambda opam install inlining-benchs </code></pre><p>The series of patches is not ready for benchmarking against real applications, as no cross module information is propagated yet (this is more practical for development because it simplifies debugging a lot), but it already works quite well on single-file code. Some very simple benchmark examples are available in the <code>inlining-benchs</code> package.</p><p>The series of patches implements a set of 'reasonable' compilation passes, that do not try anything too complicated, but combined, generates quite efficient code.</p><h2>Current Status</h2><p>As said in the previous post, I decided to design a new intermediate language to implement better inlining heuristics in the compiler. This intermediate language, called <code>flambda</code>, lies between the <code>lambda</code> code and the <code>Clambda</code> code. It has an explicit representation of closures, making them easier to manipulate, and modules do not appear in it anymore (they have already been compiled to static structures).</p><p>I then started to implement new inlining heuristics as functions from the <code>lambda</code> code to the <code>flambda</code> code. The following features are already present:</p><ul> <li> <p>intra function value analysis</p> </li><li> <p>variable rebinding</p> </li><li> <p>dead code elimination (which needs purity analysis)</p> </li><li> <p>known match / if branch elimination</p> </li> </ul><p>In more detail, the chosen strategy is divided into two passes, which can be described by the following pseudo-code:</p><pre><code>1st: if function is at toplevel then if applied to at least one constant OR small enough then inline else if applied to at least one constant AND small enough then inline 2nd: if function is small enough AND does not contain local function declarations then inline </code></pre><p>The first pass eliminates most functor applications and functions of the kind:</p><pre><code>let iter f x = let rec aux x = ... f ... in aux x </code></pre><p>The second pass eliminates the same kind of functions as Ocaml 4.01, but being after the first pass, it can also inline functions revealed by inlining functors.</p><h2>Benchmarks</h2><p>I ran a few benchmarks to ensure that there were no obvious miscompilations (and there were, but they are now fixed). On benchmarks that were too carefully written there was not much gain, but I got interesting results on some examples: those illustrate quite well the improvements, and can be seen at <code>$(opam config var lib)/inlining-benchs</code> (binaries at <code>$(opam congfig var bin)/bench-*</code>).</p><h3>The Knuth-Bendix Benchmark (single-file)</h3><p>Performance gains against OCaml 4.01 are around 20%. The main difference is that exceptions are compiled to constants, hence not allocated when raised. In that particular example, this halves the allocations.</p><p>In general, constant exceptions can be compiled to constants when predefined (<code>Not_found</code>, <code>Failure</code>, ...). They cannot yet when user defined: to improve this a few things need to be changed in <code>translcore.ml</code> to annotate values created by exceptions.</p><h3>The Noiz Benchmark:</h3><p>Performance gains are around 30% against OCaml 4.01. This code uses a lot of higher order functions of the kind:</p><pre><code>let map_triple f (a,b,c) = (f a, f b, f c) </code></pre><p>OCaml 4.01 can inline <code>map_triple</code> itself but then cannot inline the parameter <code>f</code>. Moreover, when writing:</p><pre><code>let (x,y,z) = map_triple f (1,2,3) </code></pre><p>the tuples are not really used, and after inlining their allocations can be eliminated (thanks to rebinding and dead code elimination)</p><h3>The Set Example</h3><p>Performance gains are around 20% compared to OCaml 4.01. This example shows how inlining can help defunctorization: when inlining the <code>Set</code> functor, the provided comparison function can be inlined in <code>Set.add</code>, allowing direct calls everywhere.</p><h2>Known Bugs</h2><h3>Recursive Values</h3><p>A problem may arise in a rare case of recursive values where a field access can be considered to be a constant. Something that would look like (if it were allowed):</p><pre><code>type 'a v = { v : 'a } let rec a = { v = b } and b = (a.v, a.v) </code></pre><p>I have a few solutions, but not sure yet which one is best. This probably won't appear in any normal test. This bug manifests trough a segmentation fault (<code>cmmgen</code> fails to compile that recursive value reasonably).</p><h3>Pattern-Matching</h3><p>The new passes assume that every identifier is declared only once in a given module, but this assumption can be broken on some rare pattern matching cases. I will have to dig through <code>matching.ml</code> to add a substitution in these cases. (the only non hand-built occurence that I found is in <code>ocamlnet</code>)</p><h2>known Mis-compilations</h2><ul> <li> <p>since there is no cross-module information at the moment, calls to functions from other modules are always slow.</p> </li><li> <p>In some rare cases, there could be functions with more values in their closure, thus resulting in more allocations.</p> </li> </ul><h2>What's next ?</h2><p>I would now like to add back cross-module information, and after a bit of cleanup the first series of patches should be ready to propose upstream.</p><a onclick="switchContent('post4','post3')" class="btn" href="#e70b78d2f071d064b2754bbde1303c23">Hide</a></div></span>
<a name="0f7b4061250fa9b12ae7a41ae883a8b9"></a><span class="rss-header"><span class="rss-title"><a href="http://functional-orbitz.blogspot.com/2013/07/experimenting-in-api-design-riakc.html"> Experimenting in API Design: Riakc</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author"><span id="ocaml_2">Orbitz &#9001;noreply<abbr title="(at) &rarr; @">(at)</abbr>blogger.com (orbitz)&#9002;</span><script type="text/javascript"><!--;
local = "noreply";
h = "blogger.com (orbitz)";
hq = "blogger.com%20(orbitz)";
document.getElementById("ocaml_2").innerHTML = '<a href="mailto:' + local + '@' + hq + "\" >Orbitz<\/a>";
//--></script></span>, <span class="rss-date">09 Jul 2013</span></span><span class="rss-description"><div id="post5"><p><i>Disclaimer: Riakc's API is in flux so not all of the code here is guaranteed to work by the time you read this post. However the general principles should hold. </i></p> <p>While not perfect, Riakc attempts to provide an API that is very hard to use incorrectly, and hopefully easy to use correctly. The idea being that using Riakc incorrectly will result in a compile-time error. Riakc derives its strength from being written in Ocaml, a language with a very expressive type system. Here are some examples of where I think Riakc is successful. </p> <h1>Siblings</h1><p>In Riak, when you perform a <code>GET</code> you can get back multiple values associated with the a single key. This is known as siblings. However, a <code>PUT</code> can only associate one value with a key. However, it is convenient to use the same object type for both <code>GET</code> and <code>PUT</code>. In the case of Riakc, that is a <code>Riakc.Robj.t</code>. But, what to do if you create a <code>Robj.t</code> with siblings and try to <code>PUT</code>? In the Ptyhon client you will get a runtime error. Riakc solves this by using phantom types. A <code>Robj.t</code> isn't actually just that, it's a <code>'a Robj.t</code>. The API requires that <code>'a</code> to be something specific at different parts of the code. Here is the simplified type for <code>GET</code>: </p> <pre><code><b></b></code></pre><font color="#0000FF">val</font> get <font color="#990000">:</font><br/> t <font color="#990000">-&gt;</font><br/><a onclick="switchContent('post5','post6')" class="btn" href="#0f7b4061250fa9b12ae7a41ae883a8b9">Read more...</a></div><div id="post6" style="display: none"><p><i>Disclaimer: Riakc's API is in flux so not all of the code here is guaranteed to work by the time you read this post. However the general principles should hold. </i></p> <p>While not perfect, Riakc attempts to provide an API that is very hard to use incorrectly, and hopefully easy to use correctly. The idea being that using Riakc incorrectly will result in a compile-time error. Riakc derives its strength from being written in Ocaml, a language with a very expressive type system. Here are some examples of where I think Riakc is successful. </p> <h1>Siblings</h1><p>In Riak, when you perform a <code>GET</code> you can get back multiple values associated with the a single key. This is known as siblings. However, a <code>PUT</code> can only associate one value with a key. However, it is convenient to use the same object type for both <code>GET</code> and <code>PUT</code>. In the case of Riakc, that is a <code>Riakc.Robj.t</code>. But, what to do if you create a <code>Robj.t</code> with siblings and try to <code>PUT</code>? In the Ptyhon client you will get a runtime error. Riakc solves this by using phantom types. A <code>Robj.t</code> isn't actually just that, it's a <code>'a Robj.t</code>. The API requires that <code>'a</code> to be something specific at different parts of the code. Here is the simplified type for <code>GET</code>: </p> <pre><code><b></b></code></pre><font color="#0000FF">val</font> get <font color="#990000">:</font><br/> t <font color="#990000">-&gt;</font><br/> b<font color="#990000">:</font><font color="#009900">string</font> <font color="#990000">-&gt;</font><br/> <font color="#009900">string</font> <font color="#990000">-&gt;</font><br/> <font color="#990000">([</font> `<font color="#009900">Maybe_siblings</font> <font color="#990000">]</font> <b><font color="#000080">Robj</font></b><font color="#990000">.</font>t<font color="#990000">,</font> error<font color="#990000">)</font> <b><font color="#000080">Deferred</font></b><font color="#990000">.</font><b><font color="#000080">Result</font></b><font color="#990000">.</font>t<br/> <p>And here is the simplified type for <code>PUT</code>: </p> <pre><code><b></b></code></pre><font color="#0000FF">val</font> put <font color="#990000">:</font><br/> t <font color="#990000">-&gt;</font><br/> b<font color="#990000">:</font><font color="#009900">string</font> <font color="#990000">-&gt;</font><br/> <font color="#990000">?</font>k<font color="#990000">:</font><font color="#009900">string</font> <font color="#990000">-&gt;</font><br/> <font color="#990000">[</font> `<font color="#009900">No_siblings</font> <font color="#990000">]</font> <b><font color="#000080">Robj</font></b><font color="#990000">.</font>t <font color="#990000">-&gt;</font><br/> <font color="#990000">(([</font> `<font color="#009900">Maybe_siblings</font> <font color="#990000">]</font> <b><font color="#000080">Robj</font></b><font color="#990000">.</font>t <font color="#990000">*</font> key<font color="#990000">),</font> error<font color="#990000">)</font> <b><font color="#000080">Deferred</font></b><font color="#990000">.</font><b><font color="#000080">Result</font></b><font color="#990000">.</font>t<br/> <p>The important part of the API is that <code>GET</code> returns a <code>[ `Maybe_siblings ] Riak.t</code> and <code>PUT</code> takes a <code>[ `No_siblings ] Riak.t</code>. How does one convert something that might have siblings to something that definitely doesn't? With <code>Riakc.Robj.set_content</code></p> <pre><code><b></b></code></pre><font color="#0000FF">val</font> set_content <font color="#990000">:</font> <b><font color="#000080">Content</font></b><font color="#990000">.</font>t <font color="#990000">-&gt;</font> 'a t <font color="#990000">-&gt;</font> <font color="#990000">[</font> `<font color="#009900">No_siblings</font> <font color="#990000">]</font> t<br/> <p><code>set_content</code> takes any kind of <code>Robj.t</code>, and a single <code>Content.t</code> and produces a <code>[ `No_siblings ] Riak.t</code>, because if you set contents to one value obviously you cannot have siblings. Now the type system can ensure that any call to <code>PUT</code> must have a <code>set_content</code> prior to it. </p> <h1>Setting 2i</h1><p>If you use the LevelDB backend you can use secondary indices, known as 2i, which allow you to find a set of keys based on some mapping. When you create an object you specify the mappings to which it belongs. Two types are supported in Riak: bin and int. And two query types are supported: equal and range. For example, if you encoded the time as an int you could use a range query to find all those keys that occurred within a range of times. </p> <p>Riak encodes the type of the index in the name. As an example, if you want to allow people to search by a field called "foo" which is a binary secondary index, you would name that index "foo_bin". In the Python Riak client, one sets an index with something like the following code: </p> <pre><code>obj</code></pre><font color="#990000">.</font><b><font color="#000000">add_index</font></b><font color="#990000">(</font><font color="#FF0000">'field1_bin'</font><font color="#990000">,</font> <font color="#FF0000">'val1'</font><font color="#990000">)</font><br/>obj<font color="#990000">.</font><b><font color="#000000">add_index</font></b><font color="#990000">(</font><font color="#FF0000">'field2_int'</font><font color="#990000">,</font> <font color="#993399">100000</font><font color="#990000">)</font><br/> <p>In Riakc, the naming convention is hidden from the user. Instead, the the name the field will become is encoded in the value. The Python code looks like the following in Riakc: </p> <pre><code><b></b></code></pre><font color="#0000FF">let</font> <b><font color="#0000FF">module</font></b> <font color="#009900">R</font> <font color="#990000">=</font> <b><font color="#000080">Riakc</font></b><font color="#990000">.</font><font color="#009900">Robj</font> <b><font color="#0000FF">in</font></b><br/><b><font color="#0000FF">let</font></b> index1 <font color="#990000">=</font><br/> <b><font color="#000080">R</font></b><font color="#990000">.</font>index_create<br/> <font color="#990000">~</font>k<font color="#990000">:</font><font color="#FF0000">"field1"</font><br/> <font color="#990000">~</font>v<font color="#990000">:(</font><b><font color="#000080">R</font></b><font color="#990000">.</font><b><font color="#000080">Index</font></b><font color="#990000">.</font><font color="#009900">String</font> <font color="#FF0000">"val1"</font><font color="#990000">)</font><br/><b><font color="#0000FF">in</font></b><br/><b><font color="#0000FF">let</font></b> index2 <font color="#990000">=</font><br/> <b><font color="#000080">R</font></b><font color="#990000">.</font>index_create<br/> <font color="#990000">~</font>k<font color="#990000">:</font><font color="#FF0000">"field2"</font><br/> <font color="#990000">~</font>v<font color="#990000">:(</font><b><font color="#000080">R</font></b><font color="#990000">.</font><b><font color="#000080">Index</font></b><font color="#990000">.</font><font color="#009900">Integer</font> <font color="#993399">10000</font><font color="#990000">)</font><br/><b><font color="#0000FF">in</font></b><br/><b><font color="#000080">R</font></b><font color="#990000">.</font>set_content<br/> <font color="#990000">(</font><b><font color="#000080">R</font></b><font color="#990000">.</font><b><font color="#000080">Content</font></b><font color="#990000">.</font>set_indices <font color="#990000">[</font>index1<font color="#990000">;</font> index2<font color="#990000">]</font> content<font color="#990000">)</font><br/> robj<br/> <p>When the <code>Robj.t</code> is written to the DB, "field1" and "field2" will be transformed into their appropriate names. </p> <p>Reading from Riak results in the same translation happening. If Riakc cannot determine the type of the value from the field name, for example if Riak gets a new index type, the field name maintains its precise name it got from Riak and the value is a <code>Riakc.Robj.Index.Unknown string</code>. </p> <p>In this way, we are guaranteed at compile-time that the name of the field will always match its type. </p> <h1>2i Searching</h1><p>With objects containing 2i entries, it is possible to search by values in those fields. Riak allows for searching fields by their exact value or ranges of values. While it's unclear from the Riak docs, Riakc enforces the two values in a range query are of the same type. Also, like in setting 2i values, the field name is generated from the type of the value. It is more verbose than the Python client but it enforces constraints. </p> <p>Here is a Python 2i search followed by the equivalent search in Riakc. </p> <pre><code>results </code></pre><font color="#990000">=</font> client<font color="#990000">.</font><b><font color="#000000">index</font></b><font color="#990000">(</font><font color="#FF0000">'mybucket'</font><font color="#990000">,</font> <font color="#FF0000">'field1_bin'</font><font color="#990000">,</font> <font color="#FF0000">'val1'</font><font color="#990000">,</font> <font color="#FF0000">'val5'</font><font color="#990000">).</font><b><font color="#000000">run</font></b><font color="#990000">()</font><br/> <pre><code><b></b></code></pre><font color="#000080">Riakc</font><font color="#990000">.</font><b><font color="#000080">Conn</font></b><font color="#990000">.</font>index_search<br/> conn<br/> <font color="#990000">~</font>b<font color="#990000">:</font><font color="#FF0000">"mybucket"</font><br/> <font color="#990000">~</font>index<font color="#990000">:</font><font color="#FF0000">"field1"</font><br/> <font color="#990000">(</font>range_string<br/> <font color="#990000">~</font>min<font color="#990000">:</font><font color="#FF0000">"val1"</font><br/> <font color="#990000">~</font>max<font color="#990000">:</font><font color="#FF0000">"val2"</font><br/> <font color="#990000">~</font>return_terms<font color="#990000">:</font><b><font color="#0000FF">false</font></b><font color="#990000">)</font><br/> <h1>Conclusion</h1><p>It's a bit unfair comparing an Ocaml API to a Python one, but hopefully this has demonstrated that with a reasonable type system one can express safe and powerful APIs without being inconvenient. </p><a onclick="switchContent('post6','post5')" class="btn" href="#0f7b4061250fa9b12ae7a41ae883a8b9">Hide</a></div></span>
<a name="641328ff76e1de2ca7254ef8a4c14115"></a><span class="rss-header"><span class="rss-title"><a href="http://alan.petitepomme.net/cwn/2013.07.09.html"> Caml Weekly News, 09 Jul 2013</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Caml Weekly News</span>, <span class="rss-date">09 Jul 2013</span></span><span class="rss-description">OCamlOScope: a new OCaml API search / llpp v16 / Other Caml News</span>
<a name="16902b1ec793bf3116ce09679cdd26aa"></a><span class="rss-header"><span class="rss-title"><a href="http://gallium.inria.fr/blog/gpu_memory_model"> GPU memory model</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">GaGallium</span>, <span class="rss-date">05 Jul 2013</span></span><span class="rss-description"><div id="post7"><p>Following a discussion that occurred at Gallium, I recently wondered what was the kind of memory model exposed by a GPU (read: my awesome gamer's GPU).</p> <p>Most programmers assume what is called a "sequentially consistent" (SC) memory model: that is, parallel programs execute as if instructions from various threads were interleaved. Seasoned programmers will know that the memory model exhibited by modern multi-core processors is not SC, but much more arcane.</p> <p><a href="http://moscova.inria.fr/~maranget/">Luc</a>, one of Gallium's researchers, spends a considerable amount of time testing various kind of processors to unravel what memory model they expose, and whether or not a given processor is correct with respect to its "model". The industry often provides informal textual documentation of models that is barely understandable. One better way to document a memory model is to describe what are the allowed results of so-called litmus tests.</p> <p>A customary litmus-test is the following, where we execute two threads <code>p1</code> and <code>p2</code>:</p> <pre><code>| p1 | p2 | |---------+---------| | x &lt;- 1 | y &lt;- 1 | | r1 &lt;- y | r2 &lt;- x |</code></pre> <a onclick="switchContent('post7','post8')" class="btn" href="#16902b1ec793bf3116ce09679cdd26aa">Read more...</a></div><div id="post8" style="display: none"><p>Following a discussion that occurred at Gallium, I recently wondered what was the kind of memory model exposed by a GPU (read: my awesome gamer's GPU).</p> <p>Most programmers assume what is called a "sequentially consistent" (SC) memory model: that is, parallel programs execute as if instructions from various threads were interleaved. Seasoned programmers will know that the memory model exhibited by modern multi-core processors is not SC, but much more arcane.</p> <p><a href="http://moscova.inria.fr/~maranget/">Luc</a>, one of Gallium's researchers, spends a considerable amount of time testing various kind of processors to unravel what memory model they expose, and whether or not a given processor is correct with respect to its "model". The industry often provides informal textual documentation of models that is barely understandable. One better way to document a memory model is to describe what are the allowed results of so-called litmus tests.</p> <p>A customary litmus-test is the following, where we execute two threads <code>p1</code> and <code>p2</code>:</p> <pre><code>| p1 | p2 | |---------+---------| | x &lt;- 1 | y &lt;- 1 | | r1 &lt;- y | r2 &lt;- x |</code></pre> <p>Here, <code>x</code>, <code>y</code>, <code>r1</code>, <code>r2</code> are initialized to <code>0</code>. Considering all possible interleavings of this code makes it clear that <code>r1</code> or <code>r2</code> (maybe both) must be equal to <code>1</code> at the end of the execution of <code>p1</code> and <code>p2</code>. But, on non-SC architectures, it is also possible to see <code>r1 = r2 = 0</code> at the end of the execution. (In the nomenclature defined in <a href="http://www.cl.cam.ac.uk/~pes20/ppc-supplemental/pldi105-sarkar.pdf">this paper</a>, this test is called SB, which stands for "store buffering".)</p> <p>Another common test is the following</p> <pre><code>| p1 | p2 | |---------+----------| | x &lt;- 1 | r2 &lt;- y | | y &lt;- 1 | r1 &lt;- x |</code></pre> <p>Here, the experimental situation makes it possible to determine whether or not the read-after-read and writes-after-writes dependencies are preserved. If <code>r2 = 1</code> and <code>r1 = 0</code>, then it means that writes do not appear in program order. (In the aforementioned nomenclature, this test is named MP, for "message passing".)</p> <p>There are more complex tests, that involves things such as locked instructions, barriers and so on, but I am not an expert on this, and I secretly hope that Luc will jump in and write a blog post about it. I will rather come back on the subject of this post: is my GPU sequentially consistent?</p> <p>I translated the above litmus tests in CUDA kernels, and wrote C programs that execute the litmus tests under various conditions till the relaxed behaviors appear. Then, I compiled these programs using the NVidia <code>nvcc</code> compiler, and ran them on my computer<sup><a href="http://gallium.inria.fr/blog/index.rss#fn1" id="fnref1" class="footnoteRef">1</a></sup>.</p> <p>Let's cut down the chase: as you may have guessed, the relaxed behaviors do appear. The interesting point is that for some values of the experimental parameters we choose, they may appear more or less often (and for some values, never). To be more specific, the experimental parameter I am speaking about is the amount of copies of the test that are run in parallel, and whether or not two threads that interact together are "close": basically, we execute N times the same litmus test at once, which involves 2N threads. These threads are executed in batches called "warps" of 32 threads at once, and the behaviors we get seems to depend on whether interacting threads are in the same warp or not<sup><a href="http://gallium.inria.fr/blog/index.rss#fn2" id="fnref2" class="footnoteRef">2</a></sup></p> <p>Of course, if I had read carefully the NVidia documentation (PTX isa 3.1, Section 5.1.4) beforehand, I would have found a less-than-cristal-clear explanation like the following one:</p> <blockquote> <p>Global memory is not sequentially consistent. Consider the case where one thread executes the following two assignments:</p> <pre><code>a = a + 1; b = b – 1;</code></pre> <p>If another thread sees the variable <code>b</code> change, the store operation updating <code>a</code> may still be in flight. This reiterates the kind of parallelism available in machines that run PTX.</p> </blockquote> <p>But this would have made for a less dramatic blog post... Moreover, I hope that it helps convey the idea that memory models are a "formal" thing, that can be studied experimentally (as Luc does), but can also be formalized in a proof assistant (as <a href="http://www0.cs.ucl.ac.uk/staff/j.alglave/">Jade</a> does).</p> <p>I think it would be interesting to extend the kind of attention that was given to the memory models of CPUs to GPUs, in terms of testing and formalizations (the semantics of NVidia's PTX ISA). Of course, I am just being curious here, since it is not my field of research. But if you are looking for a research internship and this interests you, you should definitely contact Luc ;).</p> <div class="footnotes"> <hr/> <ol> <li id="fn1"><p>these tests are available upon request<a href="http://gallium.inria.fr/blog/index.rss#fnref1">↩</a></p></li> <li id="fn2"><p>it is likely that this explanation is incomplete or even incorrect, but it conveys the idea of what shows up in the tests.<a href="http://gallium.inria.fr/blog/index.rss#fnref2">↩</a></p></li> </ol> </div><a onclick="switchContent('post8','post7')" class="btn" href="#16902b1ec793bf3116ce09679cdd26aa">Hide</a></div></span>
<a name="d8dd4879fad2a6db09096b12cd657497"></a><span class="rss-header"><span class="rss-title"><a href="http://www.amazon.co.uk/review/R28WYJ13WA94YL/ref=cm_cr_rdp_perm?ie=UTF8&ASIN=0957671105&linkCode=&nodeID=&tag="> On the book « OCaml from the very beginning »</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Daniel Bünzli</span>, <span class="rss-date">04 Jul 2013</span></span><span class="rss-description">Cambridge overflows with OCaml programmers. I got to meet John Whitington of <a href="http://www.coherentpdf.com/ocaml-libraries.html">camlpdf</a> fame. He kindly offered me a copy of his book « <a href="http://ocaml-book.com">OCaml from the very beginning</a>. » I read it and made a small review <a href="http://www.amazon.co.uk/review/R28WYJ13WA94YL/ref=cm_cr_rdp_perm?ie=UTF8&amp;ASIN=0957671105&amp;linkCode=&amp;nodeID=&amp;tag=">here</a>.</span>
<a name="7f392fbf92d0462ee6d04e5fcbc746d2"></a><span class="rss-header"><span class="rss-title"><a href="http://functional-orbitz.blogspot.com/2013/07/riakc-in-five-minutes.html"> Riakc In Five Minutes</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author"><span id="ocaml_3">Orbitz &#9001;noreply<abbr title="(at) &rarr; @">(at)</abbr>blogger.com (orbitz)&#9002;</span><script type="text/javascript"><!--;
local = "noreply";
h = "blogger.com (orbitz)";
hq = "blogger.com%20(orbitz)";
document.getElementById("ocaml_3").innerHTML = '<a href="mailto:' + local + '@' + hq + "\" >Orbitz<\/a>";
//--></script></span>, <span class="rss-date">04 Jul 2013</span></span><span class="rss-description"><div id="post9"><p>This is a simple example using Riakc to PUT a key into a Riak database. It assumes that you already have a Riak database up and running. </p> <p>First you need to install riakc. Simply do: <code>opam install riakc</code>. As of this writing, the latest version of riakc is 2.0.0 and the code given depends on that version. </p> <p>Now, the code. The following is a complete CLI tool that will PUT a key and print back the result from Riak. It handles all errors that the library can generate as well as outputting siblings correctly. </p> <pre><code><i></i></code></pre><font color="#9A1900">(*</font><br/><i><font color="#9A1900"> * This example is valid for version 2.0.0, and possibly later</font></i><br/><i><font color="#9A1900"> *)</font></i><br/><b><font color="#000080">open</font></b> <b><font color="#000080">Core</font></b><font color="#990000">.</font><font color="#009900">Std</font><br/><b><font color="#000080">open</font></b> <b><font color="#000080">Async</font></b><font color="#990000">.</font><font color="#009900">Std</font><br/><br/><i><font color="#9A1900">(*</font></i><br/><i><font color="#9A1900"> * Take a string of bytes and convert them to hex string</font></i><br/><i><font color="#9A1900"> * representation</font></i><br/><i><font color="#9A1900"> *)</font></i><br/><b><font color="#0000FF">let</font></b> hex_of_string <font color="#990000">=</font><br/> <b><font color="#000080">String</font></b><font color="#990000">.</font>concat_map <font color="#990000">~</font>f<font color="#990000">:(</font><b><font color="#0000FF">fun</font></b> c <font color="#990000">-&gt;</font> sprintf <font color="#FF0000">"%X"</font> <font color="#990000">(</font><b><font color="#000080">Char</font></b><font color="#990000">.</font>to_int c<font color="#990000">))</font><br/><br/><i><font color="#9A1900">(*</font></i><br/><i><font color="#9A1900"> * An Robj can have multiple values in it, each one with its</font></i><br/><i><font color="#9A1900"> * own content type, encoding, and value. This just prints</font></i><br/><i><font color="#9A1900"> * the value, which is a string blob</font></i><br/><i><font color="#9A1900"> *)</font></i><br/><b><font color="#0000FF">let</font></b> print_contents contents <font color="#990000">=</font><br/> <b><font color="#000080">List</font></b><font color="#990000">.</font>iter<br/> <font color="#990000">~</font>f<font color="#990000">:(</font><b><font color="#0000FF">fun</font></b> content <font color="#990000">-&gt;</font><br/> <b><font color="#0000FF">let</font></b> <b><font color="#0000FF">module</font></b> <font color="#009900">C</font> <font color="#990000">=</font> <b><font color="#000080">Riakc</font></b><font color="#990000">.</font><b><font color="#000080">Robj</font></b><font color="#990000">.</font><font color="#009900">Content</font> <b><font color="#0000FF">in</font></b><br/> printf <font color="#FF0000">"VALUE: %s\n"</font> <font color="#990000">(</font><b><font color="#000080">C</font></b><font color="#990000">.</font>value content<font color="#990000">))</font><br/> contents<br/><br/><b><font color="#0000FF">let</font></b> fail s <font color="#990000">=</font><br/> printf <font color="#FF0000">"%s\n"</font> s<font color="#990000">;</font><br/> shutdown <font color="#993399">1</font><br/><br/><b><font color="#0000FF">let</font></b> exec <font color="#990000">()</font> <font color="#990000">=</font><br/> <b><font color="#0000FF">let</font></b> host <font color="#990000">=</font> <b><font color="#000080">Sys</font></b><font color="#990000">.</font>argv<font color="#990000">.(</font><font color="#993399">1</font><font color="#990000">)</font> <b><font color="#0000FF">in</font></b><br/> <b><font color="#0000FF">let</font></b> port <font color="#990000">=</font> <b><font color="#000080">Int</font></b><font color="#990000">.</font>of_string <b><font color="#000080">Sys</font></b><font color="#990000">.</font>argv<font color="#990000">.(</font><font color="#993399">2</font><font color="#990000">)</font> <b><font color="#0000FF">in</font></b><br/> <i><font color="#9A1900">(*</font></i><br/><a onclick="switchContent('post9','post10')" class="btn" href="#7f392fbf92d0462ee6d04e5fcbc746d2">Read more...</a></div><div id="post10" style="display: none"><p>This is a simple example using Riakc to PUT a key into a Riak database. It assumes that you already have a Riak database up and running. </p> <p>First you need to install riakc. Simply do: <code>opam install riakc</code>. As of this writing, the latest version of riakc is 2.0.0 and the code given depends on that version. </p> <p>Now, the code. The following is a complete CLI tool that will PUT a key and print back the result from Riak. It handles all errors that the library can generate as well as outputting siblings correctly. </p> <pre><code><i></i></code></pre><font color="#9A1900">(*</font><br/><i><font color="#9A1900"> * This example is valid for version 2.0.0, and possibly later</font></i><br/><i><font color="#9A1900"> *)</font></i><br/><b><font color="#000080">open</font></b> <b><font color="#000080">Core</font></b><font color="#990000">.</font><font color="#009900">Std</font><br/><b><font color="#000080">open</font></b> <b><font color="#000080">Async</font></b><font color="#990000">.</font><font color="#009900">Std</font><br/><br/><i><font color="#9A1900">(*</font></i><br/><i><font color="#9A1900"> * Take a string of bytes and convert them to hex string</font></i><br/><i><font color="#9A1900"> * representation</font></i><br/><i><font color="#9A1900"> *)</font></i><br/><b><font color="#0000FF">let</font></b> hex_of_string <font color="#990000">=</font><br/> <b><font color="#000080">String</font></b><font color="#990000">.</font>concat_map <font color="#990000">~</font>f<font color="#990000">:(</font><b><font color="#0000FF">fun</font></b> c <font color="#990000">-&gt;</font> sprintf <font color="#FF0000">"%X"</font> <font color="#990000">(</font><b><font color="#000080">Char</font></b><font color="#990000">.</font>to_int c<font color="#990000">))</font><br/><br/><i><font color="#9A1900">(*</font></i><br/><i><font color="#9A1900"> * An Robj can have multiple values in it, each one with its</font></i><br/><i><font color="#9A1900"> * own content type, encoding, and value. This just prints</font></i><br/><i><font color="#9A1900"> * the value, which is a string blob</font></i><br/><i><font color="#9A1900"> *)</font></i><br/><b><font color="#0000FF">let</font></b> print_contents contents <font color="#990000">=</font><br/> <b><font color="#000080">List</font></b><font color="#990000">.</font>iter<br/> <font color="#990000">~</font>f<font color="#990000">:(</font><b><font color="#0000FF">fun</font></b> content <font color="#990000">-&gt;</font><br/> <b><font color="#0000FF">let</font></b> <b><font color="#0000FF">module</font></b> <font color="#009900">C</font> <font color="#990000">=</font> <b><font color="#000080">Riakc</font></b><font color="#990000">.</font><b><font color="#000080">Robj</font></b><font color="#990000">.</font><font color="#009900">Content</font> <b><font color="#0000FF">in</font></b><br/> printf <font color="#FF0000">"VALUE: %s\n"</font> <font color="#990000">(</font><b><font color="#000080">C</font></b><font color="#990000">.</font>value content<font color="#990000">))</font><br/> contents<br/><br/><b><font color="#0000FF">let</font></b> fail s <font color="#990000">=</font><br/> printf <font color="#FF0000">"%s\n"</font> s<font color="#990000">;</font><br/> shutdown <font color="#993399">1</font><br/><br/><b><font color="#0000FF">let</font></b> exec <font color="#990000">()</font> <font color="#990000">=</font><br/> <b><font color="#0000FF">let</font></b> host <font color="#990000">=</font> <b><font color="#000080">Sys</font></b><font color="#990000">.</font>argv<font color="#990000">.(</font><font color="#993399">1</font><font color="#990000">)</font> <b><font color="#0000FF">in</font></b><br/> <b><font color="#0000FF">let</font></b> port <font color="#990000">=</font> <b><font color="#000080">Int</font></b><font color="#990000">.</font>of_string <b><font color="#000080">Sys</font></b><font color="#990000">.</font>argv<font color="#990000">.(</font><font color="#993399">2</font><font color="#990000">)</font> <b><font color="#0000FF">in</font></b><br/> <i><font color="#9A1900">(*</font></i><br/><i><font color="#9A1900"> * [with_conn] is a little helper function that will</font></i><br/><i><font color="#9A1900"> * establish a connection, run a function on the connection</font></i><br/><i><font color="#9A1900"> * and tear it down when done</font></i><br/><i><font color="#9A1900"> *)</font></i><br/> <b><font color="#000080">Riakc</font></b><font color="#990000">.</font><b><font color="#000080">Conn</font></b><font color="#990000">.</font>with_conn<br/> <font color="#990000">~</font>host<br/> <font color="#990000">~</font>port<br/> <font color="#990000">(</font><b><font color="#0000FF">fun</font></b> c <font color="#990000">-&gt;</font><br/> <b><font color="#0000FF">let</font></b> <b><font color="#0000FF">module</font></b> <font color="#009900">R</font> <font color="#990000">=</font> <b><font color="#000080">Riakc</font></b><font color="#990000">.</font><font color="#009900">Robj</font> <b><font color="#0000FF">in</font></b><br/> <b><font color="#0000FF">let</font></b> content <font color="#990000">=</font> <b><font color="#000080">R</font></b><font color="#990000">.</font><b><font color="#000080">Content</font></b><font color="#990000">.</font>create <font color="#FF0000">"some random data"</font> <b><font color="#0000FF">in</font></b><br/> <b><font color="#0000FF">let</font></b> robj <font color="#990000">=</font> <b><font color="#000080">R</font></b><font color="#990000">.</font>create <font color="#990000">[]</font> <font color="#990000">|&gt;</font> <b><font color="#000080">R</font></b><font color="#990000">.</font>set_content content <b><font color="#0000FF">in</font></b><br/> <i><font color="#9A1900">(*</font></i><br/><i><font color="#9A1900"> * Put takes a bucket, a key, and an optional list of</font></i><br/><i><font color="#9A1900"> * options. In this case we are setting the</font></i><br/><i><font color="#9A1900"> * [Return_body] option which returns what the key</font></i><br/><i><font color="#9A1900"> * looks like after the put. It is possible that</font></i><br/><i><font color="#9A1900"> * siblings were created.</font></i><br/><i><font color="#9A1900"> *)</font></i><br/> <b><font color="#000080">Riakc</font></b><font color="#990000">.</font><b><font color="#000080">Conn</font></b><font color="#990000">.</font>put<br/> c<br/> <font color="#990000">~</font>b<font color="#990000">:</font><font color="#FF0000">"test_bucket"</font><br/> <font color="#990000">~</font>k<font color="#990000">:</font><font color="#FF0000">"test_key"</font><br/> <font color="#990000">~</font>opts<font color="#990000">:[</font><b><font color="#000080">Riakc</font></b><font color="#990000">.</font><b><font color="#000080">Opts</font></b><font color="#990000">.</font><b><font color="#000080">Put</font></b><font color="#990000">.</font><font color="#009900">Return_body</font><font color="#990000">]</font><br/> robj<font color="#990000">)</font><br/><br/><b><font color="#0000FF">let</font></b> eval <font color="#990000">()</font> <font color="#990000">=</font><br/> exec <font color="#990000">()</font> <font color="#990000">&gt;&gt;|</font> <b><font color="#0000FF">function</font></b><br/> <font color="#990000">|</font> <font color="#009900">Ok</font> <font color="#990000">(</font>robj<font color="#990000">,</font> key<font color="#990000">)</font> <font color="#990000">-&gt;</font> <b><font color="#0000FF">begin</font></b><br/> <i><font color="#9A1900">(*</font></i><br/><i><font color="#9A1900"> * [put] returns a [Riakc.Robj.t] and a [string</font></i><br/><i><font color="#9A1900"> * option], which is the key if Riak had to generate</font></i><br/><i><font color="#9A1900"> * it</font></i><br/><i><font color="#9A1900"> *)</font></i><br/> <b><font color="#0000FF">let</font></b> <b><font color="#0000FF">module</font></b> <font color="#009900">R</font> <font color="#990000">=</font> <b><font color="#000080">Riakc</font></b><font color="#990000">.</font><font color="#009900">Robj</font> <b><font color="#0000FF">in</font></b><br/> <i><font color="#9A1900">(*</font></i><br/><i><font color="#9A1900"> * Extract the vclock, if it exists, and convert it to</font></i><br/><i><font color="#9A1900"> * to something printable</font></i><br/><i><font color="#9A1900"> *)</font></i><br/> <b><font color="#0000FF">let</font></b> vclock <font color="#990000">=</font><br/> <b><font color="#000080">Option</font></b><font color="#990000">.</font>value<br/> <font color="#990000">~</font>default<font color="#990000">:</font><font color="#FF0000">"&lt;none&gt;"</font><br/> <font color="#990000">(</font><b><font color="#000080">Option</font></b><font color="#990000">.</font>map <font color="#990000">~</font>f<font color="#990000">:</font>hex_of_string <font color="#990000">(</font><b><font color="#000080">R</font></b><font color="#990000">.</font>vclock robj<font color="#990000">))</font><br/> <b><font color="#0000FF">in</font></b><br/> <b><font color="#0000FF">let</font></b> key <font color="#990000">=</font> <b><font color="#000080">Option</font></b><font color="#990000">.</font>value <font color="#990000">~</font>default<font color="#990000">:</font><font color="#FF0000">"&lt;none&gt;"</font> key <b><font color="#0000FF">in</font></b><br/> printf <font color="#FF0000">"KEY: %s\n"</font> key<font color="#990000">;</font><br/> printf <font color="#FF0000">"VCLOCK: %s\n"</font> vclock<font color="#990000">;</font><br/> print_contents <font color="#990000">(</font><b><font color="#000080">R</font></b><font color="#990000">.</font>contents robj<font color="#990000">);</font><br/> shutdown <font color="#993399">0</font><br/> <b><font color="#0000FF">end</font></b><br/> <i><font color="#9A1900">(*</font></i><br/><i><font color="#9A1900"> * These are the various errors that can be returned.</font></i><br/><i><font color="#9A1900"> * Many of then come directly from the ProtoBuf layer</font></i><br/><i><font color="#9A1900"> * since there aren't really any more semantics to apply</font></i><br/><i><font color="#9A1900"> * to the data if it matches the PB frame.</font></i><br/><i><font color="#9A1900"> *)</font></i><br/> <font color="#990000">|</font> <font color="#009900">Error</font> `<font color="#009900">Bad_conn</font> <font color="#990000">-&gt;</font> fail <font color="#FF0000">"Bad_conn"</font><br/> <font color="#990000">|</font> <font color="#009900">Error</font> `<font color="#009900">Bad_payload</font> <font color="#990000">-&gt;</font> fail <font color="#FF0000">"Bad_payload"</font><br/> <font color="#990000">|</font> <font color="#009900">Error</font> `<font color="#009900">Incomplete_payload</font> <font color="#990000">-&gt;</font> fail <font color="#FF0000">"Incomplete_payload"</font><br/> <font color="#990000">|</font> <font color="#009900">Error</font> `<font color="#009900">Notfound</font> <font color="#990000">-&gt;</font> fail <font color="#FF0000">"Notfound"</font><br/> <font color="#990000">|</font> <font color="#009900">Error</font> `<font color="#009900">Incomplete</font> <font color="#990000">-&gt;</font> fail <font color="#FF0000">"Incomplete"</font><br/> <font color="#990000">|</font> <font color="#009900">Error</font> `<font color="#009900">Overflow</font> <font color="#990000">-&gt;</font> fail <font color="#FF0000">"Overflow"</font><br/> <font color="#990000">|</font> <font color="#009900">Error</font> `<font color="#009900">Unknown_type</font> <font color="#990000">-&gt;</font> fail <font color="#FF0000">"Unknown_type"</font><br/> <font color="#990000">|</font> <font color="#009900">Error</font> `<font color="#009900">Wrong_type</font> <font color="#990000">-&gt;</font> fail <font color="#FF0000">"Wrong_type"</font><br/><br/><b><font color="#0000FF">let</font></b> <font color="#990000">()</font> <font color="#990000">=</font><br/> ignore <font color="#990000">(</font>eval <font color="#990000">());</font><br/> never_returns <font color="#990000">(</font><b><font color="#000080">Scheduler</font></b><font color="#990000">.</font>go <font color="#990000">())</font><br/> <p>Now compile it: </p> <pre><code>ocamlfind ocamlopt -thread -I +camlp4 -package riakc -c demo.ml<br/>ocamlfind ocamlopt -package riakc -thread -linkpkg \<br/>-o demo.native demo.cmx<br/></code></pre> <p>Finally, you can run it: <code>./demo.native <i>hostname</i> <i>port</i></code></p> <h1>...And More Detail</h1><p>The API for Riakc is broken up into two modules: <code>Riakc.Robj</code> and <code>Riakc.Conn</code> with <code>Riakc.Opts</code> being a third helper module. Below is in reference to version 2.0.0 of Riakc. </p> <h2>Riakc.Robj</h2><p><code>Riakc.Robj</code> defines a representation of an object stored in Riak. <code>Robj</code> is completely pure code. The API can be found <a href="https://github.com/orbitz/ocaml-riakc/blob/2.0.0/lib/riakc/robj.mli">here</a>. </p> <h2>Riakc.Conn</h2><p>This is the I/O layer. All interaction with the actual database happens through this module. <code>Riakc.Conn</code> is somewhat clever in that it has a compile-time requirement that you have called <code>Riakc.Robj.set_content</code> on any value you want to PUT. This guarantees you have resolved all siblings, somehow. Its API can be found <a href="https://github.com/orbitz/ocaml-riakc/blob/2.0.0/lib/riakc/conn.mli">here</a>. </p> <h2>Riakc.Opts</h2><p>Finally, various options are defined in <code>Riakc.Opts</code>. These are options that GET and PUT take. Not all of them are actually supported but support is planned. The API can be viewed <a href="https://github.com/orbitz/ocaml-riakc/blob/2.0.0/lib/riakc/opts.mli">here</a>. </p> <p>Hopefully Riakc has a fairly straight forward API. While the example code might be longer than other clients, it is complete and correct (I hope). </p><a onclick="switchContent('post10','post9')" class="btn" href="#7f392fbf92d0462ee6d04e5fcbc746d2">Hide</a></div></span>
<a name="dfd2b2b434f7a9b2152225e98e6ef5ec"></a><span class="rss-header"><span class="rss-title"><a href="http://camlspotter.blogspot.com/2013/07/ocamlscope-is-now-ocaml-heroku-app.html"> OCaml◎Scope is now an OCaml heroku app!</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author"><span id="ocaml_4">Caml Spotting &#9001;noreply<abbr title="(at) &rarr; @">(at)</abbr>blogger.com (Jun Furuse)&#9002;</span><script type="text/javascript"><!--;
local = "noreply";
h = "blogger.com (Jun Furuse)";
hq = "blogger.com%20(Jun%20Furuse)";
document.getElementById("ocaml_4").innerHTML = '<a href="mailto:' + local + '@' + hq + "\" >Caml Spotting<\/a>";
//--></script></span>, <span class="rss-date">03 Jul 2013</span></span><span class="rss-description">OCaml◎Scope, a new OCaml API search, is now a service running at <a href="http://ocamloscope.herokuapp.com/">http://ocamloscope.herokuapp.com</a>!<br/><br/><div style="clear: both; text-align: center;" class="separator"><a style="margin-left: 1em; margin-right: 1em; text-align: center;" href="http://ocamloscope.herokuapp.com/images/logo.svg"><img src="http://ocamloscope.herokuapp.com/images/logo.svg" height="131" border="0" width="320"/></a></div><br/>Change list:<br/><br/><ul><li>Now it no longer uses <a href="http://sourceforge.net/projects/ocaml-cgi/">CamlGI</a> but <a href="http://ocsigen.org/eliom/">Eliom</a> as the web engine. Eliom is much safer and easier to write!</li><li>DB carries 245302 entries from 76 OCamlFind packages.</li><li>Search algorithm tweak to get better results in shorter time</li><li>More query forms (see Examples)<div style="clear: both; text-align: center;" class="separator"><br/></div></li></ul></span>
<a name="10b672bb9a21c69969e0ff40f608bd74"></a><span class="rss-header"><span class="rss-title"><a href="http://gallium.inria.fr/blog/portable-conditionals-in-makefiles"> Portable conditionals in makefiles</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">GaGallium</span>, <span class="rss-date">02 Jul 2013</span></span><span class="rss-description"><div id="post11"><p>If you are <a href="http://caml.inria.fr/mantis/view.php?id=5737#c9658">writing software</a> that works on many variants of Unix, you are confronted to the problem of Makefiles: some systems use GNU make and others use BSD make and these two are compatible, but only on a very restricted subset. The most problematic restriction is that they don't have a common syntax for writing conditionals.</p> <p>So how do you write conditionals that work on both variants? GNU make and BSD make share so few of their "new" features (features that were not in UNIX make) that it looks like an impossible task.</p> <p>Let's say you have a variable <code>FOO</code> that contains either <code>true</code> or <code>false</code>, and you want your target <code>A</code> to depend on <code>B C D</code> in the first case, and on <code>E F G</code> in the second. I know two ways of doing that.</p> <h3 id="first-solution-substitution">First solution: substitution</h3> <p>The first solution is simple but not fully general. It uses substitution in variable references:</p> <pre><code>DEPS1 = ${FOO:true=B C D} DEPS2 = ${DEPS1:false=E F G} A : ${DEPS2} echo ${DEPS2}</code></pre> <p>This is quite ugly, it doesn't work if <code>false</code> appears in the value of the <code>true</code> case (here, <code>B C D</code>). Also, I don't think there is any way to extend it to handle a default case. But it's simple and relatively easy to understand.</p> <h3 id="second-solution-indirection">Second solution: indirection</h3> <a onclick="switchContent('post11','post12')" class="btn" href="#10b672bb9a21c69969e0ff40f608bd74">Read more...</a></div><div id="post12" style="display: none"><p>If you are <a href="http://caml.inria.fr/mantis/view.php?id=5737#c9658">writing software</a> that works on many variants of Unix, you are confronted to the problem of Makefiles: some systems use GNU make and others use BSD make and these two are compatible, but only on a very restricted subset. The most problematic restriction is that they don't have a common syntax for writing conditionals.</p> <p>So how do you write conditionals that work on both variants? GNU make and BSD make share so few of their "new" features (features that were not in UNIX make) that it looks like an impossible task.</p> <p>Let's say you have a variable <code>FOO</code> that contains either <code>true</code> or <code>false</code>, and you want your target <code>A</code> to depend on <code>B C D</code> in the first case, and on <code>E F G</code> in the second. I know two ways of doing that.</p> <h3 id="first-solution-substitution">First solution: substitution</h3> <p>The first solution is simple but not fully general. It uses substitution in variable references:</p> <pre><code>DEPS1 = ${FOO:true=B C D} DEPS2 = ${DEPS1:false=E F G} A : ${DEPS2} echo ${DEPS2}</code></pre> <p>This is quite ugly, it doesn't work if <code>false</code> appears in the value of the <code>true</code> case (here, <code>B C D</code>). Also, I don't think there is any way to extend it to handle a default case. But it's simple and relatively easy to understand.</p> <h3 id="second-solution-indirection">Second solution: indirection</h3> <p>The second solution works by applying David Wheeler's aphorism:</p> <blockquote> <p>All problems in computer science can be solved by another level of indirection.</p> </blockquote> <p>We'll use indirect variable references. This is a feature that, surprisingly, works the same in both flavours of make:</p> <pre><code>FOO = BAR BAR = toto all: echo ${${FOO}}</code></pre> <p>This will echo <code>toto</code>.</p> <p>Now, we have <code>FOO</code> that is either <code>true</code> or <code>false</code>, so we'll do this:</p> <pre><code>true = B C D false = E F G DEPS := ${${FOO}} A : ${DEPS} echo ${DEPS}</code></pre> <p>Note how the definition of <code>DEPS</code> uses <code>:=</code> rather than <code>=</code>. This is because we want to be able to reuse the variables <code>true</code> and <code>false</code> for another conditional. If we don't use <code>:=</code>, the assignment is lazy and <code>DEPS</code> gets a value based on the last values assigned to <code>true</code> and <code>false</code> (which may be further down in the makefile).</p> <h3 id="advanced-solution-more-indirection">Advanced solution: more indirection</h3> <p>The above obviously generalizes to more than two cases, but what about having a default case? Suppose that we want to do as above, but make <code>A</code> depend on <code>H I J</code> when <code>FOO</code> is set to anything else that <code>true</code> or <code>false</code> (or unset, which is the same as set to <code>""</code>). How do we do that?</p> <p>It's easy, just apply Wheeler's aphorism one more time:</p> <pre><code>unlikely_true = aaaa unlikely_false = bbbb xxx_aaaa = B C D xxx_bbbb = E F G xxx_ = H I J DEPS := ${xxx_${unlikely_${FOO}}} A : ${DEPS} echo ${DEPS}</code></pre> <p>This is getting ugly but it works. As long as you don't have any clash with some random variable whose name starts with <code>unlikely_</code>. And if you have several conditionals in your makefile, you probably should reset all these variables after using them:</p> <pre><code>unlikely_true = aaaa unlikely_false = bbbb xxx_aaaa = B C D xxx_bbbb = E F G xxx_ = H I J DEPS := ${xxx_${unlikely_${FOO}}} unlikely_true = unlikely_false = xxx_aaaa = xxx_bbbb = xxx_ = A : ${DEPS} echo ${DEPS}</code></pre> <p>This makefile has a nice property: you can use environment variables not only to override some cases, but also to add some cases without touching the makefile. For example:</p> <pre><code>make A unlikely_filenotfound=cccc xxx_cccc='X Y Z' FOO=filenotfound</code></pre> <p>This will use <code>X Y Z</code> for the dependencies of A.</p> <h3 id="obvious-solution-use-gmake">Obvious solution: use gmake</h3> <p>Of course, the obvious solution is to use GNUmake on BSD as well as Linux and MacOS, and write your makefiles for GNUmake only. That looks more reasonable than the above. Unless you have to deal with some BSD fanatics who don't want to install GNU make on their machine.</p> <p>Anyway, I started with the explicit (but maybe unreasonable) constraint of making portable makefiles. Over the years I've heard a number of very smart people claim that it was impossible, and I set out to prove them wrong. Mission accomplished.</p><a onclick="switchContent('post12','post11')" class="btn" href="#10b672bb9a21c69969e0ff40f608bd74">Hide</a></div></span>
<script type="text/javascript">function switchContent(id1,id2) {
     // Get the DOM reference
     var contentId1 = document.getElementById(id1);
     var contentId2 = document.getElementById(id2);
     // Toggle
     contentId1.style.display = "none";
     contentId2.style.display = "block";
     }</script></div>

  
    </div>

    
    <br/>
    <hr/>
    <div id="footer">
      Contribute to this project!
      Find us on <a href="https://github.com/ocaml/ocaml.org">Github</a>.
    </div>
    <span title=".././img/ = image directory from the base of the site"></span>


    
    
    

    <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
    <script src=".././js/jquery-1.8.0.min.js"></script>
    
    <script src=".././js/bootstrap.js"></script>

    <script type="text/javascript">
      var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-22552764-2']); _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-37808023-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

    </script>

</body></html>
