<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    
    <meta content="IE=8" http-equiv="X-UA-Compatible"/>
    <title>OCaml :: OCaml Planet</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <meta content="Ashish Agarwal, Esther Baruk, Christophe Troestler and many contrinutors" name="author"/>
    <meta content="" name="description"/>
    <meta content="" name="keywords"/>
    <meta content="OCaml (Weberizer)" name="generator"/>

    <link href="https://static.ocamlcore.org/official/images/favicon.ico" rel="shortcut icon"/>
    <link rel="stylesheet" href=".././css/bootstrap.css"/>
    <link href=".././css/ocaml.css" media="all" type="text/css" rel="stylesheet"/>
    <link rel="stylesheet" href=".././css/bootstrap-responsive.css"/>

    
    

    <meta content="OCaml Planet" property="og:title"/>
    <meta content="non_profit" property="og:type"/>

    <meta content="all" name="robots"/>
  </head>
  <body>
    <div id="header">
      <div class="top">
      </div>
      <div class="bottom">
      </div>
    </div>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
	  
          <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a href=".././" class="brand">OCaml</a>

          <div class="nav-collapse">
            <ul class="nav">
	      <li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">
    Discover
    <b class="caret"></b>
  </a>
  <ul class="dropdown-menu">
    <li><a href="../description.html">What is OCaml?</a></li>
    <li><a href="http://try.ocamlpro.com/">Try it in your browser</a></li>
    <li><a href="../taste.html">A Hundred Lines of OCaml</a></li>
    <li><a href="../success.html">Success Stories</a></li>
    <li><a href="../companies.html">Who is using it?</a></li>
    <li><a href="http://pleac.sourceforge.net/pleac_ocaml/">Pleac</a></li>
    <li><a href="http://rosettacode.org/wiki/Category:OCaml">Rosetta</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">
    Learn
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../install.html">Install</a></li>
    <li><a href="../tutorials/">Tutorials</a></li>
    <li><a href="../faq.html">FAQ</a></li>
    <li><a href="../books.html">Books</a></li>
    <li><a href="../videos.html">Videos</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">Use
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../libraries.html">Libraries</a></li>
    <li><a href="../dev_tools.html">Development tools</a></li>
    <li><a href="../documentation.html">Manuals and Cheat Sheets</a></li>
    <li><a href="../tutorials/#advanced">Advanced tutorials &amp; Papers</a></li>
    <li><a href="http://search.ocaml.jp/">OCaml API search</a></li>
    <li><a href="http://forge.ocamlcore.org/">Forge</a></li>
    <li><a href="https://github.com/languages/OCaml">Github</a></li>
    <li><a href="https://bitbucket.org/repo/all?name=ocaml">Bitbucket</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">Community
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../mailing_lists.html">Mailing lists</a></li>
    <li><a href="../planet/">OCaml Planet (blogs)</a></li>
    <li><a href="../meetings.html">Meetings</a></li>
    <li><a href="irc://irc.freenode.net/ocaml">IRC</a></li>
    <li><a href="http://stackoverflow.com/questions/tagged?tagnames=ocaml">Stack Overflow</a></li>
    <li><a href="http://www.reddit.com/r/ocaml/">Reddit</a></li>
    <li><a href="../support.html">Commercial Support</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">More
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="http://caml.inria.fr/mantis/">Mantis Bug Tracker</a></li>
    <li><a href="../caml-light/">Caml Light</a></li>
    <li><a href="../logos.html">Logos</a></li>
  </ul>
</li>

            </ul>
	    <form action="http://www.google.com/search" method="get" class="navbar-search pull-right">
	      <input placeholder="Search" class="search-query" name="q" type="text"/>
	      <input value="site:http://www.ocaml-lang.org/" name="q" type="hidden"/>
	    </form>
            
	    
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <span class="navigation-bar">
	<a href="./../">Home</a><span class="separation"><img src=".././img/right_arrow.png" alt="&gt;"/></span>OCaml Planet
	<span id="language">
	  <span class="horizontal-toolbar"><span class="open-bracket">[</span><span class="current-url">En</span><span class="close-bracket">]</span></span>
	</span>
      </span>

      

    <h1>OCaml Planet</h1>

    <p>The OCaml Planet aggregates various blogs from the OCaml
    community.  It is kindly provided
    by <a href="http://www.ocamlcore.com/">OCamlCore</a>.  If you
    would like to be added, read
    the <a href="http://www.ocamlcore.org/planet/">Planet
    subscription HOWTO</a>.</p>

    <br/>
    <div style="float: right; margin-right: 0; margin-top: 0" class="span2 planet-subscriptions"><em>Subscriptions</em>
      <ul><li><a href="http://alexleighton.tumblr.com/tagged/ocaml/rss">Alex Leighton</a></li><li><a href="http://blog.mestan.fr/feed/?cat=16">Alp Mestan</a></li><li><a href="http://andreiformiga.com/blog/?cat=5&feed=rss2">Andrei Formiga</a></li><li><a href="http://math.andrej.com/feed/">Andrej Bauer</a></li><li><a href="http://anil.recoil.org/feeds/atom.xml">Anil Madhavapeddy</a></li><li><a href="http://unnali.com/tag/ocaml/feed/">Arlen Cuss</a></li><li><a href="http://ashishagarwal.org/tag/ocaml/feed/">Ashish Agarwal</a></li><li><a href="http://www.blogger.com/feeds/7617521785419311079/posts/default">Cameleon news</a></li><li><a href="http://caml.inria.fr/news.en.rss">Caml INRIA</a></li><li><a href="http://camlspotter.blogspot.com/feeds/posts/default?alt=rss">Caml Spotting</a></li><li><a href="http://alan.petitepomme.net/cwn/cwn.rss">Caml Weekly News</a></li><li><a href="http://procrastiblog.com/category/ocaml/feed/">Christopher Conway</a></li><li><a href="http://coherentpdf.com/blog/?tag=ocaml&feed=rss">Coherent Graphics</a></li><li><a href="http://coq.inria.fr/news/feed">Coq</a></li><li><a href="http://erratique.ch/feeds/news.atom">Daniel Bünzli</a></li><li><a href="http://blog.dbpatterson.com/rss">Daniel Patterson</a></li><li><a href="http://nleyten.com/atom.aspx">Dario Teixeira</a></li><li><a href="http://www.blogger.com/feeds/17133288/posts/default/-/ocaml">David Baelde</a></li><li><a href="http://bentobako.org/david/blog/index.php?feed/tag/ocaml/atom">David Mentré</a></li><li><a href="http://dutherenverseauborddelatable.wordpress.com/category/ocaml/feed/">David Teller</a></li><li><a href="http://www.examachine.net/blog/?feed=rss2&cat=4">Eray Özkural</a></li><li><a href="http://www.mega-nerd.com/erikd/Blog/CodeHacking/Ocaml/index.rss20">Erik de Castro Lopo</a></li><li><a href="http://blog.emillon.org/feeds/ocaml.xml">Etienne Millon</a></li><li><a href="http://www.mega-nerd.com/erikd/Blog/FP-Syd/index.rss20">FP-Sydney</a></li><li><a href="http://www.blogger.com/feeds/8964007124326996693/posts/default/-/ocaml">Fayssal Martani</a></li><li><a href="http://frama-c.com/rss.xml">Frama-C</a></li><li><a href="http://functionaljobs.com/jobs/search/?q=ocaml&format=rss">Functional Jobs</a></li><li><a href="http://gallium.inria.fr/~scherer/gagallium/index.rss">GaGallium</a></li><li><a href="http://gaiustech.wordpress.com/category/ocaml/feed/">Gaius Hammond</a></li><li><a href="http://blog.camlcity.org/blog/rss">Gerd Stolpmann</a></li><li><a href="http://www.wisdomandwonder.com/tag/OCaml/feed">Grant Rettke</a></li><li><a href="http://blog.incubaid.com/tag/ocaml/feed/">Incubaid Research</a></li><li><a href="http://ambassadortothecomputers.blogspot.com/feeds/posts/default?alt=rss">Jake Donham</a></li><li><a href="http://scattered-thoughts.net/rss?tag=ocaml">Jamie Brandon</a></li><li><a href="http://ocaml.janestcapital.com/?q=rss.xml">Jane Street</a></li><li><a href="http://www.lexifi.com/blogs/ocaml/feed">LexiFi</a></li><li><a href="http://savonet.sourceforge.net/liquidsoap.rss">Liquidsoap</a></li><li><a href="http://syntaxexclamation.wordpress.com/tag/ocaml/feed/">Matthias Puech</a></li><li><a href="http://www.blogger.com/feeds/5888658295182480819/posts/default">Matías Giovannini</a></li><li><a href="http://eigenclass.org/R2/feeds/rss2/all">Mauricio Fernandez</a></li><li><a href="http://www.elehack.net/michael/blog/tags/ocaml?format=rss">Michael Ekstrand</a></li><li><a href="http://www.rktmb.org:82/feed/category/work/ocaml/atom">Mihamina Rakotomandimby</a></li><li><a href="http://nyc-ocaml.posterous.com/rss.xml">NYC OCaml</a></li><li><a href="http://ocamlhackers.ning.com/profiles/blog/feed?tag=ocaml&xn_auth=no">OCaml Hackers</a></li><li><a href="http://forge.ocamlcore.org/export/rss_sfnews.php">OCamlCore Forge News</a></li><li><a href="http://forge.ocamlcore.org/export/rss_sfprojects.php">OCamlCore Forge Projects</a></li><li><a href="http://www.ocamlcore.com/wp/?feed=rss2&amp;language=en&#038;language=en">OCamlCore.com</a></li><li><a href="http://www.ocamlpro.com/feed/atom.xml">OCamlPro</a></li><li><a href="http://odns.tuxfamily.org/feed/">ODNS project</a></li><li><a href="http://ox.tuxfamily.org/feed/">Ocaml XMPP project</a></li><li><a href="http://ocsigen.org/news.atom">Ocsigen project</a></li><li><a href="http://www.blogger.com/feeds/2073503406800427577/posts/default">Opa</a></li><li><a href="http://www.openmirage.org/blog/atom.xml">Open Mirage</a></li><li><a href="http://www.donadeo.net/facets/programming-languages/objective-caml/feed/">Paolo Donadeo</a></li><li><a href="https://mancoosi.org/~abate/taxonomy/term/5/0/feed">Pietro Abate</a></li><li><a href="http://redlizards.com/blog/feed/?tag=ocaml">Red Lizard Software</a></li><li><a href="http://rwmj.wordpress.com/tag/ocaml/feed/">Richard Jones</a></li><li><a href="http://blog.rastageeks.org/spip.php?page=rss&id_mot=2">Romain Beauxis</a></li><li><a href="http://seb.mondet.org/blog/feed/ocaml.rss">Sebastien Mondet</a></li><li><a href="http://upsilon.cc/~zack/tags/ocaml/index.rss">Stefano Zacchiroli</a></li><li><a href="http://le-gall.net/sylvain+violaine/blog/index.php?feed/tag/ocaml/atom">Sylvain Le Gall</a></li><li><a href="http://caml.inria.fr/hump.rss">The Caml Humps</a></li><li><a href="http://www.blogger.com/feeds/6115529230232389198/posts/default">Till Varoquaux</a></li><li><a href="http://www.nicollet.net/toroidal/ocaml/feed/">Victor Nicollet</a></li><li><a href="http://y-node.com/blog/feeds/tag/ocaml/">y-node</a></li></ul>

      <a href="http://planet.ocaml.org/rss20.xml"><img src=".././img/rss20.png"/></a>
      <a href="http://planet.ocaml.org/opml.xml"><img src=".././img/opml.png"/></a>
    </div>
    <div class="planet"><a name="ea85e6bbd2ab0d204b6a38cb979b6ef5"></a><span class="rss-header"><span class="rss-title"><a href="http://ocsigen.org/"> Journée de cours Ocsigen à Paris - Développement d'applications Web en OCaml</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Ocsigen project</span>, <span class="rss-date">29 Nov 2012</span></span><span class="rss-description"><div id="post1"><p>[Announcement for the french speaking Ocsigen Day dedicated to OCaml
programmers. December 14 at IRILL. English version below]
</p>
<h1>
 JFLO’12
Journée Francophone de Leçons sur Ocsigen —
Développement d'applications Web en OCaml
</h1>
<p>
Nous organisons une journée didactique autour d'Ocsigen dédiée aux
programmeurs OCaml. Cette journée aura lieu le 14 décembre à l'IRILL (cf
infos pratiques plus bas). Vous êtes invités à vous inscrire en ici :
</p>
<p>
<a href="https://docs.google.com/spreadsheet/viewform?formkey=dEUyaXNCeVNWQmI5cHFnU2tTc1dmaXc6MQ">Inscription</a>
</p>
<p>
Au programme, des cours et tutoriels sur les principaux composants du
projet Ocsigen :
</p>
<ul>
<li>Programmation concurrente avec Lwt ;
</li>
<li>Programmation côté client avec le compilateur Js_of_ocaml ;
</li>
<li>Programmation d'applications Web client-server avec Eliom.</li>
</ul>
<p>
Informations pratiques :</p>
<p>
LIEU : Salle ORANGE, 5e étage, Inria, 23, avenue d'Italie,75013 Paris
</p>
<p>
DATE : Vendredi 14 Décembre de 10h00 à 18h00.
</p>
<a onclick="switchContent('post1','post2')" class="btn" href="#ea85e6bbd2ab0d204b6a38cb979b6ef5">Read more...</a></div><div id="post2" style="display: none"><p>[Announcement for the french speaking Ocsigen Day dedicated to OCaml
programmers. December 14 at IRILL. English version below]
</p>
<h1>
 JFLO’12
Journée Francophone de Leçons sur Ocsigen —
Développement d'applications Web en OCaml
</h1>
<p>
Nous organisons une journée didactique autour d'Ocsigen dédiée aux
programmeurs OCaml. Cette journée aura lieu le 14 décembre à l'IRILL (cf
infos pratiques plus bas). Vous êtes invités à vous inscrire en ici :
</p>
<p>
<a href="https://docs.google.com/spreadsheet/viewform?formkey=dEUyaXNCeVNWQmI5cHFnU2tTc1dmaXc6MQ">Inscription</a>
</p>
<p>
Au programme, des cours et tutoriels sur les principaux composants du
projet Ocsigen :
</p>
<ul>
<li>Programmation concurrente avec Lwt ;
</li>
<li>Programmation côté client avec le compilateur Js_of_ocaml ;
</li>
<li>Programmation d'applications Web client-server avec Eliom.</li>
</ul>
<p>
Informations pratiques :</p>
<p>
LIEU : Salle ORANGE, 5e étage, Inria, 23, avenue d'Italie,75013 Paris
</p>
<p>
DATE : Vendredi 14 Décembre de 10h00 à 18h00.
</p>
<ul>
<li>les cours seront en français ;</li>
<li>il est fortement conseillé de venir muni de son ordinateur portable ;</li>
<li>si possible avec une version récente d'Eliom installée.</li>
</ul>
<p>
To get more frequent annoucements about Ocsigen, follow us on 
<a href="https://twitter.com/ocsigen">Twitter</a>,
<a href="https://plus.google.com/u/0/105890612060116987398/posts">Google+</a>, or
<a href="https://www.facebook.com/pages/Ocsigen/289974521051526">Facebook</a>.</p><a onclick="switchContent('post2','post1')" class="btn" href="#ea85e6bbd2ab0d204b6a38cb979b6ef5">Hide</a></div></span>
<a name="c3b516ab38f13accdd3df24b36ff284e"></a><span class="rss-header"><span class="rss-title"><a href="http://www.lexifi.com/blog/note-about-performance-printf-and-format"> A note about the performance of Printf and Format</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">LexiFi</span>, <span class="rss-date">28 Nov 2012</span></span><span class="rss-description"><div class="content-wide-padding white-bg light-grey-border">
<p>
  The goal is to display the following to stdout:
</p>
<pre>(0,0)
(1,1)
(2,2)
...
(1000000,1000000)
</pre>
<p>
  How would you implement that in OCaml?  For such a simple task, we
  probably expect the program to be IO bound, right? Ok, let's try
  with the idiomatic way, which is to use format strings as provided
  by the <tt>Printf</tt> module from OCaml standard library:
</p></div><p><a href="http://www.lexifi.com/blog/note-about-performance-printf-and-format" target="_blank">read more</a></p></span>
<a name="0b7415981db8c02f1d7c9a8d2f7c23ed"></a><span class="rss-header"><span class="rss-title"><a href="http://alan.petitepomme.net/cwn/2012.11.27.html"> Caml Weekly News, 27 Nov 2012</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Caml Weekly News</span>, <span class="rss-date">27 Nov 2012</span></span><span class="rss-description">Poll results of OASIS, package manager and misc. / open faculty position in Big Data at Wright State University / how to wrap a command line call correctly? / Monad Library? / RPM's for OCaml 4.00.1 and associated libs for Mageia 2 / opass - encrypted password db / Multithreaded https requests in ocamlnet netclient / New group: Pragmatic functional programming research / Other Caml News</span>
<a name="bfcbacfbb0db1e239d978d522713b1cb"></a><span class="rss-header"><span class="rss-title"><a href="http://www.lexifi.com/blog/type-based-selection-label-and-constructors"> Type-based selection of label and constructors</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">LexiFi</span>, <span class="rss-date">27 Nov 2012</span></span><span class="rss-description"><div class="content-wide-padding white-bg light-grey-border">
<p>
  Most languages provide some way to manipulate tuples of values with
  a proper label for each field.  They are called structures in C,
  records in OCaml; objects as found in most mainstream OO languages
  extend this same notion.
</p></div><p><a href="http://www.lexifi.com/blog/type-based-selection-label-and-constructors" target="_blank">read more</a></p></span>
<a name="9af1d5db458dcc344455b1e57d0f19a4"></a><span class="rss-header"><span class="rss-title"><a href="http://caml.inria.fr/cgi-bin/hump.cgi?contrib=818"> Stog 0.4</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">The Caml Humps</span>, <span class="rss-date">22 Nov 2012</span></span><span class="rss-description">Stog is a kind of Jekyll in OCaml: It is a static web site generator, able to handle blog posts as well as regular pages.</span>
<a name="356e3f0da13f4e3ea3fdcf9d20edc44b"></a><span class="rss-header"><span class="rss-title"><a href="http://caml.inria.fr/cgi-bin/hump.cgi?contrib=817"> Xtmpl 0.4</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">The Caml Humps</span>, <span class="rss-date">22 Nov 2012</span></span><span class="rss-description">Xtmpl is a small XML templating library for OCaml.</span>
<a name="d70d491cd82020f9a4aaa50c37091682"></a><span class="rss-header"><span class="rss-title"><a href="http://alan.petitepomme.net/cwn/2012.11.20.html"> Caml Weekly News, 20 Nov 2012</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Caml Weekly News</span>, <span class="rss-date">20 Nov 2012</span></span><span class="rss-description">Camlimages with ocamlbuild / OCaml messages in French / About ocamlbuild / GADT exhaustiveness check / DWARF output for native-code / Poll results of OASIS, package manager and misc.</span>
<a name="e9ab0afb9dae2acbc8df14359d4e1b86"></a><span class="rss-header"><span class="rss-title"><a href="https://ocaml.janestreet.com/?q=node/112"> Maps, sets, and hashtables in core</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Jane Street</span>, <span class="rss-date">12 Nov 2012</span></span><span class="rss-description"><div id="post3"><p>The below post is mostly lifted from an email I sent to the <a href="https://groups.google.com/forum/#!forum/ocaml-core">Core mailing list</a>. It explains the type hackery we employ in order to get a really nice interface for maps, sets, hashtables and other such containers. It may look complex, but actually it works out remarkably simple to use, and ends up giving you a good number of static guarantees.</p>

<p>I'll use the example of hashtables, but the language readily
translates into sets / maps.</p>

<p>There are two types of hashtables in core. Ones that use polymorphic
comparison, and ones that use a specific comparision function that is
hopefully more efficient and has non-surprising semantics (we
basically think polymorphic comparison, despite its convenience, is
too surprising to be an overall good thing).</p>

<a onclick="switchContent('post3','post4')" class="btn" href="#e9ab0afb9dae2acbc8df14359d4e1b86">Read more...</a></div><div id="post4" style="display: none"><p>The below post is mostly lifted from an email I sent to the <a href="https://groups.google.com/forum/#!forum/ocaml-core">Core mailing list</a>. It explains the type hackery we employ in order to get a really nice interface for maps, sets, hashtables and other such containers. It may look complex, but actually it works out remarkably simple to use, and ends up giving you a good number of static guarantees.</p>

<p>I'll use the example of hashtables, but the language readily
translates into sets / maps.</p>

<p>There are two types of hashtables in core. Ones that use polymorphic
comparison, and ones that use a specific comparision function that is
hopefully more efficient and has non-surprising semantics (we
basically think polymorphic comparison, despite its convenience, is
too surprising to be an overall good thing).</p>

<p>The type of hashtables using polymorphic comparison is
<span class="geshifilter"><code class="geshifilter-text">('key, 'value) Hashtbl.Poly.t</code></span>. The type of hashtables using, <em>e.g.</em>,
int comparison for the keys is 'value Int.Table.t. Given the previous
paragraph, you should always try to use Foo.Table when you can.</p>

<p>When you create a hashtable (<em>e.g.</em> using <code>create</code>, <span class="geshifilter"><code class="geshifilter-text">of_alist</code></span>, or
<span class="geshifilter"><code class="geshifilter-text">t_of_sexp</code></span>), you must use the specific module name. <em>i.e.</em>
<span class="geshifilter"><code class="geshifilter-text">let table = Int.Table.create () in</code></span>. However, when you
already have a hashtable in your hands, and you want to use accessor
functions, you should just use Hashtbl.foo, regardless of what
comparison function it uses.</p>

<p>To translate into Maps and Sets:</p>

<p></p><div class="geshifilter"><pre style="font-family: monospace;" class="text geshifilter-text">'value Foo.Table.t  ('key,'value) Hashtbl.Poly.t  Hashtbl.foo
'value Foo.Map.t    ('key,'value) Map.Poly.t      Map.foo
Foo.Set.t           'element Set.Poly.t           Set.foo</pre></div><p></p>

<hr/>

<p>If you have your own type and want to make Table, Map and Set
submodules, it's really easy:</p>

<p></p><div class="geshifilter"><pre style="font-family: monospace;" class="ocaml geshifilter-ocaml"><span style="color: #06c; font-weight: bold;">module</span> T <span style="color: #a52a2a;">=</span> <span style="color: #06c; font-weight: bold;">struct</span>
  <span style="color: #06c; font-weight: bold;">type</span> t <span style="color: #a52a2a;">=</span> <span style="color: #a52a2a;">...</span> <span style="color: #06c; font-weight: bold;">with</span> <span style="color: #06c; font-weight: bold;">compare</span>, sexp
  <span style="color: #06c; font-weight: bold;">let</span> hash <span style="color: #a52a2a;">=</span> <span style="color: #5d478b; font-style: italic;">(* your hash function, maybe Hashtbl.hash *)</span>
<span style="color: #06c; font-weight: bold;">end</span>
<span style="color: #06c; font-weight: bold;">include</span> Comparable<span style="color: #a52a2a;">.</span><span style="color: #060;">Make</span><span style="color: #6c6;">(</span>T<span style="color: #6c6;">)</span>
<span style="color: #06c; font-weight: bold;">include</span> Hashable<span style="color: #a52a2a;">.</span><span style="color: #060;">Make</span><span style="color: #6c6;">(</span>T<span style="color: #6c6;">)</span></pre></div><p></p>

<p>Saying "with compare" generates you an efficient comparison function
specialised to your type. (Note that all component types need to have
comparison functions defined too, whether through "with compare" or
through primitives.) The Comparable.Make functor adds in modules to
make you satisfy the Comparable.S signature (basically the Set and Map
modules, and a few more). The Hashable.Make functor adds in modules to
make you satisfy Hashable.S (basically Hashtbl, as well as some others
like Hash_set). If you don't want the Hashable stuff, there is no need
to define a hash function. (Although Hashtbl.hash is normally not a
bad choice.)</p>

<hr/>

<p>Here's how this all works under the hood:</p>

<p>The type of maps is "really" <span class="geshifilter"><code class="geshifilter-text">('key, 'value, 'comparator) Map.t</code></span>. Maps
contain in their values the function that is used for comparing keys,
<em>i.e.</em> a function of type <span class="geshifilter"><code class="geshifilter-text">'key -&gt; 'key -&gt; int</code></span>. But what is this
"comparator" thing?</p>

<p>We can first motivate things by saying: it's a pain to have to type
Int.Map.find for int-maps, String.Map.find for string-maps, etc. etc.
It'd be nice to have a single type and use Map.find for everything.
But this presents a problem because of functions like Map.merge, which
takes two maps and combines them. You need to know that the comparison
functions are identical, but how can you do this?</p>

<p>So we have this extra comparator phantom type. Nothing in the actual
representation has a type involving 'comparator: it's just for static
checking. If you want to have a new comparison function, you must mint
a new comparator type. (Including the Comparable signature does this
for you.)</p>

<p>I originally wrote this last section with hashtables in mind, but due to a wrinkle, hashtables work a little differently. Maps and sets are fully comparator-ified, but we're yet to completely cut over hashtables. As a result, the following code types but gives a runtime error:</p>

<p></p><div class="geshifilter"><pre style="font-family: monospace;" class="ocaml geshifilter-ocaml"><span style="color: #06c; font-weight: bold;">Hashtbl</span><span style="color: #a52a2a;">.</span><span style="color: #060;">merge</span> <span style="color: #6c6;">(</span>Int<span style="color: #a52a2a;">.</span><span style="color: #060;">Table</span><span style="color: #a52a2a;">.</span><span style="color: #060;">create</span> <span style="color: #6c6;">(</span><span style="color: #6c6;">)</span><span style="color: #6c6;">)</span> <span style="color: #6c6;">(</span><span style="color: #06c; font-weight: bold;">Hashtbl</span><span style="color: #a52a2a;">.</span><span style="color: #060;">Poly</span><span style="color: #a52a2a;">.</span><span style="color: #060;">create</span> <span style="color: #6c6;">(</span><span style="color: #6c6;">)</span><span style="color: #6c6;">)</span></pre></div><p></p>

<p>(The situation is not fully terrible: the above example only works if one side is Hashtbl.Poly.) We're working on fixing this inconsistency -- expect to see it in a version of core soon.</p><a onclick="switchContent('post4','post3')" class="btn" href="#e9ab0afb9dae2acbc8df14359d4e1b86">Hide</a></div></span>
<a name="431d644e0dbbcb19dfd5282281069a9f"></a><span class="rss-header"><span class="rss-title"><a href="http://math.andrej.com/2012/11/11/how-to-implement-dependent-type-theory-ii/"> How to implement dependent type theory II</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Andrej Bauer</span>, <span class="rss-date">11 Nov 2012</span></span><span class="rss-description"><div id="post5"><p>I am on a roll. In the second post on how to implement dependent type theory we are going to:</p>
<ol>
<li>Spiff up the syntax by allowing more flexible syntax for bindings in functions and products.</li>
<li>Keep track of source code locations so that we can report <em>where</em> the error has occurred.</li>
<li>Perform <a href="http://en.wikipedia.org/wiki/Normalisation_by_evaluation">normalization by evaluation</a>.</li>
</ol>
<p><span id="more-1320"></span></p>
<p>The relevant Github repository is <a href="https://github.com/andrejbauer/tt/tree/blog-part-II">andrejbauer/tt/</a> (branch blog-part-II). By the way, there are probably bugs in the implementation, I am not spending a huge amount of time on testing (mental note: put “implement testing” on the to do list). If you discover one, please tell me, or preferrably make a pull request with a fix. This also applies to old branches.</p>
<h3>Source code positions</h3>
<p>Source code positions seem like an annoyance because they pollute our nice datatypes. Nevertheless, an even bigger annoyance is an error message without an indication of its position.</p>
<a onclick="switchContent('post5','post6')" class="btn" href="#431d644e0dbbcb19dfd5282281069a9f">Read more...</a></div><div id="post6" style="display: none"><p>I am on a roll. In the second post on how to implement dependent type theory we are going to:</p>
<ol>
<li>Spiff up the syntax by allowing more flexible syntax for bindings in functions and products.</li>
<li>Keep track of source code locations so that we can report <em>where</em> the error has occurred.</li>
<li>Perform <a href="http://en.wikipedia.org/wiki/Normalisation_by_evaluation">normalization by evaluation</a>.</li>
</ol>
<p><span id="more-1320"></span></p>
<p>The relevant Github repository is <a href="https://github.com/andrejbauer/tt/tree/blog-part-II">andrejbauer/tt/</a> (branch blog-part-II). By the way, there are probably bugs in the implementation, I am not spending a huge amount of time on testing (mental note: put “implement testing” on the to do list). If you discover one, please tell me, or preferrably make a pull request with a fix. This also applies to old branches.</p>
<h3>Source code positions</h3>
<p>Source code positions seem like an annoyance because they pollute our nice datatypes. Nevertheless, an even bigger annoyance is an error message without an indication of its position.</p>
<p>The OCaml lexer keeps track of positions, and menhir has support for them, so we just need to incorporate them into our program. Every expression should be tagged with the source code position it came from. Sometimes we generate expressions with no associated position, so we define:</p>
<pre class="brush: plain; title: ; notranslate">type position =
  | Position of Lexing.position * Lexing.position
  | Nowhere
</pre>
<p>The type <code>Lexing.position</code> is the one from OCaml lexer. Each expression is associated with two such positions, its beginning and end. To tag expressions with positions we define two types: <code>expr</code> is an expression with a position and <code>expr'</code> without (I stole the idea from <a href="http://matija.pretnar.info/">Matija Pretnar</a>‘s <a href="http://math.andrej.com/eff/">eff</a> code):</p>
<pre class="brush: plain; title: ; notranslate">(** Abstract syntax of expressions. *)
type expr = expr' * position
and expr' =
  | Var of variable
  | Universe of int
  | Pi of abstraction
  | Lambda of abstraction
  | App of expr * expr

(** An abstraction [(x,t,e)] indicates that [x] of type [t] is bound in [e]. *)
and abstraction = variable * expr * expr
</pre>
<p>Note that <code>expr'</code> refers back to <code>expr</code> so that subexpressions come equipped with their positions. We generally follow the rule that an apostrophe is attached to a type or a function which is position-less. Except that apostrohpies are not valid in the names of grammatical rules in the parser, so in <a href="https://github.com/andrejbauer/tt/blob/blog-part-II/parser.mly">parser.mly</a> we write <code>plain_expr</code> instead of <code>expr'</code>.</p>
<p>We also extend the pretty printer and error reporting with positions, feel free to consult the source code.</p>
<h3>Better syntax for bindings</h3>
<p>This is a fairly trivial change. It is annoying to have to write things like</p>
<pre class="brush: plain; title: ; notranslate">fun x : A =&gt; fun y : A =&gt; fun z : B =&gt; fun w : B =&gt; ...
</pre>
<p>We improve the parser so that it accepts syntax like</p>
<pre class="brush: plain; title: ; notranslate">fun (x y : A) (z w : B) =&gt; ...
</pre>
<p>Let us read out the relevant portion of <a href="https://github.com/andrejbauer/tt/blob/blog-part-II/parser.mly">parser.mly</a>, namely the rules <code>abstraction</code>, <code>bind1</code> and <code>binds</code>:</p>
<pre class="brush: plain; title: ; notranslate">abstraction:
  | b = bind1
    { [b] }
  | bs = binds
    { bs }

bind1: mark_position(plain_bind1) { $1 }
plain_bind1:
  | xs = nonempty_list(NAME) COLON t = expr
    { (List.map (fun x -&gt; String x) xs, t) }

binds:
  | LPAREN b = bind1 RPAREN
    { [b] }
  | LPAREN b = bind1 RPAREN lst = binds
    { b :: lst }
</pre>
<p>A <code>bind1</code> is something of the form <code>x y ... z : t</code>. A <code>binds</code> is a non-empty list of parenthesized <code>bind1</code>‘s. An abstraction is either a <code>bind1</code> or a <code>binds</code>. Thus we can write <code>fun x y z : t =&gt; ...</code> and <code>fun (x y z : t) =&gt; ...</code> and <code>fun (x y : t) (z : t) =&gt; ...</code> but not <code>fun x y : y (z : t) =&gt; ...</code>.</p>
<h3>Normalization by evaluation</h3>
<p>In the first version we performed normalization by substitution, just like theory books say we should. But this is horribly inefficient. We could improve efficiency by keeping a current substitution (a “runtime” environment) which maps variables to the expressions. When we encounter a variable we look up its value in the current substitution. This way at least we do not keep traversing expressions during substitutions.</p>
<p>An even cooler way to normalize is known as normalization by evaluation. We first “evaluate” expressions to actual OCaml values in such a way that definitionally equal expressions evaluate to (observationally) equivalent values, and then we reconstruct the expression from the value (the fancy speak is that we <a href="http://dictionary.reference.com/browse/reify">reify</a> the value). Apart from giving us a normal form there are all sorts of other benefits (Dan Grayson keeps asking me which, perhaps the more knowledgable readers can point them out).</p>
<p>We need a datatype <code>value</code> into which we evaluate expressions. We need to evaluate expressions with free variables, which means that we are going to get stuck on applications of the form <code>x v1 v2 .. vn</code> where <code>x</code> is a free variable (these are called head-normal). We collect those in a separate datatype <code>neutral</code>:</p>
<pre class="brush: plain; title: ; notranslate">type value =
  | Neutral of neutral
  | Universe of int
  | Pi of abstraction
  | Lambda of abstraction

and abstraction = variable * value * (value -&gt; value)

and neutral =
  | Var of variable
  | App of neutral * value
</pre>
<p>Abstractions will be evaluated to OCaml functions (so OCaml will take care of substitutions). Thus an abstraction like <code>fun x : t =&gt; e</code> should be evaluated to a pair <code>(u, v)</code> where <code>u</code> is the value of <code>t</code> and <code>v</code> is the function $x \mapsto e$. But if you look at the definition of <code>abstraction</code> above you see that we also keep around the variable name. This we do for pretty-printing purposes. When we reify an evaluated abstraction back to its expression form, we use the variable name as a hint.</p>
<p>You should take the time to read <a href="https://github.com/andrejbauer/tt/blob/blog-part-II/value.ml"><code>value.ml</code></a> which contains evaluation and reification, and comparison of values. Also note that <code>Infer.normalize</code> really is just the composition of evaluation and reification.</p>
<p>We are now at 759 lines of code. We added 90 codes for evaluation by normalization and 51 for the for keeping track of source code positions.</p>
<h3>Trying something out</h3>
<p>Ok, let us try something fun. How about <a href="http://en.wikipedia.org/wiki/Church_encoding">Church numerals</a>?</p>
<pre class="brush: plain; title: ; notranslate">Parameter N : Type 0.
Parameter z : N.
Parameter s : N -&gt; N.

Definition numeral := forall A : Type 0, (A -&gt; A) -&gt; (A -&gt; A).

Definition zero := fun (A : Type 0) (f : A -&gt; A) (x : A) =&gt; x.
Definition one := fun (A : Type 0) (f : A -&gt; A) =&gt; f.
Definition two := fun (A : Type 0) (f : A -&gt; A) (x : A) =&gt; f (f x).
Definition three := fun (A : Type 0) (f : A -&gt; A) (x : A) =&gt; f (f (f x)).

Definition plus :=
  fun (m n : numeral) (A : Type 0) (f : A -&gt; A) (x : A) =&gt; m A f (n A f x).

Definition times :=
  fun (m n : numeral) (A : Type 0) (f : A -&gt; A) (x : A) =&gt; m A (n A f) x.

Definition power :=
  fun (m n : numeral) (A : Type 0) =&gt; m (A -&gt; A) (n A).
  
Definition four := plus two two.
Definition five := plus two three.
</pre>
<p>If you put the above code in <code>church.tt</code> you can load it into <code>tt</code> by</p>
<pre class="brush: plain; title: ; notranslate">./tt.native -l church.tt
</pre>
<p>Dare we compute $2^{16}$? Sure:</p>
<pre class="brush: plain; title: ; notranslate"># Eval power two (power two four) N s z.
    = s (s (s (s (s (s (s (s (s (s (s (s (s (s (s (s (s (s (s (s (s (s (s (s (s (s (s (s
      (s (s (s (s (s (s (s (s (s (s (... (...)))))))))))))))))))))))))))))))))))))))
    : N
</pre>
<p>It takes a moment, but that is mostly because of pretty-printing (if you evaluate the same expression in non-interactive mode by placing it in a file, you will notice no delay). How about $2^{20}$?</p>
<pre class="brush: plain; title: ; notranslate"># Eval power two (times four five).
Fatal error: exception Stack_overflow
</pre>
<p>Oh well. We will have to do something smarter (I am open to suggestions), or increase the stack size. Next time we are going some more types, and then I would like to focus on how to implement an interactive mode.</p><a onclick="switchContent('post6','post5')" class="btn" href="#431d644e0dbbcb19dfd5282281069a9f">Hide</a></div></span>
<a name="b4f4adcad86f1f55317ed49cdf532cb2"></a><span class="rss-header"><span class="rss-title"><a href="https://forge.ocamlcore.org/projects/mnf/"> Master and Footballer</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">OCamlCore Forge Projects</span>, <span class="rss-date">11 Nov 2012</span></span><span class="rss-description">Master and Footballer is a managing football game. The players manage team composition, tactics, finance, player-transfer...and their own career.</span>
<script type="text/javascript">function switchContent(id1,id2) {
     // Get the DOM reference
     var contentId1 = document.getElementById(id1);
     var contentId2 = document.getElementById(id2);
     // Toggle
     contentId1.style.display = "none";
     contentId2.style.display = "block";
     }</script></div>

  
    </div>

    
    <br/>
    <hr/>
    <div id="footer">
      Contribute to this project!
      Find us on <a href="https://github.com/ocaml/ocaml.org">Github</a>.
    </div>
    <span title=".././img/ = image directory from the base of the site"></span>


    
    
    

    <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
    <script src=".././js/jquery-1.8.0.min.js"></script>
    
    <script src=".././js/bootstrap.js"></script>
    <script type="text/javascript">
      var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-22552764-2']); _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
</body></html>
