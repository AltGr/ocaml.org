<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    
    <meta content="IE=8" http-equiv="X-UA-Compatible"/>
    <title>OCaml :: OCaml Planet</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <meta content="Ashish Agarwal, Esther Baruk, Christophe Troestler and many contributors" name="author"/>
    <meta content="" name="description"/>
    <meta content="" name="keywords"/>
    <meta content="OCaml (Weberizer)" name="generator"/>

    <link href="http://ocaml.org/img/favicon.ico" rel="shortcut icon"/>
    <link rel="stylesheet" href=".././css/bootstrap.css"/>
    <link href=".././css/ocaml.css" media="all" type="text/css" rel="stylesheet"/>
    <link rel="stylesheet" href=".././css/bootstrap-responsive.css"/>

    
    

    <meta content="OCaml Planet" property="og:title"/>
    <meta content="non_profit" property="og:type"/>

    <meta content="all" name="robots"/>
  </head>
  <body>
    <div id="header">
      <div class="top">
      </div>
      <div class="bottom">
      </div>
    </div>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
	  
          <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a href=".././" class="brand">OCaml</a>

          <div class="nav-collapse">
            <ul class="nav">
	      <li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">
    Discover
    <b class="caret"></b>
  </a>
  <ul class="dropdown-menu">
    <li><a href="../description.html">What is OCaml?</a></li>
    <li><a href="http://try.ocamlpro.com/">Try it Online</a></li>
    <li><a href="../taste.html">100 Lines of OCaml</a></li>
    <li><a href="../success.html">Success Stories</a></li>
    <li><a href="../companies.html">Who Is Using It?</a></li>
    <li><a href="http://pleac.sourceforge.net/pleac_ocaml/">Pleac</a></li>
    <li><a href="http://rosettacode.org/wiki/Category:OCaml">Rosetta</a>
        <a href="http://langref.org/ocaml">langref.org</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">
    Learn
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../install.html">Install</a></li>
    <li><a href="../tutorials/">Tutorials</a></li>
    <li><a href="../faq.html">FAQ</a></li>
    <li><a href="../books.html">Books</a></li>
    <li><a href="../videos.html">Videos</a></li>
    <li><a href="../papers.html">Papers</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">Use
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../releases/">Releases</a></li>
    <li><a href="../libraries.html">Libraries</a></li>
    <li><a href="../dev_tools.html">Development Tools</a></li>
    <li><a href="http://caml.inria.fr/pub/docs/manual-ocaml/">User Manual</a></li>
    <li><a href="../cheat_sheets.html">Cheat Sheets</a></li>
    <li><a href="http://search.ocaml.jp/">OCaml API Search</a></li>
    <li><a href="http://forge.ocamlcore.org/">Forge</a></li>
    <li><a href="https://github.com/languages/OCaml">GitHub</a></li>
    <li><a href="https://bitbucket.org/repo/all?name=ocaml">Bitbucket</a></li>
    <li><a href="http://gitorious.org/search?page=1&q=ocaml">Gitorious</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">Community
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../mailing_lists.html">Mailing Lists</a></li>
    <li><a href="../planet/">Blogs</a></li>
    <li><a href="../meetings/">Meetings</a></li>
    <li><a href="irc://irc.freenode.net/ocaml">IRC</a></li>
    <li><a href="http://stackoverflow.com/questions/tagged?tagnames=ocaml">Stack Overflow</a></li>
    <li><a href="http://www.reddit.com/r/ocaml/">Reddit</a></li>
    <li><a href="../support.html">Commercial Support</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">More
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="http://caml.inria.fr/mantis/">Mantis Bug Tracker</a></li>
    <li><a href="../caml-light/">Caml Light</a></li>
    <li><a href="../logos.html">Logos</a></li>
  </ul>
</li>

            </ul>
	    <form action="http://www.google.com/search" method="get" class="navbar-search pull-right">
	      <input placeholder="Search" class="search-query" name="q" type="text"/>
	      <input value="site:http://ocaml.org/" name="q" type="hidden"/>
	    </form>
            
	    
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <span class="navigation-bar">
	<a href="./../">Home</a><span class="separation"><img src=".././img/right_arrow.png" alt="&gt;"/></span>OCaml Planet
	<span id="language">
	  <span class="horizontal-toolbar"><span class="open-bracket">[</span><span class="current-url">En</span><span class="close-bracket">]</span></span>
	</span>
      </span>

      

    <h1>OCaml Planet</h1>

    <p>The OCaml Planet aggregates various blogs from the OCaml
    community.  It is kindly provided
    by <a href="http://www.ocamlcore.com/">OCamlCore</a>.  If you
    would like to be added, read
    the <a href="http://www.ocamlcore.org/planet/">Planet
    subscription HOWTO</a>.</p>

    <br/>
    <div style="float: right; margin-right: 0; margin-top: 0" class="span2 planet-subscriptions"><em>Subscriptions</em>
      <ul><li><a href="http://alexleighton.tumblr.com/tagged/ocaml/rss">Alex Leighton</a></li><li><a href="http://feeds.feedburner.com/amirmc-ocaml">Amir Chaudhry</a></li><li><a href="http://andreiformiga.com/blog/?cat=5&feed=rss2">Andrei Formiga</a></li><li><a href="http://math.andrej.com/feed/">Andrej Bauer</a></li><li><a href="http://anil.recoil.org/feeds/atom.xml">Anil Madhavapeddy</a></li><li><a href="http://ashishagarwal.org/tag/ocaml/feed/">Ashish Agarwal</a></li><li><a href="http://www.blogger.com/feeds/7617521785419311079/posts/default">Cameleon news</a></li><li><a href="http://caml.inria.fr/news.en.rss">Caml INRIA</a></li><li><a href="http://camlspotter.blogspot.com/feeds/posts/default?alt=rss">Caml Spotting</a></li><li><a href="http://alan.petitepomme.net/cwn/cwn.rss">Caml Weekly News</a></li><li><a href="http://coherentpdf.com/blog/?tag=ocaml&feed=rss2">Coherent Graphics</a></li><li><a href="http://coq.inria.fr/news/feed">Coq</a></li><li><a href="http://erratique.ch/feeds/news.atom">Daniel Bünzli</a></li><li><a href="http://nleyten.com:82/feed/tag/ocaml/atom">Dario Teixeira</a></li><li><a href="http://www.blogger.com/feeds/17133288/posts/default/-/ocaml">David Baelde</a></li><li><a href="http://blog.bentobako.org/index.php?feed/tag/ocaml/atom">David Mentré</a></li><li><a href="http://dutherenverseauborddelatable.wordpress.com/category/ocaml/feed/">David Teller</a></li><li><a href="http://www.examachine.net/blog/cat/ocaml/feed/">Eray Özkural</a></li><li><a href="http://www.mega-nerd.com/erikd/Blog/index.rss20">Erik de Castro Lopo</a></li><li><a href="http://blog.emillon.org/feeds/ocaml.xml">Etienne Millon</a></li><li><a href="http://frama-c.com/rss.xml">Frama-C</a></li><li><a href="http://functionaljobs.com/jobs/search/?q=ocaml&format=rss">Functional Jobs</a></li><li><a href="http://gallium.inria.fr/blog/index.rss">GaGallium</a></li><li><a href="http://gaiustech.wordpress.com/category/ocaml/feed/">Gaius Hammond</a></li><li><a href="http://blog.camlcity.org/blog/rss">Gerd Stolpmann</a></li><li><a href="http://jobs.github.com/positions.atom?description=ocaml&location=">Github OCaml jobs</a></li><li><a href="http://www.wisdomandwonder.com/tag/OCaml/feed">Grant Rettke</a></li><li><a href="http://hongboz.wordpress.com/feed/">Hong bo Zhang</a></li><li><a href="http://blog.incubaid.com/tag/ocaml/feed/">Incubaid Research</a></li><li><a href="http://ambassadortothecomputers.blogspot.com/feeds/posts/default?alt=rss">Jake Donham</a></li><li><a href="http://scattered-thoughts.net/atom.xml">Jamie Brandon</a></li><li><a href="https://ocaml.janestreet.com/?q=rss.xml">Jane Street</a></li><li><a href="http://lpw25.net/rss.xml">Leo White</a></li><li><a href="http://www.lexifi.com/blogs/ocaml/feed">LexiFi</a></li><li><a href="http://newblog.0branch.com/rss.xml">Marc Simpson</a></li><li><a href="http://syntaxexclamation.wordpress.com/tag/ocaml/feed/">Matthias Puech</a></li><li><a href="http://www.blogger.com/feeds/5888658295182480819/posts/default">Matías Giovannini</a></li><li><a href="">Mihamina Rakotomandimby</a></li><li><a href="http://mcclurmc.wordpress.com/feed/">Mike McClurg</a></li><li><a href="http://nyc-ocaml.posterous.com/rss.xml">NYC OCaml</a></li><li><a href="http://ocaml-book.com/blog?format=rss">OCaml Book</a></li><li><a href="http://forge.ocamlcore.org/export/rss_sfnews.php">OCamlCore Forge News</a></li><li><a href="http://forge.ocamlcore.org/export/rss_sfprojects.php">OCamlCore Forge Projects</a></li><li><a href="http://www.ocamlcore.com/wp/?feed=rss2&amp;language=en&#038;language=en">OCamlCore.com</a></li><li><a href="http://www.ocamlpro.com/feed/atom.xml">OCamlPro</a></li><li><a href="http://odns.tuxfamily.org/feed/">ODNS project</a></li><li><a href="http://ox.tuxfamily.org/feed/">Ocaml XMPP project</a></li><li><a href="http://ocsigen.org/news.atom">Ocsigen project</a></li><li><a href="http://www.blogger.com/feeds/2073503406800427577/posts/default">Opa</a></li><li><a href="http://www.openmirage.org/blog/atom.xml">Open Mirage</a></li><li><a href="http://functional-orbitz.blogspot.com/feeds/posts/default/-/planetocaml?alt=rss">Orbitz</a></li><li><a href="http://www.donadeo.net/facets/programming-languages/objective-caml/feed/">Paolo Donadeo</a></li><li><a href="https://mancoosi.org/~abate/taxonomy/term/5/0/feed">Pietro Abate</a></li><li><a href="http://rwmj.wordpress.com/tag/ocaml/feed/">Richard Jones</a></li><li><a href="http://blog.rastageeks.org/spip.php?page=rss&id_mot=2">Romain Beauxis</a></li><li><a href="http://seb.mondet.org/blog/feed/ocaml.rss">Sebastien Mondet</a></li><li><a href="http://upsilon.cc/~zack/tags/ocaml/index.rss">Stefano Zacchiroli</a></li><li><a href="http://le-gall.net/sylvain+violaine/blog/index.php?feed/tag/ocaml/atom">Sylvain Le Gall</a></li><li><a href="http://caml.inria.fr/hump.rss">The Caml Humps</a></li><li><a href="http://www.blogger.com/feeds/6115529230232389198/posts/default">Till Varoquaux</a></li><li><a href="http://y-node.com/blog/feeds/latest/">y-node</a></li></ul>

      <a href="http://planet.ocaml.org/rss20.xml"><img src=".././img/rss20.png"/></a>
      <a href="http://planet.ocaml.org/opml.xml"><img src=".././img/opml.png"/></a>
    </div>
    <div class="planet"><a name="43953969909edadc60d40a276a7da149"></a><span class="rss-header"><span class="rss-title"><a href="http://rwmj.wordpress.com/?p=4580"> OCaml 4.01.0 entering Rawhide</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Richard Jones</span>, <span class="rss-date">14 Sep 2013</span></span><span class="rss-description"><div id="post1"><p>After using OCaml for around 10 years it is still my favourite language, and it’s amazing how far ahead of other programming languages it remains to this day.</p>
<p><a href="https://sympa.inria.fr/sympa/arc/caml-list/2013-09/msg00173.html">OCaml 4.01.0 was released on Thursday</a> and I’m putting it into Fedora Rawhide over this weekend.</p>
<p>Debuginfo is now (partially) enabled.  <a href="http://www.ocamlpro.com/blog/2012/08/20/ocamlpro-and-4.00.0.html">The OCaml code generator has produced good quality DWARF information for a while</a>, and now you are able to debug OCaml programs in gdb under Fedora:</p>
<a onclick="switchContent('post1','post2')" class="btn" href="#43953969909edadc60d40a276a7da149">Read more...</a></div><div id="post2" style="display: none"><p>After using OCaml for around 10 years it is still my favourite language, and it’s amazing how far ahead of other programming languages it remains to this day.</p>
<p><a href="https://sympa.inria.fr/sympa/arc/caml-list/2013-09/msg00173.html">OCaml 4.01.0 was released on Thursday</a> and I’m putting it into Fedora Rawhide over this weekend.</p>
<p>Debuginfo is now (partially) enabled.  <a href="http://www.ocamlpro.com/blog/2012/08/20/ocamlpro-and-4.00.0.html">The OCaml code generator has produced good quality DWARF information for a while</a>, and now you are able to debug OCaml programs in gdb under Fedora:</p>
<pre>$ <b>sudo debuginfo-install ocaml ocaml-findlib</b>
$ <b>gdb /usr/bin/ocamlfind</b>
[...]
Reading symbols from /usr/bin/ocamlfind...
Reading symbols from /usr/lib/debug/usr/bin/ocamlfind.debug...done.
done.
(gdb) <b>break frontend.ml:469</b>
Breakpoint 1 at 0x432500: file frontend.ml, line 469.
(gdb) <b>run query findlib -l</b>
Starting program: /usr/bin/ocamlfind query findlib -l

Breakpoint 1, camlFrontend__query_package_1199 () at frontend.ml:469
469	let query_package () =
(gdb) <b>bt</b>
#0  camlFrontend__query_package_1199 () at frontend.ml:469
#1  0x000000000043a4b4 in camlFrontend__main_1670 () at frontend.ml:2231
#2  0x000000000043aa86 in camlFrontend__entry () at frontend.ml:2283
#3  0x000000000042adc9 in caml_program ()
#4  0x00000000004834be in caml_start_program ()
#5  0x000000000048365d in __libc_csu_init ()
#6  0x0000003979821b75 in __libc_start_main (main=0x42aa60 &lt;main&gt;, argc=4, 
    ubp_av=0x7fffffffde38, init=&lt;optimized out&gt;, fini=&lt;optimized out&gt;, 
    rtld_fini=&lt;optimized out&gt;, stack_end=0x7fffffffde28) at libc-start.c:258
#7  0x000000000042aaa9 in _start ()
(gdb) <b>list</b>
464	;;
465	
466	
467	(************************** QUERY SUBCOMMAND ***************************)
468	
469	let query_package () =
470	
471	  let long_format =
472	    "package:     %p\ndescription: %D\nversion:     %v\narchive(s):  %A\nlinkopts:    %O\nlocation:    %d\n" in
473	  let i_format =
</pre>
<p>GDB only understands location data at the moment, so you can’t yet query variables (although I understand OCaml generates the correct DWARF info for this, GDB just doesn’t know how to print OCaml expressions).</p>
<p>There will also be some limitations on the debuginfo built at first.  At the moment it doesn’t include debuginfo for OCaml libraries called from an OCaml program, because of problems that need to be worked out with the toolchain.  Mixed OCaml binary / C library debuginfo does work.</p>
<br/>  <a href="http://feeds.wordpress.com/1.0/gocomments/rwmj.wordpress.com/4580/" rel="nofollow"><img src="http://feeds.wordpress.com/1.0/comments/rwmj.wordpress.com/4580/" alt="" border="0"/></a> <img src="http://stats.wordpress.com/b.gif?host=rwmj.wordpress.com&amp;blog=6840703&amp;post=4580&amp;subd=rwmj&amp;ref=&amp;feed=1" alt="" height="1" border="0" width="1"/><a onclick="switchContent('post2','post1')" class="btn" href="#43953969909edadc60d40a276a7da149">Hide</a></div></span>
<a name="2725cd9f1034ea5060a28a7d7d44f03e"></a><span class="rss-header"><span class="rss-title"><a href="https://forge.ocamlcore.org/forum/forum.php?forum_id=885"> Expiration of SSL certificate and upcoming forge.ocaml.org</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">OCamlCore Forge News</span>, <span class="rss-date">13 Sep 2013</span></span><span class="rss-description"><pre class="rss-text">Hi everyone,

The wildcard SSL I bought a couple of years ago for *.ocamlcore.org is about to expire. I have decided to not buy a new commercial certificate. I am still considering my options, but I will probably go back to a free SSL cert from CACert. This is not widely supported but other upcoming changes don't push me to invest a lot in the ocamlcore.org domain name.

I will publish more details about the SSL migration to CACert, but if you have problem with by the end of September, check that you trust CACert.

The other big news is that OCaml Labs and RackSpace have provided me with a new host for the forge. This is a very good news because the current host starts to be unreliable.

I will take advantage of this migration to initiate another migration: changing the name of the forge to forge.ocaml.org ! This is a strong signal that the OCaml community is uniting and I am all for it.

Your forge master
Sylvain Le Gall</pre></span>
<a name="e274d9a66167786d803a222d9d616b9b"></a><span class="rss-header"><span class="rss-title"><a href="http://caml.inria.fr/pub/distrib/ocaml-4.01/"> OCaml 4.01.0 released</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Caml INRIA</span>, <span class="rss-date">12 Sep 2013</span></span><span class="rss-description"></span>
<a name="9096fd236bdf1bfe00d3eb0975343acc"></a><span class="rss-header"><span class="rss-title"><a href="http://gallium.inria.fr/blog/monomorphic_let"> Monomophic let in OCaml?</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">GaGallium</span>, <span class="rss-date">11 Sep 2013</span></span><span class="rss-description"><div id="post3"><p>Since version 7, GHC has decided to treat local let-definitions as monomorphic. We check how such a change would fare with OCaml.</p>




<p>In their 2010 paper <a href="http://research.microsoft.com/en-us/um/people/simonpj/papers/constraints/index.htm">Let should not be generalised</a>, Dimitrios Vytiniotis, Simon Peyton Jones and Tom Schrijvers argue that this allows for simpler type inference, with a very limited impact on the existing code base. Independently of the potential benefit of such a choice, it is interesting to see how much polymorphism is really needed in OCaml.</p>
<p>To check the impact of a monomorphic let, I did a small experiment, modifying the OCaml compiler to only generalize let-definitions when there is an explicit polymorphic-type annotation. (Strictly speaking, this is not full let-monomorphism, as we still generalize implicit parts inside the annotation, but this should not make any difference for our experiment.)</p>
<p>The patch can be found <a href="http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/trunk/experimental/garrigue/nongeneral-let.diff?view=markup">here</a>.</p>
<a onclick="switchContent('post3','post4')" class="btn" href="#9096fd236bdf1bfe00d3eb0975343acc">Read more...</a></div><div id="post4" style="display: none"><p>Since version 7, GHC has decided to treat local let-definitions as monomorphic. We check how such a change would fare with OCaml.</p>




<p>In their 2010 paper <a href="http://research.microsoft.com/en-us/um/people/simonpj/papers/constraints/index.htm">Let should not be generalised</a>, Dimitrios Vytiniotis, Simon Peyton Jones and Tom Schrijvers argue that this allows for simpler type inference, with a very limited impact on the existing code base. Independently of the potential benefit of such a choice, it is interesting to see how much polymorphism is really needed in OCaml.</p>
<p>To check the impact of a monomorphic let, I did a small experiment, modifying the OCaml compiler to only generalize let-definitions when there is an explicit polymorphic-type annotation. (Strictly speaking, this is not full let-monomorphism, as we still generalize implicit parts inside the annotation, but this should not make any difference for our experiment.)</p>
<p>The patch can be found <a href="http://caml.inria.fr/cgi-bin/viewvc.cgi/ocaml/trunk/experimental/garrigue/nongeneral-let.diff?view=markup">here</a>.</p>
<p>Then I tried to compile various software with this modified compiler. Namely, the OCaml distribution itself, LablGTK, and Core/Async with their dependencies. At the beginning I was fixing missing polymorphism by adding annotations by hand, but soon I came to just recompile the file with the standard compiler when the modified compiler failed.</p>
<p>The results are summarized in this table:</p>
<table>
<thead>
<tr class="header">
<th align="left">Package</th>
<th align="left">Number of files</th>
<th align="left">Failed files</th>
<th align="left">Ratio</th>
<th align="left">Errors/Line</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">OCaml</td>
<td align="left">488</td>
<td align="left">20</td>
<td align="left">4%</td>
<td align="left">1/7000</td>
</tr>
<tr class="even">
<td align="left">LablGTK</td>
<td align="left">101</td>
<td align="left">7</td>
<td align="left">7%</td>
<td align="left">1/3000</td>
</tr>
<tr class="odd">
<td align="left">Oasis setup.ml</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">100%</td>
<td align="left">1/6000</td>
</tr>
<tr class="even">
<td align="left">Sexplib</td>
<td align="left">12</td>
<td align="left">1</td>
<td align="left">8%</td>
<td align="left">1/3500</td>
</tr>
<tr class="odd">
<td align="left">Variantslib</td>
<td align="left">2</td>
<td align="left">1</td>
<td align="left">50%</td>
<td align="left">1/500</td>
</tr>
<tr class="even">
<td align="left">Core_kernel</td>
<td align="left">170</td>
<td align="left">16</td>
<td align="left">9%</td>
<td align="left">1/1800</td>
</tr>
<tr class="odd">
<td align="left">Core</td>
<td align="left">178</td>
<td align="left">4</td>
<td align="left">2%</td>
<td align="left">1/4000</td>
</tr>
<tr class="even">
<td align="left">Async_core</td>
<td align="left">36</td>
<td align="left">4</td>
<td align="left">11%</td>
<td align="left">1/1600</td>
</tr>
<tr class="odd">
<td align="left">Async_unix</td>
<td align="left">31</td>
<td align="left">7</td>
<td align="left">23%</td>
<td align="left">1/1000</td>
</tr>
<tr class="even">
<td align="left">Async_extra</td>
<td align="left">22</td>
<td align="left">2</td>
<td align="left">9%</td>
<td align="left">1/3000</td>
</tr>
<tr class="odd">
<td align="left"> </td>
<td align="left"> </td>
<td align="left"> </td>
<td align="left"> </td>
<td align="left"> </td>
</tr>
<tr class="even">
<td align="left"><em>Total</em></td>
<td align="left">1041</td>
<td align="left">63</td>
<td align="left">6%</td>
<td align="left">1/1700</td>
</tr>
</tbody>
</table>
<p>Since we did not count the number of polymorphic let-definitions, but just the number of failed files, the results are a bit rough. Still, they tell us that about 6% of files did not compile, and that more than 1 out of 1700 lines must be modified.</p>
<p>A comparison with the GHC distribution may be interesting: according to the <a href="http://research.microsoft.com/en-us/um/people/simonpj/papers/constraints/jfp-outsidein.pdf">OutsideIn paper</a> 20 modules out of 533 had to be modified, which is about 4%. This is a bit less than the results for OCaml, but GHC files tend to be shorter. They also found that 12% of packages on Hackage needed modification, which is not very informative, but seems to be much lower than our results for OCaml (a package is supposed to contain several modules).</p>
<p>More important is how easy it is to fix the errors. Namely, most of polymorphic let-definitions fall in one of three cases:</p>
<ul>
<li>function specialized to some local parameter, but still polymorphic</li>
<li>uses of <code>Obj.magic</code></li>
<li>polymorphic variants</li>
</ul>
<p>The second case is a bit special, and one could actually argue that it is better to annotate all uses of <code>Obj.magic</code>. Still, these were probably cases where there was a better place for annotation.</p>
<p>Most cases actually pertain to the first category. Fixing those is not as easy as one could think. The types involved tend to be large, and sometimes difficult to reconstruct by hand. A solution is to move the function to the toplevel, as it will then be automatically generalized, but this has two drawbacks: first, the enclosing function may be large so that the local definition is moved far away from its use point; second, we have to perform lambda-lifting manually, abtracting over local parameters and pass them explicitly at each use point.</p>
<p>Finally, polymorphic variants are particularly troublesome, because the inferred type can be huge, and we are in a situation where we need it to be polymorphic, so that using type abbreviations may not be so easy.</p>
<h3 id="what-conclusions-can-we-draw">What conclusions can we draw?</h3>
<p>Notice that these figures are comparable to experiments conducted when the value restriction had been introduced. In that case, it was argued that eta-expansion solved most situations at a very low syntactic (and computational) cost. For monomorphic let, it suffices to provide an annotation to recover polymorphism, thus the solution is universal, but its cost for the programmer is higher.</p>
<p>Actually, this discussion is mostly academic, because in OCaml we have no specific reason to make local let-definitions monomorphic. By contrast with Haskell which propagates type information through constraint solving, we instead only perform forward propagation, and actually rely on polymorphism to decide when some type information does not depend on the order of type inference and is safe to use. GADTs create problems of their own, but we handle these through <a href="http://cristal.inria.fr/~remy/gadts/">ambivalent types</a>, a mechanism similar in spirit to the tracking of sharing used for type information, which again relies on local polymorphism rather than forgoes it.</p><a onclick="switchContent('post4','post3')" class="btn" href="#9096fd236bdf1bfe00d3eb0975343acc">Hide</a></div></span>
<a name="3eb62f7b5dd4e17948290ecc87812b7e"></a><span class="rss-header"><span class="rss-title"><a href="http://alan.petitepomme.net/cwn/2013.09.10.html"> Caml Weekly News, 10 Sep 2013</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Caml Weekly News</span>, <span class="rss-date">10 Sep 2013</span></span><span class="rss-description">Pippo: a pretty interesting pre-processor that uses OCaml / OCaml 4.01.0+rc2 / Uutf 0.9.3 &amp; Xmlm 1.2.0 / OCamlPro Highlights, August 2013 / Other Caml News</span>
<a name="987ab477f849380c60405a46b6c2ca46"></a><span class="rss-header"><span class="rss-title"><a href="http://anil.recoil.org/2013/09/09/ocamlot-autotriaging"> OCamlot--exploring the edges of OPAM packages</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Anil Madhavapeddy</span>, <span class="rss-date">08 Sep 2013</span></span><span class="rss-description"><div id="post5"><p>The new release of OCaml (4.01.0) was just <a href="https://sympa.inria.fr/sympa/arc/caml-list/2013-09/msg00173.html">announced</a>! The runup to a major release like this is normally a frantic time to test that your favourite applications don’t break unexpectedly due to some incompatible language feature. This release cycle has a little different though, as we’ve been working hard on using the <a href="http://opam.ocamlpro.com">OPAM</a> package database to build an online regression testing infrastructure to mechanize much of this process.</p>

<p>I wanted to share some of what OCamlot does today, some of the results from about 3 months worth of runs that may help OCaml package maintainers, and finally where we’re going with future developments. This work has been done in collaboration with <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/sheets.html">David Sheets</a> (who built the OCamlot daemon) and the OPAM team ably led by <a href="http://gazagnaire.org">Thomas Gazagnaire</a> at <a href="http://ocamlpro.com">OCamlPro</a>. We’ve also had a lot of help from <a href="https://github.com/diml">Jeremie Dimino</a> and <a href="https://github.com/ysulsky">Yury Sulsky</a> from Jane Street and <a href="http://dave.recoil.org">Dave Scott</a> and <a href="http://jon.recoil.org">Jon Ludlam</a> from Citrix acting as guinea pigs for their respective regular releases of the <a href="https://github.com/janestreet">Core</a> and <a href="https://github.com/xapi-project">Xen/XAPI</a> releases to OPAM.</p>

<h2 id="towards_a_truely_portable_ocaml">Towards a truely portable OCaml</h2>

<a onclick="switchContent('post5','post6')" class="btn" href="#987ab477f849380c60405a46b6c2ca46">Read more...</a></div><div id="post6" style="display: none"><p>The new release of OCaml (4.01.0) was just <a href="https://sympa.inria.fr/sympa/arc/caml-list/2013-09/msg00173.html">announced</a>! The runup to a major release like this is normally a frantic time to test that your favourite applications don’t break unexpectedly due to some incompatible language feature. This release cycle has a little different though, as we’ve been working hard on using the <a href="http://opam.ocamlpro.com">OPAM</a> package database to build an online regression testing infrastructure to mechanize much of this process.</p>

<p>I wanted to share some of what OCamlot does today, some of the results from about 3 months worth of runs that may help OCaml package maintainers, and finally where we’re going with future developments. This work has been done in collaboration with <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/people/sheets.html">David Sheets</a> (who built the OCamlot daemon) and the OPAM team ably led by <a href="http://gazagnaire.org">Thomas Gazagnaire</a> at <a href="http://ocamlpro.com">OCamlPro</a>. We’ve also had a lot of help from <a href="https://github.com/diml">Jeremie Dimino</a> and <a href="https://github.com/ysulsky">Yury Sulsky</a> from Jane Street and <a href="http://dave.recoil.org">Dave Scott</a> and <a href="http://jon.recoil.org">Jon Ludlam</a> from Citrix acting as guinea pigs for their respective regular releases of the <a href="https://github.com/janestreet">Core</a> and <a href="https://github.com/xapi-project">Xen/XAPI</a> releases to OPAM.</p>

<h2 id="towards_a_truely_portable_ocaml">Towards a truely portable OCaml</h2>

<p>The upstream OCaml toolchain is built on very UNIX-like principles, with a number of command-line tools that form a build pipeline. This process usually ends with linking the intermediate object files with a <a href="https://github.com/ocaml/ocaml/tree/trunk/byterun">runtime library</a> that provides the garbage collector and other intrinsic OS functions.</p>

<p>Given these raw compiler tools, it’s very easy to compile OCaml into all sorts of weird and wonderful architectures. We’ve seen it run on <a href="http://www.algo-prog.info/ocaml_for_pic/web/index.php">8-bit PICs</a>, several efficient Javascript backends (originally <a href="http://jaked.github.io/ocamljs/">ocamljs</a> and more recently <a href="http://ocsigen.org/js_of_ocaml">js_of_ocaml</a>), and of course my own <a href="http://openmirage.org">Mirage</a> Xen unikernel.</p>

<p>While the compiler tools themselves are quite portable and work on almost any UNIX-like system, the build system scaffolding around third-party packages is less portable. Some features such as C bindings often contribute to build breakage on some less-used operating systems such as FreeBSD or OpenBSD, as they usually require probing for header file locations or adding custom <code>CFLAGS</code> before building.</p>
<table width="90%" align="center">
<tbody><tr>
<td width="30%" class="bimg"><a href="http://anil.recoil.org/images/dreamplug-nest-1.jpg"><img src="http://anil.recoil.org/images/dreamplug-nest-1-thumb.jpg" border="0" width="200"/></a><br/>Every Internet of Things starts with a tangled pile of ARM Dreamplugs.</td>
<td width="30%" class="bimg"><a href="http://anil.recoil.org/images/sparc-macppc-openbsd-1.jpg"><img src="http://anil.recoil.org/images/sparc-macppc-openbsd-1-thumb.jpg" border="0" width="200"/></a><br/>And in our server room, venerable Sparc and PowerPC G4 OpenBSD boxen still live.</td>
<td width="30%" style="vertical-align: bottom;" class="bimg"><a href="http://anil.recoil.org/images/macppc-desktop-1.jpg"><img src="http://anil.recoil.org/images/macppc-desktop-1-thumb.jpg" border="0" width="200"/></a><br/>Finding older machines is getting tough, but here's <a href="http://dave.recoil.org">Dave's</a> old iMac G5 running Linux.</td>
</tr>
</tbody></table>
<p>Most OCaml developers use x86-based machines and so foreign architectures also get less day-to-day testing (OCaml has superb support for fast native code compilation on ARM, PowerPC, Sparc32, and we’re working on MIPS64 here as part of the <a href="http://www.cl.cam.ac.uk/research/security/ctsrd/cheri.html">CHERI</a> project).</p>

<p>We want to make sure that OCaml and its package ecosystem works just as well in the embedded ecosystem as well as it does on vanilla x86 Linux. This includes running on my Linux iMac G5, my <a href="https://wiki.freebsd.org/FreeBSD/arm/Raspberry%20Pi">FreeBSD Raspberry Pi</a>, my <a href="http://www.openbsd.org/beagle.html">OpenBSD Pandaboard</a>, or even on a bytecode-only architecture like an <a href="http://www.openbsd.org/sparc64.html">OpenBSD/Sparc64</a>.</p>

<p>In the longer term, this paves the way to reliable cross-compiled packages for Windows, <a href="https://github.com/vouillon/ocaml-android">Android</a> and <a href="http://psellos.com/ocaml/compile-to-iphone.html">iPhone</a> (all of which have OCaml ports, but aren’t heavily tested with the full package database). The only practical way to get started on this is by building an automated test infrastructure for OCaml that explores the feature matrix (which eerily for me, happened in the early days of Xen too, via <a href="http://blogs.citrix.com/2013/08/30/xenserver-automated-testing-and-lab-orchestration-introducing-xenrt/">XenRT</a> to stabilize the hypervisor).</p>

<h3 id="why_not_jenkins_or_travis">Why not Jenkins or Travis?</h3>

<p>When we first started hacking on the OPAM testing infrastructure earlier this year, I maintained a local <a href="http://jenkins-ci.org">Jenkins</a> installation that monitored the repository. While Jenkins is a superb tool for many continuous integration tasks, it fell over badly when trying to use it on the non-x86 and non-Linux (or Windows) operating systems. Jenkins requires a full Java runtime stack to be available on each of the client machines, which was taking up more time to get up and running than a simple OCaml-based client and server that could compile to both portable bytecode or fast native code.</p>

<p>The other difficulty with OPAM is selecting which packages actually need to be tested, as it has a constraint-based package solver that supports expressive forwards and backwards version restrictions. While basic tests of the latest packages worked with Jenkins, we needed to increasingly customize it to automate interfacing directly with the OPAM libraries and calculating test schedules based on incoming change requests.</p>

<p>Another factor that ruled out depending on hosted services such as <a href="https://travis-ci.org">Travis</a> is that they tend to support x86-only architectures, whereas we really want to test the full spectrum of CPU variants supported by OCaml. This doesn’t mean that there’s no place for Travis of course, and in fact Mike Lin has already <a href="http://blog.mlin.net/2013/02/testing-ocaml-projects-on-travis-ci.html">made this work</a> with OPAM.</p>

<p>For our full testing needs though, <a href="https://github.com/ocamllabs/ocamlot">OCamlot</a> was born: an OCaml client and server system which coordinates different versions of the compiler, architectures and OPAM versions and records the results for triage and fixing issues.</p>

<h3 id="running_ocamlot">Running OCamlot</h3>

<p>The latest alpha release of OCamlot is pretty straightforward to run locally, if you are so inclined. First start a server process:</p>

<pre><code>$ git clone git://github.com/ocamllab/ocamlot
$ cd ocamlot
$ ./install_deps.sh
$ oasis setup
# (edit lib/config.ml if you need to change ports)
$ make
$ ./_build/lib/ocamlot_cmd.native --help
$ ./_build/lib/ocamlot_cmd.native serve</code></pre>

<p>The server listens on localhost only by default, and normally an SSL-to-TCP proxy is deployed to listen for external connections (I use <a href="https://github.com/bumptech/stud">stud</a>, which is fast and easy to configure).</p>

<p>The OCamlot clients require a local compilation of OCaml, and they autodetect their local CPU architecture and operating system. I’ve put a <a href="https://gist.github.com/avsm/6393649">gist script</a> together that automates this on most Linux and BSD variants. Just customize the top variables (set <code>MAKE</code> to <code>gmake</code> under BSD) and set the hostname to your server process.</p>

<h3 id="the_results_repository_and_autotriage">The results repository and auto-triage</h3>

<p>Once the client is running, the server dispatches tasks from its test matrix, which is calculated from the OPAM package repository. The server maintains a <a href="https://github.com/ocamlot/ocamlot-state">results repository</a>, which is a Git filesystem database that records the build results and logs via an s-expression per task. It also uses <a href="https://github.com/mirage/ocaml-cohttp">Cohttp</a> to serve up the results for a web browser.</p>

<p>It’s very convenient using Git repositories like this since we can use GitHub (or any other Git host) to coordinate and record results, and restart the server without needing any local state. So convenient, in fact, that Thomas and I have been working on a more formal engine for this called <a href="https://github.com/samoht/irminsule">Irminsule</a> (more on that in a later post, though).</p>

<p>It’s almost unheard of to have a full OCamlot run go by without some errors, and so David put together the <code>ocamlot triage</code> command. This takes the state repository and runs a set of regular expressions over it to classify them into common errors. The full file is <a href="https://github.com/ocamllabs/ocamlot/blob/master/lib/result.ml">here</a>, but an excerpt should give you an idea of what we look for:</p>
<div class="highlight"><pre><code class="ocaml">	<span class="c">(* ordered minor to severe *)</span>
	<span class="k">type</span> <span class="n">analysis</span> <span class="o">=</span>
	  <span class="o">|</span> <span class="nc">Solver</span> <span class="k">of</span> <span class="n">solver_error</span> <span class="n">option</span>
	  <span class="o">|</span> <span class="nc">Dep</span> <span class="k">of</span> <span class="kt">string</span> <span class="o">*</span> <span class="n">analysis</span>
	  <span class="o">|</span> <span class="nc">Transient</span> <span class="k">of</span> <span class="n">transient_error</span>
	  <span class="o">|</span> <span class="nc">System</span> <span class="k">of</span> <span class="n">system_error</span>
	  <span class="o">|</span> <span class="nc">Meta</span> <span class="k">of</span> <span class="n">meta_error</span>
	  <span class="o">|</span> <span class="nc">Ext_dep</span> <span class="k">of</span> <span class="n">ext_dep_error</span>
	  <span class="o">|</span> <span class="nc">Build</span> <span class="k">of</span> <span class="n">build_error</span>
	  <span class="o">|</span> <span class="nc">Multiple</span> <span class="k">of</span> <span class="n">analysis</span> <span class="kt">list</span>
	    <span class="k">with</span> <span class="n">sexp</span>
	
</code></pre>
</div>
<p>The errors are ordered by severity to aid in color highlighting. They start with OPAM solver failures and dependency failures (e.g. due to trying to build a package that requires a specific OCaml version that isn’t available), and move onto missing package dependencies or system libraris.</p>

<h2 id="testing_the_run_up_to_ocaml_401">Testing the run up to OCaml 4.01</h2>

<p>Of course, running all these tests is useless without taking action on the results. I’ve been keeping track of them in <a href="https://github.com/OCamlPro/opam-repository/issues/1029">issue #1029</a>. The nice thing about GitHub issues is that when this bug is referenced in commits (even in other repositories) a cross-reference shows up on that webpage and lets everything be tracked nicely.</p>

<p>So what were the most common failures in the runup to 4.01, and what should you avoid when writing your own code?</p>

<h3 id="different_standard_library_module_signatures">Different standard library module signatures</h3>

<p>There have been a few changes to some of the functor signatures in the standard library, such as adding a <code>find</code> function to Set (<a href="http://caml.inria.fr/mantis/view.php?id=5864">mantis #5864</a>). A third-party library that tries to match the functor signature will fail to compile with a type error, such as this one below for <a href="http://anil.recoil.org/feeds/atom.xml">zipperposition.0.2</a>:</p>

<pre><code>Error: The implementation src/ptset.ml
       does not match the interface src/ptset.cmi:
       ...
       In module Big:
       The field `find' is required but not provided</code></pre>

<p>The relevant code in <code>zipperposition</code> makes it clear what the problem is:</p>
<div class="highlight"><pre><code class="ocaml">	<span class="c">(* Big-endian Patricia trees *)</span>
	<span class="k">module</span> <span class="nc">Big</span> <span class="o">:</span> <span class="k">sig</span>
	  <span class="k">include</span> <span class="nn">Set</span><span class="p">.</span><span class="nc">S</span> <span class="k">with</span> <span class="k">type</span> <span class="n">elt</span> <span class="o">=</span> <span class="kt">int</span>
	  <span class="k">val</span> <span class="n">intersect</span> <span class="o">:</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="kt">bool</span>
	<span class="k">end</span>
	
</code></pre>
</div>
<p>This particular bug was <a href="https://github.com/c-cube/zipperposition/issues/1">reported upstream</a>, and the fix requires implementing the <code>find</code> function for the Patricia-tree-based <code>Set</code>. Since the OPAM package will always be broken on OCaml 4.01, it was marked with a <a href="https://github.com/ocamlpro/opam-repository/commit/e45530205987f67d4316a958446d3dcc954b19ec">compiler version constraint</a> to prevent it being selected for installation under that compiler. When a new version with the fix is uploaded to OPAM, it will always be selected in preference to this broken one.</p>

<p>One other 4.01 change that temporarily broke most of the bigger networking libraries such as <a href="https://github.com/janestreet/core">Core</a>, <a href="https://ocsigen.org/lwt">Lwt</a> and <a href="http://batteries.forge.ocamlcore.org">Batteries</a> was the addition of the <a href="http://caml.inria.fr/mantis/view.php?id=5568">close-on-exec</a> flag to the <code>Unix</code> module. This change only affects upstream packages that redefine the UNIX module for their own purposes (such as adding an asynchronous I/O monad as Lwt does), hence it affects the standard library replacement packages.</p>

<p>The fix here was to locally add patches into the relevant OPAM packages to immediately unbreak things when the fix when into the 4.01 branch of the compiler, and notify upstream maintainers to release new versions of their projects. There’s a subtle problem here: when a patch such as this goes into an unreleased branch of the compiler (such as <code>4.01.0dev</code>), it’s hard to reliably detect if the user has got the very latest version of the compiler or not. If you do have problems like this in the future, try recompiling via <code>opam switch reinstall &lt;version&gt;</code> to the latest branch.</p>

<p>It’s very useful to be able to drop in bleeding-edge compiler tools into the OPAM repository using compiler constraints like this. For an example, see Alain Frisch’s <a href="https://github.com/OCamlPro/opam-repository/blob/master/packages/ppx_tools.0.1/opam">ppx_tools</a>, that require the very latest 4.02dev trunk release to compile his new extension-points feature.</p>

<h3 id="multiple_object_definitions">Multiple object definitions</h3>

<p>OCaml 4.01 also restricts multiple method definitions with the same name in the same object. This leaves only inheritance as the way to override method names, but some packages such as OCamlnet and Mlorg had minor uses of the old mechanism.</p>

<p>You can see this by using <code>opam switch</code>:</p>

<pre><code>$ opam switch 4.00.1
$ eval `opam config env`
$ ocaml
# object method x = 1 method x = 2 end;;
- : &lt; x : int &gt; = &lt;obj&gt;
$ opam switch 4.01.0
$ eval `opam config env`
$ ocaml
# object method x = 1 method x = 2 end;;
Error: The method `x' has multiple definitions in this object</code></pre>

<h3 id="new_warnings_and_the_dreaded_warningsaserrors">New warnings, and the dreaded warnings-as-errors</h3>

<p>After a decade of being deprecated, the <code>(or)</code> and <code>(&amp;)</code> operators finally had a warning turned on by default.</p>

<pre><code>$ ocaml
# true or false;;
Warning 3: deprecated feature: operator (or); you should use (||) instead
- : bool = true</code></pre>

<p>This wouldn’t normally be so bad, except that a surprising number of released packages also turn warnings into fatal errors (by using the <code>-w @</code> flags explained in the <a href="http://caml.inria.fr/pub/docs/manual-ocaml/comp.html">manual</a>). Warnings-as-errors is extremely useful when <em>developing</em> code but is rather harmful in released code, since a future compiler can choose to emit new warnings that aren’t necessarily fatal bugs.</p>

<p>Packages that failed like this include ocamlgraph, spotlib, quickcheck, OPA, Lablgtk-extras and many more. Please do make an effort to not leave this option turned on in your packages, or else it makes life more difficult for testing your code on bleeding edge versions of the compiler in the future.</p>

<p>It’s worth noting here that OCaml 4.01 has introduced a fair number of new and very useful warnings across a number of areas, mainly to do with detecting unexpected ambiguation or shadowing of values. I’ll cover more on these in a future post about the new 4.01 goodies.</p>

<h3 id="external_system_dependencies">External system dependencies</h3>

<p>While there any many packages in OPAM that are pure OCaml, there are also a substantial number that require other system tools to be installed. The Lablgtk GUI library obviously requires the C <code>gtk</code> library to be installed.</p>

<p>Determining if these libraries are installed on a particular OS is well beyond the scope of OPAM, as there are almost as many package managers as there are operating systems. However, it’s important for automated testing and user-friendly error messages to have some notion of detecting if the environment is ready for the OCaml package or not.</p>

<p>We’re solving this by using a <code>depexts</code> field in OPAM that consists of a set of tags that identify OS-specific packages that need to be present. A separate script can query these tags from OPAM and do the OS-specific tests or installation.</p>

<p>For example, here’s the <code>sqlite3-ocaml</code> OPAM description:</p>

<pre><code>opam-version: "1"
maintainer: "markus.mottl@gmail.com"
build: [
  ["ocaml" "setup.ml" "-configure"]
  ["ocaml" "setup.ml" "-build"]
  ["ocaml" "setup.ml" "-install"]
]
remove: [ ["ocamlfind" "remove" "sqlite3"] ]
depends: ["ocamlfind"]
depexts: [
  [ ["debian"  ] [ "libsqlite3-dev"]    ]
  [ ["freebsd" ] [ "database/sqlite3"]  ]
  [ ["openbsd" ] [ "database/sqlite3"]  ]
]</code></pre>

<p>The <code>depexts</code> field here lists APT package for Debian, and the ports tree locations for FreeBSD and OpenBSD. It could also list more specialised tags for particular versions of an OS. You can query this from OPAM as follows:</p>

<pre><code>$ opam install -e debian sqlite3-ocaml
libsqlite3-dev
$ opam install -e openbsd sqlite3-ocaml
database/sqlite3</code></pre>

<p>OCamlot therefore needs to query the <code>depexts</code> field from the package and run the right <code>apt</code> or <code>pkg_add</code> commands. I’ll write about this in more detail when it’s fully baked, as we’ve modified the semantics of the tag querying between OPAM 1.0 and OPAM 1.1 to make it easier to use in OCamlot.</p>

<h3 id="portable_shell_scripts">Portable shell scripts</h3>

<p>Once we’ve gotten past the hurdle of the compiler version causing failures, there is the small matter of testing non-Linux operating systems, as well as non-x86 CPU architectures. The <a href="https://github.com/OCamlPro/opam-repository/issues/1029">#1029 overview</a> lists many of these failures under the Portability section.</p>
<a href="http://www.openbsd.org"><img src="http://anil.recoil.org/images/ppuf200X181.gif" style="float: right;"/></a>
<p>Damien Doligez made some excellent points about how to write <a href="http://gallium.inria.fr/blog/portable-conditionals-in-makefiles/">portable Makefiles</a> that works across both GNU and BSD makes. This is why the carefully crafted OCaml Makefiles do not require GNU make to be installed when compiling on FreeBSD or OpenBSD (MacOS X gave up the fight a long time ago and installs GNU make as its default <code>make</code> command).</p>

<p>OPAM tries to help out BSD by providing a <code>make</code> macro in <code>opam</code> files that is substituted with either <code>"make"</code> (by default) or <code>"gmake"</code> (for BSD). While this works for for the toplevel invocation of the Makefile, it fails if the Makefile recursively invokes further targets without using the <code>$(MAKE)</code> variable instead of directly calling the command. Patching these sorts of things is easy but tedious: see the <a href="https://github.com/OCamlPro/opam-repository/blob/master/packages/facile.1.1/files/bsdmake.patch">patchfile</a> for the Facile constraint programming library for an example.</p>

<p>The real problem here, of course, is that package maintainers cannot be reasonably expected to test their code on systems that they don’t normally use–if we demanded perfect portability to be present in the main OPAM repository, we would’t get any submissions!</p>

<p>OCamlot automates this nicely though, by finding lots of portability bugs automatically, and maintainers are by-and-large very responsive when we report the problem upstream.</p>

<h2 id="the_emerging_distributed_workflow">The emerging distributed workflow</h2>

<p>The big drawback to OCamlot in its current form is the amount of triage effort it puts on the OPAM maintainers. The package database has now exceeded 500 packages in just a short few months, and has over 1500 unique versions that all need build testing and more accurate constraints. The wider community has been <em>really</em> keen to participate in helping with triage (just look at all the other people that leapt in on <a href="https://github.com/OCamlPro/opam-repository/issues/1029">bug #1029</a>), so its our immediate priority to make OCamlot more transparent for people that want to use it to improve their own packages, and in the future also use it to test various hypotheses about all the available open-source OCaml code (see Jacques’ experiment with <a href="http://gallium.inria.fr/blog/monomorphic_let/">monomorphic let</a> as an example of something that can benefit from wider automated compilation).</p>

<p>I’ll talk more about how we’re solving this in my upcoming <a href="http://ocaml.org/meetings/ocaml/2013/">OCaml 2013 Workshop</a> talk about the Platform. I don’t want spoil it too much, but it involves a lovely distributed Git workflow, an enhanced <a href="https://github.com/OCamlPro/opam2web">opam2web</a>, and a brand new metadata overlay system for OPAM that lets us enhance the package database with extra information such as statistics, portability and test results, but without polluting the main Git repository with all this extra non-essential data.</p>

<p>If you’re really curious to know right now, then you can see the outline of the new system at Amir’s <a href="http://amirchaudhry.com/wireframe-demos-for-ocamlorg/">new ocaml.org wireframes</a> blog post, where Part III contains the continuous integration workflow. A lot of infrastructure work has gone into building all of this over the summer, and now it’s all starting to be deployed in a very satisfying way…</p><a onclick="switchContent('post6','post5')" class="btn" href="#987ab477f849380c60405a46b6c2ca46">Hide</a></div></span>
<a name="d6c831966663fa2d001ee4356a668fc5"></a><span class="rss-header"><span class="rss-title"><a href="http://le-gall.net/sylvain+violaine/blog/index.php?post/2013/09/06/OUnit-2.0-progress%2C-August-2013"> OUnit 2.0 progress, August 2013</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Sylvain Le Gall</span>, <span class="rss-date">06 Sep 2013</span></span><span class="rss-description"><div id="post7"><p>After a long pause, I have resumed my work on <a href="http://ounit.forge.ocamlcore.org">OUnit2</a>. It is going quite well.</p>


<p>The basic features:</p>
<ul>
<li>better configuration setup
<ul>
<li>environment variable</li>
<li>command line options</li>
<li>configuration files</li>
</ul></li>
<li>systematic logging (verbose always on), but output log in a file</li>
<li>allow vim quickfix to jump in the log file where the error has happened</li>
<li>output HTML report</li>
<li>output JUnit report</li>
<li>choose how to run your test:
<ul>
<li>run tests in parallel using processes (auto-detect number of CPU and run as many worker processes)</li>
<li>run tests concurrently using threads</li>
<li>use the old sequential runner</li>
</ul></li>
<li>refactoring of the bracket, now easier to use</li>
<li>refactoring of OUnit2 interface (remove all useless functions)</li>
<li>non-fatal section: allow to fail inside non-fatal section without quitting immediately the whole test</li>
<li>allow to use OUnit1 test inside OUnit2 (smooth the transition)</li>
</ul>

<p>I still need to do the following:</p>
<a onclick="switchContent('post7','post8')" class="btn" href="#d6c831966663fa2d001ee4356a668fc5">Read more...</a></div><div id="post8" style="display: none"><p>After a long pause, I have resumed my work on <a href="http://ounit.forge.ocamlcore.org">OUnit2</a>. It is going quite well.</p>


<p>The basic features:</p>
<ul>
<li>better configuration setup
<ul>
<li>environment variable</li>
<li>command line options</li>
<li>configuration files</li>
</ul></li>
<li>systematic logging (verbose always on), but output log in a file</li>
<li>allow vim quickfix to jump in the log file where the error has happened</li>
<li>output HTML report</li>
<li>output JUnit report</li>
<li>choose how to run your test:
<ul>
<li>run tests in parallel using processes (auto-detect number of CPU and run as many worker processes)</li>
<li>run tests concurrently using threads</li>
<li>use the old sequential runner</li>
</ul></li>
<li>refactoring of the bracket, now easier to use</li>
<li>refactoring of OUnit2 interface (remove all useless functions)</li>
<li>non-fatal section: allow to fail inside non-fatal section without quitting immediately the whole test</li>
<li>allow to use OUnit1 test inside OUnit2 (smooth the transition)</li>
</ul>

<p>I still need to do the following:</p>
<ul>
<li>a test chooser that does smart selection of tests:
<ul>
<li>run the one that failed in the last run and run them first</li>
<li>before re-running the one that was ok, check that all failing tests are now passing otherwise skip the already passing tests.</li>
</ul></li>
<li>timer that makes tests fail if they take too long</li>
<li>allow to parametrize output filename so that you can use <code>OUNIT_OUTPUT_FILE=ounit-$(name),log</code> and have <code>$(name)</code> replace by the test suite name</li>
<li>create locks to avoid accessing the same resources within a single process or the whole application (typically to avoid doing a <code>chdir</code> while another thread is doing a <code>chdir</code> elsewhere)</li>
<li>better logging when using multiple workers</li>
<li>add more tests for the new runners</li>
<li>introduce a 'cached' state to avoid rerunning a test if you can programmaticaly determine that the result will be the same.</li>
<li>create a <code>in_testdata_dir</code> function to locate test data, if any</li>
<li>sys admin (website, release process)</li>
<li>update the whole documentation</li>
</ul>

<p>There is still a lot of work, but the current results are already quite good. The speed improvement of the processes runner is a good thing to shorten test timing (HINT: tester needed!).</p>


<h2>Focus on: the new bracket.</h2>


<p>In OUnit 1, a bracket was very functional:</p>


<pre> bracket 
    (fun () -&gt; "foo")  (* setup *)
    (fun foo -&gt; ())
    (fun foo -&gt; ())  (* tear down *)</pre>


<p>So for common bracket, like <code>bracket_tmpfile</code></p>


<pre>   bracket_tmpfile
       (fun (fn, chn) -&gt;
             (* Do something with chn and fn *)</pre>


<p>The problem is that if you were using 2 or 3 temporary files, the level of indentation was high. I have decide to switch to a more imperative approach, registering the <code>tear down</code> function inside the test context:</p>


<pre>   let (fn1, chn1) = bracket_tmpfile ctxt in
   let (fn2, chn2) = bracket_tmpfile ctxt in
      ....</pre>


<p>This is shorter and clearer (albeit less functional).</p>


<h2>Focus on: non fatal section</h2>


<p>Sometimes, you want to verify a set of properties but to have a clear vision of what is going wrong, you need to do more than one assert.</p>


<p>In OUnit1, you can do:</p>


<pre> assert_equal exp1 v1;
 assert_equal exp2 v2</pre>


<p>But if <code>exp1 &lt;&gt; v1</code>, you quit immediately and you'll never know for <code>exp2</code> and <code>v2</code>.</p>


<p>In OUnit2, you can do:</p>


<pre> non_fatal ctxt (fun ctxt -&gt; assert_equal exp1 v1);
 non_fatal ctxt (fun ctxt -&gt; assert_equal exp2 v2)</pre>


<p>In this new version, you will test both equality and the result of the test will be the worst failure you get (or success if both of them succeed).</p>


<h2>Help wanted</h2>


<p>If you have a long standing issue with OUnit, this is the time to submit a bug.
<a href="https://forge.ocamlcore.org/tracker/?atid=733&amp;group_id=162&amp;func=browse">OUnit BTS</a></p>


<p>If you want to try the dev version of OUnit:</p>


<pre> $&gt; darcs get http://forge.ocamlcore.org/anonscm/darcs/ounit/ounit</pre>


<p>Patches always welcome.</p>


<p>Special thanks to Thomas Wickham who has entirely written OUnitRunnerThreads and kickstarted the processes runner.</p><a onclick="switchContent('post8','post7')" class="btn" href="#d6c831966663fa2d001ee4356a668fc5">Hide</a></div></span>
<a name="06bf61429abfb4a29b6d1fca28c2cd0d"></a><span class="rss-header"><span class="rss-title"><a href="http://erratique.ch/software"> Uutf 0.9.3 and Xmlm 1.2.0</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Daniel Bünzli</span>, <span class="rss-date">06 Sep 2013</span></span><span class="rss-description"><p>Release of Uutf 0.9.3 and Xmlm 1.2.0. Consult the individual release notes for details.</p></span>
<a name="084d4489740acd01cf618fd8f8ddb477"></a><span class="rss-header"><span class="rss-title"><a href="https://forge.ocamlcore.org/projects/labltk/"> LablTk</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">OCamlCore Forge Projects</span>, <span class="rss-date">06 Sep 2013</span></span><span class="rss-description">LablTk is an interface to the Tcl/Tk GUI framework. It allows to develop GUI applications in a speedy and type safe way. A legacy Camltk interface is included. The OCamlBrowser library viewer is also part of this project.</span>
<a name="27df2f358de2d91f6750cba25663cb71"></a><span class="rss-header"><span class="rss-title"><a href="http://coherentpdf.com/blog/?p=68"> Community Release of PDF Command Line Tools</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Coherent Graphics</span>, <span class="rss-date">05 Sep 2013</span></span><span class="rss-description"><p>The <code>cpdf</code> tool has been available commercially since 2007, and is widely used in industry and government. The same technology is used in the <a href="http://www.coherentpdf.com/proview.html">Proview PDF Editor</a> for the mac.</p>
<p>Now we’re releasing it for free, under a special not-for-commercial-use license.</p>
<p>Binaries for Windows, Mac and Linux, OCaml source code, and full documentation are all available <a href="http://community.coherentpdf.com/">here</a>.</p>
<p>The Coherent PDF Command Line Tools allow you to manipulate existing PDF files in a variety of ways. For example:</p>
<ul>
<li>Merge PDF files together, or split them apart</li>
<li>Encrypt and decrypt</li>
<li>Scale, crop and rotate pages</li>
<li>Read and set document info and metadata</li>
<li>Copy, add or remove bookmarks</li>
<li>Stamp logos, text, dates, page numbers</li>
<li>Add or remove attachments</li>
</ul>
<p> </p>
&lt;script type="text/javascript"&gt;
  addthis_url    = 'http%3A%2F%2Fcoherentpdf.com%2Fblog%2F%3Fp%3D68';
  addthis_title  = 'Community+Release+of+PDF+Command+Line+Tools';
  addthis_pub    = '';
&lt;/script&gt;&lt;script src="http://s7.addthis.com/js/addthis_widget.php?v=12" type="text/javascript"&gt;&lt;/script&gt;</span>
<script type="text/javascript">function switchContent(id1,id2) {
     // Get the DOM reference
     var contentId1 = document.getElementById(id1);
     var contentId2 = document.getElementById(id2);
     // Toggle
     contentId1.style.display = "none";
     contentId2.style.display = "block";
     }</script></div>

  
    </div>

    
    <br/>
    <hr/>
    <div id="footer">
      Contribute to this project!
      Find us on <a href="https://github.com/ocaml/ocaml.org">Github</a>.
    </div>
    <span title=".././img/ = image directory from the base of the site"></span>


    
    
    

    <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
    <script src=".././js/jquery-1.8.0.min.js"></script>
    
    <script src=".././js/bootstrap.js"></script>

    <script type="text/javascript">
      var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-22552764-2']); _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-37808023-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

    </script>

</body></html>
