<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    
    <meta content="IE=8" http-equiv="X-UA-Compatible"/>
    <title>OCaml :: OCaml Planet</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <meta content="Ashish Agarwal, Esther Baruk, Christophe Troestler and many contributors" name="author"/>
    <meta content="" name="description"/>
    <meta content="" name="keywords"/>
    <meta content="OCaml (Weberizer)" name="generator"/>

    <link href="https://static.ocamlcore.org/official/images/favicon.ico" rel="shortcut icon"/>
    <link rel="stylesheet" href=".././css/bootstrap.css"/>
    <link href=".././css/ocaml.css" media="all" type="text/css" rel="stylesheet"/>
    <link rel="stylesheet" href=".././css/bootstrap-responsive.css"/>

    
    

    <meta content="OCaml Planet" property="og:title"/>
    <meta content="non_profit" property="og:type"/>

    <meta content="all" name="robots"/>
  </head>
  <body>
    <div id="header">
      <div class="top">
      </div>
      <div class="bottom">
      </div>
    </div>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
	  
          <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a href=".././" class="brand">OCaml</a>

          <div class="nav-collapse">
            <ul class="nav">
	      <li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">
    Discover
    <b class="caret"></b>
  </a>
  <ul class="dropdown-menu">
    <li><a href="../description.html">What is OCaml?</a></li>
    <li><a href="http://try.ocamlpro.com/">Try it Online</a></li>
    <li><a href="../taste.html">100 Lines of OCaml</a></li>
    <li><a href="../success.html">Success Stories</a></li>
    <li><a href="../companies.html">Who Is Using It?</a></li>
    <li><a href="http://pleac.sourceforge.net/pleac_ocaml/">Pleac</a></li>
    <li><a href="http://rosettacode.org/wiki/Category:OCaml">Rosetta</a>
        <a href="http://langref.org/ocaml">langref.org</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">
    Learn
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../install.html">Install</a></li>
    <li><a href="../tutorials/">Tutorials</a></li>
    <li><a href="../faq.html">FAQ</a></li>
    <li><a href="../books.html">Books</a></li>
    <li><a href="../videos.html">Videos</a></li>
    <li><a href="../papers.html">Papers</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">Use
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../releases/">Releases</a></li>
    <li><a href="../libraries.html">Libraries</a></li>
    <li><a href="../dev_tools.html">Development Tools</a></li>
    <li><a href="../books.html#manual">User Manual</a></li>
    <li><a href="../cheat_sheets.html">Cheat Sheets</a></li>
    <li><a href="http://search.ocaml.jp/">OCaml API Search</a></li>
    <li><a href="http://forge.ocamlcore.org/">Forge</a></li>
    <li><a href="https://github.com/languages/OCaml">GitHub</a></li>
    <li><a href="https://bitbucket.org/repo/all?name=ocaml">Bitbucket</a></li>
    <li><a href="http://gitorious.org/search?page=1&q=ocaml">Gitorious</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">Community
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../mailing_lists.html">Mailing Lists</a></li>
    <li><a href="../planet/">Blogs</a></li>
    <li><a href="../meetings/">Meetings</a></li>
    <li><a href="irc://irc.freenode.net/ocaml">IRC</a></li>
    <li><a href="http://stackoverflow.com/questions/tagged?tagnames=ocaml">Stack Overflow</a></li>
    <li><a href="http://www.reddit.com/r/ocaml/">Reddit</a></li>
    <li><a href="../support.html">Commercial Support</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">More
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="http://caml.inria.fr/mantis/">Mantis Bug Tracker</a></li>
    <li><a href="../caml-light/">Caml Light</a></li>
    <li><a href="../logos.html">Logos</a></li>
  </ul>
</li>

            </ul>
	    <form action="http://www.google.com/search" method="get" class="navbar-search pull-right">
	      <input placeholder="Search" class="search-query" name="q" type="text"/>
	      <input value="site:http://www.ocaml.org/" name="q" type="hidden"/>
	    </form>
            
	    
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <span class="navigation-bar">
	<a href="./../">Home</a><span class="separation"><img src=".././img/right_arrow.png" alt="&gt;"/></span>OCaml Planet
	<span id="language">
	  <span class="horizontal-toolbar"><span class="open-bracket">[</span><span class="current-url">En</span><span class="close-bracket">]</span></span>
	</span>
      </span>

      

    <h1>OCaml Planet</h1>

    <p>The OCaml Planet aggregates various blogs from the OCaml
    community.  It is kindly provided
    by <a href="http://www.ocamlcore.com/">OCamlCore</a>.  If you
    would like to be added, read
    the <a href="http://www.ocamlcore.org/planet/">Planet
    subscription HOWTO</a>.</p>

    <br/>
    <div style="float: right; margin-right: 0; margin-top: 0" class="span2 planet-subscriptions"><em>Subscriptions</em>
      <ul><li><a href="http://alexleighton.tumblr.com/tagged/ocaml/rss">Alex Leighton</a></li><li><a href="http://feeds.feedburner.com/amirmc-ocaml">Amir Chaudhry</a></li><li><a href="http://andreiformiga.com/blog/?cat=5&feed=rss2">Andrei Formiga</a></li><li><a href="http://math.andrej.com/feed/">Andrej Bauer</a></li><li><a href="http://anil.recoil.org/feeds/atom.xml">Anil Madhavapeddy</a></li><li><a href="http://ashishagarwal.org/tag/ocaml/feed/">Ashish Agarwal</a></li><li><a href="http://www.blogger.com/feeds/7617521785419311079/posts/default">Cameleon news</a></li><li><a href="http://caml.inria.fr/news.en.rss">Caml INRIA</a></li><li><a href="http://camlspotter.blogspot.com/feeds/posts/default?alt=rss">Caml Spotting</a></li><li><a href="http://alan.petitepomme.net/cwn/cwn.rss">Caml Weekly News</a></li><li><a href="http://coherentpdf.com/blog/?tag=ocaml&feed=rss">Coherent Graphics</a></li><li><a href="http://coq.inria.fr/news/feed">Coq</a></li><li><a href="http://erratique.ch/feeds/news.atom">Daniel Bünzli</a></li><li><a href="http://nleyten.com:82/feed/tag/ocaml/atom">Dario Teixeira</a></li><li><a href="http://www.blogger.com/feeds/17133288/posts/default/-/ocaml">David Baelde</a></li><li><a href="http://blog.bentobako.org/index.php?feed/tag/ocaml/atom">David Mentré</a></li><li><a href="http://dutherenverseauborddelatable.wordpress.com/category/ocaml/feed/">David Teller</a></li><li><a href="http://www.examachine.net/blog/cat/ocaml/feed/">Eray Özkural</a></li><li><a href="http://www.mega-nerd.com/erikd/Blog/index.rss20">Erik de Castro Lopo</a></li><li><a href="http://blog.emillon.org/feeds/ocaml.xml">Etienne Millon</a></li><li><a href="http://frama-c.com/rss.xml">Frama-C</a></li><li><a href="http://functionaljobs.com/jobs/search/?q=ocaml&format=rss">Functional Jobs</a></li><li><a href="http://gallium.inria.fr/blog/index.rss">GaGallium</a></li><li><a href="http://gaiustech.wordpress.com/category/ocaml/feed/">Gaius Hammond</a></li><li><a href="http://blog.camlcity.org/blog/rss">Gerd Stolpmann</a></li><li><a href="http://jobs.github.com/positions.atom?description=ocaml&location=">Github OCaml jobs</a></li><li><a href="http://www.wisdomandwonder.com/tag/OCaml/feed">Grant Rettke</a></li><li><a href="http://hongboz.wordpress.com/feed/">Hong bo Zhang</a></li><li><a href="http://blog.incubaid.com/tag/ocaml/feed/">Incubaid Research</a></li><li><a href="http://ambassadortothecomputers.blogspot.com/feeds/posts/default?alt=rss">Jake Donham</a></li><li><a href="http://scattered-thoughts.net/atom.xml">Jamie Brandon</a></li><li><a href="https://ocaml.janestreet.com/?q=rss.xml">Jane Street</a></li><li><a href="http://lpw25.net/rss.xml">Leo White</a></li><li><a href="http://www.lexifi.com/blogs/ocaml/feed">LexiFi</a></li><li><a href="http://newblog.0branch.com/rss.xml">Marc Simpson</a></li><li><a href="http://syntaxexclamation.wordpress.com/tag/ocaml/feed/">Matthias Puech</a></li><li><a href="http://www.blogger.com/feeds/5888658295182480819/posts/default">Matías Giovannini</a></li><li><a href="">Mihamina Rakotomandimby</a></li><li><a href="http://mcclurmc.wordpress.com/feed/">Mike McClurg</a></li><li><a href="http://nyc-ocaml.posterous.com/rss.xml">NYC OCaml</a></li><li><a href="http://ocaml-book.com/blog?format=rss">OCaml Book</a></li><li><a href="http://forge.ocamlcore.org/export/rss_sfnews.php">OCamlCore Forge News</a></li><li><a href="http://forge.ocamlcore.org/export/rss_sfprojects.php">OCamlCore Forge Projects</a></li><li><a href="http://www.ocamlcore.com/wp/?feed=rss2&amp;language=en&#038;language=en">OCamlCore.com</a></li><li><a href="http://www.ocamlpro.com/feed/atom.xml">OCamlPro</a></li><li><a href="http://odns.tuxfamily.org/feed/">ODNS project</a></li><li><a href="http://ox.tuxfamily.org/feed/">Ocaml XMPP project</a></li><li><a href="http://ocsigen.org/news.atom">Ocsigen project</a></li><li><a href="http://www.blogger.com/feeds/2073503406800427577/posts/default">Opa</a></li><li><a href="http://www.openmirage.org/blog/atom.xml">Open Mirage</a></li><li><a href="http://functional-orbitz.blogspot.com/feeds/posts/default/-/planetocaml?alt=rss">Orbitz</a></li><li><a href="http://www.donadeo.net/facets/programming-languages/objective-caml/feed/">Paolo Donadeo</a></li><li><a href="https://mancoosi.org/~abate/taxonomy/term/5/0/feed">Pietro Abate</a></li><li><a href="http://rwmj.wordpress.com/tag/ocaml/feed/">Richard Jones</a></li><li><a href="http://blog.rastageeks.org/spip.php?page=rss&id_mot=2">Romain Beauxis</a></li><li><a href="http://seb.mondet.org/blog/feed/ocaml.rss">Sebastien Mondet</a></li><li><a href="http://upsilon.cc/~zack/tags/ocaml/index.rss">Stefano Zacchiroli</a></li><li><a href="http://le-gall.net/sylvain+violaine/blog/index.php?feed/tag/ocaml/atom">Sylvain Le Gall</a></li><li><a href="http://caml.inria.fr/hump.rss">The Caml Humps</a></li><li><a href="http://www.blogger.com/feeds/6115529230232389198/posts/default">Till Varoquaux</a></li><li><a href="http://y-node.com/blog/feeds/latest/">y-node</a></li></ul>

      <a href="http://planet.ocaml.org/rss20.xml"><img src=".././img/rss20.png"/></a>
      <a href="http://planet.ocaml.org/opml.xml"><img src=".././img/opml.png"/></a>
    </div>
    <div class="planet"><a name="d8dd4879fad2a6db09096b12cd657497"></a><span class="rss-header"><span class="rss-title"><a href="http://www.amazon.co.uk/review/R28WYJ13WA94YL/ref=cm_cr_rdp_perm?ie=UTF8&ASIN=0957671105&linkCode=&nodeID=&tag="> On the book « OCaml from the very beginning »</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Daniel Bünzli</span>, <span class="rss-date">04 Jul 2013</span></span><span class="rss-description">Cambridge overflows with OCaml programmers. I got to meet John Whitington of <a href="http://www.coherentpdf.com/ocaml-libraries.html">camlpdf</a> fame. He kindly offered me a copy of his book « <a href="http://ocaml-book.com">OCaml from the very beginning</a>. » I read it and made a small review <a href="http://www.amazon.co.uk/review/R28WYJ13WA94YL/ref=cm_cr_rdp_perm?ie=UTF8&amp;ASIN=0957671105&amp;linkCode=&amp;nodeID=&amp;tag=">here</a>.</span>
<a name="7f392fbf92d0462ee6d04e5fcbc746d2"></a><span class="rss-header"><span class="rss-title"><a href="http://functional-orbitz.blogspot.com/2013/07/riakc-in-five-minutes.html"> Riakc In Five Minutes</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author"><span id="ocaml_1">Orbitz &#9001;noreply<abbr title="(at) &rarr; @">(at)</abbr>blogger.com (orbitz)&#9002;</span><script type="text/javascript"><!--;
local = "noreply";
h = "blogger.com (orbitz)";
hq = "blogger.com%20(orbitz)";
document.getElementById("ocaml_1").innerHTML = '<a href="mailto:' + local + '@' + hq + "\" >Orbitz<\/a>";
//--></script></span>, <span class="rss-date">04 Jul 2013</span></span><span class="rss-description"><div id="post1"><p>This is a simple example using Riakc to PUT a key into a Riak database. It assumes that you already have a Riak database up and running. </p> <p>First you need to install riakc. Simply do: <code>opam install riakc</code>. As of this writing, the latest version of riakc is 2.0.0 and the code given depends on that version. </p> <p>Now, the code. The following is a complete CLI tool that will PUT a key and print back the result from Riak. It handles all errors that the library can generate as well as outputting siblings correctly. </p> <pre><code><i></i></code></pre><font color="#9A1900">(*</font><br/><i><font color="#9A1900"> * This example is valid for version 2.0.0, and possibly later</font></i><br/><i><font color="#9A1900"> *)</font></i><br/><b><font color="#000080">open</font></b> <b><font color="#000080">Core</font></b><font color="#990000">.</font><font color="#009900">Std</font><br/><b><font color="#000080">open</font></b> <b><font color="#000080">Async</font></b><font color="#990000">.</font><font color="#009900">Std</font><br/><br/><i><font color="#9A1900">(*</font></i><br/><i><font color="#9A1900"> * Take a string of bytes and convert them to hex string</font></i><br/><i><font color="#9A1900"> * representation</font></i><br/><i><font color="#9A1900"> *)</font></i><br/><b><font color="#0000FF">let</font></b> hex_of_string <font color="#990000">=</font><br/> <b><font color="#000080">String</font></b><font color="#990000">.</font>concat_map <font color="#990000">~</font>f<font color="#990000">:(</font><b><font color="#0000FF">fun</font></b> c <font color="#990000">-&gt;</font> sprintf <font color="#FF0000">"%X"</font> <font color="#990000">(</font><b><font color="#000080">Char</font></b><font color="#990000">.</font>to_int c<font color="#990000">))</font><br/><br/><i><font color="#9A1900">(*</font></i><br/><i><font color="#9A1900"> * An Robj can have multiple values in it, each one with its</font></i><br/><i><font color="#9A1900"> * own content type, encoding, and value. This just prints</font></i><br/><i><font color="#9A1900"> * the value, which is a string blob</font></i><br/><i><font color="#9A1900"> *)</font></i><br/><b><font color="#0000FF">let</font></b> print_contents contents <font color="#990000">=</font><br/> <b><font color="#000080">List</font></b><font color="#990000">.</font>iter<br/> <font color="#990000">~</font>f<font color="#990000">:(</font><b><font color="#0000FF">fun</font></b> content <font color="#990000">-&gt;</font><br/> <b><font color="#0000FF">let</font></b> <b><font color="#0000FF">module</font></b> <font color="#009900">C</font> <font color="#990000">=</font> <b><font color="#000080">Riakc</font></b><font color="#990000">.</font><b><font color="#000080">Robj</font></b><font color="#990000">.</font><font color="#009900">Content</font> <b><font color="#0000FF">in</font></b><br/> printf <font color="#FF0000">"VALUE: %s\n"</font> <font color="#990000">(</font><b><font color="#000080">C</font></b><font color="#990000">.</font>value content<font color="#990000">))</font><br/> contents<br/><br/><b><font color="#0000FF">let</font></b> fail s <font color="#990000">=</font><br/> printf <font color="#FF0000">"%s\n"</font> s<font color="#990000">;</font><br/> shutdown <font color="#993399">1</font><br/><br/><b><font color="#0000FF">let</font></b> exec <font color="#990000">()</font> <font color="#990000">=</font><br/> <b><font color="#0000FF">let</font></b> host <font color="#990000">=</font> <b><font color="#000080">Sys</font></b><font color="#990000">.</font>argv<font color="#990000">.(</font><font color="#993399">1</font><font color="#990000">)</font> <b><font color="#0000FF">in</font></b><br/> <b><font color="#0000FF">let</font></b> port <font color="#990000">=</font> <b><font color="#000080">Int</font></b><font color="#990000">.</font>of_string <b><font color="#000080">Sys</font></b><font color="#990000">.</font>argv<font color="#990000">.(</font><font color="#993399">2</font><font color="#990000">)</font> <b><font color="#0000FF">in</font></b><br/> <i><font color="#9A1900">(*</font></i><br/><a onclick="switchContent('post1','post2')" class="btn" href="#7f392fbf92d0462ee6d04e5fcbc746d2">Read more...</a></div><div id="post2" style="display: none"><p>This is a simple example using Riakc to PUT a key into a Riak database. It assumes that you already have a Riak database up and running. </p> <p>First you need to install riakc. Simply do: <code>opam install riakc</code>. As of this writing, the latest version of riakc is 2.0.0 and the code given depends on that version. </p> <p>Now, the code. The following is a complete CLI tool that will PUT a key and print back the result from Riak. It handles all errors that the library can generate as well as outputting siblings correctly. </p> <pre><code><i></i></code></pre><font color="#9A1900">(*</font><br/><i><font color="#9A1900"> * This example is valid for version 2.0.0, and possibly later</font></i><br/><i><font color="#9A1900"> *)</font></i><br/><b><font color="#000080">open</font></b> <b><font color="#000080">Core</font></b><font color="#990000">.</font><font color="#009900">Std</font><br/><b><font color="#000080">open</font></b> <b><font color="#000080">Async</font></b><font color="#990000">.</font><font color="#009900">Std</font><br/><br/><i><font color="#9A1900">(*</font></i><br/><i><font color="#9A1900"> * Take a string of bytes and convert them to hex string</font></i><br/><i><font color="#9A1900"> * representation</font></i><br/><i><font color="#9A1900"> *)</font></i><br/><b><font color="#0000FF">let</font></b> hex_of_string <font color="#990000">=</font><br/> <b><font color="#000080">String</font></b><font color="#990000">.</font>concat_map <font color="#990000">~</font>f<font color="#990000">:(</font><b><font color="#0000FF">fun</font></b> c <font color="#990000">-&gt;</font> sprintf <font color="#FF0000">"%X"</font> <font color="#990000">(</font><b><font color="#000080">Char</font></b><font color="#990000">.</font>to_int c<font color="#990000">))</font><br/><br/><i><font color="#9A1900">(*</font></i><br/><i><font color="#9A1900"> * An Robj can have multiple values in it, each one with its</font></i><br/><i><font color="#9A1900"> * own content type, encoding, and value. This just prints</font></i><br/><i><font color="#9A1900"> * the value, which is a string blob</font></i><br/><i><font color="#9A1900"> *)</font></i><br/><b><font color="#0000FF">let</font></b> print_contents contents <font color="#990000">=</font><br/> <b><font color="#000080">List</font></b><font color="#990000">.</font>iter<br/> <font color="#990000">~</font>f<font color="#990000">:(</font><b><font color="#0000FF">fun</font></b> content <font color="#990000">-&gt;</font><br/> <b><font color="#0000FF">let</font></b> <b><font color="#0000FF">module</font></b> <font color="#009900">C</font> <font color="#990000">=</font> <b><font color="#000080">Riakc</font></b><font color="#990000">.</font><b><font color="#000080">Robj</font></b><font color="#990000">.</font><font color="#009900">Content</font> <b><font color="#0000FF">in</font></b><br/> printf <font color="#FF0000">"VALUE: %s\n"</font> <font color="#990000">(</font><b><font color="#000080">C</font></b><font color="#990000">.</font>value content<font color="#990000">))</font><br/> contents<br/><br/><b><font color="#0000FF">let</font></b> fail s <font color="#990000">=</font><br/> printf <font color="#FF0000">"%s\n"</font> s<font color="#990000">;</font><br/> shutdown <font color="#993399">1</font><br/><br/><b><font color="#0000FF">let</font></b> exec <font color="#990000">()</font> <font color="#990000">=</font><br/> <b><font color="#0000FF">let</font></b> host <font color="#990000">=</font> <b><font color="#000080">Sys</font></b><font color="#990000">.</font>argv<font color="#990000">.(</font><font color="#993399">1</font><font color="#990000">)</font> <b><font color="#0000FF">in</font></b><br/> <b><font color="#0000FF">let</font></b> port <font color="#990000">=</font> <b><font color="#000080">Int</font></b><font color="#990000">.</font>of_string <b><font color="#000080">Sys</font></b><font color="#990000">.</font>argv<font color="#990000">.(</font><font color="#993399">2</font><font color="#990000">)</font> <b><font color="#0000FF">in</font></b><br/> <i><font color="#9A1900">(*</font></i><br/><i><font color="#9A1900"> * [with_conn] is a little helper function that will</font></i><br/><i><font color="#9A1900"> * establish a connection, run a function on the connection</font></i><br/><i><font color="#9A1900"> * and tear it down when done</font></i><br/><i><font color="#9A1900"> *)</font></i><br/> <b><font color="#000080">Riakc</font></b><font color="#990000">.</font><b><font color="#000080">Conn</font></b><font color="#990000">.</font>with_conn<br/> <font color="#990000">~</font>host<br/> <font color="#990000">~</font>port<br/> <font color="#990000">(</font><b><font color="#0000FF">fun</font></b> c <font color="#990000">-&gt;</font><br/> <b><font color="#0000FF">let</font></b> <b><font color="#0000FF">module</font></b> <font color="#009900">R</font> <font color="#990000">=</font> <b><font color="#000080">Riakc</font></b><font color="#990000">.</font><font color="#009900">Robj</font> <b><font color="#0000FF">in</font></b><br/> <b><font color="#0000FF">let</font></b> content <font color="#990000">=</font> <b><font color="#000080">R</font></b><font color="#990000">.</font><b><font color="#000080">Content</font></b><font color="#990000">.</font>create <font color="#FF0000">"some random data"</font> <b><font color="#0000FF">in</font></b><br/> <b><font color="#0000FF">let</font></b> robj <font color="#990000">=</font> <b><font color="#000080">R</font></b><font color="#990000">.</font>create <font color="#990000">[]</font> <font color="#990000">|&gt;</font> <b><font color="#000080">R</font></b><font color="#990000">.</font>set_content content <b><font color="#0000FF">in</font></b><br/> <i><font color="#9A1900">(*</font></i><br/><i><font color="#9A1900"> * Put takes a bucket, a key, and an optional list of</font></i><br/><i><font color="#9A1900"> * options. In this case we are setting the</font></i><br/><i><font color="#9A1900"> * [Return_body] option which returns what the key</font></i><br/><i><font color="#9A1900"> * looks like after the put. It is possible that</font></i><br/><i><font color="#9A1900"> * siblings were created.</font></i><br/><i><font color="#9A1900"> *)</font></i><br/> <b><font color="#000080">Riakc</font></b><font color="#990000">.</font><b><font color="#000080">Conn</font></b><font color="#990000">.</font>put<br/> c<br/> <font color="#990000">~</font>b<font color="#990000">:</font><font color="#FF0000">"test_bucket"</font><br/> <font color="#990000">~</font>k<font color="#990000">:</font><font color="#FF0000">"test_key"</font><br/> <font color="#990000">~</font>opts<font color="#990000">:[</font><b><font color="#000080">Riakc</font></b><font color="#990000">.</font><b><font color="#000080">Opts</font></b><font color="#990000">.</font><b><font color="#000080">Put</font></b><font color="#990000">.</font><font color="#009900">Return_body</font><font color="#990000">]</font><br/> robj<font color="#990000">)</font><br/><br/><b><font color="#0000FF">let</font></b> eval <font color="#990000">()</font> <font color="#990000">=</font><br/> exec <font color="#990000">()</font> <font color="#990000">&gt;&gt;|</font> <b><font color="#0000FF">function</font></b><br/> <font color="#990000">|</font> <font color="#009900">Ok</font> <font color="#990000">(</font>robj<font color="#990000">,</font> key<font color="#990000">)</font> <font color="#990000">-&gt;</font> <b><font color="#0000FF">begin</font></b><br/> <i><font color="#9A1900">(*</font></i><br/><i><font color="#9A1900"> * [put] returns a [Riakc.Robj.t] and a [string</font></i><br/><i><font color="#9A1900"> * option], which is the key if Riak had to generate</font></i><br/><i><font color="#9A1900"> * it</font></i><br/><i><font color="#9A1900"> *)</font></i><br/> <b><font color="#0000FF">let</font></b> <b><font color="#0000FF">module</font></b> <font color="#009900">R</font> <font color="#990000">=</font> <b><font color="#000080">Riakc</font></b><font color="#990000">.</font><font color="#009900">Robj</font> <b><font color="#0000FF">in</font></b><br/> <i><font color="#9A1900">(*</font></i><br/><i><font color="#9A1900"> * Extract the vclock, if it exists, and convert it to</font></i><br/><i><font color="#9A1900"> * to something printable</font></i><br/><i><font color="#9A1900"> *)</font></i><br/> <b><font color="#0000FF">let</font></b> vclock <font color="#990000">=</font><br/> <b><font color="#000080">Option</font></b><font color="#990000">.</font>value<br/> <font color="#990000">~</font>default<font color="#990000">:</font><font color="#FF0000">"&lt;none&gt;"</font><br/> <font color="#990000">(</font><b><font color="#000080">Option</font></b><font color="#990000">.</font>map <font color="#990000">~</font>f<font color="#990000">:</font>hex_of_string <font color="#990000">(</font><b><font color="#000080">R</font></b><font color="#990000">.</font>vclock robj<font color="#990000">))</font><br/> <b><font color="#0000FF">in</font></b><br/> <b><font color="#0000FF">let</font></b> key <font color="#990000">=</font> <b><font color="#000080">Option</font></b><font color="#990000">.</font>value <font color="#990000">~</font>default<font color="#990000">:</font><font color="#FF0000">"&lt;none&gt;"</font> key <b><font color="#0000FF">in</font></b><br/> printf <font color="#FF0000">"KEY: %s\n"</font> key<font color="#990000">;</font><br/> printf <font color="#FF0000">"VCLOCK: %s\n"</font> vclock<font color="#990000">;</font><br/> print_contents <font color="#990000">(</font><b><font color="#000080">R</font></b><font color="#990000">.</font>contents robj<font color="#990000">);</font><br/> shutdown <font color="#993399">0</font><br/> <b><font color="#0000FF">end</font></b><br/> <i><font color="#9A1900">(*</font></i><br/><i><font color="#9A1900"> * These are the various errors that can be returned.</font></i><br/><i><font color="#9A1900"> * Many of then come directly from the ProtoBuf layer</font></i><br/><i><font color="#9A1900"> * since there aren't really any more semantics to apply</font></i><br/><i><font color="#9A1900"> * to the data if it matches the PB frame.</font></i><br/><i><font color="#9A1900"> *)</font></i><br/> <font color="#990000">|</font> <font color="#009900">Error</font> `<font color="#009900">Bad_conn</font> <font color="#990000">-&gt;</font> fail <font color="#FF0000">"Bad_conn"</font><br/> <font color="#990000">|</font> <font color="#009900">Error</font> `<font color="#009900">Bad_payload</font> <font color="#990000">-&gt;</font> fail <font color="#FF0000">"Bad_payload"</font><br/> <font color="#990000">|</font> <font color="#009900">Error</font> `<font color="#009900">Incomplete_payload</font> <font color="#990000">-&gt;</font> fail <font color="#FF0000">"Incomplete_payload"</font><br/> <font color="#990000">|</font> <font color="#009900">Error</font> `<font color="#009900">Notfound</font> <font color="#990000">-&gt;</font> fail <font color="#FF0000">"Notfound"</font><br/> <font color="#990000">|</font> <font color="#009900">Error</font> `<font color="#009900">Incomplete</font> <font color="#990000">-&gt;</font> fail <font color="#FF0000">"Incomplete"</font><br/> <font color="#990000">|</font> <font color="#009900">Error</font> `<font color="#009900">Overflow</font> <font color="#990000">-&gt;</font> fail <font color="#FF0000">"Overflow"</font><br/> <font color="#990000">|</font> <font color="#009900">Error</font> `<font color="#009900">Unknown_type</font> <font color="#990000">-&gt;</font> fail <font color="#FF0000">"Unknown_type"</font><br/> <font color="#990000">|</font> <font color="#009900">Error</font> `<font color="#009900">Wrong_type</font> <font color="#990000">-&gt;</font> fail <font color="#FF0000">"Wrong_type"</font><br/><br/><b><font color="#0000FF">let</font></b> <font color="#990000">()</font> <font color="#990000">=</font><br/> ignore <font color="#990000">(</font>eval <font color="#990000">());</font><br/> never_returns <font color="#990000">(</font><b><font color="#000080">Scheduler</font></b><font color="#990000">.</font>go <font color="#990000">())</font><br/> <p>Now compile it: </p> <pre><code>ocamlfind ocamlopt -thread -I +camlp4 -package riakc -c demo.ml<br/>ocamlfind ocamlopt -package riakc -thread -linkpkg \<br/>-o demo.native demo.cmx<br/></code></pre> <p>Finally, you can run it: <code>./demo.native <i>hostname</i> <i>port</i></code></p> <h1>...And More Detail</h1><p>The API for Riakc is broken up into two modules: <code>Riakc.Robj</code> and <code>Riakc.Conn</code> with <code>Riakc.Opts</code> being a third helper module. Below is in reference to version 2.0.0 of Riakc. </p> <h2>Riakc.Robj</h2><p><code>Riakc.Robj</code> defines a representation of an object stored in Riak. <code>Robj</code> is completely pure code. The API can be found <a href="https://github.com/orbitz/ocaml-riakc/blob/2.0.0/lib/riakc/robj.mli">here</a>. </p> <h2>Riakc.Conn</h2><p>This is the I/O layer. All interaction with the actual database happens through this module. <code>Riakc.Conn</code> is somewhat clever in that it has a compile-time requirement that you have called <code>Riakc.Robj.set_content</code> on any value you want to PUT. This guarantees you have resolved all siblings, somehow. Its API can be found <a href="https://github.com/orbitz/ocaml-riakc/blob/2.0.0/lib/riakc/conn.mli">here</a>. </p> <h2>Riakc.Opts</h2><p>Finally, various options are defined in <code>Riakc.Opts</code>. These are options that GET and PUT take. Not all of them are actually supported but support is planned. The API can be viewed <a href="https://github.com/orbitz/ocaml-riakc/blob/2.0.0/lib/riakc/opts.mli">here</a>. </p> <p>Hopefully Riakc has a fairly straight forward API. While the example code might be longer than other clients, it is complete and correct (I hope). </p><a onclick="switchContent('post2','post1')" class="btn" href="#7f392fbf92d0462ee6d04e5fcbc746d2">Hide</a></div></span>
<a name="dfd2b2b434f7a9b2152225e98e6ef5ec"></a><span class="rss-header"><span class="rss-title"><a href="http://camlspotter.blogspot.com/2013/07/ocamlscope-is-now-ocaml-heroku-app.html"> OCaml◎Scope is now an OCaml heroku app!</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author"><span id="ocaml_2">Caml Spotting &#9001;noreply<abbr title="(at) &rarr; @">(at)</abbr>blogger.com (Jun Furuse)&#9002;</span><script type="text/javascript"><!--;
local = "noreply";
h = "blogger.com (Jun Furuse)";
hq = "blogger.com%20(Jun%20Furuse)";
document.getElementById("ocaml_2").innerHTML = '<a href="mailto:' + local + '@' + hq + "\" >Caml Spotting<\/a>";
//--></script></span>, <span class="rss-date">03 Jul 2013</span></span><span class="rss-description">OCaml◎Scope, a new OCaml API search, is now a service running at <a href="http://ocamloscope.herokuapp.com/">http://ocamloscope.herokuapp.com</a>!<br/><br/><div style="clear: both; text-align: center;" class="separator"><a style="margin-left: 1em; margin-right: 1em; text-align: center;" href="http://ocamloscope.herokuapp.com/images/logo.svg"><img src="http://ocamloscope.herokuapp.com/images/logo.svg" height="131" border="0" width="320"/></a></div><br/>Change list:<br/><br/><ul><li>Now it no longer uses <a href="http://sourceforge.net/projects/ocaml-cgi/">CamlGI</a> but <a href="http://ocsigen.org/eliom/">Eliom</a> as the web engine. Eliom is much safer and easier to write!</li><li>DB carries 245302 entries from 76 OCamlFind packages.</li><li>Search algorithm tweak to get better results in shorter time</li><li>More query forms (see Examples)<div style="clear: both; text-align: center;" class="separator"><br/></div></li></ul></span>
<a name="33d2c5c3726b781f82f8fbf0cf68010d"></a><span class="rss-header"><span class="rss-title"><a href="http://alan.petitepomme.net/cwn/2013.07.02.html"> Caml Weekly News, 02 Jul 2013</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Caml Weekly News</span>, <span class="rss-date">02 Jul 2013</span></span><span class="rss-description">Spoc: GPGPU programming with OCaml / Ocaml on windows / meetup Paris-OCaml (OUPS) mardi 2 juillet / Mixing two GADTs / Request for feedback: A problem with injectivity and GADTs / Other Caml News</span>
<a name="10b672bb9a21c69969e0ff40f608bd74"></a><span class="rss-header"><span class="rss-title"><a href="http://gallium.inria.fr/blog/portable-conditionals-in-makefiles"> Portable conditionals in makefiles</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">GaGallium</span>, <span class="rss-date">02 Jul 2013</span></span><span class="rss-description"><div id="post3"><p>If you are <a href="http://caml.inria.fr/mantis/view.php?id=5737#c9658">writing software</a> that works on many variants of Unix, you are confronted to the problem of Makefiles: some systems use GNU make and others use BSD make and these two are compatible, but only on a very restricted subset. The most problematic restriction is that they don't have a common syntax for writing conditionals.</p> <p>So how do you write conditionals that work on both variants? GNU make and BSD make share so few of their "new" features (features that were not in UNIX make) that it looks like an impossible task.</p> <p>Let's say you have a variable <code>FOO</code> that contains either <code>true</code> or <code>false</code>, and you want your target <code>A</code> to depend on <code>B C D</code> in the first case, and on <code>E F G</code> in the second. I know two ways of doing that.</p> <h3 id="first-solution-substitution">First solution: substitution</h3> <p>The first solution is simple but not fully general. It uses substitution in variable references:</p> <pre><code>DEPS1 = ${FOO:true=B C D} DEPS2 = ${DEPS1:false=E F G} A : ${DEPS2} echo ${DEPS2}</code></pre> <p>This is quite ugly, it doesn't work if <code>false</code> appears in the value of the <code>true</code> case (here, <code>B C D</code>). Also, I don't think there is any way to extend it to handle a default case. But it's simple and relatively easy to understand.</p> <h3 id="second-solution-indirection">Second solution: indirection</h3> <a onclick="switchContent('post3','post4')" class="btn" href="#10b672bb9a21c69969e0ff40f608bd74">Read more...</a></div><div id="post4" style="display: none"><p>If you are <a href="http://caml.inria.fr/mantis/view.php?id=5737#c9658">writing software</a> that works on many variants of Unix, you are confronted to the problem of Makefiles: some systems use GNU make and others use BSD make and these two are compatible, but only on a very restricted subset. The most problematic restriction is that they don't have a common syntax for writing conditionals.</p> <p>So how do you write conditionals that work on both variants? GNU make and BSD make share so few of their "new" features (features that were not in UNIX make) that it looks like an impossible task.</p> <p>Let's say you have a variable <code>FOO</code> that contains either <code>true</code> or <code>false</code>, and you want your target <code>A</code> to depend on <code>B C D</code> in the first case, and on <code>E F G</code> in the second. I know two ways of doing that.</p> <h3 id="first-solution-substitution">First solution: substitution</h3> <p>The first solution is simple but not fully general. It uses substitution in variable references:</p> <pre><code>DEPS1 = ${FOO:true=B C D} DEPS2 = ${DEPS1:false=E F G} A : ${DEPS2} echo ${DEPS2}</code></pre> <p>This is quite ugly, it doesn't work if <code>false</code> appears in the value of the <code>true</code> case (here, <code>B C D</code>). Also, I don't think there is any way to extend it to handle a default case. But it's simple and relatively easy to understand.</p> <h3 id="second-solution-indirection">Second solution: indirection</h3> <p>The second solution works by applying David Wheeler's aphorism:</p> <blockquote> <p>All problems in computer science can be solved by another level of indirection.</p> </blockquote> <p>We'll use indirect variable references. This is a feature that, surprisingly, works the same in both flavours of make:</p> <pre><code>FOO = BAR BAR = toto all: echo ${${FOO}}</code></pre> <p>This will echo <code>toto</code>.</p> <p>Now, we have <code>FOO</code> that is either <code>true</code> or <code>false</code>, so we'll do this:</p> <pre><code>true = B C D false = E F G DEPS := ${${FOO}} A : ${DEPS} echo ${DEPS}</code></pre> <p>Note how the definition of <code>DEPS</code> uses <code>:=</code> rather than <code>=</code>. This is because we want to be able to reuse the variables <code>true</code> and <code>false</code> for another conditional. If we don't use <code>:=</code>, the assignment is lazy and <code>DEPS</code> gets a value based on the last values assigned to <code>true</code> and <code>false</code> (which may be further down in the makefile).</p> <h3 id="advanced-solution-more-indirection">Advanced solution: more indirection</h3> <p>The above obviously generalizes to more than two cases, but what about having a default case? Suppose that we want to do as above, but make <code>A</code> depend on <code>H I J</code> when <code>FOO</code> is set to anything else that <code>true</code> or <code>false</code> (or unset, which is the same as set to <code>""</code>). How do we do that?</p> <p>It's easy, just apply Wheeler's aphorism one more time:</p> <pre><code>unlikely_true = aaaa unlikely_false = bbbb xxx_aaaa = B C D xxx_bbbb = E F G xxx_ = H I J DEPS := ${xxx_${unlikely_${FOO}}} A : ${DEPS} echo ${DEPS}</code></pre> <p>This is getting ugly but it works. As long as you don't have any clash with some random variable whose name starts with <code>unlikely_</code>. And if you have several conditionals in your makefile, you probably should reset all these variables after using them:</p> <pre><code>unlikely_true = aaaa unlikely_false = bbbb xxx_aaaa = B C D xxx_bbbb = E F G xxx_ = H I J DEPS := ${xxx_${unlikely_${FOO}}} unlikely_true = unlikely_false = xxx_aaaa = xxx_bbbb = xxx_ = A : ${DEPS} echo ${DEPS}</code></pre> <p>This makefile has a nice property: you can use environment variables not only to override some cases, but also to add some cases without touching the makefile. For example:</p> <pre><code>make A unlikely_filenotfound=cccc xxx_cccc='X Y Z' FOO=filenotfound</code></pre> <p>This will use <code>X Y Z</code> for the dependencies of A.</p> <h3 id="obvious-solution-use-gmake">Obvious solution: use gmake</h3> <p>Of course, the obvious solution is to use GNUmake on BSD as well as Linux and MacOS, and write your makefiles for GNUmake only. That looks more reasonable than the above. Unless you have to deal with some BSD fanatics who don't want to install GNU make on their machine.</p> <p>Anyway, I started with the explicit (but maybe unreasonable) constraint of making portable makefiles. Over the years I've heard a number of very smart people claim that it was impossible, and I set out to prove them wrong. Mission accomplished.</p><a onclick="switchContent('post4','post3')" class="btn" href="#10b672bb9a21c69969e0ff40f608bd74">Hide</a></div></span>
<a name="8d87c6d6f6db85dd0a0e4b9c4c650383"></a><span class="rss-header"><span class="rss-title"><a href="http://www.ocamlpro.com/blog/2013/07/01/monthly-06.html"> News from May and June</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author"><span id="ocaml_3">OCamlPro &#9001;thomas<abbr title="(at) &rarr; @">(at)</abbr>ocamlpro.com (Thomas Gazagnaire)&#9002;</span><script type="text/javascript"><!--;
local = "thomas";
h = "ocamlpro.com (Thomas Gazagnaire)";
hq = "ocamlpro.com%20(Thomas%20Gazagnaire)";
document.getElementById("ocaml_3").innerHTML = '<a href="mailto:' + local + '@' + hq + "\" >OCamlPro<\/a>";
//--></script></span>, <span class="rss-date">01 Jul 2013</span></span><span class="rss-description"><div id="post5"><p>It is time to give a brief summary of our recent activities. As usual, our contributions were focused on three main objectives: (i) make the OCaml compiler faster and easier to use; (ii) make the OCaml developers more efficient by releasing new development tools and improving editor supports; and (iii) organize and participate to community events around the language. We are also welcoming four interns who will work with us on these objectives during the summer.</p><h2>Compiler updates</h2><p>Following the ideas he announced in his recent <a href="http://www.ocamlpro.com/blog/2013/05/24/optimisations-you-shouldn-t-do.html">blog post</a>, <a href="https://github.com/chambart">Pierre Chambart</a> has made some progress on his <a href="https://github.com/chambart/ocaml/tree/flambda_experiments">inlining branch</a>. He is currently working on stabilizing and cleaning-up the code for optimization which does not take into account inter-module information.</p><a onclick="switchContent('post5','post6')" class="btn" href="#8d87c6d6f6db85dd0a0e4b9c4c650383">Read more...</a></div><div id="post6" style="display: none"><p>It is time to give a brief summary of our recent activities. As usual, our contributions were focused on three main objectives: (i) make the OCaml compiler faster and easier to use; (ii) make the OCaml developers more efficient by releasing new development tools and improving editor supports; and (iii) organize and participate to community events around the language. We are also welcoming four interns who will work with us on these objectives during the summer.</p><h2>Compiler updates</h2><p>Following the ideas he announced in his recent <a href="http://www.ocamlpro.com/blog/2013/05/24/optimisations-you-shouldn-t-do.html">blog post</a>, <a href="https://github.com/chambart">Pierre Chambart</a> has made some progress on his <a href="https://github.com/chambart/ocaml/tree/flambda_experiments">inlining branch</a>. He is currently working on stabilizing and cleaning-up the code for optimization which does not take into account inter-module information.</p><p>We also continue to work on our profiling tool and start to separate the different parts of the project. We have <a href="https://github.com/cago/ocaml">patched</a> the compiler and runtime, for both bytecode and native code, to generate (i) <code>.prof</code> files which contain the id-loc information and allow us to recover the location from the identifiers in the header of the block; and (ii) to dump a program heap in a file on demand or to monitor a running program without memory and performance overhead. <a href="http://cagdas.bozman.fr/">Çagdas Bozman</a> has presented the work he has done so far regarding his PhD to members of the <a href="http://bware.lri.fr/index.php/Presentation">Bware</a> project and we started to test our prototype on industrial use-cases using the <a href="http://why3.lri.fr/">why3</a> platform.</p><p>On the multi-core front, <a href="http://ageinghacker.net/">Luca Saiu</a> is continuing his post-doc with <a href="http://fabrice.lefessant.net/">Fabrice le Fessant</a> and is modifying the OCaml runtime to support parallel programming on multi-core computers. Their version of the "multi-runtime" OCaml provides a message-passing abstraction in which a running OCaml program is "split" into independent OCaml programs, one per thread (if possible running on its separate core) with a separate instance of the runtime library in order to reduce resource contention both at the software and at the hardware level. Luca is now debugging the support for OCaml multi-threading running on top of a multi-context parallel program. A recent presentation covering this work and its challenges is available <a href="http://www.ocamlpro.com/pub/multi-runtime.pdf.tar.gz">online</a>.</p><p>A new intern from <a href="http://www.ens-cachan.fr/">ENS Cachan</a>, <a href="https://github.com/thomasblanc">Thomas Blanc</a> is working on a whole program analysis system. His internship's final goal is to provide a good hint of exceptions that may be left uncaught by the program, resulting a failure. It is quite interesting as exceptions are pretty much the part of the program "hard to foresee". The main difficulty comes from higher-order functions (like <code>List.iter</code>). Because of them, a simple local analysis becomes impossible. So the first task is to take the whole program in the form of separated <code>.cmt</code> files, <a href="https://github.com/thomasblanc/ocaml-typedtree-mapper">merge</a> it, and remove every higher-order functions (either by direct inlining if possible or by a very big pattern matching). The merging as already been done through a deep browsing of the compiler's typedtrees. Thomas is now focusing in reordering the code so that higher-order functions can be safely removed.</p><p>Finally, we are helping to prepare the release 4.01.0 of the OCaml compiler: Fabrice has integrated his <a href="http://www.ocamlpro.com/blog/2012/08/08/profile-native-code.html">frame-pointer</a> patch, that can be used to profile the performance of OCaml applications using Linux <code>perf</code> tool; he has added in <code>Pervasives</code> <a href="https://github.com/ocaml/ocaml/commit/ace0205b6499ffdae4588cfdd640c45855217a8f">two application operators</a> that had been optimized before, but were only available for people who knew about that; he has also added a new environment variable, <code>OCAMLCOMPPARAM</code>, that can be used to change how a program is compiled by <code>ocamlc</code>/<code>ocamlopt</code>, without changing the build system (for example, <code>OCAMLCOMPPARAM='g=1' make</code> can be used to compile a project in debug mode without modifying the makefiles).</p><h2>Development Tools</h2><p>Since the initial release of <a href="http://opam.ocamlpro.com">OPAM</a> in March, we have been kept busy preparing the upcoming <code>1.1.0</code> version, which should interface nicely with the forthcoming set of automatic tools which will constitute the first version of the <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html">OCaml Platform</a> that we are helping <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/">OCamlLabs</a> to deliver. We have constantly been focused on fixing bugs and implementing feature requests (more than <a href="https://github.com/OCamlPro/opam/issues?direction=desc&amp;milestone=17&amp;page=1&amp;sort=created&amp;state=closed">70 issues</a> have been closed on Github) and we have recently improved the speed and reliability of <code>opam update</code>. More good news related to OPAM: The number of packages submitted to <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/tasks/platform.html">official</a> repository is steadily increasing with around 20 new packages integrated every-months (and much more already existing package upgrades), and the official Debian package should land in <a href="http://ftp-master.debian.org/new/opam_1.0.0-1.html">testing</a> very soon.</p><p>This month, <a href="http://louis.gesbert.fr/cv.en.html">Louis</a> was still busy improving different tools for ocaml code edition. <code>ocp-index</code> and <code>ocp-indent</code>, made for the community to improve the general ocaml experience and kindly funded by <a href="http://janestreet.com">Jane Street</a>, have seen some updates:</p><ul> <li> <p><a href="https://github.com/OCamlPro/ocp-index">ocp-index</a>: the library data access tool which was first presented in <a href="http://www.ocamlpro.com/blog/2013/04/22/monthly-04.html">April</a> has seen some progress, with the ability to locate definitions and resolve type names. It is still not yet considered stable though, expect more from it soon. An early release (0.2.0) is in OPAM.</p> </li><li> <p><a href="https://github.com/OCamlPro/ocp-indent">ocp-indent</a> the generic ocaml source code indenter, has seen its usual bunch of fixes, along with some new customisation options. Also, its <a href="https://github.com/OCamlPro/ocp-indent/blob/master/src/indentPrinter.mli">library interface</a> has been rewritten, offering much better flexibility and opening the gate to uses like restarting from checkpoints to avoid full reparsing, detecting top-expression boundaries, syntax coloration, etc. We will be releasing 1.3.0 in OPAM very soon.</p> </li> </ul><p>We are also developing in-house projects aiming at providing a better first experience of OCaml to beginners and students:</p><ul> <li> <p>the new <a href="https://github.com/OCamlPro/ocaml-top">ocaml-top</a> (previous project name <code>ocp-edit-simple</code>) aims to offer a simple, but clean and easy-to-use interface to interact with the ocaml top-level. It is intended mainly for exercises, tutorials and practicals. A release should be coming soon, the Linux version being quite stable while some bugs remain on Windows.</p> </li><li> <p>two new interns, <a href="http://www.linkedin.com/profile/view?id=3D238971426&amp;locale=3Dfr_FR&amp;tr=k3Dtyah">David</a> and <a href="http://www.linkedin.com/profile/view?id=3D65173689">Pierrick</a>, have started working on a <a href="https://github.com/pcouderc/ocp-webedit">web-IDE</a> for OCaml. As students, they have seen sometimes how difficult it could be to install OCaml on some OSes, or simply configure editors like emacs or vim. To solve these issues, the idea is to use only a web browser-based editor and provide a way to compile a project without having to install anything on your computer. For the editing part, the idea is to use <a href="http://ace.ajax.org/">Ace</a> and improve it for OCaml, using <a href="https://github.com/OCamlPro/ocp-indent">ocp-indent</a> for example, which is possible by using <a href="http://ocsigen.org/js_of_ocaml/">js_of_ocaml</a>. The next step will be to glue this editor with both <a href="http://try.ocamlpro.com/">TryOCaml</a> to execute code, and a cloud computing part, to store projects and files and access them from anywhere.</p> </li> </ul><p>We are also trying to improve cross-compilation tutorials and tools for developing native iOS application under a Linux system, using the OCaml language. <a href="http://fr.linkedin.com/pub/souhire-kenawi/6a/614/54b/">Souhire</a>, our fourth new intern, is experimenting with that idea and will document how to set up such an environment, from the foundation until the publication on the application store (if it is possible). She is starting to look at how iOS applications (with a native graphical interface) written in C can be cross-compiled on <a href="http://code.google.com/p/ios-toolchain-based-on-clang-for-linux/wiki/HowTo_en">Linux</a>, and how the ones written in OCaml can be cross-compiled on <a href="http://psellos.com/ocaml/">MacOSX</a>.</p><p>On the library front, Fabrice has completely rewritten the way his <a href="http://www.typerex.org/ocplib-wxOCaml.html">wxOCaml library</a> is generated, compared to what was described in a previous <a href="http://www.ocamlpro.com/blog/2013/04/02/wxocaml-reloaded.html">blog post</a>. It does not share any code anymore with other wxWidgets bindings (wxHaskell or wxEiffel), but directly generates the stubs from a DSL (close to C++) describing the wxWidgets classes. It should make binding more widgets (classes) and more methods for each widget much easier, and also help for maintenance, evolution and compatibility with wxWidgets version. There are now an interesting set of samples in the library, covering many interesting usages.</p><h2>Community</h2><p>We have also been pretty active during the last months to promote the use of OCaml in the free-software and research community: we are actively participating to the upcoming <a href="http://ocaml.org/meetings/ocaml/2013/">OCaml 2013</a> and <a href="http://cufp.org/2013cfp">Commercial User of Functional Programming</a> conference which will be help next September in Boston.</p><p>While I was visiting <a href="http://janestreet.com/">Jane Street</a> with <a href="http://www.cl.cam.ac.uk/projects/ocamllabs/index.html">OCamlLabs's team</a>, I had the pleasure to be invited to give a talk at the <a href="http://www.meetup.com/NYC-OCaml/">NYC OCaml meetup</a> on OPAM (my slides can be found online <a href="http://www.ocamlpro.com/pub/ny-meetup.pdf">here</a>). It was a nice meetup, with more than 20 people, hosted in the great Jane-Street New-York offices.</p><p>OCamlPro is still organizing OCaml meetups in Paris, hosted by <a href="http://www.irill.org/">IRILL</a> and sponsored by <a href="http://www.lexifi.com/">LexiFi</a> : our last Ocaml Users in PariS (OUPS) meetup was in <a href="http://www.meetup.com/ocaml-paris/events/116100692/">May</a>, there were more than 50 persons ! It was a nice collection of talks, where Esther Baruk spoke about the usage of OCaml at Lexifi, Benoit Vaugon about all the secrets that we always wanted to know about the OCaml bytecode, Frédéric Bour presents us Merlin, the new IDe for VIM, and Gabriel Scherer told us how to better interact with the OCaml core team.</p><p>We are now preparing our next <a href="http://www.meetup.com/ocaml-paris/events/121412532/">OUPS</a> meeting which will take place at IRILL on Tuesday, July 2nd. Emphasis will be on programming in OCaml in different context. Thus, there will be some js_of_ocaml experiences, GPGPU in OCaml and GADTs in practice. There is still many seats available, so do not hesitate to register to the meetup, but if you cannot, this time, videos of the talks (in French) will be available afterwards.</p><p>Not really related to OCaml, we also attend the <a href="http://www.teratec.eu/gb/forum/index.html">Teratec 2013 Forum</a> which brings together a lot of <a href="http://www.scilab.org/">Scilab</a> users. This is part of the <a href="http://www.richelieu.pro">Richelieu</a> research project that <a href="http://www.linkedin.com/profile/view?id=130990583">Michael</a> is working on: his goal is to analyze Scilab code, before just-in-time compilation. It requires a basic type-inference algorithm, but for a language that has not been designed for that ! He is currently struggling with the dynamic aspects of Scilab language. After some work on preprocessing <code>eval</code> and <code>evalstr</code> functions, he is now focusing on how Scilab programers usually write functions. He is currently using different kinds of analyses on real-world Scilab programs to understand how they are structured.</p><p>Finally, we are happy to announce that we finally found the time to release the <a href="https://github.com/OCamlPro/ocaml-cheat-sheets">sources</a> of our OCaml <a href="http://www.typerex.org/cheatsheets.html">cheat-sheets</a>. Feel free to contribute by sending patches if you are interested to improve them!</p><a onclick="switchContent('post6','post5')" class="btn" href="#8d87c6d6f6db85dd0a0e4b9c4c650383">Hide</a></div></span>
<a name="30c4128ba4fe090b5149f177721c4f90"></a><span class="rss-header"><span class="rss-title"><a href="http://coq.inria.fr/coq-received-acm-sigplan-programming-languages-software-2013-award"> Coq received ACM SIGPLAN Programming Languages Software 2013 award</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Coq</span>, <span class="rss-date">30 Jun 2013</span></span><span class="rss-description"><p>The development of Coq has been initiated in 1984 at INRIA by Thierry Coquand and Gérard Huet, then joined by Christine Paulin-Mohring and more than 40 direct <a href="http://coq.inria.fr/who-did-what-in-coq">contributors</a>.</p> <p>The first public release was CoC 4.10 in 1989. Extended with native inductive types, it was renamed Coq in 1991.</p> <p>Since then, a growing community of users has shared its enthousiasm in the originality of the concepts of Coq and of its various features, as a richly-typed programming language and as an interactive theorem prover.</p> <p><a href="http://coq.inria.fr/coq-received-acm-sigplan-programming-languages-software-2013-award">read more</a></p></span>
<a name="98b8022c20f13c501cd47f90d07115a0"></a><span class="rss-header"><span class="rss-title"><a href="http://jobs.github.com/positions/78c69f44-e031-11e2-97c6-4063613e594f"> Full Time: Senior Functional Programmer at Bloomberg L.P. in Lexington, NY</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Github OCaml jobs</span>, <span class="rss-date">28 Jun 2013</span></span><span class="rss-description"><div id="post7"><p><strong>The Role:</strong></p> <p>Bloomberg is starting an exciting journey to become industry leader in derivative applications by providing the next generation of cross-asset structuring &amp; pricing platform. This includes complete and flexible financial contract representation, integration with advanced pricing models and end to end large scale enterprise solution. </p> <p>Using innovative functional programming techniques, the candidate will participate in the development of algebra representation for financial instruments, dynamic CUDA and C code generation as well as automatic GUI workflow. The candidate will also have the opportunity to lead the introduction of functional programming at Bloomberg while solving some of the most complex financial problems.</p> <p><strong>Qualifications:</strong></p> <ul> <li>Deep understanding and 3+ years recent hands on experience in OCaml or Haskell</li> <li>Good understanding of compiler theory and compiler construction for functional language</li> <li>Solid C/C++ skills</li> <li>Experience in derivative structuring and pricing preferred</li> <li>Good problem solving skills</li> <li>Ability to work well independently and collaboratively</li> </ul> <p><strong>The Company:</strong></p> <a onclick="switchContent('post7','post8')" class="btn" href="#98b8022c20f13c501cd47f90d07115a0">Read more...</a></div><div id="post8" style="display: none"><p><strong>The Role:</strong></p> <p>Bloomberg is starting an exciting journey to become industry leader in derivative applications by providing the next generation of cross-asset structuring &amp; pricing platform. This includes complete and flexible financial contract representation, integration with advanced pricing models and end to end large scale enterprise solution. </p> <p>Using innovative functional programming techniques, the candidate will participate in the development of algebra representation for financial instruments, dynamic CUDA and C code generation as well as automatic GUI workflow. The candidate will also have the opportunity to lead the introduction of functional programming at Bloomberg while solving some of the most complex financial problems.</p> <p><strong>Qualifications:</strong></p> <ul> <li>Deep understanding and 3+ years recent hands on experience in OCaml or Haskell</li> <li>Good understanding of compiler theory and compiler construction for functional language</li> <li>Solid C/C++ skills</li> <li>Experience in derivative structuring and pricing preferred</li> <li>Good problem solving skills</li> <li>Ability to work well independently and collaboratively</li> </ul> <p><strong>The Company:</strong></p> <p>Bloomberg, the global business and financial information and news leader, gives influential decision makers a critical edge by connecting them to a dynamic network of information, people and ideas. The company’s strength – delivering data, news and analytics through innovative technology, quickly and accurately – is at the core of the Bloomberg Professional service, which provides real time financial information to more than 310,000 subscribers globally. Bloomberg’s enterprise solutions build on the company’s core strength, leveraging technology to allow customers to access, integrate, distribute and manage data and information across organizations more efficiently and effectively. Through Bloomberg Law, Bloomberg Government, Bloomberg New Energy Finance and Bloomberg BNA, the company provides data, news and analytics to decision makers in industries beyond finance. And Bloomberg News, delivered through the Bloomberg Professional service, television, radio, mobile, the Internet and two magazines, Bloomberg Businessweek and Bloomberg Markets, covers the world with more than 2,300 news and multimedia professionals at 146 bureaus in 72 countries. Headquartered in New York, Bloomberg employs more than 15,000 people in 192 locations around the world.</p> <p>Bloomberg is an equal opportunities employer and we welcome applications from all backgrounds regardless of race, colour, religion, sex, ancestry, age, marital status, sexual orientation, gender identity, disability or any other classification protected by law.</p><a onclick="switchContent('post8','post7')" class="btn" href="#98b8022c20f13c501cd47f90d07115a0">Hide</a></div></span>
<a name="15aa8b6782b0ab6fe5b10e3acb7c6035"></a><span class="rss-header"><span class="rss-title"><a href="http://gallium.inria.fr/blog/typestate-in-mezzo-mutable-list-iterators"> Typestate in Mezzo? Starting with list iterators.</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">GaGallium</span>, <span class="rss-date">26 Jun 2013</span></span><span class="rss-description"><div id="post9"><p>I (Armaël Guéneau) am currently doing an internship with François Pottier, working on <a href="http://gallium.inria.fr/~protzenk/mezzo-lang/">Mezzo</a>, which has been introduced by Jonathan in two previous blog posts (<a href="http://gallium.inria.fr/blog/introduction-to-mezzo/">the first</a>, <a href="http://gallium.inria.fr/blog/introduction-to-mezzo-2/">the second</a>).</p> <p>Since the beginning of my internship, I have been playing with Mezzo, writing some code, and, more specifically, trying to see how the notion of <em>typestate</em> could be expressed with Mezzo's permissions. As an application, I tried to write in Mezzo an iterator on lists. What I call an iterator is here more like Scala's <em>Iterator</em> , or a bit like what Gabriel called generators in a <a href="http://gallium.inria.fr/blog/generators-iterators-control-and-continuations/">previous blog post</a>.</p> <p>This example turned out to be subtle enough to write in Mezzo: in this post, I'll try to show you the details of the implementation, leading to a fully working implementation of list iterators. I think it's a good opportunity to see an implementation of a (very simple) typestate, and also some funny tricks with Mezzo's permissions.</p> <a onclick="switchContent('post9','post10')" class="btn" href="#15aa8b6782b0ab6fe5b10e3acb7c6035">Read more...</a></div><div id="post10" style="display: none"><p>I (Armaël Guéneau) am currently doing an internship with François Pottier, working on <a href="http://gallium.inria.fr/~protzenk/mezzo-lang/">Mezzo</a>, which has been introduced by Jonathan in two previous blog posts (<a href="http://gallium.inria.fr/blog/introduction-to-mezzo/">the first</a>, <a href="http://gallium.inria.fr/blog/introduction-to-mezzo-2/">the second</a>).</p> <p>Since the beginning of my internship, I have been playing with Mezzo, writing some code, and, more specifically, trying to see how the notion of <em>typestate</em> could be expressed with Mezzo's permissions. As an application, I tried to write in Mezzo an iterator on lists. What I call an iterator is here more like Scala's <em>Iterator</em> , or a bit like what Gabriel called generators in a <a href="http://gallium.inria.fr/blog/generators-iterators-control-and-continuations/">previous blog post</a>.</p> <p>This example turned out to be subtle enough to write in Mezzo: in this post, I'll try to show you the details of the implementation, leading to a fully working implementation of list iterators. I think it's a good opportunity to see an implementation of a (very simple) typestate, and also some funny tricks with Mezzo's permissions.</p> <p>A word of warning, though: while the theory and implementation of Mezzo are starting to fit in nicely, the library-land is very much unknown territory so far. We are trying new things, and expect them to be easier in the future. As always, practice and teaching will surely yield substantial improvements, leading us to see in retrospect how we could have simplified things. Expect the code examples in this post to look <em>complicated</em>, and probably not representative of the Mezzo code we expect to write in the future.</p> <h3 id="briefing">Briefing</h3> <p>What I want as an iterator is an object that let us iterate on a collection, giving one new element each time we call a function <code>next</code>, that makes the iterator go a step forward. Note that such an iterator is mutable, its internal state being modified by <code>next</code>. It would be possible to consider functional iterators, returning a value corresponding to the next position in the list; but to study the relation with typestate systems we decide to study <em>mutable</em> iterators here.</p> <p>We have to handle the case where the iterator has no more elements. In Java or Scala, you have to check if there are more elements available with <code>hasNext</code>, and if you call <code>next</code> on an empty iterator, an exception is raised. In Mezzo we don't have exceptions. Moreover, we want to statically express the protocol that the operations on an iterator must follow, in the types themselves. It's the idea of typestate. By achieving that, the user is prevented <em>at compilation time</em> of using <code>next</code> on an empty iterator.</p> <p>The application to (simply linked) lists seems straightforward: you just have to follow the <code>tail</code> link of each <code>Cons</code> cell, starting with the head of the list. What is not so trivial is how to express that with Mezzo's permissions.</p> <h3 id="the-silent-iterator">The silent iterator</h3> <p>Let's start with a very stupid iterator: it traverses the list, but without giving its elements to the user.</p> <h4 id="from-the-outside-signatures">From the outside: signatures</h4> <h5 id="an-iterator-has-exclusive-access-on-the-list">An iterator has exclusive access on the list</h5> <p>First, to be able to iterate on a list, the iterator will need the permission to access the list and its contents. A solution is to <strong>consume</strong> the permission <code>l @ list a</code> when you create an iterator on the list <code>l</code> (of elements of type <code>a</code>), and <strong>give it back</strong> when the iteration is finished (or when you stop the iterator manually).</p> <p>This gives us the following signatures for the <code>new</code> and <code>stop</code> functions:</p> <pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="kw">val</span> <span class="kw">new</span>: [a] (consumes l: <span class="dt">list</span> a) -&gt; iterator a (l @ <span class="dt">list</span> a) <span class="kw">val</span> stop: [a, post: perm] (consumes iterator a post) -&gt; (| post)</code></pre> <p>In case you're not familiar with Mezzo syntax yet, you can find more details in <a href="http://gallium.inria.fr/blog/introduction-to-mezzo/">the first post</a> cited above, but let me just do a quick reminder here. The bracket notation <code>[post:perm]</code> is parametric polymorphism on a type of kind <code>perm</code> (a permission), and that <code>(consumes foo)</code> indicates that type <code>foo</code> is not given back to the type environment after the functional call. Finally, <code>(foo | bar)</code> is a conjunction of the type <code>foo</code> and the permission <code>bar</code>, which may be a purely static information, not associated to any runtime value; in particular, <code>(| post)</code> is an empty tuple that is only useful as the carrier of the permission <code>post</code>.</p> <h5 id="expressing-iterator-typestate">Expressing iterator typestate</h5> <p>We also need a <code>next</code> function, that takes an iterator in input. To handle the fact that <code>next</code> may lead to an empty iterator, we say that <code>next</code> consumes the fact that the input argument is an iterator, and returns a variant of <code>option a</code>:</p> <pre class="sourceCode ocaml"><code class="sourceCode ocaml">data offer (post: perm) a = | <span class="dt">None</span> {| post } | <span class="dt">Some</span> { x: a }</code></pre> <p>In the first case, the iteration is finished: the <code>post</code> permission (in practice equal to <code>l @ list a</code> for a given <code>a</code> and <code>l</code>) is returned. In the second case, an element is returned. Note that we could have used the sum type of the standard library, <code>choice a b</code>, but this specific datatype allows us to give more explicit constructor names (than <code>Left</code> and <code>Right</code>).</p> <p>We now have the <code>next</code> signature:</p> <pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="kw">val</span> next: [a, post: perm] (consumes it: iterator a post) -&gt; offer post (| it @ iterator a post)</code></pre> <p>For now, because our iterator is silent, in the <code>Some</code> case, we return no value of type <code>a</code>, only the fact that <code>it</code> is still an iterator, so we can continue the iteration. On the contrary, after a <code>None</code> answer, it is statically not possible to call <code>next</code> again: the permission <code>it @ iterator a post</code> has been consumed and was not returned through the offer.</p> <div class="figure"> <img src="http://gallium.inria.fr/blog/ts1.png" alt="Typestate of the iterator"/><p class="caption">Typestate of the iterator</p> </div> <p>A small code example using this iterator:</p> <pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="co">(* Loop calls [next] on the iterator until it is empty *)</span> <span class="kw">val</span> <span class="kw">rec</span> loop [a, post: perm] (consumes it: iterator a post): (| post) = <span class="kw">match</span> next it <span class="kw">with</span> | <span class="dt">None</span> -&gt; () | <span class="dt">Some</span> { x } -&gt; loop it end</code></pre> <h4 id="diving-into-the-internals-implementation">Diving into the internals: implementation</h4> <h5 id="a-first-attempt">A first attempt</h5> <p>To be able to go forward, the iterator must store the elements that will be explored in the future. With a list, it's easy: initially, it consists in the list itself, and each call to <code>next</code> just takes the tail of the current internal list.</p> <p>This gives us:</p> <pre class="sourceCode ocaml"><code class="sourceCode ocaml">data <span class="kw">mutable</span> iterator a (post: perm) = <span class="dt">Iterator</span> { xs: <span class="dt">list</span> a } data offer (post: perm) a = | <span class="dt">None</span> { | post } | <span class="dt">Some</span> { x: a } <span class="kw">val</span> <span class="kw">new</span> [a] (consumes l: <span class="dt">list</span> a): iterator a (l @ <span class="dt">list</span> a) = <span class="dt">Iterator</span> { xs = l } <span class="kw">val</span> next [a, post: perm] (consumes it: iterator a post): offer post (| it @ iterator a post) = <span class="kw">match</span> it.xs <span class="kw">with</span> | <span class="dt">Nil</span> -&gt; <span class="dt">None</span> | <span class="dt">Cons</span> { head; tail } -&gt; it.xs &lt;- tail; <span class="dt">Some</span> { x = () } end</code></pre> <p>Sadly, this example doesn't typecheck: in the match case where <code>it.xs</code> is <code>Nil</code>, we return <code>None</code>, and the permission <code>post</code>. However, we don't have <code>post</code>!</p> <p>Formally, at the beginning of <code>next</code>, the only available permissions are <code>it @ iterator a post</code>, and in the first match case, <code>it.xs @ Nil</code>. Nothing here gives us <code>post</code>.<br/>Intuitively, even if we had <code>post</code> at the beginning, <code>next</code> here doesn't preserves the knowledge of the cons cells we have already explored: we have to store in the iterator the permissions of the previous cons cells, to be able to finally merge them back into <code>post</code>.</p> <h5 id="storing-the-old-permissions">Storing the old permissions</h5> <p>We introduce a new permission, <code>p</code>, that describes the permission for the consumed cons cells. The iterator contains <code>p</code>, and a function, <code>rewind</code>, that consumes <code>p</code>, and the permission on the tail, and merge them into <code>post</code>.</p> <pre class="sourceCode ocaml"><code class="sourceCode ocaml">data <span class="kw">mutable</span> iterator a (p: perm) (post: perm) = <span class="dt">Iterator</span> { content: ( xs: <span class="dt">list</span> a, rewind: (| consumes (p * xs @ <span class="dt">list</span> a)) -&gt; (| post) | p ) }</code></pre> <p>With this definition of <code>iterator</code>, the signature of <code>next</code> would be:</p> <pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="kw">val</span> next: [a, p: perm, post: perm] ( consumes it: <span class="dt">Iterator</span> { content: ( xs: <span class="dt">list</span> a, rewind: (| consumes (p * xs @ <span class="dt">list</span> a)) -&gt; (| post) | p ) } -&gt; offer post (| it @ iterator a (p * xs @ <span class="dt">Cons</span> { head: a; tail: unknown }) post)</code></pre> <p>The idea is that before the call to <code>next</code>, the iterator stores in <code>xs</code> the permission on the non-traversed part of the list, <code>xs</code>, and <code>rewind</code> requests the permission on the already-traversed part of the list, represented by <code>p</code>, upto <code>xs</code> excluded. If <code>xs</code> is itself a cons cell (and only in this case), we can call <code>next</code>; the iterator will then store only the tail of <code>xs</code>, and its rewind function request the permission for <code>p</code>, plus the first cell of <code>xs</code> -- which at this point as been traversed.</p> <p>Concretely, imagine we have the following list construction, for some list <code>lb @ list int</code>.</p> <pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="kw">val</span> la = <span class="dt">Cons</span> { head=1; tail=lb }</code></pre> <p>and are now iterating on this list. Assuming we have already called <code>next</code> once, have traversed the first cell of <code>la</code>, the <code>rewind</code> function of the iterator would have a type equivalent to the following:</p> <pre class="sourceCode ocaml"><code class="sourceCode ocaml">rewind: (| consumes ( la @ <span class="dt">Cons</span> { head:int; tail=lb } * lb @ <span class="dt">list</span> <span class="dt">int</span>) ) -&gt; (| post )</code></pre> <p>If we pattern-match on <code>lb</code>, in the <code>Cons</code> case, the typing environment will learn that <code>lb</code> has type <code>Cons { head : int; tail = lc }</code> for some tail <code>lc @ list int</code>. So rewind has the refined type</p> <pre class="sourceCode ocaml"><code class="sourceCode ocaml">rewind: (| consumes ( la @ <span class="dt">Cons</span> { head:int; tail=lb } * lb @ <span class="dt">Cons</span> { head:int; tail=lc }) ) -&gt; (| post )</code></pre> <p>The already-traversed part of the list, <code>la</code>, has the same type, but the not-yet-traversed part has been refined to a cons type. Note that with the additional hypothesis <code>lc @ int</code> of our context, this is equivalent to the following type:</p> <pre class="sourceCode ocaml"><code class="sourceCode ocaml">rewind: (| consumes ( (la @ <span class="dt">Cons</span> { head:int; tail=lb } * lb @ <span class="dt">Cons</span> { head:int; tail=lc }) * lc @ <span class="dt">list</span> <span class="dt">int</span> ) -&gt; (| post )</code></pre> <p>which is precisely the type of the <code>rewind</code> function of the iterator <em>returned</em> by <code>next</code>. So after pattern-matching, the type of the <code>rewind</code> function passed to <code>next</code> becomes exactly the same as the type of the <code>rewind</code> function expected as a return value. We can return this function, unchanged: it has just been <em>transtyped</em>.</p> <pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="kw">val</span> next it <span class="co">(* lengthy type annotation that we won't repeat here *)</span> = <span class="kw">let</span> (xs, rewind) = it.content <span class="kw">in</span> <span class="kw">match</span> xs <span class="kw">with</span> | <span class="dt">Nil</span> -&gt; <span class="co">(* p * xs @ list a *)</span> rewind (); <span class="co">(* post *)</span> <span class="dt">None</span> | <span class="dt">Cons</span> { head; tail } -&gt; it.content &lt;- (tail, rewind); <span class="dt">Some</span> end</code></pre> <p>As we described, in the <code>Cons</code> case, the value of the <code>xs</code> field of <code>it</code> is changed to <code>tail</code>, but the <code>rewind</code> field is unchanged.</p> <p>Remark: we can still shorten this definition by quantifying <code>p</code> existentially in the definition of <code>iterator</code>, and the typechecker will be able to pack and unpack the quantification to do implicitly what we've done explicitly previously (the conversion <code>p</code> → <code>p * xs @ Cons { head: a; tail: unknown }</code>).</p> <pre class="sourceCode ocaml"><code class="sourceCode ocaml">data <span class="kw">mutable</span> iterator a (post: perm) = <span class="dt">Iterator</span> { content: { p: perm } ( xs: <span class="dt">list</span> a, rewind: (| consumes (p * xs @ <span class="dt">list</span> a)) -&gt; (| post) | p ) }</code></pre> <p>The type for <code>next</code> becomes much more readable. In fact, it is exactly the one we hoped to get <a href="http://gallium.inria.fr/blog/index.rss#expressing-iterator-typestate">at the very beginning</a> of the post.</p> <pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="kw">val</span> next [a, post: perm] (consumes it: iterator a post): offer post (| it @ iterator a post)</code></pre> <p>For the function <code>new</code>, the permission <code>p</code> is the neutral permission <code>empty</code>, and <code>rewind</code> needs to do nothing at all:</p> <pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="kw">val</span> <span class="kw">new</span> [a] (consumes l: <span class="dt">list</span> a): iterator a (l @ <span class="dt">list</span> a) = <span class="dt">Iterator</span> { content = ( l, <span class="kw">fun</span> (| consumes l @ <span class="dt">list</span>): (| l @ <span class="dt">list</span> a) = () )}</code></pre> <p>We can also write a <code>stop</code> function that stops the iteration:</p> <pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="kw">val</span> stop [a, post: perm] (consumes (it: iterator a post)): (| post) = <span class="kw">let</span> _, rewind = it.content <span class="kw">in</span> rewind ()</code></pre> <p>Note that the <code>rewind</code> function never does anything; it is just used for its effect on the typing environment.</p> <h3 id="the-chatty-and-useful-iterator">The chatty (and useful) iterator</h3> <p>This is great, we can traverse a list using our iterator. But it would be even more great if we could actually get the contents of the list!</p> <p>This is a bit more complicated: while giving an element to the user, we have to give him also the permission on it. This breaks the invariant "the iterator always can have <code>post</code> by applying <code>rewind</code>". Now, our iterator can have a <em>hole</em> in it: when giving an element to the user, a hole appears. To continue the iteration, the user <em>must</em> give the permission on the element back to the iterator.</p> <p>Consequently, the definition of <code>iterator</code> changes a bit: an <code>iterator</code> is now also parametrized by a permission <code>hole</code>, which in fact means "what does the iterator need to fill its hole and be able to generate <code>post</code>".</p> <p>Here is the new definition of <code>iterator</code>. Note that it doesn't contains <code>hole</code>, but we need it to generate <code>post</code>:</p> <pre class="sourceCode ocaml"><code class="sourceCode ocaml">data <span class="kw">mutable</span> iterator a (hole: perm) (post: perm) = <span class="dt">Iterator</span> { content: { p: perm } ( xs: <span class="dt">list</span> a, rewind: (| p * hole * l @ <span class="dt">list</span> a) -&gt; (| post) | p ) }</code></pre> <p>Thus, an iterator without a hole is an <code>iterator a empty post</code>, while an iterator that has given away <code>x @ a</code> to the user is a <code>iterator a (x @ a) post</code>.</p> <p>We can now write <code>next</code>. It takes an iterator parametrized by any permission <code>hole</code>, the permission <code>hole</code> itself, and implicitly fills the hole by merging <code>hole</code> into <code>p</code>. It finally returns the next element (if any).</p> <pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="kw">val</span> next [a, hole: perm, post: perm] (consumes (it: iterator a hole post | hole)): offer post (x: a | it @ iterator a (x @ a) post) = <span class="kw">let</span> xs, rewind = it.content <span class="kw">in</span> <span class="kw">match</span> xs <span class="kw">with</span> | <span class="dt">Nil</span> -&gt; rewind (); <span class="dt">None</span> | <span class="dt">Cons</span> { head; tail } -&gt; s.content &lt;- tail, rewind <span class="dt">Some</span> { x = head } end</code></pre> <p>And we can now use this iterator:</p> <pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="co">(* [nth] takes an iterator [it] and an integer [n], makes him go forward of [n]</span> <span class="co"> steps, and then returns it (if it hasn't been consumed) *)</span> <span class="kw">val</span> <span class="kw">rec</span> nth [a, hole: perm, post: perm] (consumes (it: iterator a hole post | hole), n: <span class="dt">int</span>): offer (x: a | it @ iterator a (x @ a) post) post = <span class="kw">match</span> next [hole = hole] it <span class="kw">with</span> | <span class="dt">None</span> -&gt; <span class="dt">None</span> | <span class="dt">Some</span> { x } -&gt; <span class="kw">if</span> n &lt;= 0 <span class="kw">then</span> ( <span class="dt">Some</span> { x = x } ) <span class="kw">else</span> ( nth [a = a, hole = (x @ a)] (it, n<span class="dv">-1</span>) ) end </code></pre> <p>You can note that we have sometimes to instantiate by hand the polymorphic parameters when calling a function. For example, here, when calling recursively <code>nth</code>, we have to say that a previous call to <code>next</code> has created a hole of "shape" <code>x @ a</code> we want to merge back to continue the iteration.</p> <h3 id="the-cherry-on-top">The cherry on top</h3> <p>So, here it is, an iterator on lists!<br/>However, this needs a little cleaning: we store in our iterator a rewind function, which is the same for every iterator, that doesn't change over time, and is just present to <em>convert</em> permissions.</p> <p>A way to clean up a bit is to declare a toplevel identity function, named <code>convert</code>:</p> <pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="kw">val</span> convert (): () = () alias convertible (p: perm) (q: perm): perm = convert @ (| consumes p) -&gt; (| q) data <span class="kw">mutable</span> iterator a (hole: perm) (post: perm) = <span class="dt">Iterator</span> { content: {p: perm} ( l: <span class="dt">list</span> a | p * convertible (p * hole * l @ <span class="dt">list</span> a) post ) }</code></pre> <p>I find that piece of code cute, and I think it enlightens the way the transtyping of <code>rewind</code> works: if rewind can have type <code>(| consumes p) -&gt; (| q)</code> it's because this is a subtype of <code>() -&gt; ()</code>, which means we have convinced the typechecker that <code>p</code> is convertible into <code>q</code>.</p> <h3 id="i-want-the-code">I want the code!</h3> <p>I doubt so, but just in case, the complete code, with some dummy examples of applications, <a href="http://gallium.inria.fr/blog/listiterator.mz.src.html">can be found there</a>.</p><a onclick="switchContent('post10','post9')" class="btn" href="#15aa8b6782b0ab6fe5b10e3acb7c6035">Hide</a></div></span>
<a name="8279cbbb65276d847fd5a12d54530cb9"></a><span class="rss-header"><span class="rss-title"><a href="http://scattered-thoughts.net/blog/2013/06/25/flowing-faster-lein-gnome"> Flowing faster: lein-gnome</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Jamie Brandon</span>, <span class="rss-date">25 Jun 2013</span></span><span class="rss-description"><p>After several weeks of banging my head against the empty space where the gnome-shell documentation should be, I’ve finally revived technomancy’s <a href="https://github.com/jamii/lein-gnome">lein-gnome</a>. It can build, package, deploy and reload gnome-shell extensions and includes a hello-world template. I’ve also added a unified log watcher that hunts down all the various places gnome-shell might choose to put your stack-traces and a cljs repl server that runs inside your extension so you can trial-and-error your way to victory.</p> <p>Future plans for a rainy day include:</p> <ul> <li><p>Writing a proper nrepl server for cljs so you can <code>C-x e</code> directly from emacs (this is non-trivial for projects with crossover code).</p></li> <li><p>Figure out how dynamic loading of bindings works in gjs so I can support tab-completion</p></li> <li><p>Clone the Looking Glass picker tool</p></li> </ul> <p>In the meantime I’m going to start work on <a href="https://github.com/jamii/golem">golem</a>. Until cljs has true nrepl support my hack for live interaction in emacs is the following:</p> <ul> <li><p>Save all extension state to disk on <code>disable</code></p></li> <li><p>Load all extension state from disk on <code>enable</code></p></li> <li><p>Hook <code>lein gnome install</code> into <code>lein cljsbuild auto</code></p></li> </ul></span>
<script type="text/javascript">function switchContent(id1,id2) {
     // Get the DOM reference
     var contentId1 = document.getElementById(id1);
     var contentId2 = document.getElementById(id2);
     // Toggle
     contentId1.style.display = "none";
     contentId2.style.display = "block";
     }</script></div>

  
    </div>

    
    <br/>
    <hr/>
    <div id="footer">
      Contribute to this project!
      Find us on <a href="https://github.com/ocaml/ocaml.org">Github</a>.
    </div>
    <span title=".././img/ = image directory from the base of the site"></span>


    
    
    

    <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
    <script src=".././js/jquery-1.8.0.min.js"></script>
    
    <script src=".././js/bootstrap.js"></script>

    <script type="text/javascript">
      var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-22552764-2']); _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-37808023-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

    </script>

</body></html>
