<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    
    <meta content="IE=8" http-equiv="X-UA-Compatible"/>
    <title>OCaml :: OCaml Planet</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <meta content="Ashish Agarwal, Esther Baruk, Christophe Troestler and many contributors" name="author"/>
    <meta content="" name="description"/>
    <meta content="" name="keywords"/>
    <meta content="OCaml (Weberizer)" name="generator"/>

    <link href="http://ocaml.org/img/favicon.ico" rel="shortcut icon"/>
    <link rel="stylesheet" href=".././css/bootstrap.css"/>
    <link href=".././css/ocaml.css" media="all" type="text/css" rel="stylesheet"/>
    <link rel="stylesheet" href=".././css/bootstrap-responsive.css"/>

    
    

    <meta content="OCaml Planet" property="og:title"/>
    <meta content="non_profit" property="og:type"/>

    <meta content="all" name="robots"/>
  </head>
  <body>
    <div id="header">
      <div class="top">
      </div>
      <div class="bottom">
      </div>
    </div>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
	  
          <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a href=".././" class="brand">OCaml</a>

          <div class="nav-collapse">
            <ul class="nav">
	      <li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">
    Discover
    <b class="caret"></b>
  </a>
  <ul class="dropdown-menu">
    <li><a href="../description.html">What is OCaml?</a></li>
    <li><a href="http://try.ocamlpro.com/">Try it Online</a></li>
    <li><a href="../taste.html">100 Lines of OCaml</a></li>
    <li><a href="../success.html">Success Stories</a></li>
    <li><a href="../companies.html">Who Is Using It?</a></li>
    <li><a href="http://pleac.sourceforge.net/pleac_ocaml/">Pleac</a></li>
    <li><a href="http://rosettacode.org/wiki/Category:OCaml">Rosetta</a>
        <a href="http://langref.org/ocaml">langref.org</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">
    Learn
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../install.html">Install</a></li>
    <li><a href="../tutorials/">Tutorials</a></li>
    <li><a href="../faq.html">FAQ</a></li>
    <li><a href="../books.html">Books</a></li>
    <li><a href="../videos.html">Videos</a></li>
    <li><a href="../papers.html">Papers</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">Use
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../releases/">Releases</a></li>
    <li><a href="../libraries.html">Libraries</a></li>
    <li><a href="../dev_tools.html">Development Tools</a></li>
    <li><a href="http://caml.inria.fr/pub/docs/manual-ocaml/">User Manual</a></li>
    <li><a href="../cheat_sheets.html">Cheat Sheets</a></li>
    <li><a href="http://search.ocaml.jp/">OCaml API Search</a></li>
    <li><a href="http://forge.ocamlcore.org/">Forge</a></li>
    <li><a href="https://github.com/languages/OCaml">GitHub</a></li>
    <li><a href="https://bitbucket.org/repo/all?name=ocaml">Bitbucket</a></li>
    <li><a href="http://gitorious.org/search?page=1&q=ocaml">Gitorious</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">Community
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="../mailing_lists.html">Mailing Lists</a></li>
    <li><a href="../planet/">Blogs</a></li>
    <li><a href="../meetings/">Meetings</a></li>
    <li><a href="irc://irc.freenode.net/ocaml">IRC</a></li>
    <li><a href="http://stackoverflow.com/questions/tagged?tagnames=ocaml">Stack Overflow</a></li>
    <li><a href="http://www.reddit.com/r/ocaml/">Reddit</a></li>
    <li><a href="../support.html">Commercial Support</a></li>
  </ul>
</li>
<li class="dropdown">
  <a href="../#" class="dropdown-toggle" data-toggle="dropdown">More
    <b class="caret"></b></a>
  <ul class="dropdown-menu">
    <li><a href="http://caml.inria.fr/mantis/">Mantis Bug Tracker</a></li>
    <li><a href="../caml-light/">Caml Light</a></li>
    <li><a href="../logos.html">Logos</a></li>
  </ul>
</li>

            </ul>
	    <form action="http://www.google.com/search" method="get" class="navbar-search pull-right">
	      <input placeholder="Search" class="search-query" name="q" type="text"/>
	      <input value="site:http://ocaml.org/" name="q" type="hidden"/>
	    </form>
            
	    
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <span class="navigation-bar">
	<a href="./../">Home</a><span class="separation"><img src=".././img/right_arrow.png" alt="&gt;"/></span>OCaml Planet
	<span id="language">
	  <span class="horizontal-toolbar"><span class="open-bracket">[</span><span class="current-url">En</span><span class="close-bracket">]</span></span>
	</span>
      </span>

      

    <h1>OCaml Planet</h1>

    <p>The OCaml Planet aggregates various blogs from the OCaml
    community.  It is kindly provided
    by <a href="http://www.ocamlcore.com/">OCamlCore</a>.  If you
    would like to be added, read
    the <a href="http://www.ocamlcore.org/planet/">Planet
    subscription HOWTO</a>.</p>

    <br/>
    <div style="float: right; margin-right: 0; margin-top: 0" class="span2 planet-subscriptions"><em>Subscriptions</em>
      <ul><li><a href="http://alexleighton.tumblr.com/tagged/ocaml/rss">Alex Leighton</a></li><li><a href="http://feeds.feedburner.com/amirmc-ocaml">Amir Chaudhry</a></li><li><a href="http://andreiformiga.com/blog/?cat=5&feed=rss2">Andrei Formiga</a></li><li><a href="http://math.andrej.com/feed/">Andrej Bauer</a></li><li><a href="http://anil.recoil.org/feeds/atom.xml">Anil Madhavapeddy</a></li><li><a href="http://ashishagarwal.org/tag/ocaml/feed/">Ashish Agarwal</a></li><li><a href="http://www.blogger.com/feeds/7617521785419311079/posts/default">Cameleon news</a></li><li><a href="http://caml.inria.fr/news.en.rss">Caml INRIA</a></li><li><a href="http://camlspotter.blogspot.com/feeds/posts/default?alt=rss">Caml Spotting</a></li><li><a href="http://alan.petitepomme.net/cwn/cwn.rss">Caml Weekly News</a></li><li><a href="http://coherentpdf.com/blog/?tag=ocaml&feed=rss2">Coherent Graphics</a></li><li><a href="http://coq.inria.fr/news/feed">Coq</a></li><li><a href="http://erratique.ch/feeds/news.atom">Daniel Bünzli</a></li><li><a href="http://nleyten.com:82/feed/tag/ocaml/atom">Dario Teixeira</a></li><li><a href="http://www.blogger.com/feeds/17133288/posts/default/-/ocaml">David Baelde</a></li><li><a href="http://blog.bentobako.org/index.php?feed/tag/ocaml/atom">David Mentré</a></li><li><a href="http://dutherenverseauborddelatable.wordpress.com/category/ocaml/feed/">David Teller</a></li><li><a href="http://www.examachine.net/blog/cat/ocaml/feed/">Eray Özkural</a></li><li><a href="http://www.mega-nerd.com/erikd/Blog/index.rss20">Erik de Castro Lopo</a></li><li><a href="http://blog.emillon.org/feeds/ocaml.xml">Etienne Millon</a></li><li><a href="http://frama-c.com/rss.xml">Frama-C</a></li><li><a href="http://functionaljobs.com/jobs/search/?q=ocaml&format=rss">Functional Jobs</a></li><li><a href="http://gallium.inria.fr/blog/index.rss">GaGallium</a></li><li><a href="http://gaiustech.wordpress.com/category/ocaml/feed/">Gaius Hammond</a></li><li><a href="http://blog.camlcity.org/blog/rss">Gerd Stolpmann</a></li><li><a href="http://jobs.github.com/positions.atom?description=ocaml&location=">Github OCaml jobs</a></li><li><a href="http://www.wisdomandwonder.com/tag/OCaml/feed">Grant Rettke</a></li><li><a href="http://hongboz.wordpress.com/feed/">Hong bo Zhang</a></li><li><a href="http://blog.incubaid.com/tag/ocaml/feed/">Incubaid Research</a></li><li><a href="http://ambassadortothecomputers.blogspot.com/feeds/posts/default?alt=rss">Jake Donham</a></li><li><a href="http://scattered-thoughts.net/atom.xml">Jamie Brandon</a></li><li><a href="https://ocaml.janestreet.com/?q=rss.xml">Jane Street</a></li><li><a href="http://lpw25.net/rss.xml">Leo White</a></li><li><a href="http://www.lexifi.com/blogs/ocaml/feed">LexiFi</a></li><li><a href="http://newblog.0branch.com/rss.xml">Marc Simpson</a></li><li><a href="http://syntaxexclamation.wordpress.com/tag/ocaml/feed/">Matthias Puech</a></li><li><a href="http://www.blogger.com/feeds/5888658295182480819/posts/default">Matías Giovannini</a></li><li><a href="">Mihamina Rakotomandimby</a></li><li><a href="http://mcclurmc.wordpress.com/feed/">Mike McClurg</a></li><li><a href="http://nyc-ocaml.posterous.com/rss.xml">NYC OCaml</a></li><li><a href="http://ocaml-book.com/blog?format=rss">OCaml Book</a></li><li><a href="http://ocamllabs.github.com/compiler-hacking/rss.xml">OCaml Labs compiler hacking</a></li><li><a href="http://forge.ocamlcore.org/export/rss_sfnews.php">OCamlCore Forge News</a></li><li><a href="http://forge.ocamlcore.org/export/rss_sfprojects.php">OCamlCore Forge Projects</a></li><li><a href="http://www.ocamlcore.com/wp/?feed=rss2&amp;language=en&#038;language=en">OCamlCore.com</a></li><li><a href="http://www.ocamlpro.com/feed/atom.xml">OCamlPro</a></li><li><a href="http://odns.tuxfamily.org/feed/">ODNS project</a></li><li><a href="http://ox.tuxfamily.org/feed/">Ocaml XMPP project</a></li><li><a href="http://ocsigen.org/news.atom">Ocsigen project</a></li><li><a href="http://www.blogger.com/feeds/2073503406800427577/posts/default">Opa</a></li><li><a href="http://www.openmirage.org/blog/atom.xml">Open Mirage</a></li><li><a href="http://functional-orbitz.blogspot.com/feeds/posts/default/-/planetocaml?alt=rss">Orbitz</a></li><li><a href="http://www.donadeo.net/facets/programming-languages/objective-caml/feed/">Paolo Donadeo</a></li><li><a href="https://mancoosi.org/~abate/taxonomy/term/5/0/feed">Pietro Abate</a></li><li><a href="http://rwmj.wordpress.com/tag/ocaml/feed/">Richard Jones</a></li><li><a href="http://blog.rastageeks.org/spip.php?page=rss&id_mot=2">Romain Beauxis</a></li><li><a href="http://seb.mondet.org/blog/feed/ocaml.rss">Sebastien Mondet</a></li><li><a href="http://upsilon.cc/~zack/tags/ocaml/index.rss">Stefano Zacchiroli</a></li><li><a href="http://le-gall.net/sylvain+violaine/blog/index.php?feed/tag/ocaml/atom">Sylvain Le Gall</a></li><li><a href="http://caml.inria.fr/hump.rss">The Caml Humps</a></li><li><a href="http://www.blogger.com/feeds/6115529230232389198/posts/default">Till Varoquaux</a></li><li><a href="http://y-node.com/blog/feeds/latest/">y-node</a></li></ul>

      <a href="http://planet.ocaml.org/rss20.xml"><img src=".././img/rss20.png"/></a>
      <a href="http://planet.ocaml.org/opml.xml"><img src=".././img/opml.png"/></a>
    </div>
    <div class="planet"><a name="25ee71eaab22f4807c1693c70768aa15"></a><span class="rss-header"><span class="rss-title"><a href="https://forge.ocamlcore.org/projects/exenum/"> exenum: exhaustive enumerations</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">OCamlCore Forge Projects</span>, <span class="rss-date">12 Oct 2013</span></span><span class="rss-description">Build efficient enumerations for datatypes. Inspired by Feat for Haskell.</span>
<a name="953d5773cba3f37f4d19a34195d51f01"></a><span class="rss-header"><span class="rss-title"><a href="https://forge.ocamlcore.org/forum/forum.php?forum_id=888"> OCaml MySQL Protocol 0.9 available</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">OCamlCore Forge News</span>, <span class="rss-date">08 Oct 2013</span></span><span class="rss-description"><pre class="rss-text">Really close the socket when closing the connection to the MySQL server. Add a benchmark to compare with the C MySQL binding.</pre></span>
<a name="693cc34cd8aafd0d1beae7a1b7d45790"></a><span class="rss-header"><span class="rss-title"><a href="http://alan.petitepomme.net/cwn/2013.10.08.html"> Caml Weekly News, 08 Oct 2013</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Caml Weekly News</span>, <span class="rss-date">08 Oct 2013</span></span><span class="rss-description">OASIS help - libraries with mixed C/C++ part / Feedback on the ocaml.org redesign and logo / QCheck 0.1 / Other Caml News</span>
<a name="6fb0b10cf7a048a1e3867f88d357a419"></a><span class="rss-header"><span class="rss-title"><a href="http://anil.recoil.org/2013/10/08/fpdays-real-world-ocaml.html"> FPDays 2013 Real World OCaml tutorial in Cambridge</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Anil Madhavapeddy</span>, <span class="rss-date">07 Oct 2013</span></span><span class="rss-description"><div id="post1"><a href="http://fpdays.net/fpdays2013/sessions/index.php?session=24"><img src="http://anil.recoil.org/images/fpdays-logo-thumb.jpg" style="padding-left: 15px; float: right;" width="200"/></a>
<p>Yaron Minsky and I have been running OCaml tutorials for a few years at <a href="http://icfpconference.org">ICFP</a> and <a href="http://cufp.org">CUFP</a>, but haven’t really spread out into the wider conference circuit. Now that <a href="https://realworldocaml.org">Real World OCaml</a> is almost finished, the scene is set for doing much more. The first such tutorial is being help at <a href="http://fpdays.net/fpdays2013/">FPDays 2013</a> on October 24th in the lovely Murray Edwards College in Cambridge. Check out the <a href="http://lanyrd.com/2013/fpdays/">Lanyrd page</a> for ticket information, and the <a href="http://lanyrd.com/2013/fpdays/sckzky/">OCaml session</a> page for more information.</p>

<p>The basic layout of the tutorial is to get started with the guided tour of the <a href="https://realworldocaml.org">book</a>, and then work through building a <a href="https://bitbucket.org/yminsky/core-hello-world">distributed message broker</a>. This gets you familiar with the <a href="https://github.com/janestreet/core">Core</a> standard library, the <a href="https://github.com/janestreet/async">Async</a> event-driven I/O library, and all the strongly-typed RPC plumbing that goes in between. We’re hoping to have physical preprints of the book available for free to attendees, so do sign up fast if you wish to attend.</p>

<a onclick="switchContent('post1','post2')" class="btn" href="#6fb0b10cf7a048a1e3867f88d357a419">Read more...</a></div><div id="post2" style="display: none"><a href="http://fpdays.net/fpdays2013/sessions/index.php?session=24"><img src="http://anil.recoil.org/images/fpdays-logo-thumb.jpg" style="padding-left: 15px; float: right;" width="200"/></a>
<p>Yaron Minsky and I have been running OCaml tutorials for a few years at <a href="http://icfpconference.org">ICFP</a> and <a href="http://cufp.org">CUFP</a>, but haven’t really spread out into the wider conference circuit. Now that <a href="https://realworldocaml.org">Real World OCaml</a> is almost finished, the scene is set for doing much more. The first such tutorial is being help at <a href="http://fpdays.net/fpdays2013/">FPDays 2013</a> on October 24th in the lovely Murray Edwards College in Cambridge. Check out the <a href="http://lanyrd.com/2013/fpdays/">Lanyrd page</a> for ticket information, and the <a href="http://lanyrd.com/2013/fpdays/sckzky/">OCaml session</a> page for more information.</p>

<p>The basic layout of the tutorial is to get started with the guided tour of the <a href="https://realworldocaml.org">book</a>, and then work through building a <a href="https://bitbucket.org/yminsky/core-hello-world">distributed message broker</a>. This gets you familiar with the <a href="https://github.com/janestreet/core">Core</a> standard library, the <a href="https://github.com/janestreet/async">Async</a> event-driven I/O library, and all the strongly-typed RPC plumbing that goes in between. We’re hoping to have physical preprints of the book available for free to attendees, so do sign up fast if you wish to attend.</p>

<p>As a bonus, the Cambridge FPDays session will feature Jeremy Yallop working through the book and conducting the tutorial: he has an incredible depth of knowledge about the innards of OCaml’s type system, and so advanced users will also find a good home in this tutorial to throw questions at him too! For those of you interested in other programming languages, there are also excellent-looking sessions on Erlang, F# and Scala, and Phil Wadler is giving a keynote speech. I’m most excited about <a href="http://fpdays.net/fpdays2013/sessions/index.php?session=28">Sam Aaron’s session</a> on live coding and music though. You have to hear it to believe it…</p><a onclick="switchContent('post2','post1')" class="btn" href="#6fb0b10cf7a048a1e3867f88d357a419">Hide</a></div></span>
<a name="3163b1093e85b021085a7ee20f18b8b5"></a><span class="rss-header"><span class="rss-title"><a href="http://nleyten.com/post/2013/10/07/Announcing-CCSS-1.4"> Announcing CCSS 1.4</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Dario Teixeira</span>, <span class="rss-date">07 Oct 2013</span></span><span class="rss-description"><div id="post3"><p>I've recently released version 1.4 of <a href="http://ccss.forge.ocamlcore.org/">CCSS</a>, a preprocessor/pretty-printer for
CSS (Cascading Style Sheets). Though CCSS most definitely falls into the
category of software developed to scratch a personal itch, it has gained other
users in the meantime. Consequently, I reckon a few words are in order
concerning the features/idiosyncrasies of this tool.</p>
<p>For those not familiar with CCSS or CSS preprocessors in general, the basic
rationale for these tools is to fill some glaring shortcomings in the vanilla
CSS language, namely the lack of variables and basic arithmetic operations.
Many tools go further still, providing new ways to structure and organise CSS
declarations.</p>
<a onclick="switchContent('post3','post4')" class="btn" href="#3163b1093e85b021085a7ee20f18b8b5">Read more...</a></div><div id="post4" style="display: none"><p>I've recently released version 1.4 of <a href="http://ccss.forge.ocamlcore.org/">CCSS</a>, a preprocessor/pretty-printer for
CSS (Cascading Style Sheets). Though CCSS most definitely falls into the
category of software developed to scratch a personal itch, it has gained other
users in the meantime. Consequently, I reckon a few words are in order
concerning the features/idiosyncrasies of this tool.</p>
<p>For those not familiar with CCSS or CSS preprocessors in general, the basic
rationale for these tools is to fill some glaring shortcomings in the vanilla
CSS language, namely the lack of variables and basic arithmetic operations.
Many tools go further still, providing new ways to structure and organise CSS
declarations.</p>
<p>There is certainly no lack of CSS preprocessors available, most of which
have large user bases and plenty of fancy features. So, why CCSS? Does the
world really need yet another CSS preprocessing tool? I cannot speak for the
world. I can, however, relate that some years ago I was in need of a CSS
preprocessor that supported variables, arithmetic, and did not choke on the few
CSS3 constructs I was introducing into my stylesheets. Moreover, I was looking
for a nice, clean syntax that felt like a natural extension to vanilla CSS.
Finally, I don't think it was unreasonable to expect that a tool performing
such a simple task to be fast. Unfortunately, the tools I tried back then did
not quite meet these requirements, particularly where speed was concerned.</p>
<p>OCaml hackers being who they are, I reckoned that a better tool for my needs
could be written in a weekend. And that's how CCSS was born. Fortunately, I was
about right concerning the time estimate, which just goes to show how awesome
the OCaml language and assorted tools (namely Menhir and Ulex) are for writing
compilers.</p>
<p>This little history brings us to the most important point about CCSS that
potential users should be aware of: it was never meant to be a fully-compliant
superset of vanilla CSS. To illustrate this point, consider the humble
semicolon, which according to the CSS spec is a declaration <em>separator</em>,
and optional after the last declaration in a block. Omitting the last semicolon
is, however, a brittle practice (it's all too easy to forget to add the
semicolon when a new declaration is appended to the block), which is why users
are advised to always write a semicolon at the end of each declaration,
effectively treating it as a declaration <em>terminator</em>. Guess what? The
CCSS grammar treats the semicolon as a mandatory terminator — spec be
damned.</p>
<p>Variables are perhaps the most useful extension to CSS, and CCSS does
support them. In previous versions, variables could only be assigned to
expressions. The recently released version 1.4, however, introduces the
possibility of assigning a whole declaration block to a variable. This feature
is similar to what other preprocessors term <em>mixins</em>, so this is the
nomeclature I'm using too.</p>
<p>The example shown below illustrates the use of variables to declare commonly
used expressions. Note that syntactically, variable identifiers are
distinguished by starting with a mandatory uppercase letter. This was chosen to
make tooling (such as syntax highlighting in editors) easier.</p>
<pre>Foo: 20em;
Bar: 1px solid black;
h1
{
width: Foo;
border: Bar;
}
</pre>
<p>The second example concerns the use of variables to declare mixins, ie,
declaration blocks that can be included within subsequent declaration
blocks:</p>
<pre>Inverse_scheme:
{
color: #fff;
background: #000;
}
h1
{
Inverse_scheme;
font-weight: bold;
}
</pre>
<p>CCSS also extends CSS expressions with basic arithmetic operations
(addition, subtraction, multiplication, and division). The operands must be CSS
quantities (either dimensionless or with an attached unit), or other
expressions that ultimately resolve into a quantity. Moreover, variables whose
value is a quantity (or an expression which resolves into a quantity) may also
be used as operand.</p>
<p>The operators are '+', '-', '*', and '÷'. Note that multiplication and
division have precedence over addition and subtraction, but you may use
parentheses to group operations. In addition, the choice of the non-ASCII
character '÷' as division operator betrays CCSS's origins as tool designed to
scratch a personal itch: it can be input with just a few easy-to-remember
keystrokes in VIM, the editor I use. I had thus no motivation to find an ugly
multi-character token to represent it. Consider thus the following input:</p>
<pre>Left: 10em;
Right: 5em;
Total: Left + Right;
h1
{
padding: (1.5em + 0.5em) * 2;
width: 2 * Total;
}
</pre>
<p>CCSS will produce the following output:</p>
<pre>h1
{
padding: 4em;
width: 30em;
}
</pre>
<p>The reader will have noticed that CCSS must be unit-aware when performing
arithmetic. As a matter of fact, the programme performs a basic sanity check of
units, and will complain if you try, for example, to add "1em" with "10px". By
default, CCSS will not make any attempt to convert units even if they are
convertible, such "cm" and "mm". If you wish for CCSS to attempt unit
conversion, please provide option "--convert" on the command line (short
version "-c").</p>
<p>Units can be grouped into four categories, and conversion is possible if the
units belong to the same category. Upon conversion, the result will be the same
unit as the first operand. The categories and corresponding units are as
follows:</p>
<ul>
<li><strong>length:</strong> mm, cm, in, pt, pc</li>
<li><strong>angle:</strong> deg, grad, rad</li>
<li><strong>time:</strong> ms, s</li>
<li><strong>frequency:</strong> hz, khz</li>
</ul>
<p>As an illustration of unit conversion, the result for all the following
arithmetic operations is the same, "2in":</p>
<pre>h1
{
foo1: 1in + 1in;
foo2: 1in + 2.54cm;
foo3: 1in + 25.4mm;
foo4: 1in + 72pt;
foo5: 1in + 6pc;
}
</pre>
<p>And that's it! Note that the project's development has recently <a href="https://github.com/darioteixeira/ccss">moved to GitHub</a>, so fork away!</p><a onclick="switchContent('post4','post3')" class="btn" href="#3163b1093e85b021085a7ee20f18b8b5">Hide</a></div></span>
<a name="b341d9862dfecfd9d18039bdfdb01f31"></a><span class="rss-header"><span class="rss-title"><a href="http://scattered-thoughts.net/blog/2013/10/06/hugo-a-go-go/"> Hugo-a-go-go</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Jamie Brandon</span>, <span class="rss-date">06 Oct 2013</span></span><span class="rss-description"><div id="post5"><p>For the <a href="http://clojurecup.com/">2013 Clojure Cup</a> myself and <a href="http://www.thattommyhall.com/">Tom Hall</a> wrote a <a href="http://en.wikipedia.org/wiki/Go_%28game%29">go</a> AI in clojurescript, inspired by <a href="https://github.com/ztellman/pushkin">pushkin</a>. The source is <a href="https://github.com/jamii/hugo-a-go-go/">here</a> and it can currently be played on the <a href="http://hugoagogo.clojurecup.com/">clojure cup site</a> (only tested in chrome).</p>




<p>Before reading this post it would help to understand the rules of go. Hugo-a-go-go follows (an approximation of) the <a href="http://en.wikipedia.org/wiki/Rules_of_Go#Chinese_rules">chinese rules</a>. Due to the limited time we don’t yet check for <a href="http://en.wikipedia.org/wiki/Rules_of_Go#Ko">ko</a> and don’t even attempt to detect the end of the game. The code at the moment is incredibly messy and probably very buggy (the version we submitted seems to actually <em>try</em> to lose) so treat it with suspicion.</p>

<h2>Board</h2>

<p>The best place to start is with the board representation. The most expensive operation for the AI is detecting suicide and death. To make this fast we track connected strings of pieces.</p>

&lt;figure class="code"&gt;&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;<div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="clojure"><span class="line"><span class="p">(</span><span class="kd">defrecord </span><span class="nv">String</span> <span class="p">[</span><span class="nv">colour</span> <span class="nv">liberties</span><span class="p">])</span>
</span></code></pre></td></tr></tbody></table></div>&lt;/figure&gt;


<p><code>colour</code> is one of <code>:black</code>, <code>:white</code>, <code>:grey</code> (for the border) or <code>:empty</code>. <code>liberties</code> tracks the number of <a href="https://groups.google.com/forum/#!msg/computer-go-archive/hs259RQQ5hI/TOLFX2d5Y6UJ">pseudo-liberties</a> the string has (for black or white strings; for empty or grey strings the <code>liberties</code> value is never read and exists just to avoid having to branch on the colour).</p>

<a onclick="switchContent('post5','post6')" class="btn" href="#b341d9862dfecfd9d18039bdfdb01f31">Read more...</a></div><div id="post6" style="display: none"><p>For the <a href="http://clojurecup.com/">2013 Clojure Cup</a> myself and <a href="http://www.thattommyhall.com/">Tom Hall</a> wrote a <a href="http://en.wikipedia.org/wiki/Go_%28game%29">go</a> AI in clojurescript, inspired by <a href="https://github.com/ztellman/pushkin">pushkin</a>. The source is <a href="https://github.com/jamii/hugo-a-go-go/">here</a> and it can currently be played on the <a href="http://hugoagogo.clojurecup.com/">clojure cup site</a> (only tested in chrome).</p>




<p>Before reading this post it would help to understand the rules of go. Hugo-a-go-go follows (an approximation of) the <a href="http://en.wikipedia.org/wiki/Rules_of_Go#Chinese_rules">chinese rules</a>. Due to the limited time we don’t yet check for <a href="http://en.wikipedia.org/wiki/Rules_of_Go#Ko">ko</a> and don’t even attempt to detect the end of the game. The code at the moment is incredibly messy and probably very buggy (the version we submitted seems to actually <em>try</em> to lose) so treat it with suspicion.</p>

<h2>Board</h2>

<p>The best place to start is with the board representation. The most expensive operation for the AI is detecting suicide and death. To make this fast we track connected strings of pieces.</p>

&lt;figure class="code"&gt;&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;<div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="clojure"><span class="line"><span class="p">(</span><span class="kd">defrecord </span><span class="nv">String</span> <span class="p">[</span><span class="nv">colour</span> <span class="nv">liberties</span><span class="p">])</span>
</span></code></pre></td></tr></tbody></table></div>&lt;/figure&gt;


<p><code>colour</code> is one of <code>:black</code>, <code>:white</code>, <code>:grey</code> (for the border) or <code>:empty</code>. <code>liberties</code> tracks the number of <a href="https://groups.google.com/forum/#!msg/computer-go-archive/hs259RQQ5hI/TOLFX2d5Y6UJ">pseudo-liberties</a> the string has (for black or white strings; for empty or grey strings the <code>liberties</code> value is never read and exists just to avoid having to branch on the colour).</p>

<p>The board is represented by a 1d array of pointers to strings (this representation is inspired by <a href="http://www.gnu.org/software/gnugo/">gnugo</a> rather than pushkin) and a pointer to the empty string (which we use for fast <code>empty?</code> checks).</p>

&lt;figure class="code"&gt;&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;<div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="clojure"><span class="line"><span class="p">(</span><span class="kd">defrecord </span><span class="nv">Board</span> <span class="p">[</span><span class="nv">strings</span> <span class="nv">empty-string</span><span class="p">])</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="k">def </span><span class="nv">size</span> <span class="mi">9</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="k">def </span><span class="nv">array-size</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">2</span> <span class="nv">size</span><span class="p">))</span>
</span><span class="line"><span class="p">(</span><span class="k">def </span><span class="nv">max-pos</span> <span class="p">(</span><span class="nb">* </span><span class="nv">array-size</span> <span class="nv">array-size</span><span class="p">))</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="kd">defn </span><span class="nv">-&gt;pos</span> <span class="p">[</span><span class="nv">x</span> <span class="nv">y</span><span class="p">]</span>
</span><span class="line">  <span class="p">(</span><span class="nb">+ </span><span class="mi">1</span> <span class="nv">x</span> <span class="p">(</span><span class="nb">* </span><span class="nv">array-size</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">1</span> <span class="nv">y</span><span class="p">))))</span>
</span></code></pre></td></tr></tbody></table></div>&lt;/figure&gt;


<p>To create a board we just have to setup the empty-string and border-string.</p>

&lt;figure class="code"&gt;&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;<div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="clojure"><span class="line"><span class="p">(</span><span class="kd">defn </span><span class="k">new </span><span class="p">[]</span>
</span><span class="line">  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">empty-string</span> <span class="p">(</span><span class="nf">-&gt;String</span> <span class="ss">:empty</span> <span class="mi">0</span><span class="p">)</span>
</span><span class="line">        <span class="nv">border-string</span> <span class="p">(</span><span class="nf">-&gt;String</span> <span class="ss">:grey</span> <span class="mi">0</span><span class="p">)</span>
</span><span class="line">        <span class="nv">strings</span> <span class="p">(</span><span class="nf">object-array</span> <span class="nv">max-pos</span><span class="p">)]</span>
</span><span class="line">    <span class="p">(</span><span class="nb">dotimes </span><span class="p">[</span><span class="nv">i</span> <span class="nv">max-pos</span><span class="p">]</span>
</span><span class="line">      <span class="p">(</span><span class="nb">aset </span><span class="nv">strings</span> <span class="nv">i</span> <span class="nv">empty-string</span><span class="p">))</span>
</span><span class="line">    <span class="p">(</span><span class="nb">dotimes </span><span class="p">[</span><span class="nv">i</span> <span class="nv">array-size</span><span class="p">]</span>
</span><span class="line">      <span class="p">(</span><span class="nb">aset </span><span class="nv">strings</span> <span class="p">(</span><span class="nf">-&gt;pos</span> <span class="p">(</span><span class="nb">dec </span><span class="nv">i</span><span class="p">)</span> <span class="mi">-1</span><span class="p">)</span> <span class="nv">border-string</span><span class="p">)</span>
</span><span class="line">      <span class="p">(</span><span class="nb">aset </span><span class="nv">strings</span> <span class="p">(</span><span class="nf">-&gt;pos</span> <span class="p">(</span><span class="nb">dec </span><span class="nv">i</span><span class="p">)</span> <span class="nv">size</span><span class="p">)</span> <span class="nv">border-string</span><span class="p">)</span>
</span><span class="line">      <span class="p">(</span><span class="nb">aset </span><span class="nv">strings</span> <span class="p">(</span><span class="nf">-&gt;pos</span> <span class="mi">-1</span> <span class="p">(</span><span class="nb">dec </span><span class="nv">i</span><span class="p">))</span> <span class="nv">border-string</span><span class="p">)</span>
</span><span class="line">      <span class="p">(</span><span class="nb">aset </span><span class="nv">strings</span> <span class="p">(</span><span class="nf">-&gt;pos</span> <span class="nv">size</span> <span class="p">(</span><span class="nb">dec </span><span class="nv">i</span><span class="p">))</span> <span class="nv">border-string</span><span class="p">))</span>
</span><span class="line">    <span class="p">(</span><span class="nf">-&gt;Board</span> <span class="nv">strings</span> <span class="nv">empty-string</span><span class="p">)))</span>
</span></code></pre></td></tr></tbody></table></div>&lt;/figure&gt;


<p>A given move is <em>not</em> suicide if, after the move is made, there is at least one neighbour which is either:</p>

<ul>
<li><p>the same colour and has more than zero liberties</p></li>
<li><p>the opposite colour and has zero liberties (ie would die if the move was carried through)</p></li>
<li><p>empty</p></li>
</ul>


&lt;figure class="code"&gt;&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;<div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
</pre></td><td class="code"><pre><code class="clojure"><span class="line"><span class="p">(</span><span class="kd">defn </span><span class="nv">suicide?</span> <span class="p">[</span><span class="o">^</span><span class="nv">Board</span> <span class="nv">board</span> <span class="nv">colour</span> <span class="nv">pos</span><span class="p">]</span>
</span><span class="line">  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">suicide</span> <span class="p">(</span><span class="nf">atom</span> <span class="nv">true</span><span class="p">)</span>
</span><span class="line">        <span class="nv">opposite-colour</span> <span class="p">(</span><span class="nf">condp</span> <span class="nv">keyword-identical?</span> <span class="nv">colour</span> <span class="ss">:black</span> <span class="ss">:white</span> <span class="ss">:white</span> <span class="ss">:black</span><span class="p">)]</span>
</span><span class="line">    <span class="c1">;; decrement all the neighbours liberties</span>
</span><span class="line">    <span class="p">(</span><span class="nf">foreach-neighbour</span> <span class="nv">neighbour-pos</span> <span class="nv">pos</span>
</span><span class="line">      <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">string</span> <span class="p">(</span><span class="nb">aget </span><span class="p">(</span><span class="nf">.-strings</span> <span class="nv">board</span><span class="p">)</span> <span class="nv">neighbour-pos</span><span class="p">)]</span>
</span><span class="line">        <span class="p">(</span><span class="nf">set!</span> <span class="p">(</span><span class="nf">.-liberties</span> <span class="nv">string</span><span class="p">)</span> <span class="p">(</span><span class="nb">dec </span><span class="p">(</span><span class="nf">.-liberties</span> <span class="nv">string</span><span class="p">)))))</span>
</span><span class="line">    <span class="c1">;; check for suicide</span>
</span><span class="line">    <span class="p">(</span><span class="nf">foreach-neighbour</span> <span class="nv">neighbour-pos</span> <span class="nv">pos</span>
</span><span class="line">      <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">string</span> <span class="p">(</span><span class="nb">aget </span><span class="p">(</span><span class="nf">.-strings</span> <span class="nv">board</span><span class="p">)</span> <span class="nv">neighbour-pos</span><span class="p">)]</span>
</span><span class="line">        <span class="p">(</span><span class="nf">condp</span> <span class="nv">keyword-identical?</span> <span class="p">(</span><span class="nf">.-colour</span> <span class="nv">string</span><span class="p">)</span>
</span><span class="line">          <span class="nv">colour</span> <span class="p">(</span><span class="nb">when </span><span class="p">(</span><span class="nb">&gt; </span><span class="p">(</span><span class="nf">.-liberties</span> <span class="nv">string</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
</span><span class="line">                   <span class="p">(</span><span class="nf">reset!</span> <span class="nv">suicide</span> <span class="nv">false</span><span class="p">))</span>
</span><span class="line">          <span class="nv">opposite-colour</span> <span class="p">(</span><span class="nb">when </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nf">.-liberties</span> <span class="nv">string</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
</span><span class="line">                            <span class="p">(</span><span class="nf">reset!</span> <span class="nv">suicide</span> <span class="nv">false</span><span class="p">))</span>
</span><span class="line">          <span class="ss">:empty</span> <span class="p">(</span><span class="nf">reset!</span> <span class="nv">suicide</span> <span class="nv">false</span><span class="p">)</span>
</span><span class="line">          <span class="ss">:grey</span> <span class="nv">nil</span><span class="p">)))</span>
</span><span class="line">    <span class="c1">;; undo the decrement</span>
</span><span class="line">    <span class="p">(</span><span class="nf">foreach-neighbour</span> <span class="nv">neighbour-pos</span> <span class="nv">pos</span>
</span><span class="line">      <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">string</span> <span class="p">(</span><span class="nb">aget </span><span class="p">(</span><span class="nf">.-strings</span> <span class="nv">board</span><span class="p">)</span> <span class="nv">neighbour-pos</span><span class="p">)]</span>
</span><span class="line">        <span class="p">(</span><span class="nf">set!</span> <span class="p">(</span><span class="nf">.-liberties</span> <span class="nv">string</span><span class="p">)</span> <span class="p">(</span><span class="nb">inc </span><span class="p">(</span><span class="nf">.-liberties</span> <span class="nv">string</span><span class="p">)))))</span>
</span><span class="line">    <span class="err">@</span><span class="nv">suicide</span><span class="p">))</span>
</span></code></pre></td></tr></tbody></table></div>&lt;/figure&gt;


<p>Actually making a move is similar but we have to clear out dead strings and join adjacent strings together. Proving that it’s safe to do all this in a single pass is straightforward, if tedious.</p>

&lt;figure class="code"&gt;&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;<div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
</pre></td><td class="code"><pre><code class="clojure"><span class="line"><span class="kd">defn </span><span class="nv">set-colour</span> <span class="p">[</span><span class="o">^</span><span class="nv">Board</span> <span class="nv">board</span> <span class="nv">pos</span> <span class="nv">colour</span><span class="p">]</span>
</span><span class="line">  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">string</span> <span class="p">(</span><span class="nf">-&gt;String</span> <span class="nv">colour</span> <span class="mi">0</span><span class="p">)]</span>
</span><span class="line">    <span class="p">(</span><span class="nb">aset </span><span class="p">(</span><span class="nf">.-strings</span> <span class="nv">board</span><span class="p">)</span> <span class="nv">pos</span> <span class="nv">string</span><span class="p">)</span>
</span><span class="line">    <span class="p">(</span><span class="nf">foreach-neighbour</span> <span class="nv">neighbour-pos</span> <span class="nv">pos</span>
</span><span class="line">                       <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">neighbour-string</span> <span class="p">(</span><span class="nb">aget </span><span class="p">(</span><span class="nf">.-strings</span> <span class="nv">board</span><span class="p">)</span> <span class="nv">neighbour-pos</span><span class="p">)</span>
</span><span class="line">                             <span class="nv">neighbour-colour</span> <span class="p">(</span><span class="nf">.-colour</span> <span class="nv">neighbour-string</span><span class="p">)]</span>
</span><span class="line">                         <span class="p">(</span><span class="nf">condp</span> <span class="nv">keyword-identical?</span> <span class="nv">neighbour-colour</span>
</span><span class="line">                           <span class="ss">:empty</span>
</span><span class="line">                           <span class="p">(</span><span class="nf">set!</span> <span class="p">(</span><span class="nf">.-liberties</span> <span class="p">(</span><span class="nb">aget </span><span class="p">(</span><span class="nf">.-strings</span> <span class="nv">board</span><span class="p">)</span> <span class="nv">pos</span><span class="p">))</span> <span class="p">(</span><span class="nb">inc </span><span class="p">(</span><span class="nf">.-liberties</span> <span class="p">(</span><span class="nb">aget </span><span class="p">(</span><span class="nf">.-strings</span> <span class="nv">board</span><span class="p">)</span> <span class="nv">pos</span><span class="p">))))</span>
</span><span class="line">
</span><span class="line">                           <span class="ss">:grey</span>
</span><span class="line">                           <span class="nv">nil</span>
</span><span class="line">
</span><span class="line">                           <span class="nv">colour</span>
</span><span class="line">                           <span class="p">(</span><span class="nf">do</span>
</span><span class="line">                             <span class="p">(</span><span class="nf">set!</span> <span class="p">(</span><span class="nf">.-liberties</span> <span class="nv">neighbour-string</span><span class="p">)</span> <span class="p">(</span><span class="nb">dec </span><span class="p">(</span><span class="nf">.-liberties</span> <span class="nv">neighbour-string</span><span class="p">)))</span>
</span><span class="line">                             <span class="p">(</span><span class="nf">join-strings</span> <span class="nv">board</span> <span class="p">(</span><span class="nb">aget </span><span class="p">(</span><span class="nf">.-strings</span> <span class="nv">board</span><span class="p">)</span> <span class="nv">pos</span><span class="p">)</span> <span class="nv">neighbour-string</span> <span class="nv">pos</span> <span class="nv">neighbour-pos</span><span class="p">))</span>
</span><span class="line">
</span><span class="line">                           <span class="c1">;; opposite colour</span>
</span><span class="line">                           <span class="p">(</span><span class="nf">do</span>
</span><span class="line">                             <span class="p">(</span><span class="nf">set!</span> <span class="p">(</span><span class="nf">.-liberties</span> <span class="nv">neighbour-string</span><span class="p">)</span> <span class="p">(</span><span class="nb">dec </span><span class="p">(</span><span class="nf">.-liberties</span> <span class="nv">neighbour-string</span><span class="p">)))</span>
</span><span class="line">                             <span class="p">(</span><span class="nb">when </span><span class="p">(</span><span class="nb">= </span><span class="mi">0</span> <span class="p">(</span><span class="nf">.-liberties</span> <span class="nv">neighbour-string</span><span class="p">))</span>
</span><span class="line">                               <span class="p">(</span><span class="nf">clear-string</span> <span class="nv">board</span> <span class="nv">neighbour-string</span> <span class="nv">neighbour-pos</span><span class="p">))))))))</span>
</span></code></pre></td></tr></tbody></table></div>&lt;/figure&gt;


<h2>Monte Carlo</h2>

<p>Go branches far too much to exhaustively check all possible futures. Instead we use a heuristic measure of the value of a move – the Monte Carlo estimate of the expected score when both players choose from the set of valid moves uniformly at random. To put it simply, we run large numbers of random games from this board position and take the mean score as our measure of how strong this board position is. Since we don’t have a test for the end of the game we just run until either 100 moves have been made or until both sides have no valid moves remaining.</p>

&lt;figure class="code"&gt;&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;<div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
</pre></td><td class="code"><pre><code class="clojure"><span class="line"><span class="p">(</span><span class="kd">defn </span><span class="nv">flood-fill</span> <span class="p">[</span><span class="nv">board</span> <span class="nv">colour</span><span class="p">]</span>
</span><span class="line">  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">filled</span> <span class="p">(</span><span class="nf">object-array</span> <span class="nv">max-pos</span><span class="p">)]</span>
</span><span class="line">    <span class="p">(</span><span class="nf">letfn</span> <span class="p">[(</span><span class="nf">flood-fill-around</span> <span class="p">[</span><span class="nv">pos</span><span class="p">]</span>
</span><span class="line">              <span class="p">(</span><span class="nf">foreach-neighbour</span> <span class="nv">pos</span> <span class="nv">pos</span>
</span><span class="line">                  <span class="p">(</span><span class="nb">when </span><span class="p">(</span><span class="nb">and </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">aget </span><span class="nv">filled</span> <span class="nv">pos</span><span class="p">))</span>
</span><span class="line">                             <span class="p">(</span><span class="nf">keyword-identical?</span> <span class="ss">:empty</span> <span class="p">(</span><span class="nf">get-colour</span> <span class="nv">board</span> <span class="nv">pos</span><span class="p">)))</span>
</span><span class="line">                    <span class="p">(</span><span class="nb">aset </span><span class="nv">filled</span> <span class="nv">pos</span> <span class="nv">true</span><span class="p">)</span>
</span><span class="line">                    <span class="p">(</span><span class="nf">flood-fill-around</span> <span class="nv">pos</span><span class="p">))))]</span>
</span><span class="line">      <span class="p">(</span><span class="nb">dotimes </span><span class="p">[</span><span class="nv">x</span> <span class="nv">size</span><span class="p">]</span>
</span><span class="line">        <span class="p">(</span><span class="nb">dotimes </span><span class="p">[</span><span class="nv">y</span> <span class="nv">size</span><span class="p">]</span>
</span><span class="line">          <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">pos</span> <span class="p">(</span><span class="nf">-&gt;pos</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)]</span>
</span><span class="line">            <span class="p">(</span><span class="nb">when </span><span class="p">(</span><span class="nf">keyword-identical?</span> <span class="nv">colour</span> <span class="p">(</span><span class="nf">get-colour</span> <span class="nv">board</span> <span class="nv">pos</span><span class="p">))</span>
</span><span class="line">              <span class="p">(</span><span class="nb">aset </span><span class="nv">filled</span> <span class="nv">pos</span> <span class="nv">true</span><span class="p">)</span>
</span><span class="line">              <span class="p">(</span><span class="nf">flood-fill-around</span> <span class="nv">pos</span><span class="p">))))))</span>
</span><span class="line">    <span class="p">(</span><span class="nb">count </span><span class="p">(</span><span class="nb">filter identity </span><span class="nv">filled</span><span class="p">))))</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="kd">defn </span><span class="nv">score</span> <span class="p">[</span><span class="nv">board</span><span class="p">]</span>
</span><span class="line">  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">white-flood</span> <span class="p">(</span><span class="nf">flood-fill</span> <span class="nv">board</span> <span class="ss">:white</span><span class="p">)</span>
</span><span class="line">        <span class="nv">black-flood</span> <span class="p">(</span><span class="nf">flood-fill</span> <span class="nv">board</span> <span class="ss">:black</span><span class="p">)</span>
</span><span class="line">        <span class="nv">total</span> <span class="p">(</span><span class="nb">* </span><span class="nv">size</span> <span class="nv">size</span><span class="p">)</span>
</span><span class="line">        <span class="nv">overlap</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">+ </span><span class="nv">white-flood</span> <span class="nv">black-flood</span><span class="p">)</span> <span class="nv">total</span><span class="p">)</span>
</span><span class="line">        <span class="nv">white-score</span> <span class="p">(</span><span class="nb">- </span><span class="nv">white-flood</span> <span class="nv">overlap</span><span class="p">)</span>
</span><span class="line">        <span class="nv">black-score</span> <span class="p">(</span><span class="nb">- </span><span class="nv">black-flood</span> <span class="nv">overlap</span><span class="p">)]</span>
</span><span class="line">    <span class="p">{</span><span class="ss">:white</span> <span class="nv">white-score</span> <span class="ss">:black</span> <span class="nv">black-score</span><span class="p">}))</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="kd">defn </span><span class="nv">random-move</span> <span class="p">[</span><span class="nv">board</span> <span class="nv">colour</span><span class="p">]</span>
</span><span class="line">  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">starting-pos</span> <span class="p">(</span><span class="nf">random-int</span> <span class="nv">board/max-pos</span><span class="p">)]</span>
</span><span class="line">    <span class="p">(</span><span class="k">loop </span><span class="p">[</span><span class="nv">pos</span> <span class="nv">starting-pos</span><span class="p">]</span>
</span><span class="line">      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">and </span><span class="p">(</span><span class="nf">board/valid?</span> <span class="nv">board</span> <span class="nv">colour</span> <span class="nv">pos</span><span class="p">)</span>
</span><span class="line">               <span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nf">board/eyelike?</span> <span class="nv">board</span> <span class="nv">colour</span> <span class="nv">pos</span><span class="p">)))</span>
</span><span class="line">        <span class="nv">pos</span>
</span><span class="line">        <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">new-pos</span> <span class="p">(</span><span class="nf">mod</span> <span class="p">(</span><span class="nb">inc </span><span class="nv">pos</span><span class="p">)</span> <span class="nv">board/max-pos</span><span class="p">)]</span>
</span><span class="line">          <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">starting-pos</span> <span class="nv">new-pos</span><span class="p">)</span>
</span><span class="line">            <span class="nv">nil</span>
</span><span class="line">            <span class="p">(</span><span class="nf">recur</span> <span class="nv">new-pos</span><span class="p">)))))))</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="kd">defn </span><span class="nv">with-random-moves</span> <span class="p">[</span><span class="nv">board</span> <span class="nv">n</span> <span class="nv">starting-colour</span><span class="p">]</span>
</span><span class="line">  <span class="p">(</span><span class="nb">doseq </span><span class="p">[</span><span class="nv">colour</span> <span class="p">(</span><span class="nb">take </span><span class="nv">n</span> <span class="p">(</span><span class="nb">interleave </span><span class="p">(</span><span class="nb">repeat </span><span class="nv">starting-colour</span><span class="p">)</span> <span class="p">(</span><span class="nb">repeat </span><span class="p">(</span><span class="nf">board/opposite-colour</span> <span class="nv">starting-colour</span><span class="p">))))]</span>
</span><span class="line">      <span class="p">(</span><span class="nb">when-let </span><span class="p">[</span><span class="nv">move</span> <span class="p">(</span><span class="nf">random-move</span> <span class="nv">board</span> <span class="nv">colour</span><span class="p">)]</span>
</span><span class="line">        <span class="p">(</span><span class="nf">board/set-colour</span> <span class="nv">board</span> <span class="nv">move</span> <span class="nv">colour</span><span class="p">)))</span>
</span><span class="line">  <span class="nv">board</span><span class="p">)</span>
</span></code></pre></td></tr></tbody></table></div>&lt;/figure&gt;


<p>You may notice that the above code actually only runs until one side has no moves – this is the first of many bugs.</p>

<p>The scoring and random-move code was a huge bottleneck so at the last minute I ‘optimised’ it by changing it to:</p>

&lt;figure class="code"&gt;&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;<div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
</pre></td><td class="code"><pre><code class="clojure"><span class="line"><span class="c1">;; rough approximation of the final score if the board is tightly packed</span>
</span><span class="line"><span class="p">(</span><span class="kd">defn </span><span class="nv">score</span> <span class="p">[</span><span class="nv">board</span> <span class="nv">colour</span><span class="p">]</span>
</span><span class="line">  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">score</span> <span class="p">(</span><span class="nf">atom</span> <span class="mi">0</span><span class="p">)]</span>
</span><span class="line">    <span class="p">(</span><span class="nb">dotimes </span><span class="p">[</span><span class="nv">pos</span> <span class="nv">board/max-pos</span><span class="p">]</span>
</span><span class="line">      <span class="p">(</span><span class="nb">when </span><span class="p">(</span><span class="nf">keyword-identical?</span> <span class="nv">colour</span> <span class="p">(</span><span class="nf">board/get-colour</span> <span class="nv">board</span> <span class="nv">pos</span><span class="p">))</span>
</span><span class="line">        <span class="p">(</span><span class="nf">swap!</span> <span class="nv">score</span> <span class="nv">inc</span><span class="p">)))</span>
</span><span class="line">    <span class="err">@</span><span class="nv">score</span><span class="p">))</span>
</span><span class="line">
</span><span class="line"><span class="c1">;; massive speedup at the expense of never playing in killed spaces</span>
</span><span class="line"><span class="p">(</span><span class="kd">defn </span><span class="nv">with-random-moves-from</span> <span class="p">[</span><span class="nv">board</span> <span class="nv">n</span> <span class="nv">starting-colour</span> <span class="nv">moves</span><span class="p">]</span>
</span><span class="line">  <span class="p">(</span><span class="nf">js/goog.array.shuffle</span> <span class="nv">moves</span><span class="p">)</span>
</span><span class="line">  <span class="p">(</span><span class="k">loop </span><span class="p">[</span><span class="nv">colour</span> <span class="nv">starting-colour</span><span class="p">]</span>
</span><span class="line">    <span class="p">(</span><span class="nb">if-let </span><span class="p">[</span><span class="nv">move</span> <span class="p">(</span><span class="nf">.pop</span> <span class="nv">moves</span><span class="p">)]</span>
</span><span class="line">      <span class="p">(</span><span class="nf">board/set-colour</span> <span class="nv">board</span> <span class="nv">move</span> <span class="nv">colour</span><span class="p">)</span>
</span><span class="line">      <span class="p">(</span><span class="nf">recur</span> <span class="p">(</span><span class="nf">board/opposite-colour</span> <span class="nv">colour</span><span class="p">))))</span>
</span><span class="line">  <span class="nv">board</span><span class="p">)</span>
</span></code></pre></td></tr></tbody></table></div>&lt;/figure&gt;


<p>I think it is these two changes that are largely responsible for the submitted version playing so poorly – it doesn’t check for eyes in the random playouts, doesn’t allow the other player to keep killing strings when the ai player has no moves and doesn’t count eyes in the final score. This explains why it likes to tightly pack pieces against the edge of the board.</p>

<h2>UCT</h2>

<p>While the monte-carlo estimate gives us a reasonable heuristic for move strength it doesn’t re-use any information between passes. With such a large move space we need to explore more intelligently. The <a href="http://teytaud.over-blog.com/article-35709049.html">UCT</a> algorithm treats move-selection like a <a href="http://en.wikipedia.org/wiki/Multi-armed_bandit">multi-armed bandit problem</a>.</p>

&lt;iframe allowfullscreen="allowfullscreen" frameborder="0" height="360" src="http://scattered-thoughts.net//www.youtube.com/embed/dbvoPg51CqQ?feature=player_embedded" width="640"&gt;video&lt;/iframe&gt;


<p>We build a tree of moves where each node in the tree tracks not just the estimated score for all its child nodes but also the upper bound of a confidence interval on that estimate.</p>

&lt;figure class="code"&gt;&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;<div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="clojure"><span class="line"><span class="p">(</span><span class="kd">defrecord </span><span class="nv">Node</span> <span class="p">[</span><span class="nv">parent</span> <span class="nv">colour</span> <span class="nv">pos</span> <span class="nb">count </span><span class="nv">sum</span> <span class="nv">nodes</span> <span class="nv">valids</span><span class="p">])</span>
</span></code></pre></td></tr></tbody></table></div>&lt;/figure&gt;


<p><code>colour</code> is the colour making the move at this node. <code>pos</code> is the position at which it is moving. <code>nodes</code> is a list of child nodes for which we have estimates. <code>valids</code> is a list of valid moves which have not yet been converted into nodes. <code>count</code> and <code>sum</code> track the mean score for all the children in <code>nodes</code>.</p>

<p>On each iteration we pick a path through the tree, choosing some explore/exploit tradeoff using the upper confidence bounds. Given the limited time we had, I decided to just copy a scoring function from a paper without stopping to understand it, so I don’t actually know what explore/exploit tradeoff we are making :S</p>

&lt;figure class="code"&gt;&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;<div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
</pre></td><td class="code"><pre><code class="clojure"><span class="line"><span class="p">(</span><span class="kd">defn </span><span class="nv">best-child</span> <span class="p">[</span><span class="nv">node</span><span class="p">]</span>
</span><span class="line">  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">best-score</span> <span class="p">(</span><span class="nf">atom</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">/ </span><span class="mi">1</span> <span class="mi">0</span><span class="p">)))</span>
</span><span class="line">        <span class="nv">best-child</span> <span class="p">(</span><span class="nf">atom</span> <span class="nv">nil</span><span class="p">)]</span>
</span><span class="line">    <span class="p">(</span><span class="nb">doseq </span><span class="p">[</span><span class="nv">child</span> <span class="p">(</span><span class="nf">.-nodes</span> <span class="nv">node</span><span class="p">)]</span>
</span><span class="line">      <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">score</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">.-sum</span> <span class="nv">child</span><span class="p">)</span> <span class="p">(</span><span class="nf">.-count</span> <span class="nv">child</span><span class="p">))</span>
</span><span class="line">                     <span class="p">(</span><span class="nf">js/Math.sqrt</span>
</span><span class="line">                      <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">* </span><span class="mi">2</span> <span class="p">(</span><span class="nf">js/Math.log</span> <span class="p">(</span><span class="nf">.-count</span> <span class="nv">node</span><span class="p">)))</span>
</span><span class="line">                         <span class="p">(</span><span class="nb">* </span><span class="mi">5</span> <span class="p">(</span><span class="nf">.-count</span> <span class="nv">child</span><span class="p">)))))]</span>
</span><span class="line">        <span class="p">(</span><span class="nb">when </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">score</span> <span class="err">@</span><span class="nv">best-score</span><span class="p">)</span>
</span><span class="line">          <span class="p">(</span><span class="nf">reset!</span> <span class="nv">best-score</span> <span class="nv">score</span><span class="p">)</span>
</span><span class="line">          <span class="p">(</span><span class="nf">reset!</span> <span class="nv">best-child</span> <span class="nv">child</span><span class="p">))))</span>
</span><span class="line">    <span class="err">@</span><span class="nv">best-child</span><span class="p">))</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="kd">defn </span><span class="nv">expand</span> <span class="p">[</span><span class="nv">board</span> <span class="nb">node </span><span class="nv">ai-colour</span><span class="p">]</span>
</span><span class="line">  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">pos</span> <span class="p">(</span><span class="nf">.-pos</span> <span class="nv">node</span><span class="p">)]</span>
</span><span class="line">    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not= </span><span class="mi">0</span> <span class="nv">pos</span><span class="p">)</span> <span class="c1">;; top node has pos 0 - probably a smell</span>
</span><span class="line">      <span class="p">(</span><span class="nf">board/set-colour</span> <span class="nv">board</span> <span class="nv">pos</span> <span class="p">(</span><span class="nf">.-colour</span> <span class="nv">node</span><span class="p">))))</span>
</span><span class="line">  <span class="p">(</span><span class="nb">if-let </span><span class="p">[</span><span class="nv">valid-pos</span> <span class="p">(</span><span class="nf">.pop</span> <span class="p">(</span><span class="nf">.-valids</span> <span class="nv">node</span><span class="p">))]</span>
</span><span class="line">    <span class="p">(</span><span class="nf">.push</span> <span class="p">(</span><span class="nf">.-nodes</span> <span class="nv">node</span><span class="p">)</span> <span class="p">(</span><span class="nf">expand-leaf</span> <span class="nv">board</span> <span class="nv">ai-colour</span> <span class="nb">node </span><span class="p">(</span><span class="nf">board/opposite-colour</span> <span class="p">(</span><span class="nf">.-colour</span> <span class="nv">node</span><span class="p">))</span> <span class="nv">valid-pos</span><span class="p">))</span>
</span><span class="line">    <span class="p">(</span><span class="nb">if-let </span><span class="p">[</span><span class="nv">child</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nf">.-colour</span> <span class="nv">node</span><span class="p">)</span> <span class="nv">ai-colour</span><span class="p">)</span>
</span><span class="line">                     <span class="p">(</span><span class="nf">worst-child</span> <span class="nv">node</span><span class="p">)</span>
</span><span class="line">                     <span class="p">(</span><span class="nf">best-child</span> <span class="nv">node</span><span class="p">))]</span>
</span><span class="line">      <span class="p">(</span><span class="nf">expand</span> <span class="nv">board</span> <span class="nv">child</span> <span class="nv">ai-colour</span><span class="p">)</span>
</span><span class="line">      <span class="nv">nil</span> <span class="c1">;; no possible moves - pass</span>
</span><span class="line">      <span class="p">)))</span>
</span></code></pre></td></tr></tbody></table></div>&lt;/figure&gt;


<p>On reaching a leaf we extend it by one more move, estimate the value of that move using monte-carlo simulations and then propagate the value back up the path to the top of tree.</p>

&lt;figure class="code"&gt;&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;<div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="clojure"><span class="line"><span class="p">(</span><span class="kd">defn </span><span class="nv">expand-leaf</span> <span class="p">[</span><span class="nv">board</span> <span class="nv">ai-colour</span> <span class="nv">parent</span> <span class="nv">colour</span> <span class="nv">pos</span><span class="p">]</span>
</span><span class="line">  <span class="p">(</span><span class="nf">board/set-colour</span> <span class="nv">board</span> <span class="nv">pos</span> <span class="nv">colour</span><span class="p">)</span>
</span><span class="line">  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">valids</span> <span class="p">(</span><span class="nf">valids</span> <span class="nv">board</span> <span class="p">(</span><span class="nf">board/opposite-colour</span> <span class="nv">colour</span><span class="p">))]</span>
</span><span class="line">    <span class="p">(</span><span class="nf">random/with-random-moves-from</span> <span class="nv">board</span> <span class="mi">100</span> <span class="p">(</span><span class="nf">board/opposite-colour</span> <span class="nv">colour</span><span class="p">)</span> <span class="p">(</span><span class="nf">aclone</span> <span class="nv">valids</span><span class="p">))</span>
</span><span class="line">    <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">value</span> <span class="p">(</span><span class="nf">value</span> <span class="nv">board</span> <span class="nv">ai-colour</span><span class="p">)]</span>
</span><span class="line">      <span class="p">(</span><span class="nf">add-value</span> <span class="nv">parent</span> <span class="nv">value</span><span class="p">)</span>
</span><span class="line">      <span class="p">(</span><span class="nf">-&gt;Node</span> <span class="nv">parent</span> <span class="nv">colour</span> <span class="nv">pos</span> <span class="mi">1</span> <span class="nv">value</span> <span class="p">(</span><span class="nf">object-array</span> <span class="mi">0</span><span class="p">)</span> <span class="nv">valids</span><span class="p">))))</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="kd">defn </span><span class="nv">add-value</span> <span class="p">[</span><span class="nb">node </span><span class="nv">value</span><span class="p">]</span>
</span><span class="line">  <span class="p">(</span><span class="nf">set!</span> <span class="p">(</span><span class="nf">.-count</span> <span class="nv">node</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">.-count</span> <span class="nv">node</span><span class="p">)</span> <span class="mi">1</span><span class="p">))</span>
</span><span class="line">  <span class="p">(</span><span class="nf">set!</span> <span class="p">(</span><span class="nf">.-sum</span> <span class="nv">node</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">.-sum</span> <span class="nv">node</span><span class="p">)</span> <span class="nv">value</span><span class="p">))</span>
</span><span class="line">  <span class="p">(</span><span class="nb">if-let </span><span class="p">[</span><span class="nv">parent</span> <span class="p">(</span><span class="nf">.-parent</span> <span class="nv">node</span><span class="p">)]</span>
</span><span class="line">    <span class="p">(</span><span class="nf">recur</span> <span class="nv">parent</span> <span class="nv">value</span><span class="p">)))</span>
</span></code></pre></td></tr></tbody></table></div>&lt;/figure&gt;


<p>Finally, the ai chooses its move by running a number of iterations of this algorithm and returning the value of <code>best-child</code> at the root (this is probably wrong – at this point we should just exploit, not explore).</p>

&lt;figure class="code"&gt;&lt;figcaption&gt;<span></span>&lt;/figcaption&gt;<div class="highlight"><table><tbody><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="clojure"><span class="line"><span class="p">(</span><span class="kd">defn </span><span class="nv">move-for</span> <span class="p">[</span><span class="nv">board</span> <span class="nv">colour</span> <span class="nv">n</span><span class="p">]</span>
</span><span class="line">  <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nb">node </span><span class="p">(</span><span class="nf">hugo-a-go-go.tree/new</span> <span class="p">(</span><span class="nf">board/copy</span> <span class="nv">board</span><span class="p">)</span> <span class="nv">colour</span><span class="p">)]</span>
</span><span class="line">    <span class="p">(</span><span class="nb">dotimes </span><span class="p">[</span><span class="nv">_</span> <span class="nv">n</span><span class="p">]</span>
</span><span class="line">      <span class="p">(</span><span class="nf">expand</span> <span class="p">(</span><span class="nf">board/copy</span> <span class="nv">board</span><span class="p">)</span> <span class="nb">node </span><span class="nv">colour</span><span class="p">))</span>
</span><span class="line">    <span class="p">(</span><span class="nb">when-let </span><span class="p">[</span><span class="nv">child</span> <span class="p">(</span><span class="nf">best-child</span> <span class="nv">node</span><span class="p">)]</span>
</span><span class="line">      <span class="p">(</span><span class="nf">.-pos</span> <span class="nv">child</span><span class="p">))))</span>
</span></code></pre></td></tr></tbody></table></div>&lt;/figure&gt;


<h2>Postmortem</h2>

<p>Together we spent around 20 man-hours on the competition. I spent the first two thirds of the competition just getting the board representation to work correctly. Part of the delay was that after moving to a cljs-only implementation the feedback loop was much slower. I wasted an hour or two tring to get brepl working without any success and after that had to rely on print statements and pre-compiled test cases. Finding errors in cljs also leaves a lot to be desired (eg a typo in a field name resulted in an <code>undefined</code> value which, several functions later, became a <code>NaN</code> which then behaves interestingly inside max/min). I only started on the UCT code an hour or two before the deadline. Tom started on the user input around the same time. We played our first game against the ai about five minutes before the deadline and frantically submitted whatever code we had running.</p>

<p>If we were taking it more seriously we certainly could have done a lot more to prepare – being familiar with the cljs dev tools, actually learning the rules of go, sketching out the board representation and the UCT implementation before the weekend started, not walking a marathon on the same weekend. But winning was not the goal and instead we had a lot of fun and excitement seeing just how much we can hack together in such a short space of time.</p>

<p>Our AI is definitely not correct so it’s difficult to evaluate the project yet. The code is relatively short and simple (especially compared to eg <a href="http://git.savannah.gnu.org/cgit/gnugo.git/tree/engine">gnugo</a>) but that doesn’t mean much until it actually works. The performance is promising – the current version can simulate around 5k games per second in chrome. Fixing the monte-carlo step and the scoring will eat into that performance but I’ve already spotted plenty of inefficiencies in other places. We haven’t even started experimenting with <a href="https://github.com/ztellman/vertigo">vertigo</a> or <a href="http://asmjs.org/">asm.js</a> yet so there is certainly lots of headroom.</p>

<p>I am definitely hoping to come back to this project. To echo <a href="http://www.youtube.com/watch?v=v5dYE0CMmHQ">Zach Tellman’s motivation</a>, it will be really interesting to see if it is possible to write a competitive go AI in a high-level language. We’ve also thought about distributing the UCT step and have team games pitching the aggregated wisdom of a group of human players voting on their next move against the assembled computing power of their browsing machines.</p><a onclick="switchContent('post6','post5')" class="btn" href="#b341d9862dfecfd9d18039bdfdb01f31">Hide</a></div></span>
<a name="44d016d52953714656621700da80c74d"></a><span class="rss-header"><span class="rss-title"><a href="http://anil.recoil.org/2013/10/06/travis-secure-ssh-integration.html"> Using Travis for secure deployments with SSH</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Anil Madhavapeddy</span>, <span class="rss-date">05 Oct 2013</span></span><span class="rss-description"><div id="post7"><a href="http://travis-ci.org"><img src="http://anil.recoil.org/images/travis-mascot-200px.png" style="padding-left: 15px; float: right;"/></a>
<p>In my <a href="http://anil.recoil.org/2013/09/30/travis-and-ocaml.html">previous post</a> on Travis, I explained how it can be used to easily test OCaml packages on GitHub without having to host any infrastructure yourself.</p>

<p>The next step I wanted to investigate was how to use Travis to trigger service deployments after a successful build. One nice feature that Travis has is <a href="http://about.travis-ci.org/docs/user/encryption-keys/">support for encrypted environment variables</a>. The basic workflow is that you encrypt key/value pairs using a public key that they publish per GitHub repository. Once registered, this is made available as a decrypted environment variable within the Travis worker. You can use this to transmit API keys or other authentication data that you need to commit to the <code>travis.yml</code> file, but obviously can’t leave on a public repository for the world to see.</p>

<a onclick="switchContent('post7','post8')" class="btn" href="#44d016d52953714656621700da80c74d">Read more...</a></div><div id="post8" style="display: none"><a href="http://travis-ci.org"><img src="http://anil.recoil.org/images/travis-mascot-200px.png" style="padding-left: 15px; float: right;"/></a>
<p>In my <a href="http://anil.recoil.org/2013/09/30/travis-and-ocaml.html">previous post</a> on Travis, I explained how it can be used to easily test OCaml packages on GitHub without having to host any infrastructure yourself.</p>

<p>The next step I wanted to investigate was how to use Travis to trigger service deployments after a successful build. One nice feature that Travis has is <a href="http://about.travis-ci.org/docs/user/encryption-keys/">support for encrypted environment variables</a>. The basic workflow is that you encrypt key/value pairs using a public key that they publish per GitHub repository. Once registered, this is made available as a decrypted environment variable within the Travis worker. You can use this to transmit API keys or other authentication data that you need to commit to the <code>travis.yml</code> file, but obviously can’t leave on a public repository for the world to see.</p>

<p>The small hitch with this whole scheme is that there’s a very small limit of about 90 bytes or so for the size of each individual environment variable that’s exported, and so you can’t just stash an SSH private key in there. Instead, it needs to be Base64 encoded, split it up into multiple environment variables of the right size, and then reassembled within the Travis VM. Rather than deal with importable shell scripts between MacOS X and Linux, I created a small <code>travis-senv</code> command-line binary to make this easier.</p>

<p>To use it, just <code>opam install travis-senv</code> and follow the instructions on the <a href="https://github.com/avsm/travis-senv">README at the homepage</a>. Here’s the fragment of shell script that pushes the build output to another GitHub repository:</p>
<div class="highlight"><pre><code class="sh"><span class="k">if</span> <span class="o">[</span> <span class="s2">"$DEPLOY"</span> <span class="o">=</span> <span class="s2">"1"</span> <span class="o">]</span>; <span class="k">then</span>
  <span class="c"># get the secure key out for deployment</span>
  opam install travis-senv
  mkdir -p ~/.ssh
  <span class="nv">SSH_DEPLOY_KEY</span><span class="o">=</span>~/.ssh/id_dsa
  travis-senv decrypt &gt; <span class="nv">$SSH_DEPLOY_KEY</span>
  chmod 600 <span class="nv">$SSH_DEPLOY_KEY</span>
  <span class="nb">echo</span> <span class="s2">"Host mirdeploy github.com"</span> &gt;&gt; ~/.ssh/config
  <span class="nb">echo</span> <span class="s2">"   Hostname github.com"</span> &gt;&gt; ~/.ssh/config
  <span class="nb">echo</span> <span class="s2">"   StrictHostKeyChecking no"</span> &gt;&gt; ~/.ssh/config
  <span class="nb">echo</span> <span class="s2">"   CheckHostIP no"</span> &gt;&gt; ~/.ssh/config
  <span class="nb">echo</span> <span class="s2">"   UserKnownHostsFile=/dev/null"</span> &gt;&gt; ~/.ssh/config
  git config --global user.email <span class="s2">"travis@openmirage.org"</span>
  git config --global user.name <span class="s2">"Travis the Build Bot"</span>
  git clone git@mirdeploy:mirage/mirage-www-deployment
  <span class="nb">cd </span>mirage-www-deployment
  mkdir -p xen/<span class="nv">$TRAVIS_COMMIT</span>
  cp ../src/mir-www.xen ../src/mir-www.map ../src/www.conf xen/<span class="nv">$TRAVIS_COMMIT</span>
  bzip2 -9 xen/<span class="nv">$TRAVIS_COMMIT</span>/mir-www.xen
  git pull --rebase
  git add xen/<span class="nv">$TRAVIS_COMMIT</span>
  git commit -m <span class="s2">"adding $TRAVIS_COMMIT"</span>
  git push
<span class="k">fi</span>
</code></pre></div>
<p>I’ve been using this to automate the construction of the <a href="http://openmirage.org">Mirage Xen unikernel</a> homepage. Every time there’s a push to the <a href="https://github.com/mirage/mirage-www">mirage-www</a>, the <a href="https://github.com/mirage/mirage-www/blob/master/.travis-ci.sh">Travis scripts</a> now retrieve an SSH deployment key using <code>travis-senv</code>, and push the results of the build to the <a href="https://github.com/mirage/mirage-www-deployment">mirage-www-deployment</a> repository that stores the build output. This repository is polled by the hosting machines we have to look for new kernels and rotate the website (but more on this later – I’m just integrating the EC2 and Rackspace scripts to remove this step entirely next!)</p><a onclick="switchContent('post8','post7')" class="btn" href="#44d016d52953714656621700da80c74d">Hide</a></div></span>
<a name="3be72f200d01294717a4640003afe9ff"></a><span class="rss-header"><span class="rss-title"><a href="https://forge.ocamlcore.org/forum/forum.php?forum_id=887"> SSL up again, special thanks to Gabriel Kerneis</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">OCamlCore Forge News</span>, <span class="rss-date">01 Oct 2013</span></span><span class="rss-description"><pre class="rss-text">Hi,

I was a little bit lazy and I have unfortunately let the SSL certificate expired two days ago. I was somehow busy releasing OUnit 2.0 ;-)

The good news is that thanks to the suggestion of G. Kerneis in my previous post, I got a couple of new free SSL certificate from StartSSL. This is a very good news because this CA is well known (tested on Debian Wheezy and my Android Phone), so it means that we have the same level of recognition that we have before.

The other good news is that at each iteration of the SSL renewal process, I learn new things! This time I learn about SSL/SNI extension that allows to have multiple certificate to handle each apache virtual host. This means that now https://forge.ocamlcore.org and https://lists.forge.ocamlcore.org are both using valid certificate.

Enjoy
Sylvain</pre></span>
<a name="403fcdb04b4f43f4dcaec4d1bdbe2823"></a><span class="rss-header"><span class="rss-title"><a href="http://erratique.ch/software"> Uucd 1.0.0 and Uunf 0.9.2</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Daniel Bünzli</span>, <span class="rss-date">01 Oct 2013</span></span><span class="rss-description"><p>Release of Uucd and Uunf to support Unicode 6.3.0. Consult the individual release notes for details.</p></span>
<a name="7dea5ef655297aa9dc8b78dd3c5ff9f5"></a><span class="rss-header"><span class="rss-title"><a href="http://alan.petitepomme.net/cwn/2013.10.01.html"> Caml Weekly News, 01 Oct 2013</a></span>&nbsp;&mdash;&nbsp;<span class="rss-author">Caml Weekly News</span>, <span class="rss-date">01 Oct 2013</span></span><span class="rss-description">Feedback on the ocaml.org redesign and logo / Enhanced OCaml Documentation 4.01 / Gg 0.8.0 and Vg 0.8.0 / otags reloaded 4.01.1 for OCaml 4.01 / meetup OCaml-Pairs (OUPS), mercredi 9 octobre √† l'IRILL / embedding js_of_ocaml output? / OUnit v2.0.0 / Thread behaviour / Esterel Technologies is looking for an Ocaml SW developer in Toulouse (CDI) / equivalent checking of ocaml program? / LablGtk 2.18.0 and LablGL 1.05 / Uucd 1.0.0 &amp; Uunf 0.9.2 / Other Caml News</span>
<script type="text/javascript">function switchContent(id1,id2) {
     // Get the DOM reference
     var contentId1 = document.getElementById(id1);
     var contentId2 = document.getElementById(id2);
     // Toggle
     contentId1.style.display = "none";
     contentId2.style.display = "block";
     }</script></div>

  
    </div>

    
    <br/>
    <hr/>
    <div id="footer">
      Contribute to this project!
      Find us on <a href="https://github.com/ocaml/ocaml.org">Github</a>.
    </div>
    <span title=".././img/ = image directory from the base of the site"></span>


    
    
    

    <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
    <script src=".././js/jquery-1.8.0.min.js"></script>
    
    <script src=".././js/bootstrap.js"></script>

    <script type="text/javascript">
      var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-22552764-2']); _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-37808023-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

    </script>

</body></html>
